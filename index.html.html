<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¢ í†µí•© ìš”ì²­ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    
    <!-- PWA ì„¤ì • -->
    <meta name="description" content="êµ¬ë§¤ ìš”ì²­ ë° ì‹œì„¤ ê´€ë¦¬ í†µí•© í”Œë«í¼">
    <meta name="theme-color" content="#3b82f6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ìš”ì²­ê´€ë¦¬">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- ë§¤ë‹ˆí˜ìŠ¤íŠ¸ íŒŒì¼ -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, updateDoc, doc, deleteDoc, getDocs } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getAuth, signInAnonymously, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        
        // Firebase ì„¤ì • (ì‚¬ìš©ìê°€ ì‹¤ì œ í”„ë¡œì íŠ¸ ì„¤ì •ìœ¼ë¡œ êµì²´í•´ì•¼ í•¨)
        const firebaseConfig = {
            apiKey: "your-api-key-here",
            authDomain: "your-project.firebaseapp.com",
            projectId: "your-project-id",
            storageBucket: "your-project.appspot.com",
            messagingSenderId: "123456789",
            appId: "your-app-id"
        };
        
        // Firebase ì´ˆê¸°í™”
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        
        // ì „ì—­ ë³€ìˆ˜ë¡œ ì„¤ì •
        window.firebaseDB = db;
        window.firebaseAuth = auth;
        
        console.log('ğŸ”¥ Firebase ì´ˆê¸°í™” ì™„ë£Œ');
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            opacity: 0;
            animation: fadeIn 0.5s ease-in-out forwards;
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 2rem;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header h1 {
            color: white;
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.1rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            margin-bottom: 2rem;
            overflow: hidden;
        }

        .tab {
            flex: 1;
            padding: 1rem 2rem;
            background: transparent;
            border: none;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            font-weight: 600;
        }

        .tab:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .tab.active {
            background: rgba(255, 255, 255, 0.2);
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.1);
        }

        .tab-content {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: slideIn 0.3s ease-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            color: #374151;
            font-weight: 600;
        }

        input, select, textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
            color: white;
            padding: 0.75rem 2rem;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4);
        }

        .alert {
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            animation: slideIn 0.3s ease-out;
        }

        .alert.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }

        .alert.error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }

        .admin-tabs {
            display: flex;
            margin-bottom: 2rem;
        }

        .admin-sub-tab {
            padding: 0.75rem 1.5rem;
            background: #f3f4f6;
            border: none;
            cursor: pointer;
            margin-right: 0.5rem;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .admin-sub-tab.active {
            background: #3b82f6;
            color: white;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        th, td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }

        th {
            background: #f9fafb;
            font-weight: 600;
            color: #374151;
        }

        tr:hover {
            background: #f9fafb;
        }

        .badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .status-pending { background: #fef3c7; color: #92400e; }
        .status-progress { background: #dbeafe; color: #1e40af; }
        .status-completed { background: #d1fae5; color: #065f46; }
        .status-cancelled { background: #fee2e2; color: #991b1b; }

        .priority-urgent { background: #fee2e2; color: #991b1b; }
        .priority-high { background: #fed7d7; color: #c53030; }
        .priority-normal { background: #e2e8f0; color: #4a5568; }
        .priority-low { background: #f0fff4; color: #38a169; }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 15px;
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .clickable-row {
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .clickable-row:hover {
            background: #f3f4f6 !important;
            transform: translateY(-1px);
        }

        .file-upload {
            border: 2px dashed #d1d5db;
            border-radius: 10px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .file-upload:hover {
            border-color: #3b82f6;
            background: #f8fafc;
        }

        .file-upload.dragover {
            border-color: #3b82f6;
            background: #eff6ff;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <!-- í—¤ë” -->
    <header class="header">
        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;">
            <div>
                <h1>ğŸ¢ í†µí•© ìš”ì²­ ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
                <p>êµ¬ë§¤ ìš”ì²­ ë° ì‹œì„¤ ê´€ë¦¬ í†µí•© í”Œë«í¼</p>
            </div>
            <div id="sync-status" style="background: rgba(255, 255, 255, 0.1); padding: 0.5rem 1rem; border-radius: 20px; backdrop-filter: blur(10px); min-width: 150px; text-align: center;">
                <span style="color: #f59e0b;">ğŸ”„</span>
                <span style="font-size: 0.8rem; margin-left: 0.25rem;">ì—°ê²° ì¤‘...</span>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- íƒ­ ë©”ë‰´ -->
        <div class="tabs">
            <button class="tab active" onclick="showTab('purchase')">
                <span style="font-size: 1.2rem;">ğŸ›’</span><br>êµ¬ë§¤ ìš”ì²­
            </button>
            <button class="tab" onclick="showTab('facility')">
                <span style="font-size: 1.2rem;">ğŸ”§</span><br>ì‹œì„¤ ê´€ë¦¬
            </button>
            <button class="tab" onclick="showTab('admin')" id="admin-tab">
                <span style="font-size: 1.2rem;">ğŸ‘¨â€ğŸ’¼</span><br>ê´€ë¦¬ì
            </button>
        </div>

        <!-- êµ¬ë§¤ ìš”ì²­ íƒ­ -->
        <div id="purchase-tab" class="tab-content active">
            <h2 style="color: #1f2937; margin-bottom: 2rem;">
                <span style="font-size: 2rem;">ğŸ›’</span> êµ¬ë§¤ ìš”ì²­ ë“±ë¡
            </h2>
            
            <form id="purchase-form" onsubmit="submitPurchaseRequest(event)">
                <div class="form-group">
                    <label for="purchase-title">
                        <span style="font-size: 1.2rem;">ğŸ“</span> ìš”ì²­ ì œëª© *
                    </label>
                    <input type="text" id="purchase-title" name="title" placeholder="ì˜ˆ: ì‚¬ë¬´ìš©í’ˆ êµ¬ë§¤ ìš”ì²­" required>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label for="purchase-department">
                            <span style="font-size: 1.2rem;">ğŸ¢</span> ë¶€ì„œ *
                        </label>
                        <input type="text" id="purchase-department" name="department" placeholder="ì˜ˆ: ITíŒ€" required>
                    </div>
                    <div class="form-group">
                        <label for="purchase-requester">
                            <span style="font-size: 1.2rem;">ğŸ‘¤</span> ìš”ì²­ì *
                        </label>
                        <input type="text" id="purchase-requester" name="requestedBy" placeholder="í™ê¸¸ë™" required>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label for="purchase-item">
                            <span style="font-size: 1.2rem;">ğŸ“¦</span> ë¬¼í’ˆëª… *
                        </label>
                        <input type="text" id="purchase-item" name="item" placeholder="ì˜ˆ: A4 ìš©ì§€, ë³¼íœ ì„¸íŠ¸" required>
                    </div>
                    <div class="form-group">
                        <label for="purchase-quantity">
                            <span style="font-size: 1.2rem;">ğŸ“¦</span> ìˆ˜ëŸ‰ *
                        </label>
                        <input type="text" id="purchase-quantity" name="quantity" placeholder="ì˜ˆ: 5ê°œ, 1ë°•ìŠ¤, 10ì„¸íŠ¸, 1ì‹" required>
                    </div>
                    <div class="form-group">
                        <label for="purchase-budget">
                            <span style="font-size: 1.2rem;">ğŸ’°</span> ì˜ˆì‚° (ì›) *
                        </label>
                        <input type="number" id="purchase-budget" name="budget" placeholder="ì˜ˆ: 500000, 1000000" min="1" step="1000" required>
                    </div>
                </div>

                <div class="form-group">
                    <label for="purchase-priority">
                        <span style="font-size: 1.2rem;">â­</span> ìš°ì„ ìˆœìœ„
                    </label>
                    <select id="purchase-priority" name="priority">
                        <option value="ë‚®ìŒ">ë‚®ìŒ</option>
                        <option value="ë³´í†µ" selected>ë³´í†µ</option>
                        <option value="ë†’ìŒ">ë†’ìŒ</option>
                        <option value="ê¸´ê¸‰">ê¸´ê¸‰</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="purchase-reason">
                        <span style="font-size: 1.2rem;">ğŸ“</span> êµ¬ë§¤ ì‚¬ìœ  *
                    </label>
                    <textarea id="purchase-reason" name="reason" rows="4" placeholder="êµ¬ë§¤ê°€ í•„ìš”í•œ ì´ìœ ë¥¼ ìƒì„¸íˆ ì‘ì„±í•´ì£¼ì„¸ìš”." required></textarea>
                </div>

                <div class="form-group">
                    <label>
                        <span style="font-size: 1.2rem;">ğŸ“</span> ê²¬ì ì„œ ì²¨ë¶€ (ì„ íƒ)
                    </label>
                    <div class="file-upload" onclick="document.getElementById('quote-file').click()">
                        <input type="file" id="quote-file" accept=".pdf,.xlsx,.xls,.hwp" style="display: none;" onchange="handleQuoteFile(event)">
                        <p><span style="font-size: 2rem;">ğŸ“</span></p>
                        <p>PDF, Excel, í•œê¸€ íŒŒì¼ì„ ì„ íƒí•˜ê±°ë‚˜ ì—¬ê¸°ì— ë“œë˜ê·¸í•˜ì„¸ìš”</p>
                        <p style="font-size: 0.9rem; color: #6b7280; margin-top: 0.5rem;">ìµœëŒ€ íŒŒì¼ í¬ê¸°: 10MB</p>
                    </div>
                    <div id="quote-file-info" style="margin-top: 1rem; display: none;"></div>
                </div>

                <button type="submit" class="btn" style="width: 100%; font-size: 1.1rem; padding: 1rem;">
                    <span style="font-size: 1.2rem;">ğŸš€</span> êµ¬ë§¤ ìš”ì²­ ì œì¶œ
                </button>
            </form>
        </div>

        <!-- ì‹œì„¤ ê´€ë¦¬ íƒ­ -->
        <div id="facility-tab" class="tab-content">
            <h2 style="color: #1f2937; margin-bottom: 2rem;">
                <span style="font-size: 2rem;">ğŸ”§</span> ì‹œì„¤ ê´€ë¦¬ ìš”ì²­
            </h2>
            
            <form id="facility-form" onsubmit="submitFacilityRequest(event)">
                <div class="form-group">
                    <label for="facility-title">
                        <span style="font-size: 1.2rem;">ğŸ“</span> ìš”ì²­ ì œëª© *
                    </label>
                    <input type="text" id="facility-title" name="title" placeholder="ì˜ˆ: ê°•ì˜ì‹¤ ì—ì–´ì»¨ ìˆ˜ë¦¬ ìš”ì²­" required>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label for="facility-department">
                            <span style="font-size: 1.2rem;">ğŸ¢</span> ë¶€ì„œ *
                        </label>
                        <input type="text" id="facility-department" name="department" placeholder="ì˜ˆ: ì´ë¬´íŒ€" required>
                    </div>
                    <div class="form-group">
                        <label for="facility-requester">
                            <span style="font-size: 1.2rem;">ğŸ‘¤</span> ìš”ì²­ì *
                        </label>
                        <input type="text" id="facility-requester" name="requestedBy" placeholder="í™ê¸¸ë™" required>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label for="facility-name">
                            <span style="font-size: 1.2rem;">ğŸ—ï¸</span> ì‹œì„¤ëª… *
                        </label>
                        <input type="text" id="facility-name" name="facility" placeholder="ì˜ˆ: ê°•ì˜ì‹¤ 301í˜¸" required>
                    </div>
                    <div class="form-group">
                        <label for="facility-location">
                            <span style="font-size: 1.2rem;">ğŸ“</span> ìœ„ì¹˜ *
                        </label>
                        <input type="text" id="facility-location" name="location" placeholder="ì˜ˆ: ê³µí•™ê´€ 3ì¸µ" required>
                    </div>
                    <div class="form-group">
                        <label for="facility-priority">
                            <span style="font-size: 1.2rem;">â­</span> ìš°ì„ ìˆœìœ„
                        </label>
                        <select id="facility-priority" name="priority">
                            <option value="ë‚®ìŒ">ë‚®ìŒ</option>
                            <option value="ë³´í†µ" selected>ë³´í†µ</option>
                            <option value="ë†’ìŒ">ë†’ìŒ</option>
                            <option value="ê¸´ê¸‰">ê¸´ê¸‰</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="facility-phone">
                        <span style="font-size: 1.2rem;">ğŸ“</span> ì—°ë½ì²˜
                    </label>
                    <input type="tel" id="facility-phone" name="phone" placeholder="010-1234-5678">
                </div>

                <div class="form-group">
                    <label for="facility-description">
                        <span style="font-size: 1.2rem;">ğŸ“‹</span> ë¬¸ì œ ìƒí™© *
                    </label>
                    <textarea id="facility-description" name="description" rows="4" placeholder="ì‹œì„¤ì˜ ë¬¸ì œì ì´ë‚˜ ìˆ˜ë¦¬ê°€ í•„ìš”í•œ ì‚¬í•­ì„ ìƒì„¸íˆ ì‘ì„±í•´ì£¼ì„¸ìš”." required></textarea>
                </div>

                <div class="form-group">
                    <label>
                        <span style="font-size: 1.2rem;">ğŸ“·</span> ì‹œì„¤ ì‚¬ì§„ ì²¨ë¶€ (ì„ íƒ)
                    </label>
                    <div class="file-upload" onclick="document.getElementById('facility-photos').click()">
                        <input type="file" id="facility-photos" accept="image/*" multiple style="display: none;" onchange="handleFacilityPhotos(event)">
                        <p><span style="font-size: 2rem;">ğŸ“¸</span></p>
                        <p>ì‚¬ì§„ì„ ì„ íƒí•˜ê±°ë‚˜ ì—¬ê¸°ì— ë“œë˜ê·¸í•˜ì„¸ìš” (ìµœëŒ€ 5ì¥)</p>
                        <p style="font-size: 0.9rem; color: #6b7280; margin-top: 0.5rem;">JPG, PNG, GIF í˜•ì‹ / ê° íŒŒì¼ ìµœëŒ€ 5MB</p>
                    </div>
                    <div id="photo-preview" style="margin-top: 1rem;"></div>
                </div>

                <button type="submit" class="btn" style="width: 100%; font-size: 1.1rem; padding: 1rem;">
                    <span style="font-size: 1.2rem;">ğŸš€</span> ì‹œì„¤ ê´€ë¦¬ ìš”ì²­ ì œì¶œ
                </button>
            </form>
        </div>

        <!-- ê´€ë¦¬ì íƒ­ -->
        <div id="admin-tab-content" class="tab-content">
            <div id="admin-login">
                <h2 style="color: #1f2937; margin-bottom: 2rem; text-align: center;">
                    <span style="font-size: 2rem;">ğŸ”</span> ê´€ë¦¬ì ë¡œê·¸ì¸
                </h2>
                
                <form onsubmit="adminLogin(event)" style="max-width: 400px; margin: 0 auto;">
                    <div class="form-group">
                        <label for="admin-username">
                            <span style="font-size: 1.2rem;">ğŸ‘¤</span> ì‚¬ìš©ìëª…
                        </label>
                        <input type="text" id="admin-username" name="username" placeholder="admin" required>
                    </div>
                    <div class="form-group">
                        <label for="admin-password">
                            <span style="font-size: 1.2rem;">ğŸ”’</span> ë¹„ë°€ë²ˆí˜¸
                        </label>
                        <input type="password" id="admin-password" name="password" placeholder="admin123" required>
                    </div>
                    <button type="submit" class="btn" style="width: 100%;">
                        <span style="font-size: 1.2rem;">ğŸšª</span> ë¡œê·¸ì¸
                    </button>
                </form>
            </div>

            <div id="admin-panel" style="display: none;">
                <h2 style="color: #1f2937; margin-bottom: 2rem;">
                    <span style="font-size: 2rem;">ğŸ‘¨â€ğŸ’¼</span> ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ
                </h2>

                <div class="admin-tabs">
                    <button class="admin-sub-tab active" onclick="showAdminTab('all')">
                        <span style="font-size: 1.1rem;">ğŸ“Š</span> ì „ì²´ í˜„í™©
                    </button>
                    <button class="admin-sub-tab" onclick="showAdminTab('purchase')">
                        <span style="font-size: 1.1rem;">ğŸ›’</span> êµ¬ë§¤ ìš”ì²­
                    </button>
                    <button class="admin-sub-tab" onclick="showAdminTab('facility')">
                        <span style="font-size: 1.1rem;">ğŸ”§</span> ì‹œì„¤ ê´€ë¦¬
                    </button>
                </div>

                <!-- ì „ì²´ í˜„í™© -->
                <div id="admin-all-tab" class="admin-content active">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div id="total-requests" class="stat-number">0</div>
                            <div>ì „ì²´ ìš”ì²­</div>
                        </div>
                        <div class="stat-card">
                            <div id="pending-requests" class="stat-number">0</div>
                            <div>ëŒ€ê¸° ì¤‘</div>
                        </div>
                        <div class="stat-card">
                            <div id="progress-requests" class="stat-number">0</div>
                            <div>ì§„í–‰ ì¤‘</div>
                        </div>
                        <div class="stat-card">
                            <div id="completed-requests" class="stat-number">0</div>
                            <div>ì™„ë£Œ</div>
                        </div>
                    </div>

                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3 style="color: #1f2937;">ì „ì²´ ìš”ì²­ ëª©ë¡</h3>
                        <button onclick="exportToExcel('all')" class="btn" style="font-size: 0.9rem; padding: 0.5rem 1rem;">
                            <span style="font-size: 1rem;">ğŸ“Š</span> Excel ë‹¤ìš´ë¡œë“œ
                        </button>
                    </div>

                    <div style="overflow-x: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th>ìœ í˜•</th>
                                    <th>ì œëª©</th>
                                    <th>ìš”ì²­ì</th>
                                    <th>ë¶€ì„œ</th>
                                    <th>ë¬¼í’ˆ/ì‹œì„¤</th>
                                    <th>ìˆ˜ëŸ‰/ìœ„ì¹˜</th>
                                    <th>ì˜ˆì‚°</th>
                                    <th>ìš°ì„ ìˆœìœ„</th>
                                    <th>ìƒíƒœ</th>
                                    <th>ë“±ë¡ì¼</th>
                                    <th>ê´€ë¦¬</th>
                                </tr>
                            </thead>
                            <tbody id="all-requests-tbody">
                                <tr>
                                    <td colspan="11" style="text-align: center; color: #6b7280; padding: 2rem;">
                                        ë“±ë¡ëœ ìš”ì²­ì´ ì—†ìŠµë‹ˆë‹¤.
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- êµ¬ë§¤ ìš”ì²­ -->
                <div id="admin-purchase-tab" class="admin-content">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3 style="color: #1f2937;">êµ¬ë§¤ ìš”ì²­ ëª©ë¡</h3>
                        <button onclick="exportToExcel('purchase')" class="btn" style="font-size: 0.9rem; padding: 0.5rem 1rem;">
                            <span style="font-size: 1rem;">ğŸ“Š</span> Excel ë‹¤ìš´ë¡œë“œ
                        </button>
                    </div>

                    <div style="overflow-x: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th>ì œëª©</th>
                                    <th>ìš”ì²­ì</th>
                                    <th>ë¶€ì„œ</th>
                                    <th>ë¬¼í’ˆëª…</th>
                                    <th>ìˆ˜ëŸ‰</th>
                                    <th>ì˜ˆì‚° (ì›)</th>
                                    <th>ìš°ì„ ìˆœìœ„</th>
                                    <th>ìƒíƒœ</th>
                                    <th>ë“±ë¡ì¼</th>
                                    <th>ê´€ë¦¬</th>
                                </tr>
                            </thead>
                            <tbody id="purchase-requests-tbody">
                                <tr>
                                    <td colspan="10" style="text-align: center; color: #6b7280; padding: 2rem;">
                                        ë“±ë¡ëœ êµ¬ë§¤ ìš”ì²­ì´ ì—†ìŠµë‹ˆë‹¤.
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- ì‹œì„¤ ê´€ë¦¬ -->
                <div id="admin-facility-tab" class="admin-content">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3 style="color: #1f2937;">ì‹œì„¤ ê´€ë¦¬ ìš”ì²­ ëª©ë¡</h3>
                        <button onclick="exportToExcel('facility')" class="btn" style="font-size: 0.9rem; padding: 0.5rem 1rem;">
                            <span style="font-size: 1rem;">ğŸ“Š</span> Excel ë‹¤ìš´ë¡œë“œ
                        </button>
                    </div>

                    <div style="overflow-x: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th>ì œëª©</th>
                                    <th>ìš”ì²­ì</th>
                                    <th>ë¶€ì„œ</th>
                                    <th>ì‹œì„¤ëª…</th>
                                    <th>ìœ„ì¹˜</th>
                                    <th>ìš°ì„ ìˆœìœ„</th>
                                    <th>ìƒíƒœ</th>
                                    <th>ë“±ë¡ì¼</th>
                                    <th>ê´€ë¦¬</th>
                                </tr>
                            </thead>
                            <tbody id="facility-requests-tbody">
                                <tr>
                                    <td colspan="9" style="text-align: center; color: #6b7280; padding: 2rem;">
                                        ë“±ë¡ëœ ì‹œì„¤ ê´€ë¦¬ ìš”ì²­ì´ ì—†ìŠµë‹ˆë‹¤.
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ìƒì„¸ ì •ë³´ ëª¨ë‹¬ -->
    <div id="detail-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;" onclick="closeModal()">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; border-radius: 20px; padding: 2rem; max-width: 600px; width: 90%; max-height: 80%; overflow-y: auto;" onclick="event.stopPropagation()">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h3 id="modal-title" style="color: #1f2937;">ìš”ì²­ ìƒì„¸ ì •ë³´</h3>
                <button onclick="closeModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">âœ•</button>
            </div>
            <div id="modal-content"></div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let currentTab = 'purchase';
        let isAdmin = false;
        let requests = [];
        let requestIdCounter = 1;

        // Firebase ì—°ê²° ìƒíƒœ
        let isFirebaseConnected = false;
        let firebaseRetryCount = 0;
        const MAX_RETRY_COUNT = 3;

        // íƒ­ ì „í™˜
        function showTab(tabName) {
            // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // ì„ íƒí•œ íƒ­ í™œì„±í™”
            event.target.closest('.tab').classList.add('active');
            document.getElementById(tabName + '-tab' + (tabName === 'admin' ? '-content' : '')).classList.add('active');
            
            currentTab = tabName;
        }

        // ê´€ë¦¬ì íƒ­ ì „í™˜
        function showAdminTab(tabName) {
            document.querySelectorAll('.admin-sub-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.admin-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById('admin-' + tabName + '-tab').classList.add('active');
            
            if (tabName === 'all') {
                loadAllRequests();
            } else if (tabName === 'purchase') {
                loadPurchaseRequests();
            } else if (tabName === 'facility') {
                loadFacilityRequests();
            }
        }

        // ì•Œë¦¼ í‘œì‹œ
        function showAlert(message, type = 'success') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert ${type}`;
            alertDiv.textContent = message;
            
            const container = document.querySelector('.tab-content.active') || document.body;
            container.insertBefore(alertDiv, container.firstChild);
            
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }

        // Firebase ì´ˆê¸°í™” ëŒ€ê¸°
        async function waitForFirestore() {
            return new Promise((resolve) => {
                const checkFirestore = () => {
                    if (window.firebaseDB && window.firebaseAuth) {
                        resolve(true);
                    } else {
                        setTimeout(checkFirestore, 100);
                    }
                };
                checkFirestore();
            });
        }

        // Firebase ì¸ì¦ (ìµëª… ë¡œê·¸ì¸)
        async function initializeFirebaseAuth() {
            try {
                await waitForFirestore();
                const auth = window.firebaseAuth;
                
                // ìµëª… ë¡œê·¸ì¸
                await auth.signInAnonymously();
                isFirebaseConnected = true;
                
                console.log('ğŸ”¥ Firebase ì¸ì¦ ì™„ë£Œ');
                showSyncStatus('connected', 'ì‹¤ì‹œê°„ ë™ê¸°í™” ì—°ê²°ë¨');
                
                // ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
                setupRealtimeListeners();
                
            } catch (error) {
                console.error('âŒ Firebase ì¸ì¦ ì‹¤íŒ¨:', error);
                handleFirebaseError(error);
            }
        }

        // ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        async function setupRealtimeListeners() {
            try {
                const { collection, query, orderBy, onSnapshot } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
                const db = window.firebaseDB;
                
                const q = query(collection(db, 'requests'), orderBy('createdAt', 'desc'));
                
                // ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ
                onSnapshot(q, (snapshot) => {
                    const updatedRequests = [];
                    snapshot.forEach((doc) => {
                        updatedRequests.push({
                            firebaseId: doc.id,
                            ...doc.data()
                        });
                    });
                    
                    console.log('ğŸ”¥ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸:', updatedRequests.length, 'ê°œ');
                    
                    // ì „ì—­ ìš”ì²­ ë°°ì—´ ì—…ë°ì´íŠ¸
                    requests = updatedRequests;
                    
                    // UI ì—…ë°ì´íŠ¸
                    if (isAdmin) {
                        refreshAdminUI();
                    }
                    
                    showSyncStatus('synced', `${updatedRequests.length}ê°œ ìš”ì²­ ë™ê¸°í™”ë¨`);
                }, (error) => {
                    console.error('âŒ ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ ì˜¤ë¥˜:', error);
                    showSyncStatus('error', 'ì‹¤ì‹œê°„ ë™ê¸°í™” ì˜¤ë¥˜');
                });
                
            } catch (error) {
                console.error('âŒ ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì‹¤íŒ¨:', error);
            }
        }

        // ìš”ì²­ ë°ì´í„°ë¥¼ Firebaseì— ì €ì¥
        async function saveRequestToFirebase(requestData) {
            try {
                if (!isFirebaseConnected) {
                    throw new Error('Firebase ì—°ê²°ì´ ëŠì–´ì§');
                }
                
                const { addDoc, collection } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
                const db = window.firebaseDB;
                
                // Firestoreì— ì €ì¥
                const docRef = await addDoc(collection(db, 'requests'), {
                    ...requestData,
                    createdAt: requestData.createdAt || new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                });
                
                console.log('ğŸ”¥ Firebase ì €ì¥ ì™„ë£Œ:', docRef.id);
                return docRef.id;
                
            } catch (error) {
                console.error('âŒ Firebase ì €ì¥ ì‹¤íŒ¨:', error);
                // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ë°±ì—… ì €ì¥
                saveToLocalStorage(requestData);
                showSyncStatus('error', 'Firebase ì €ì¥ ì‹¤íŒ¨, ë¡œì»¬ì— ë°±ì—…ë¨');
                throw error;
            }
        }

        // Firebaseì—ì„œ ìš”ì²­ ìƒíƒœ ì—…ë°ì´íŠ¸
        async function updateRequestInFirebase(firebaseId, updates) {
            try {
                if (!isFirebaseConnected || !firebaseId) {
                    throw new Error('Firebase ì—°ê²° ë˜ëŠ” ID ì—†ìŒ');
                }
                
                const { doc, updateDoc } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
                const db = window.firebaseDB;
                
                await updateDoc(doc(db, 'requests', firebaseId), {
                    ...updates,
                    updatedAt: new Date().toISOString()
                });
                
                console.log('ğŸ”¥ Firebase ì—…ë°ì´íŠ¸ ì™„ë£Œ:', firebaseId);
                
            } catch (error) {
                console.error('âŒ Firebase ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
                showSyncStatus('error', 'Firebase ì—…ë°ì´íŠ¸ ì‹¤íŒ¨');
                throw error;
            }
        }

        // ë™ê¸°í™” ìƒíƒœ í‘œì‹œ
        function showSyncStatus(status, message) {
            const statusDiv = document.getElementById('sync-status');
            if (!statusDiv) return;
            
            const icons = {
                'connecting': 'ğŸ”„',
                'connected': 'ğŸŸ¢',
                'synced': 'âœ…',
                'error': 'ğŸ”´',
                'offline': 'âš«'
            };
            
            const colors = {
                'connecting': '#f59e0b',
                'connected': '#22c55e',
                'synced': '#10b981',
                'error': '#ef4444',
                'offline': '#6b7280'
            };
            
            statusDiv.innerHTML = `
                <span style="color: ${colors[status]};">${icons[status]}</span>
                <span style="font-size: 0.8rem; margin-left: 0.25rem;">${message}</span>
            `;
        }

        // Firebase ì˜¤ë¥˜ ì²˜ë¦¬
        function handleFirebaseError(error) {
            firebaseRetryCount++;
            
            if (firebaseRetryCount <= MAX_RETRY_COUNT) {
                console.log(`ğŸ”„ Firebase ì¬ì—°ê²° ì‹œë„ ${firebaseRetryCount}/${MAX_RETRY_COUNT}`);
                showSyncStatus('connecting', `ì¬ì—°ê²° ì¤‘... (${firebaseRetryCount}/${MAX_RETRY_COUNT})`);
                
                setTimeout(() => {
                    initializeFirebaseAuth();
                }, 2000 * firebaseRetryCount);
            } else {
                console.log('âŒ Firebase ì—°ê²° í¬ê¸°, ì˜¤í”„ë¼ì¸ ëª¨ë“œë¡œ ì „í™˜');
                showSyncStatus('offline', 'ì˜¤í”„ë¼ì¸ ëª¨ë“œ (ë¡œì»¬ ì €ì¥)');
                isFirebaseConnected = false;
            }
        }

        // ë¡œì»¬ ë°±ì—… ê¸°ëŠ¥
        function saveToLocalStorage(data) {
            try {
                const localData = JSON.parse(localStorage.getItem('requests_backup') || '[]');
                localData.unshift(data);
                localStorage.setItem('requests_backup', JSON.stringify(localData));
            } catch (error) {
                console.error('âŒ ë¡œì»¬ ì €ì¥ ì‹¤íŒ¨:', error);
            }
        }

        // ê´€ë¦¬ì UI ìƒˆë¡œê³ ì¹¨
        function refreshAdminUI() {
            if (document.getElementById('admin-all-tab')?.style.display !== 'none') {
                loadAllRequests();
            }
            if (document.getElementById('admin-purchase-tab')?.style.display !== 'none') {
                loadPurchaseRequests();
            }
            if (document.getElementById('admin-facility-tab')?.style.display !== 'none') {
                loadFacilityRequests();
            }
            updateAllStats();
        }

        // êµ¬ë§¤ ìš”ì²­ ì œì¶œ
        async function submitPurchaseRequest(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const file = document.getElementById('quote-file').files[0];
            
            const requestData = {
                id: requestIdCounter++,
                type: 'purchase',
                title: formData.get('title'),
                department: formData.get('department'),
                item: formData.get('item'),
                quantity: formData.get('quantity'),
                budget: parseInt(formData.get('budget')),
                reason: formData.get('reason'),
                status: 'ëŒ€ê¸°',
                requestedBy: formData.get('requestedBy'),
                priority: formData.get('priority') || 'ë³´í†µ',
                quoteFile: file ? {
                    name: file.name,
                    size: file.size,
                    type: file.type,
                    lastModified: file.lastModified
                } : null,
                createdAt: new Date().toISOString()
            };
            
            // Firebaseì— ì €ì¥ ì‹œë„
            if (isFirebaseConnected) {
                try {
                    const firebaseId = await saveRequestToFirebase(requestData);
                    requestData.firebaseId = firebaseId;
                    showAlert('êµ¬ë§¤ ìš”ì²­ì´ ì„±ê³µì ìœ¼ë¡œ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤! (ì‹¤ì‹œê°„ ë™ê¸°í™”)', 'success');
                } catch (error) {
                    // Firebase ì‹¤íŒ¨ ì‹œ ë¡œì»¬ì— ì €ì¥
                    requests.unshift(requestData);
                    saveToStorage();
                    showAlert('êµ¬ë§¤ ìš”ì²­ì´ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤. (ë¡œì»¬ ì €ì¥)', 'success');
                }
            } else {
                // ì˜¤í”„ë¼ì¸ ëª¨ë“œ: ë¡œì»¬ì—ë§Œ ì €ì¥
                requests.unshift(requestData);
                saveToStorage();
                showAlert('êµ¬ë§¤ ìš”ì²­ì´ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤. (ì˜¤í”„ë¼ì¸ ëª¨ë“œ)', 'success');
            }
            
            e.target.reset();
            
            console.log('ğŸ›’ ìƒˆë¡œìš´ êµ¬ë§¤ ìš”ì²­:', requestData);
        }

        // ì‹œì„¤ ê´€ë¦¬ ìš”ì²­ ì œì¶œ
        async function submitFacilityRequest(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const photos = document.getElementById('facility-photos').files;
            
            // ì‚¬ì§„ ë°ì´í„° ì²˜ë¦¬
            const photoData = [];
            for (let i = 0; i < photos.length; i++) {
                photoData.push({
                    name: photos[i].name,
                    size: photos[i].size,
                    type: photos[i].type,
                    lastModified: photos[i].lastModified
                });
            }
            
            const requestData = {
                id: requestIdCounter++,
                type: 'facility',
                title: formData.get('title'),
                department: formData.get('department'),
                facility: formData.get('facility'),
                description: formData.get('description'),
                status: 'ëŒ€ê¸°',
                requestedBy: formData.get('requestedBy'),
                priority: formData.get('priority') || 'ë³´í†µ',
                phone: formData.get('phone') || '',
                location: formData.get('location') || '',
                facilityPhotos: photoData.length > 0 ? photoData : null,
                createdAt: new Date().toISOString()
            };
            
            // Firebaseì— ì €ì¥ ì‹œë„
            if (isFirebaseConnected) {
                try {
                    const firebaseId = await saveRequestToFirebase(requestData);
                    requestData.firebaseId = firebaseId;
                    showAlert('ì‹œì„¤ ê´€ë¦¬ ìš”ì²­ì´ ì„±ê³µì ìœ¼ë¡œ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤! (ì‹¤ì‹œê°„ ë™ê¸°í™”)', 'success');
                } catch (error) {
                    // Firebase ì‹¤íŒ¨ ì‹œ ë¡œì»¬ì— ì €ì¥
                    requests.unshift(requestData);
                    saveToStorage();
                    showAlert('ì‹œì„¤ ê´€ë¦¬ ìš”ì²­ì´ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤. (ë¡œì»¬ ì €ì¥)', 'success');
                }
            } else {
                // ì˜¤í”„ë¼ì¸ ëª¨ë“œ: ë¡œì»¬ì—ë§Œ ì €ì¥
                requests.unshift(requestData);
                saveToStorage();
                showAlert('ì‹œì„¤ ê´€ë¦¬ ìš”ì²­ì´ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤. (ì˜¤í”„ë¼ì¸ ëª¨ë“œ)', 'success');
            }
            
            e.target.reset();
            
            // ì‚¬ì§„ ì—…ë¡œë“œ UI ì´ˆê¸°í™”
            resetPhotoUpload();
            
            console.log('ğŸ”§ ìƒˆë¡œìš´ ì‹œì„¤ ê´€ë¦¬ ìš”ì²­:', requestData);
        }

        // ê´€ë¦¬ì ë¡œê·¸ì¸
        function adminLogin(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const username = formData.get('username');
            const password = formData.get('password');
            
            if (username === 'admin' && password === 'admin123') {
                isAdmin = true;
                document.getElementById('admin-login').style.display = 'none';
                document.getElementById('admin-panel').style.display = 'block';
                document.getElementById('admin-tab').innerHTML = '<span style="font-size: 1.2rem;">ğŸ‘¨â€ğŸ’¼</span><br>ê´€ë¦¬ì (ë¡œê·¸ì¸ë¨)';
                
                showAlert('ê´€ë¦¬ìë¡œ ë¡œê·¸ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                showAdminTab('all');
            } else {
                showAlert('ì˜ëª»ëœ ê´€ë¦¬ì ì •ë³´ì…ë‹ˆë‹¤.', 'error');
            }
        }

        // ìƒíƒœ ì—…ë°ì´íŠ¸
        async function updateStatus(requestId, newStatus) {
            const request = requests.find(r => r.id === requestId);
            if (request) {
                request.status = newStatus;
                request.updatedAt = new Date().toISOString();
                
                // Firebaseì— ì—…ë°ì´íŠ¸ ì‹œë„
                if (isFirebaseConnected && request.firebaseId) {
                    try {
                        await updateRequestInFirebase(request.firebaseId, {
                            status: newStatus,
                            updatedAt: request.updatedAt
                        });
                        showAlert(`ìš”ì²­ ìƒíƒœê°€ "${newStatus}"ë¡œ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤. (ì‹¤ì‹œê°„ ë™ê¸°í™”)`, 'success');
                    } catch (error) {
                        // Firebase ì—…ë°ì´íŠ¸ ì‹¤íŒ¨ ì‹œ ë¡œì»¬ë§Œ ì €ì¥
                        saveToStorage();
                        showAlert(`ìš”ì²­ ìƒíƒœê°€ "${newStatus}"ë¡œ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤. (ë¡œì»¬ ì €ì¥)`, 'success');
                    }
                } else {
                    // ì˜¤í”„ë¼ì¸ ëª¨ë“œ: ë¡œì»¬ì—ë§Œ ì €ì¥
                    saveToStorage();
                    showAlert(`ìš”ì²­ ìƒíƒœê°€ "${newStatus}"ë¡œ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤. (ì˜¤í”„ë¼ì¸ ëª¨ë“œ)`, 'success');
                }
            }
        }

        // íŒŒì¼ ì²˜ë¦¬ í•¨ìˆ˜ë“¤
        function handleQuoteFile(event) {
            const file = event.target.files[0];
            const infoDiv = document.getElementById('quote-file-info');
            
            if (file) {
                if (file.size > 10 * 1024 * 1024) {
                    showAlert('íŒŒì¼ í¬ê¸°ëŠ” 10MBë¥¼ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                    event.target.value = '';
                    return;
                }
                
                infoDiv.innerHTML = `
                    <div style="background: #f0f9ff; border: 1px solid #0ea5e9; border-radius: 8px; padding: 1rem;">
                        <p><strong>ğŸ“ ${file.name}</strong></p>
                        <p style="color: #6b7280; font-size: 0.9rem;">
                            í¬ê¸°: ${(file.size / 1024 / 1024).toFixed(2)}MB | 
                            ìœ í˜•: ${file.type || 'ì•Œ ìˆ˜ ì—†ìŒ'}
                        </p>
                    </div>
                `;
                infoDiv.style.display = 'block';
            } else {
                infoDiv.style.display = 'none';
            }
        }

        function handleFacilityPhotos(event) {
            const files = Array.from(event.target.files);
            const previewDiv = document.getElementById('photo-preview');
            
            if (files.length > 5) {
                showAlert('ìµœëŒ€ 5ì¥ê¹Œì§€ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            previewDiv.innerHTML = '';
            
            files.forEach((file, index) => {
                if (file.size > 5 * 1024 * 1024) {
                    showAlert(`${file.name}ì˜ íŒŒì¼ í¬ê¸°ê°€ 5MBë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤.`, 'error');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const photoDiv = document.createElement('div');
                    photoDiv.style.cssText = `
                        display: inline-block;
                        margin: 0.5rem;
                        border: 1px solid #d1d5db;
                        border-radius: 8px;
                        overflow: hidden;
                        position: relative;
                    `;
                    
                    photoDiv.innerHTML = `
                        <img src="${e.target.result}" alt="ë¯¸ë¦¬ë³´ê¸°" style="width: 100px; height: 100px; object-fit: cover;">
                        <div style="padding: 0.5rem; font-size: 0.8rem; color: #6b7280;">
                            ${file.name}<br>
                            ${(file.size / 1024 / 1024).toFixed(2)}MB
                        </div>
                    `;
                    
                    previewDiv.appendChild(photoDiv);
                };
                reader.readAsDataURL(file);
            });
        }

        function resetPhotoUpload() {
            document.getElementById('facility-photos').value = '';
            document.getElementById('photo-preview').innerHTML = '';
        }

        // ë°ì´í„° ë¡œë“œ í•¨ìˆ˜ë“¤
        function loadAllRequests() {
            const tbody = document.getElementById('all-requests-tbody');
            tbody.innerHTML = '';
            
            if (requests.length === 0) {
                tbody.innerHTML = '<tr><td colspan="11" style="text-align: center; color: #6b7280; padding: 2rem;">ë“±ë¡ëœ ìš”ì²­ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                return;
            }
            
            requests.forEach(request => {
                const row = document.createElement('tr');
                row.className = 'clickable-row';
                row.onclick = () => showRequestDetail(request);
                createAllRequestRow(row, request);
                tbody.appendChild(row);
            });
            
            updateAllStats();
        }

        function loadPurchaseRequests() {
            const tbody = document.getElementById('purchase-requests-tbody');
            tbody.innerHTML = '';
            
            const purchaseRequests = requests.filter(r => r.type === 'purchase');
            
            if (purchaseRequests.length === 0) {
                tbody.innerHTML = '<tr><td colspan="10" style="text-align: center; color: #6b7280; padding: 2rem;">ë“±ë¡ëœ êµ¬ë§¤ ìš”ì²­ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                return;
            }
            
            purchaseRequests.forEach(request => {
                const row = document.createElement('tr');
                row.className = 'clickable-row';
                row.onclick = () => showRequestDetail(request);
                createPurchaseRequestRow(row, request);
                tbody.appendChild(row);
            });
        }

        function loadFacilityRequests() {
            const tbody = document.getElementById('facility-requests-tbody');
            tbody.innerHTML = '';
            
            const facilityRequests = requests.filter(r => r.type === 'facility');
            
            if (facilityRequests.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" style="text-align: center; color: #6b7280; padding: 2rem;">ë“±ë¡ëœ ì‹œì„¤ ê´€ë¦¬ ìš”ì²­ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                return;
            }
            
            facilityRequests.forEach(request => {
                const row = document.createElement('tr');
                row.className = 'clickable-row';
                row.onclick = () => showRequestDetail(request);
                createFacilityRequestRow(row, request);
                tbody.appendChild(row);
            });
        }

        // í…Œì´ë¸” í–‰ ìƒì„± í•¨ìˆ˜ë“¤
        function createAllRequestRow(row, request) {
            const typeIcon = request.type === 'purchase' ? 'ğŸ›’' : 'ğŸ”§';
            const typeName = request.type === 'purchase' ? 'êµ¬ë§¤ìš”ì²­' : 'ì‹œì„¤ê´€ë¦¬';
            
            row.innerHTML = `
                <td><span class="badge">${typeIcon} ${typeName}</span></td>
                <td style="max-width: 200px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${request.title}</td>
                <td>${request.requestedBy}</td>
                <td>${request.department}</td>
                <td>${request.type === 'purchase' ? request.item : request.facility}</td>
                <td>${request.type === 'purchase' ? formatQuantity(request.quantity) : request.location}</td>
                <td>
                    ${request.type === 'purchase' && request.budget
                        ? `<span style="font-weight: 600; color: #059669;">${request.budget.toLocaleString()}ì›</span>`
                        : request.type === 'purchase' ? '-' : '-'}
                </td>
                <td><span class="badge ${getPriorityBadgeClass(request.priority || 'ë³´í†µ')}">${request.priority || 'ë³´í†µ'}</span></td>
                <td><span class="badge ${getStatusBadgeClass(request.status)}">${request.status}</span></td>
                <td>${formatDate(request.createdAt)}</td>
                <td>
                    <select onchange="updateStatus(${request.id}, this.value)" onclick="event.stopPropagation()">
                        <option value="ëŒ€ê¸°" ${request.status === 'ëŒ€ê¸°' ? 'selected' : ''}>ëŒ€ê¸°</option>
                        <option value="ì§„í–‰ì¤‘" ${request.status === 'ì§„í–‰ì¤‘' ? 'selected' : ''}>ì§„í–‰ì¤‘</option>
                        <option value="ì™„ë£Œ" ${request.status === 'ì™„ë£Œ' ? 'selected' : ''}>ì™„ë£Œ</option>
                        <option value="ì·¨ì†Œ" ${request.status === 'ì·¨ì†Œ' ? 'selected' : ''}>ì·¨ì†Œ</option>
                    </select>
                </td>
            `;
        }

        function createPurchaseRequestRow(row, request) {
            row.innerHTML = `
                <td style="max-width: 200px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${request.title}</td>
                <td>${request.requestedBy}</td>
                <td>${request.department}</td>
                <td>${request.item}</td>
                <td><span class="badge" style="background: #f3f4f6; color: #374151;">${formatQuantity(request.quantity)}</span></td>
                <td style="font-weight: 600; color: #059669; text-align: right;">${request.budget ? request.budget.toLocaleString() + 'ì›' : '-'}</td>
                <td><span class="badge ${getPriorityBadgeClass(request.priority || 'ë³´í†µ')}">${request.priority || 'ë³´í†µ'}</span></td>
                <td><span class="badge ${getStatusBadgeClass(request.status)}">${request.status}</span></td>
                <td>${formatDate(request.createdAt)}</td>
                <td>
                    <select onchange="updateStatus(${request.id}, this.value)" onclick="event.stopPropagation()">
                        <option value="ëŒ€ê¸°" ${request.status === 'ëŒ€ê¸°' ? 'selected' : ''}>ëŒ€ê¸°</option>
                        <option value="ì§„í–‰ì¤‘" ${request.status === 'ì§„í–‰ì¤‘' ? 'selected' : ''}>ì§„í–‰ì¤‘</option>
                        <option value="ì™„ë£Œ" ${request.status === 'ì™„ë£Œ' ? 'selected' : ''}>ì™„ë£Œ</option>
                        <option value="ì·¨ì†Œ" ${request.status === 'ì·¨ì†Œ' ? 'selected' : ''}>ì·¨ì†Œ</option>
                    </select>
                </td>
            `;
        }

        function createFacilityRequestRow(row, request) {
            row.innerHTML = `
                <td style="max-width: 200px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${request.title}</td>
                <td>${request.requestedBy}</td>
                <td>${request.department}</td>
                <td>${request.facility}</td>
                <td>${request.location}</td>
                <td><span class="badge ${getPriorityBadgeClass(request.priority || 'ë³´í†µ')}">${request.priority || 'ë³´í†µ'}</span></td>
                <td><span class="badge ${getStatusBadgeClass(request.status)}">${request.status}</span></td>
                <td>${formatDate(request.createdAt)}</td>
                <td>
                    <select onchange="updateStatus(${request.id}, this.value)" onclick="event.stopPropagation()">
                        <option value="ëŒ€ê¸°" ${request.status === 'ëŒ€ê¸°' ? 'selected' : ''}>ëŒ€ê¸°</option>
                        <option value="ì§„í–‰ì¤‘" ${request.status === 'ì§„í–‰ì¤‘' ? 'selected' : ''}>ì§„í–‰ì¤‘</option>
                        <option value="ì™„ë£Œ" ${request.status === 'ì™„ë£Œ' ? 'selected' : ''}>ì™„ë£Œ</option>
                        <option value="ì·¨ì†Œ" ${request.status === 'ì·¨ì†Œ' ? 'selected' : ''}>ì·¨ì†Œ</option>
                    </select>
                </td>
            `;
        }

        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
        function formatQuantity(quantity) {
            if (!quantity) return '-';
            
            // ìˆ«ìë§Œ ìˆëŠ” ê²½ìš° "ê°œ" ì¶”ê°€
            if (/^\d+$/.test(quantity.toString())) {
                return quantity + 'ê°œ';
            }
            
            // ì´ë¯¸ ë‹¨ìœ„ê°€ ìˆê±°ë‚˜ ë¬¸ìê°€ í¬í•¨ëœ ê²½ìš° ê·¸ëŒ€ë¡œ ë°˜í™˜
            return quantity.toString();
        }

        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleDateString('ko-KR') + ' ' + date.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
        }

        function getStatusBadgeClass(status) {
            switch (status) {
                case 'ëŒ€ê¸°': return 'status-pending';
                case 'ì§„í–‰ì¤‘': return 'status-progress';
                case 'ì™„ë£Œ': return 'status-completed';
                case 'ì·¨ì†Œ': return 'status-cancelled';
                default: return 'status-pending';
            }
        }

        function getPriorityBadgeClass(priority) {
            switch (priority) {
                case 'ê¸´ê¸‰': return 'priority-urgent';
                case 'ë†’ìŒ': return 'priority-high';
                case 'ë³´í†µ': return 'priority-normal';
                case 'ë‚®ìŒ': return 'priority-low';
                default: return 'priority-normal';
            }
        }

        function updateAllStats() {
            const total = requests.length;
            const pending = requests.filter(r => r.status === 'ëŒ€ê¸°').length;
            const progress = requests.filter(r => r.status === 'ì§„í–‰ì¤‘').length;
            const completed = requests.filter(r => r.status === 'ì™„ë£Œ').length;
            
            document.getElementById('total-requests').textContent = total;
            document.getElementById('pending-requests').textContent = pending;
            document.getElementById('progress-requests').textContent = progress;
            document.getElementById('completed-requests').textContent = completed;
        }

        // ìƒì„¸ ì •ë³´ ëª¨ë‹¬
        function showRequestDetail(request) {
            const modal = document.getElementById('detail-modal');
            const title = document.getElementById('modal-title');
            const content = document.getElementById('modal-content');
            
            title.textContent = `${request.type === 'purchase' ? 'êµ¬ë§¤ ìš”ì²­' : 'ì‹œì„¤ ê´€ë¦¬'} ìƒì„¸ ì •ë³´`;
            
            let detailHTML = `
                <div style="margin-bottom: 1rem;">
                    <strong>ğŸ“ ì œëª©:</strong> ${request.title}
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                    <div><strong>ğŸ‘¤ ìš”ì²­ì:</strong> ${request.requestedBy}</div>
                    <div><strong>ğŸ¢ ë¶€ì„œ:</strong> ${request.department}</div>
                </div>
            `;
            
            if (request.type === 'purchase') {
                detailHTML += `
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                        <div><strong>ğŸ“¦ ë¬¼í’ˆëª…:</strong> ${request.item}</div>
                        <div><strong>ğŸ“Š ìˆ˜ëŸ‰:</strong> ${formatQuantity(request.quantity)}</div>
                        <div><strong>ğŸ’° ì˜ˆì‚°:</strong> ${request.budget ? request.budget.toLocaleString() + 'ì›' : '-'}</div>
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <strong>ğŸ“ êµ¬ë§¤ ì‚¬ìœ :</strong><br>
                        <div style="background: #f9fafb; padding: 1rem; border-radius: 8px; margin-top: 0.5rem;">${request.reason}</div>
                    </div>
                `;
                
                if (request.quoteFile) {
                    detailHTML += `
                        <div style="margin-bottom: 1rem;">
                            <strong>ğŸ“ ê²¬ì ì„œ:</strong> ${request.quoteFile.name}
                            <span style="color: #6b7280; font-size: 0.9rem;">(${(request.quoteFile.size / 1024 / 1024).toFixed(2)}MB)</span>
                        </div>
                    `;
                }
            } else {
                detailHTML += `
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                        <div><strong>ğŸ—ï¸ ì‹œì„¤ëª…:</strong> ${request.facility}</div>
                        <div><strong>ğŸ“ ìœ„ì¹˜:</strong> ${request.location}</div>
                    </div>
                    ${request.phone ? `<div style="margin-bottom: 1rem;"><strong>ğŸ“ ì—°ë½ì²˜:</strong> ${request.phone}</div>` : ''}
                    <div style="margin-bottom: 1rem;">
                        <strong>ğŸ“‹ ë¬¸ì œ ìƒí™©:</strong><br>
                        <div style="background: #f9fafb; padding: 1rem; border-radius: 8px; margin-top: 0.5rem;">${request.description}</div>
                    </div>
                `;
                
                if (request.facilityPhotos && request.facilityPhotos.length > 0) {
                    detailHTML += `
                        <div style="margin-bottom: 1rem;">
                            <strong>ğŸ“· ì²¨ë¶€ ì‚¬ì§„:</strong> ${request.facilityPhotos.length}ì¥
                        </div>
                    `;
                }
            }
            
            detailHTML += `
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                    <div><strong>â­ ìš°ì„ ìˆœìœ„:</strong> <span class="badge ${getPriorityBadgeClass(request.priority || 'ë³´í†µ')}">${request.priority || 'ë³´í†µ'}</span></div>
                    <div><strong>ğŸ“Š ìƒíƒœ:</strong> <span class="badge ${getStatusBadgeClass(request.status)}">${request.status}</span></div>
                    <div><strong>ğŸ“… ë“±ë¡ì¼:</strong> ${formatDate(request.createdAt)}</div>
                </div>
            `;
            
            if (request.updatedAt && request.updatedAt !== request.createdAt) {
                detailHTML += `
                    <div style="margin-bottom: 1rem;">
                        <strong>ğŸ”„ ìˆ˜ì •ì¼:</strong> ${formatDate(request.updatedAt)}
                    </div>
                `;
            }
            
            content.innerHTML = detailHTML;
            modal.style.display = 'block';
        }

        function closeModal() {
            document.getElementById('detail-modal').style.display = 'none';
        }

        // Excel ë‚´ë³´ë‚´ê¸°
        function exportToExcel(type) {
            let data = [];
            let filename = '';
            
            if (type === 'all') {
                data = requests.map(request => ({
                    'ìœ í˜•': request.type === 'purchase' ? 'êµ¬ë§¤ìš”ì²­' : 'ì‹œì„¤ê´€ë¦¬',
                    'ì œëª©': request.title,
                    'ìš”ì²­ì': request.requestedBy,
                    'ë¶€ì„œ': request.department,
                    'ë¬¼í’ˆ/ì‹œì„¤': request.type === 'purchase' ? request.item : request.facility,
                    'ìˆ˜ëŸ‰/ìœ„ì¹˜': request.quantity ? formatQuantity(request.quantity) : request.location || '-',
                    'ì˜ˆì‚°': request.type === 'purchase' && request.budget ? request.budget.toLocaleString() + 'ì›' : '-',
                    'ìš°ì„ ìˆœìœ„': request.priority || 'ë³´í†µ',
                    'ìƒíƒœ': request.status,
                    'ë“±ë¡ì¼': formatDate(request.createdAt)
                }));
                filename = 'ì „ì²´_ìš”ì²­_ëª©ë¡';
            } else if (type === 'purchase') {
                const purchaseRequests = requests.filter(r => r.type === 'purchase');
                data = purchaseRequests.map(request => ({
                    'ì œëª©': request.title,
                    'ìš”ì²­ì': request.requestedBy,
                    'ë¶€ì„œ': request.department,
                    'ë¬¼í’ˆëª…': request.item,
                    'ìˆ˜ëŸ‰': formatQuantity(request.quantity),
                    'ì˜ˆì‚° (ì›)': request.budget ? request.budget.toLocaleString() : '-',
                    'ìš°ì„ ìˆœìœ„': request.priority || 'ë³´í†µ',
                    'ìƒíƒœ': request.status,
                    'êµ¬ë§¤ ì‚¬ìœ ': request.reason,
                    'ë“±ë¡ì¼': formatDate(request.createdAt)
                }));
                filename = 'êµ¬ë§¤_ìš”ì²­_ëª©ë¡';
            } else if (type === 'facility') {
                const facilityRequests = requests.filter(r => r.type === 'facility');
                data = facilityRequests.map(request => ({
                    'ì œëª©': request.title,
                    'ìš”ì²­ì': request.requestedBy,
                    'ë¶€ì„œ': request.department,
                    'ì‹œì„¤ëª…': request.facility,
                    'ìœ„ì¹˜': request.location,
                    'ì—°ë½ì²˜': request.phone || '-',
                    'ìš°ì„ ìˆœìœ„': request.priority || 'ë³´í†µ',
                    'ìƒíƒœ': request.status,
                    'ë¬¸ì œ ìƒí™©': request.description,
                    'ë“±ë¡ì¼': formatDate(request.createdAt)
                }));
                filename = 'ì‹œì„¤ê´€ë¦¬_ìš”ì²­_ëª©ë¡';
            }
            
            if (data.length === 0) {
                showAlert('ë‚´ë³´ë‚¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            // SheetJSë¥¼ ì‚¬ìš©í•œ Excel ìƒì„±
            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "ìš”ì²­ ëª©ë¡");
            
            // íŒŒì¼ ë‹¤ìš´ë¡œë“œ
            const today = new Date().toISOString().split('T')[0];
            XLSX.writeFile(wb, `${filename}_${today}.xlsx`);
            
            showAlert('Excel íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        }

        // ì €ì¥ í•¨ìˆ˜
        function saveToStorage() {
            try {
                localStorage.setItem('requests', JSON.stringify(requests));
            } catch (error) {
                console.error('ë¡œì»¬ ì €ì¥ ì‹¤íŒ¨:', error);
            }
        }

        // Service Worker ë“±ë¡
        async function registerServiceWorker() {
            if ('serviceWorker' in navigator) {
                try {
                    const registration = await navigator.serviceWorker.register('/sw.js');
                    console.log('âœ… Service Worker ë“±ë¡ ì„±ê³µ:', registration.scope);
                    
                    // ì—…ë°ì´íŠ¸ í™•ì¸
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                // ìƒˆ ë²„ì „ ì‚¬ìš© ê°€ëŠ¥
                                showUpdateAvailablePrompt();
                            }
                        });
                    });
                    
                } catch (error) {
                    console.error('âŒ Service Worker ë“±ë¡ ì‹¤íŒ¨:', error);
                }
            } else {
                console.log('ğŸš« ì´ ë¸Œë¼ìš°ì €ëŠ” Service Workerë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
            }
        }

        // PWA ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ ì„¤ì •
        function setupPWAInstallPrompt() {
            let deferredPrompt;
            
            window.addEventListener('beforeinstallprompt', (e) => {
                console.log('ğŸ“± PWA ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ ì¤€ë¹„');
                e.preventDefault();
                deferredPrompt = e;
                
                // ì„¤ì¹˜ ë²„íŠ¼ í‘œì‹œ (í—¤ë”ì— ì¶”ê°€)
                showInstallButton(deferredPrompt);
            });
            
            window.addEventListener('appinstalled', (evt) => {
                console.log('ğŸ‰ PWA ì„¤ì¹˜ ì™„ë£Œ');
                showAlert('ì•±ì´ ì„±ê³µì ìœ¼ë¡œ ì„¤ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                hideInstallButton();
            });
        }

        // ì„¤ì¹˜ ë²„íŠ¼ í‘œì‹œ
        function showInstallButton(deferredPrompt) {
            const syncStatus = document.getElementById('sync-status');
            if (!syncStatus) return;
            
            const installBtn = document.createElement('button');
            installBtn.id = 'install-btn';
            installBtn.innerHTML = 'ğŸ“± ì•± ì„¤ì¹˜';
            installBtn.style.cssText = `
                margin-left: 1rem;
                padding: 0.5rem 1rem;
                background: #10b981;
                color: white;
                border: none;
                border-radius: 20px;
                font-size: 0.8rem;
                cursor: pointer;
                transition: all 0.3s ease;
            `;
            
            installBtn.onclick = async () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    console.log('PWA ì„¤ì¹˜ ì„ íƒ:', outcome);
                    deferredPrompt = null;
                    hideInstallButton();
                }
            };
            
            syncStatus.parentElement.appendChild(installBtn);
        }

        // ì„¤ì¹˜ ë²„íŠ¼ ìˆ¨ê¸°ê¸°
        function hideInstallButton() {
            const installBtn = document.getElementById('install-btn');
            if (installBtn) {
                installBtn.remove();
            }
        }

        // ì—…ë°ì´íŠ¸ ì‚¬ìš© ê°€ëŠ¥ í”„ë¡¬í”„íŠ¸
        function showUpdateAvailablePrompt() {
            const updatePrompt = confirm(
                'ìƒˆë¡œìš´ ë²„ì „ì´ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.\ní˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ ì—…ë°ì´íŠ¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?'
            );
            
            if (updatePrompt) {
                // Service Workerì—ê²Œ skipWaiting ì‹ í˜¸ ì „ì†¡
                if (navigator.serviceWorker.controller) {
                    navigator.serviceWorker.controller.postMessage({ type: 'SKIP_WAITING' });
                }
                window.location.reload();
            }
        }

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            // Service Worker ë“±ë¡
            registerServiceWorker();
            
            // Firebase ì—°ê²° ì‹œë„
            setTimeout(() => {
                initializeFirebaseAuth();
            }, 500);
            
            // ë„¤íŠ¸ì›Œí¬ ìƒíƒœ ëª¨ë‹ˆí„°ë§
            window.addEventListener('online', function() {
                console.log('ğŸŒ ë„¤íŠ¸ì›Œí¬ ì—°ê²°ë¨');
                if (!isFirebaseConnected) {
                    initializeFirebaseAuth();
                }
            });
            
            window.addEventListener('offline', function() {
                console.log('ğŸ“± ì˜¤í”„ë¼ì¸ ìƒíƒœ');
                showSyncStatus('offline', 'ì˜¤í”„ë¼ì¸ ëª¨ë“œ');
                isFirebaseConnected = false;
            });
            
            // PWA ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ ì²˜ë¦¬
            setupPWAInstallPrompt();
            
            // í˜ì´ë“œ ì¸ ì• ë‹ˆë©”ì´ì…˜
            setTimeout(() => {
                document.body.style.opacity = '1';
            }, 100);
            
            console.log('ğŸ¯ í†µí•© ìš”ì²­ ê´€ë¦¬ ì‹œìŠ¤í…œì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
        });

        // Service Worker ë©”ì‹œì§€ ìˆ˜ì‹ 
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.addEventListener('message', event => {
                console.log('ğŸ’¬ Service Worker ë©”ì‹œì§€:', event.data);
                
                if (event.data.type === 'SYNC_LOCAL_DATA') {
                    // ë°±ê·¸ë¼ìš´ë“œ ë™ê¸°í™”ëœ ë°ì´í„° ì²˜ë¦¬
                    console.log('ğŸ”„ ë°±ê·¸ë¼ìš´ë“œ ë™ê¸°í™” ë°ì´í„° ìˆ˜ì‹ ');
                    // í•„ìš” ì‹œ UI ì—…ë°ì´íŠ¸
                }
            });
        }
    </script>

    <!-- SheetJS ë¼ì´ë¸ŒëŸ¬ë¦¬ (Excel íŒŒì¼ ìƒì„±ìš©) -->
    <script src="https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

</body>
</html>
