<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üè¢ ÌÜµÌï© ÏöîÏ≤≠ Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú</title>
    
    <!-- PWA ÏÑ§Ï†ï -->
    <meta name="description" content="Íµ¨Îß§ ÏöîÏ≤≠ Î∞è ÏãúÏÑ§ Í¥ÄÎ¶¨ ÌÜµÌï© ÌîåÎû´Ìèº">
    <meta name="theme-color" content="#3b82f6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ÏöîÏ≤≠Í¥ÄÎ¶¨">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- Îß§ÎãàÌéòÏä§Ìä∏ ÌååÏùº -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, updateDoc, doc, deleteDoc, getDocs } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getAuth, signInAnonymously, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        
        // Firebase ÏÑ§Ï†ï (ÏÇ¨Ïö©ÏûêÍ∞Ä Ïã§Ï†ú ÌîÑÎ°úÏ†ùÌä∏ ÏÑ§Ï†ïÏúºÎ°ú ÍµêÏ≤¥Ìï¥Ïïº Ìï®)
        const firebaseConfig = {
            apiKey: "your-api-key-here",
            authDomain: "your-project.firebaseapp.com",
            projectId: "your-project-id",
            storageBucket: "your-project.appspot.com",
            messagingSenderId: "123456789",
            appId: "your-app-id"
        };
        
        // Firebase Ï¥àÍ∏∞Ìôî
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        
        // Ï†ÑÏó≠ Î≥ÄÏàòÎ°ú ÏÑ§Ï†ï
        window.firebaseDB = db;
        window.firebaseAuth = auth;
        
        console.log('üî• Firebase Ï¥àÍ∏∞Ìôî ÏôÑÎ£å');
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            opacity: 0;
            animation: fadeIn 0.5s ease-in-out forwards;
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 2rem;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header h1 {
            color: white;
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.1rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            margin-bottom: 2rem;
            overflow: hidden;
        }

        .tab {
            flex: 1;
            padding: 1rem 2rem;
            background: transparent;
            border: none;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            font-weight: 600;
        }

        .tab:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .tab.active {
            background: rgba(255, 255, 255, 0.2);
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.1);
        }

        .tab-content {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: slideIn 0.3s ease-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            color: #374151;
            font-weight: 600;
        }

        input, select, textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
            color: white;
            padding: 0.75rem 2rem;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4);
        }

        .alert {
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            animation: slideIn 0.3s ease-out;
        }

        .alert.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }

        .alert.error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }

        .admin-tabs {
            display: flex;
            margin-bottom: 2rem;
        }

        .admin-sub-tab {
            padding: 0.75rem 1.5rem;
            background: #f3f4f6;
            border: none;
            cursor: pointer;
            margin-right: 0.5rem;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .admin-sub-tab.active {
            background: #3b82f6;
            color: white;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        th, td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }

        th {
            background: #f9fafb;
            font-weight: 600;
            color: #374151;
        }

        tr:hover {
            background: #f9fafb;
        }

        .badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .status-pending { background: #fef3c7; color: #92400e; }
        .status-progress { background: #dbeafe; color: #1e40af; }
        .status-completed { background: #d1fae5; color: #065f46; }
        .status-cancelled { background: #fee2e2; color: #991b1b; }

        .priority-urgent { background: #fee2e2; color: #991b1b; }
        .priority-high { background: #fed7d7; color: #c53030; }
        .priority-normal { background: #e2e8f0; color: #4a5568; }
        .priority-low { background: #f0fff4; color: #38a169; }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 15px;
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .clickable-row {
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .clickable-row:hover {
            background: #f3f4f6 !important;
            transform: translateY(-1px);
        }

        .file-upload {
            border: 2px dashed #d1d5db;
            border-radius: 10px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .file-upload:hover {
            border-color: #3b82f6;
            background: #f8fafc;
        }

        .file-upload.dragover {
            border-color: #3b82f6;
            background: #eff6ff;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <!-- Ìó§Îçî -->
    <header class="header">
        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;">
            <div>
                <h1>üè¢ ÌÜµÌï© ÏöîÏ≤≠ Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú</h1>
                <p>Íµ¨Îß§ ÏöîÏ≤≠ Î∞è ÏãúÏÑ§ Í¥ÄÎ¶¨ ÌÜµÌï© ÌîåÎû´Ìèº</p>
            </div>
            <div id="sync-status" style="background: rgba(255, 255, 255, 0.1); padding: 0.5rem 1rem; border-radius: 20px; backdrop-filter: blur(10px); min-width: 150px; text-align: center;">
                <span style="color: #f59e0b;">üîÑ</span>
                <span style="font-size: 0.8rem; margin-left: 0.25rem;">Ïó∞Í≤∞ Ï§ë...</span>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- ÌÉ≠ Î©îÎâ¥ -->
        <div class="tabs">
            <button class="tab active" onclick="showTab('purchase')">
                <span style="font-size: 1.2rem;">üõí</span><br>Íµ¨Îß§ ÏöîÏ≤≠
            </button>
            <button class="tab" onclick="showTab('facility')">
                <span style="font-size: 1.2rem;">üîß</span><br>ÏãúÏÑ§ Í¥ÄÎ¶¨
            </button>
            <button class="tab" onclick="showTab('admin')" id="admin-tab">
                <span style="font-size: 1.2rem;">üë®‚Äçüíº</span><br>Í¥ÄÎ¶¨Ïûê
            </button>
        </div>

        <!-- Íµ¨Îß§ ÏöîÏ≤≠ ÌÉ≠ -->
        <div id="purchase-tab" class="tab-content active">
            <h2 style="color: #1f2937; margin-bottom: 2rem;">
                <span style="font-size: 2rem;">üõí</span> Íµ¨Îß§ ÏöîÏ≤≠ Îì±Î°ù
            </h2>
            
            <form id="purchase-form" onsubmit="submitPurchaseRequest(event)">
                <div class="form-group">
                    <label for="purchase-title">
                        <span style="font-size: 1.2rem;">üìù</span> ÏöîÏ≤≠ Ï†úÎ™© *
                    </label>
                    <input type="text" id="purchase-title" name="title" placeholder="Ïòà: ÏÇ¨Î¨¥Ïö©Ìíà Íµ¨Îß§ ÏöîÏ≤≠" required>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label for="purchase-department">
                            <span style="font-size: 1.2rem;">üè¢</span> Î∂ÄÏÑú *
                        </label>
                        <input type="text" id="purchase-department" name="department" placeholder="Ïòà: ITÌåÄ" required>
                    </div>
                    <div class="form-group">
                        <label for="purchase-requester">
                            <span style="font-size: 1.2rem;">üë§</span> ÏöîÏ≤≠Ïûê *
                        </label>
                        <input type="text" id="purchase-requester" name="requestedBy" placeholder="ÌôçÍ∏∏Îèô" required>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label for="purchase-item">
                            <span style="font-size: 1.2rem;">üì¶</span> Î¨ºÌíàÎ™Ö *
                        </label>
                        <input type="text" id="purchase-item" name="item" placeholder="Ïòà: A4 Ïö©ÏßÄ, Î≥ºÌéú ÏÑ∏Ìä∏" required>
                    </div>
                    <div class="form-group">
                        <label for="purchase-quantity">
                            <span style="font-size: 1.2rem;">üì¶</span> ÏàòÎüâ *
                        </label>
                        <input type="text" id="purchase-quantity" name="quantity" placeholder="Ïòà: 5Í∞ú, 1Î∞ïÏä§, 10ÏÑ∏Ìä∏, 1Ïãù" required>
                    </div>
                    <div class="form-group">
                        <label for="purchase-budget">
                            <span style="font-size: 1.2rem;">üí∞</span> ÏòàÏÇ∞ (Ïõê) *
                        </label>
                        <input type="number" id="purchase-budget" name="budget" placeholder="Ïòà: 500000, 1000000" min="1" step="1000" required>
                    </div>
                </div>

                <div class="form-group">
                    <label for="purchase-priority">
                        <span style="font-size: 1.2rem;">‚≠ê</span> Ïö∞ÏÑ†ÏàúÏúÑ
                    </label>
                    <select id="purchase-priority" name="priority">
                        <option value="ÎÇÆÏùå">ÎÇÆÏùå</option>
                        <option value="Î≥¥ÌÜµ" selected>Î≥¥ÌÜµ</option>
                        <option value="ÎÜíÏùå">ÎÜíÏùå</option>
                        <option value="Í∏¥Í∏â">Í∏¥Í∏â</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="purchase-reason">
                        <span style="font-size: 1.2rem;">üìù</span> Íµ¨Îß§ ÏÇ¨Ïú† *
                    </label>
                    <textarea id="purchase-reason" name="reason" rows="4" placeholder="Íµ¨Îß§Í∞Ä ÌïÑÏöîÌïú Ïù¥Ïú†Î•º ÏÉÅÏÑ∏Ìûà ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî." required></textarea>
                </div>

                <div class="form-group">
                    <label>
                        <span style="font-size: 1.2rem;">üìé</span> Í≤¨Ï†ÅÏÑú Ï≤®Î∂Ä (ÏÑ†ÌÉù)
                    </label>
                    <div class="file-upload" onclick="document.getElementById('quote-file').click()">
                        <input type="file" id="quote-file" accept=".pdf,.xlsx,.xls,.hwp" style="display: none;" onchange="handleQuoteFile(event)">
                        <p><span style="font-size: 2rem;">üìÅ</span></p>
                        <p>PDF, Excel, ÌïúÍ∏Ä ÌååÏùºÏùÑ ÏÑ†ÌÉùÌïòÍ±∞ÎÇò Ïó¨Í∏∞Ïóê ÎìúÎûòÍ∑∏ÌïòÏÑ∏Ïöî</p>
                        <p style="font-size: 0.9rem; color: #6b7280; margin-top: 0.5rem;">ÏµúÎåÄ ÌååÏùº ÌÅ¨Í∏∞: 10MB</p>
                    </div>
                    <div id="quote-file-info" style="margin-top: 1rem; display: none;"></div>
                </div>

                <button type="submit" class="btn" style="width: 100%; font-size: 1.1rem; padding: 1rem;">
                    <span style="font-size: 1.2rem;">üöÄ</span> Íµ¨Îß§ ÏöîÏ≤≠ Ï†úÏ∂ú
                </button>
            </form>
        </div>

        <!-- ÏãúÏÑ§ Í¥ÄÎ¶¨ ÌÉ≠ -->
        <div id="facility-tab" class="tab-content">
            <h2 style="color: #1f2937; margin-bottom: 2rem;">
                <span style="font-size: 2rem;">üîß</span> ÏãúÏÑ§ Í¥ÄÎ¶¨ ÏöîÏ≤≠
            </h2>
            
            <form id="facility-form" onsubmit="submitFacilityRequest(event)">
                <div class="form-group">
                    <label for="facility-title">
                        <span style="font-size: 1.2rem;">üìù</span> ÏöîÏ≤≠ Ï†úÎ™© *
                    </label>
                    <input type="text" id="facility-title" name="title" placeholder="Ïòà: Í∞ïÏùòÏã§ ÏóêÏñ¥Ïª® ÏàòÎ¶¨ ÏöîÏ≤≠" required>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label for="facility-department">
                            <span style="font-size: 1.2rem;">üè¢</span> Î∂ÄÏÑú *
                        </label>
                        <input type="text" id="facility-department" name="department" placeholder="Ïòà: Ï¥ùÎ¨¥ÌåÄ" required>
                    </div>
                    <div class="form-group">
                        <label for="facility-requester">
                            <span style="font-size: 1.2rem;">üë§</span> ÏöîÏ≤≠Ïûê *
                        </label>
                        <input type="text" id="facility-requester" name="requestedBy" placeholder="ÌôçÍ∏∏Îèô" required>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label for="facility-name">
                            <span style="font-size: 1.2rem;">üèóÔ∏è</span> ÏãúÏÑ§Î™Ö *
                        </label>
                        <input type="text" id="facility-name" name="facility" placeholder="Ïòà: Í∞ïÏùòÏã§ 301Ìò∏" required>
                    </div>
                    <div class="form-group">
                        <label for="facility-location">
                            <span style="font-size: 1.2rem;">üìç</span> ÏúÑÏπò *
                        </label>
                        <input type="text" id="facility-location" name="location" placeholder="Ïòà: Í≥µÌïôÍ¥Ä 3Ï∏µ" required>
                    </div>
                    <div class="form-group">
                        <label for="facility-priority">
                            <span style="font-size: 1.2rem;">‚≠ê</span> Ïö∞ÏÑ†ÏàúÏúÑ
                        </label>
                        <select id="facility-priority" name="priority">
                            <option value="ÎÇÆÏùå">ÎÇÆÏùå</option>
                            <option value="Î≥¥ÌÜµ" selected>Î≥¥ÌÜµ</option>
                            <option value="ÎÜíÏùå">ÎÜíÏùå</option>
                            <option value="Í∏¥Í∏â">Í∏¥Í∏â</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="facility-phone">
                        <span style="font-size: 1.2rem;">üìû</span> Ïó∞ÎùΩÏ≤ò
                    </label>
                    <input type="tel" id="facility-phone" name="phone" placeholder="010-1234-5678">
                </div>

                <div class="form-group">
                    <label for="facility-description">
                        <span style="font-size: 1.2rem;">üìã</span> Î¨∏Ï†ú ÏÉÅÌô© *
                    </label>
                    <textarea id="facility-description" name="description" rows="4" placeholder="ÏãúÏÑ§Ïùò Î¨∏Ï†úÏ†êÏù¥ÎÇò ÏàòÎ¶¨Í∞Ä ÌïÑÏöîÌïú ÏÇ¨Ìï≠ÏùÑ ÏÉÅÏÑ∏Ìûà ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî." required></textarea>
                </div>

                <div class="form-group">
                    <label>
                        <span style="font-size: 1.2rem;">üì∑</span> ÏãúÏÑ§ ÏÇ¨ÏßÑ Ï≤®Î∂Ä (ÏÑ†ÌÉù)
                    </label>
                    <div class="file-upload" onclick="document.getElementById('facility-photos').click()">
                        <input type="file" id="facility-photos" accept="image/*" multiple style="display: none;" onchange="handleFacilityPhotos(event)">
                        <p><span style="font-size: 2rem;">üì∏</span></p>
                        <p>ÏÇ¨ÏßÑÏùÑ ÏÑ†ÌÉùÌïòÍ±∞ÎÇò Ïó¨Í∏∞Ïóê ÎìúÎûòÍ∑∏ÌïòÏÑ∏Ïöî (ÏµúÎåÄ 5Ïû•)</p>
                        <p style="font-size: 0.9rem; color: #6b7280; margin-top: 0.5rem;">JPG, PNG, GIF ÌòïÏãù / Í∞Å ÌååÏùº ÏµúÎåÄ 5MB</p>
                    </div>
                    <div id="photo-preview" style="margin-top: 1rem;"></div>
                </div>

                <button type="submit" class="btn" style="width: 100%; font-size: 1.1rem; padding: 1rem;">
                    <span style="font-size: 1.2rem;">üöÄ</span> ÏãúÏÑ§ Í¥ÄÎ¶¨ ÏöîÏ≤≠ Ï†úÏ∂ú
                </button>
            </form>
        </div>

        <!-- Í¥ÄÎ¶¨Ïûê ÌÉ≠ -->
        <div id="admin-tab-content" class="tab-content">
            <div id="admin-login">
                <h2 style="color: #1f2937; margin-bottom: 2rem; text-align: center;">
                    <span style="font-size: 2rem;">üîê</span> Í¥ÄÎ¶¨Ïûê Î°úÍ∑∏Ïù∏
                </h2>
                
                <form onsubmit="adminLogin(event)" style="max-width: 400px; margin: 0 auto;">
                    <div class="form-group">
                        <label for="admin-username">
                            <span style="font-size: 1.2rem;">üë§</span> ÏÇ¨Ïö©ÏûêÎ™Ö
                        </label>
                        <input type="text" id="admin-username" name="username" placeholder="admin" required>
                    </div>
                    <div class="form-group">
                        <label for="admin-password">
                            <span style="font-size: 1.2rem;">üîí</span> ÎπÑÎ∞ÄÎ≤àÌò∏
                        </label>
                        <input type="password" id="admin-password" name="password" placeholder="admin123" required>
                    </div>
                    <button type="submit" class="btn" style="width: 100%;">
                        <span style="font-size: 1.2rem;">üö™</span> Î°úÍ∑∏Ïù∏
                    </button>
                </form>
            </div>

            <div id="admin-panel" style="display: none;">
                <h2 style="color: #1f2937; margin-bottom: 2rem;">
                    <span style="font-size: 2rem;">üë®‚Äçüíº</span> Í¥ÄÎ¶¨Ïûê ÎåÄÏãúÎ≥¥Îìú
                </h2>

                <div class="admin-tabs">
                    <button class="admin-sub-tab active" onclick="showAdminTab('all')">
                        <span style="font-size: 1.1rem;">üìä</span> Ï†ÑÏ≤¥ ÌòÑÌô©
                    </button>
                    <button class="admin-sub-tab" onclick="showAdminTab('purchase')">
                        <span style="font-size: 1.1rem;">üõí</span> Íµ¨Îß§ ÏöîÏ≤≠
                    </button>
                    <button class="admin-sub-tab" onclick="showAdminTab('facility')">
                        <span style="font-size: 1.1rem;">üîß</span> ÏãúÏÑ§ Í¥ÄÎ¶¨
                    </button>
                </div>

                <!-- Ï†ÑÏ≤¥ ÌòÑÌô© -->
                <div id="admin-all-tab" class="admin-content active">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div id="total-requests" class="stat-number">0</div>
                            <div>Ï†ÑÏ≤¥ ÏöîÏ≤≠</div>
                        </div>
                        <div class="stat-card">
                            <div id="pending-requests" class="stat-number">0</div>
                            <div>ÎåÄÍ∏∞ Ï§ë</div>
                        </div>
                        <div class="stat-card">
                            <div id="progress-requests" class="stat-number">0</div>
                            <div>ÏßÑÌñâ Ï§ë</div>
                        </div>
                        <div class="stat-card">
                            <div id="completed-requests" class="stat-number">0</div>
                            <div>ÏôÑÎ£å</div>
                        </div>
                    </div>

                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3 style="color: #1f2937;">Ï†ÑÏ≤¥ ÏöîÏ≤≠ Î™©Î°ù</h3>
                        <button onclick="exportToExcel('all')" class="btn" style="font-size: 0.9rem; padding: 0.5rem 1rem;">
                            <span style="font-size: 1rem;">üìä</span> Excel Îã§Ïö¥Î°úÎìú
                        </button>
                    </div>

                    <div style="overflow-x: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th>Ïú†Ìòï</th>
                                    <th>Ï†úÎ™©</th>
                                    <th>ÏöîÏ≤≠Ïûê</th>
                                    <th>Î∂ÄÏÑú</th>
                                    <th>Î¨ºÌíà/ÏãúÏÑ§</th>
                                    <th>ÏàòÎüâ/ÏúÑÏπò</th>
                                    <th>ÏòàÏÇ∞</th>
                                    <th>Ïö∞ÏÑ†ÏàúÏúÑ</th>
                                    <th>ÏÉÅÌÉú</th>
                                    <th>Îì±Î°ùÏùº</th>
                                    <th>Í¥ÄÎ¶¨</th>
                                </tr>
                            </thead>
                            <tbody id="all-requests-tbody">
                                <tr>
                                    <td colspan="11" style="text-align: center; color: #6b7280; padding: 2rem;">
                                        Îì±Î°ùÎêú ÏöîÏ≤≠Ïù¥ ÏóÜÏäµÎãàÎã§.
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Íµ¨Îß§ ÏöîÏ≤≠ -->
                <div id="admin-purchase-tab" class="admin-content">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3 style="color: #1f2937;">Íµ¨Îß§ ÏöîÏ≤≠ Î™©Î°ù</h3>
                        <button onclick="exportToExcel('purchase')" class="btn" style="font-size: 0.9rem; padding: 0.5rem 1rem;">
                            <span style="font-size: 1rem;">üìä</span> Excel Îã§Ïö¥Î°úÎìú
                        </button>
                    </div>

                    <div style="overflow-x: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th>Ï†úÎ™©</th>
                                    <th>ÏöîÏ≤≠Ïûê</th>
                                    <th>Î∂ÄÏÑú</th>
                                    <th>Î¨ºÌíàÎ™Ö</th>
                                    <th>ÏàòÎüâ</th>
                                    <th>ÏòàÏÇ∞ (Ïõê)</th>
                                    <th>Ïö∞ÏÑ†ÏàúÏúÑ</th>
                                    <th>ÏÉÅÌÉú</th>
                                    <th>Îì±Î°ùÏùº</th>
                                    <th>Í¥ÄÎ¶¨</th>
                                </tr>
                            </thead>
                            <tbody id="purchase-requests-tbody">
                                <tr>
                                    <td colspan="10" style="text-align: center; color: #6b7280; padding: 2rem;">
                                        Îì±Î°ùÎêú Íµ¨Îß§ ÏöîÏ≤≠Ïù¥ ÏóÜÏäµÎãàÎã§.
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- ÏãúÏÑ§ Í¥ÄÎ¶¨ -->
                <div id="admin-facility-tab" class="admin-content">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3 style="color: #1f2937;">ÏãúÏÑ§ Í¥ÄÎ¶¨ ÏöîÏ≤≠ Î™©Î°ù</h3>
                        <button onclick="exportToExcel('facility')" class="btn" style="font-size: 0.9rem; padding: 0.5rem 1rem;">
                            <span style="font-size: 1rem;">üìä</span> Excel Îã§Ïö¥Î°úÎìú
                        </button>
                    </div>

                    <div style="overflow-x: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th>Ï†úÎ™©</th>
                                    <th>ÏöîÏ≤≠Ïûê</th>
                                    <th>Î∂ÄÏÑú</th>
                                    <th>ÏãúÏÑ§Î™Ö</th>
                                    <th>ÏúÑÏπò</th>
                                    <th>Ïö∞ÏÑ†ÏàúÏúÑ</th>
                                    <th>ÏÉÅÌÉú</th>
                                    <th>Îì±Î°ùÏùº</th>
                                    <th>Í¥ÄÎ¶¨</th>
                                </tr>
                            </thead>
                            <tbody id="facility-requests-tbody">
                                <tr>
                                    <td colspan="9" style="text-align: center; color: #6b7280; padding: 2rem;">
                                        Îì±Î°ùÎêú ÏãúÏÑ§ Í¥ÄÎ¶¨ ÏöîÏ≤≠Ïù¥ ÏóÜÏäµÎãàÎã§.
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ÏÉÅÏÑ∏ Ï†ïÎ≥¥ Î™®Îã¨ -->
    <div id="detail-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;" onclick="closeModal()">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; border-radius: 20px; padding: 2rem; max-width: 600px; width: 90%; max-height: 80%; overflow-y: auto;" onclick="event.stopPropagation()">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h3 id="modal-title" style="color: #1f2937;">ÏöîÏ≤≠ ÏÉÅÏÑ∏ Ï†ïÎ≥¥</h3>
                <button onclick="closeModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">‚úï</button>
            </div>
            <div id="modal-content"></div>
        </div>
    </div>

    <script>
        // Ï†ÑÏó≠ Î≥ÄÏàò
        let currentTab = 'purchase';
        let isAdmin = false;
        let requests = [];
        let requestIdCounter = 1;

        // Firebase Ïó∞Í≤∞ ÏÉÅÌÉú
        let isFirebaseConnected = false;
        let firebaseRetryCount = 0;
        const MAX_RETRY_COUNT = 3;

        // ÌÉ≠ Ï†ÑÌôò
        function showTab(tabName) {
            // Î™®Îì† ÌÉ≠ ÎπÑÌôúÏÑ±Ìôî
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // ÏÑ†ÌÉùÌïú ÌÉ≠ ÌôúÏÑ±Ìôî
            event.target.closest('.tab').classList.add('active');
            document.getElementById(tabName + '-tab' + (tabName === 'admin' ? '-content' : '')).classList.add('active');
            
            currentTab = tabName;
        }

        // Í¥ÄÎ¶¨Ïûê ÌÉ≠ Ï†ÑÌôò
        function showAdminTab(tabName) {
            document.querySelectorAll('.admin-sub-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.admin-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById('admin-' + tabName + '-tab').classList.add('active');
            
            if (tabName === 'all') {
                loadAllRequests();
            } else if (tabName === 'purchase') {
                loadPurchaseRequests();
            } else if (tabName === 'facility') {
                loadFacilityRequests();
            }
        }

        // ÏïåÎ¶º ÌëúÏãú
        function showAlert(message, type = 'success') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert ${type}`;
            alertDiv.textContent = message;
            
            const container = document.querySelector('.tab-content.active') || document.body;
            container.insertBefore(alertDiv, container.firstChild);
            
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }

        // Firebase Ï¥àÍ∏∞Ìôî ÎåÄÍ∏∞
        async function waitForFirestore() {
            return new Promise((resolve) => {
                const checkFirestore = () => {
                    if (window.firebaseDB && window.firebaseAuth) {
                        resolve(true);
                    } else {
                        setTimeout(checkFirestore, 100);
                    }
                };
                checkFirestore();
            });
        }

        // Firebase Ïù∏Ï¶ù (ÏùµÎ™Ö Î°úÍ∑∏Ïù∏)
        async function initializeFirebaseAuth() {
            try {
                await waitForFirestore();
                const auth = window.firebaseAuth;
                
                // ÏùµÎ™Ö Î°úÍ∑∏Ïù∏
                await auth.signInAnonymously();
                isFirebaseConnected = true;
                
                console.log('üî• Firebase Ïù∏Ï¶ù ÏôÑÎ£å');
                showSyncStatus('connected', 'Ïã§ÏãúÍ∞Ñ ÎèôÍ∏∞Ìôî Ïó∞Í≤∞Îê®');
                
                // Ïã§ÏãúÍ∞Ñ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï
                setupRealtimeListeners();
                
            } catch (error) {
                console.error('‚ùå Firebase Ïù∏Ï¶ù Ïã§Ìå®:', error);
                handleFirebaseError(error);
            }
        }

        // Ïã§ÏãúÍ∞Ñ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï
        async function setupRealtimeListeners() {
            try {
                const { collection, query, orderBy, onSnapshot } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
                const db = window.firebaseDB;
                
                const q = query(collection(db, 'requests'), orderBy('createdAt', 'desc'));
                
                // Ïã§ÏãúÍ∞Ñ Î¶¨Ïä§ÎÑà
                onSnapshot(q, (snapshot) => {
                    const updatedRequests = [];
                    snapshot.forEach((doc) => {
                        updatedRequests.push({
                            firebaseId: doc.id,
                            ...doc.data()
                        });
                    });
                    
                    console.log('üî• Ïã§ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏:', updatedRequests.length, 'Í∞ú');
                    
                    // Ï†ÑÏó≠ ÏöîÏ≤≠ Î∞∞Ïó¥ ÏóÖÎç∞Ïù¥Ìä∏
                    requests = updatedRequests;
                    
                    // UI ÏóÖÎç∞Ïù¥Ìä∏
                    if (isAdmin) {
                        refreshAdminUI();
                    }
                    
                    showSyncStatus('synced', `${updatedRequests.length}Í∞ú ÏöîÏ≤≠ ÎèôÍ∏∞ÌôîÎê®`);
                }, (error) => {
                    console.error('‚ùå Ïã§ÏãúÍ∞Ñ Î¶¨Ïä§ÎÑà Ïò§Î•ò:', error);
                    showSyncStatus('error', 'Ïã§ÏãúÍ∞Ñ ÎèôÍ∏∞Ìôî Ïò§Î•ò');
                });
                
            } catch (error) {
                console.error('‚ùå Ïã§ÏãúÍ∞Ñ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï Ïã§Ìå®:', error);
            }
        }

        // ÏöîÏ≤≠ Îç∞Ïù¥ÌÑ∞Î•º FirebaseÏóê Ï†ÄÏû•
        async function saveRequestToFirebase(requestData) {
            try {
                if (!isFirebaseConnected) {
                    throw new Error('Firebase Ïó∞Í≤∞Ïù¥ ÎÅäÏñ¥Ïßê');
                }
                
                const { addDoc, collection } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
                const db = window.firebaseDB;
                
                // FirestoreÏóê Ï†ÄÏû•
                const docRef = await addDoc(collection(db, 'requests'), {
                    ...requestData,
                    createdAt: requestData.createdAt || new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                });
                
                console.log('üî• Firebase Ï†ÄÏû• ÏôÑÎ£å:', docRef.id);
                return docRef.id;
                
            } catch (error) {
                console.error('‚ùå Firebase Ï†ÄÏû• Ïã§Ìå®:', error);
                // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄÏóê Î∞±ÏóÖ Ï†ÄÏû•
                saveToLocalStorage(requestData);
                showSyncStatus('error', 'Firebase Ï†ÄÏû• Ïã§Ìå®, Î°úÏª¨Ïóê Î∞±ÏóÖÎê®');
                throw error;
            }
        }

        // FirebaseÏóêÏÑú ÏöîÏ≤≠ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
        async function updateRequestInFirebase(firebaseId, updates) {
            try {
                if (!isFirebaseConnected || !firebaseId) {
                    throw new Error('Firebase Ïó∞Í≤∞ ÎòêÎäî ID ÏóÜÏùå');
                }
                
                const { doc, updateDoc } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
                const db = window.firebaseDB;
                
                await updateDoc(doc(db, 'requests', firebaseId), {
                    ...updates,
                    updatedAt: new Date().toISOString()
                });
                
                console.log('üî• Firebase ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å:', firebaseId);
                
            } catch (error) {
                console.error('‚ùå Firebase ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìå®:', error);
                showSyncStatus('error', 'Firebase ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìå®');
                throw error;
            }
        }

        // ÎèôÍ∏∞Ìôî ÏÉÅÌÉú ÌëúÏãú
        function showSyncStatus(status, message) {
            const statusDiv = document.getElementById('sync-status');
            if (!statusDiv) return;
            
            const icons = {
                'connecting': 'üîÑ',
                'connected': 'üü¢',
                'synced': '‚úÖ',
                'error': 'üî¥',
                'offline': '‚ö´'
            };
            
            const colors = {
                'connecting': '#f59e0b',
                'connected': '#22c55e',
                'synced': '#10b981',
                'error': '#ef4444',
                'offline': '#6b7280'
            };
            
            statusDiv.innerHTML = `
                <span style="color: ${colors[status]};">${icons[status]}</span>
                <span style="font-size: 0.8rem; margin-left: 0.25rem;">${message}</span>
            `;
        }

        // Firebase Ïò§Î•ò Ï≤òÎ¶¨
        function handleFirebaseError(error) {
            firebaseRetryCount++;
            
            if (firebaseRetryCount <= MAX_RETRY_COUNT) {
                console.log(`üîÑ Firebase Ïû¨Ïó∞Í≤∞ ÏãúÎèÑ ${firebaseRetryCount}/${MAX_RETRY_COUNT}`);
                showSyncStatus('connecting', `Ïû¨Ïó∞Í≤∞ Ï§ë... (${firebaseRetryCount}/${MAX_RETRY_COUNT})`);
                
                setTimeout(() => {
                    initializeFirebaseAuth();
                }, 2000 * firebaseRetryCount);
            } else {
                console.log('‚ùå Firebase Ïó∞Í≤∞ Ìè¨Í∏∞, Ïò§ÌîÑÎùºÏù∏ Î™®ÎìúÎ°ú Ï†ÑÌôò');
                showSyncStatus('offline', 'Ïò§ÌîÑÎùºÏù∏ Î™®Îìú (Î°úÏª¨ Ï†ÄÏû•)');
                isFirebaseConnected = false;
            }
        }

        // Î°úÏª¨ Î∞±ÏóÖ Í∏∞Îä•
        function saveToLocalStorage(data) {
            try {
                const localData = JSON.parse(localStorage.getItem('requests_backup') || '[]');
                localData.unshift(data);
                localStorage.setItem('requests_backup', JSON.stringify(localData));
            } catch (error) {
                console.error('‚ùå Î°úÏª¨ Ï†ÄÏû• Ïã§Ìå®:', error);
            }
        }

        // Í¥ÄÎ¶¨Ïûê UI ÏÉàÎ°úÍ≥†Ïπ®
        function refreshAdminUI() {
            if (document.getElementById('admin-all-tab')?.style.display !== 'none') {
                loadAllRequests();
            }
            if (document.getElementById('admin-purchase-tab')?.style.display !== 'none') {
                loadPurchaseRequests();
            }
            if (document.getElementById('admin-facility-tab')?.style.display !== 'none') {
                loadFacilityRequests();
            }
            updateAllStats();
        }

        // Íµ¨Îß§ ÏöîÏ≤≠ Ï†úÏ∂ú
        async function submitPurchaseRequest(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const file = document.getElementById('quote-file').files[0];
            
            const requestData = {
                id: requestIdCounter++,
                type: 'purchase',
                title: formData.get('title'),
                department: formData.get('department'),
                item: formData.get('item'),
                quantity: formData.get('quantity'),
                budget: parseInt(formData.get('budget')),
                reason: formData.get('reason'),
                status: 'ÎåÄÍ∏∞',
                requestedBy: formData.get('requestedBy'),
                priority: formData.get('priority') || 'Î≥¥ÌÜµ',
                quoteFile: file ? {
                    name: file.name,
                    size: file.size,
                    type: file.type,
                    lastModified: file.lastModified
                } : null,
                createdAt: new Date().toISOString()
            };
            
            // FirebaseÏóê Ï†ÄÏû• ÏãúÎèÑ
            if (isFirebaseConnected) {
                try {
                    const firebaseId = await saveRequestToFirebase(requestData);
                    requestData.firebaseId = firebaseId;
                    showAlert('Íµ¨Îß§ ÏöîÏ≤≠Ïù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï†úÏ∂úÎêòÏóàÏäµÎãàÎã§! (Ïã§ÏãúÍ∞Ñ ÎèôÍ∏∞Ìôî)', 'success');
                } catch (error) {
                    // Firebase Ïã§Ìå® Ïãú Î°úÏª¨Ïóê Ï†ÄÏû•
                    requests.unshift(requestData);
                    saveToStorage();
                    showAlert('Íµ¨Îß§ ÏöîÏ≤≠Ïù¥ Ï†úÏ∂úÎêòÏóàÏäµÎãàÎã§. (Î°úÏª¨ Ï†ÄÏû•)', 'success');
                }
            } else {
                // Ïò§ÌîÑÎùºÏù∏ Î™®Îìú: Î°úÏª¨ÏóêÎßå Ï†ÄÏû•
                requests.unshift(requestData);
                saveToStorage();
                showAlert('Íµ¨Îß§ ÏöîÏ≤≠Ïù¥ Ï†úÏ∂úÎêòÏóàÏäµÎãàÎã§. (Ïò§ÌîÑÎùºÏù∏ Î™®Îìú)', 'success');
            }
            
            e.target.reset();
            
            console.log('üõí ÏÉàÎ°úÏö¥ Íµ¨Îß§ ÏöîÏ≤≠:', requestData);
        }

        // ÏãúÏÑ§ Í¥ÄÎ¶¨ ÏöîÏ≤≠ Ï†úÏ∂ú
        async function submitFacilityRequest(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const photos = document.getElementById('facility-photos').files;
            
            // ÏÇ¨ÏßÑ Îç∞Ïù¥ÌÑ∞ Ï≤òÎ¶¨
            const photoData = [];
            for (let i = 0; i < photos.length; i++) {
                photoData.push({
                    name: photos[i].name,
                    size: photos[i].size,
                    type: photos[i].type,
                    lastModified: photos[i].lastModified
                });
            }
            
            const requestData = {
                id: requestIdCounter++,
                type: 'facility',
                title: formData.get('title'),
                department: formData.get('department'),
                facility: formData.get('facility'),
                description: formData.get('description'),
                status: 'ÎåÄÍ∏∞',
                requestedBy: formData.get('requestedBy'),
                priority: formData.get('priority') || 'Î≥¥ÌÜµ',
                phone: formData.get('phone') || '',
                location: formData.get('location') || '',
                facilityPhotos: photoData.length > 0 ? photoData : null,
                createdAt: new Date().toISOString()
            };
            
            // FirebaseÏóê Ï†ÄÏû• ÏãúÎèÑ
            if (isFirebaseConnected) {
                try {
                    const firebaseId = await saveRequestToFirebase(requestData);
                    requestData.firebaseId = firebaseId;
                    showAlert('ÏãúÏÑ§ Í¥ÄÎ¶¨ ÏöîÏ≤≠Ïù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï†úÏ∂úÎêòÏóàÏäµÎãàÎã§! (Ïã§ÏãúÍ∞Ñ ÎèôÍ∏∞Ìôî)', 'success');
                } catch (error) {
                    // Firebase Ïã§Ìå® Ïãú Î°úÏª¨Ïóê Ï†ÄÏû•
                    requests.unshift(requestData);
                    saveToStorage();
                    showAlert('ÏãúÏÑ§ Í¥ÄÎ¶¨ ÏöîÏ≤≠Ïù¥ Ï†úÏ∂úÎêòÏóàÏäµÎãàÎã§. (Î°úÏª¨ Ï†ÄÏû•)', 'success');
                }
            } else {
                // Ïò§ÌîÑÎùºÏù∏ Î™®Îìú: Î°úÏª¨ÏóêÎßå Ï†ÄÏû•
                requests.unshift(requestData);
                saveToStorage();
                showAlert('ÏãúÏÑ§ Í¥ÄÎ¶¨ ÏöîÏ≤≠Ïù¥ Ï†úÏ∂úÎêòÏóàÏäµÎãàÎã§. (Ïò§ÌîÑÎùºÏù∏ Î™®Îìú)', 'success');
            }
            
            e.target.reset();
            
            // ÏÇ¨ÏßÑ ÏóÖÎ°úÎìú UI Ï¥àÍ∏∞Ìôî
            resetPhotoUpload();
            
            console.log('üîß ÏÉàÎ°úÏö¥ ÏãúÏÑ§ Í¥ÄÎ¶¨ ÏöîÏ≤≠:', requestData);
        }

        // Í¥ÄÎ¶¨Ïûê Î°úÍ∑∏Ïù∏
        function adminLogin(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const username = formData.get('username');
            const password = formData.get('password');
            
            if (username === 'admin' && password === 'admin123') {
                isAdmin = true;
                document.getElementById('admin-login').style.display = 'none';
                document.getElementById('admin-panel').style.display = 'block';
                document.getElementById('admin-tab').innerHTML = '<span style="font-size: 1.2rem;">üë®‚Äçüíº</span><br>Í¥ÄÎ¶¨Ïûê (Î°úÍ∑∏Ïù∏Îê®)';
                
                showAlert('Í¥ÄÎ¶¨ÏûêÎ°ú Î°úÍ∑∏Ïù∏ÎêòÏóàÏäµÎãàÎã§.', 'success');
                showAdminTab('all');
            } else {
                showAlert('ÏûòÎ™ªÎêú Í¥ÄÎ¶¨Ïûê Ï†ïÎ≥¥ÏûÖÎãàÎã§.', 'error');
            }
        }

        // ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
        async function updateStatus(requestId, newStatus) {
            const request = requests.find(r => r.id === requestId);
            if (request) {
                request.status = newStatus;
                request.updatedAt = new Date().toISOString();
                
                // FirebaseÏóê ÏóÖÎç∞Ïù¥Ìä∏ ÏãúÎèÑ
                if (isFirebaseConnected && request.firebaseId) {
                    try {
                        await updateRequestInFirebase(request.firebaseId, {
                            status: newStatus,
                            updatedAt: request.updatedAt
                        });
                        showAlert(`ÏöîÏ≤≠ ÏÉÅÌÉúÍ∞Ä "${newStatus}"Î°ú ÏóÖÎç∞Ïù¥Ìä∏ÎêòÏóàÏäµÎãàÎã§. (Ïã§ÏãúÍ∞Ñ ÎèôÍ∏∞Ìôî)`, 'success');
                    } catch (error) {
                        // Firebase ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìå® Ïãú Î°úÏª¨Îßå Ï†ÄÏû•
                        saveToStorage();
                        showAlert(`ÏöîÏ≤≠ ÏÉÅÌÉúÍ∞Ä "${newStatus}"Î°ú ÏóÖÎç∞Ïù¥Ìä∏ÎêòÏóàÏäµÎãàÎã§. (Î°úÏª¨ Ï†ÄÏû•)`, 'success');
                    }
                } else {
                    // Ïò§ÌîÑÎùºÏù∏ Î™®Îìú: Î°úÏª¨ÏóêÎßå Ï†ÄÏû•
                    saveToStorage();
                    showAlert(`ÏöîÏ≤≠ ÏÉÅÌÉúÍ∞Ä "${newStatus}"Î°ú ÏóÖÎç∞Ïù¥Ìä∏ÎêòÏóàÏäµÎãàÎã§. (Ïò§ÌîÑÎùºÏù∏ Î™®Îìú)`, 'success');
                }
            }
        }

        // ÌååÏùº Ï≤òÎ¶¨ Ìï®ÏàòÎì§
        function handleQuoteFile(event) {
            const file = event.target.files[0];
            const infoDiv = document.getElementById('quote-file-info');
            
            if (file) {
                if (file.size > 10 * 1024 * 1024) {
                    showAlert('ÌååÏùº ÌÅ¨Í∏∞Îäî 10MBÎ•º Ï¥àÍ≥ºÌï† Ïàò ÏóÜÏäµÎãàÎã§.', 'error');
                    event.target.value = '';
                    return;
                }
                
                infoDiv.innerHTML = `
                    <div style="background: #f0f9ff; border: 1px solid #0ea5e9; border-radius: 8px; padding: 1rem;">
                        <p><strong>üìé ${file.name}</strong></p>
                        <p style="color: #6b7280; font-size: 0.9rem;">
                            ÌÅ¨Í∏∞: ${(file.size / 1024 / 1024).toFixed(2)}MB | 
                            Ïú†Ìòï: ${file.type || 'Ïïå Ïàò ÏóÜÏùå'}
                        </p>
                    </div>
                `;
                infoDiv.style.display = 'block';
            } else {
                infoDiv.style.display = 'none';
            }
        }

        function handleFacilityPhotos(event) {
            const files = Array.from(event.target.files);
            const previewDiv = document.getElementById('photo-preview');
            
            if (files.length > 5) {
                showAlert('ÏµúÎåÄ 5Ïû•ÍπåÏßÄÎßå ÏóÖÎ°úÎìúÌï† Ïàò ÏûàÏäµÎãàÎã§.', 'error');
                return;
            }
            
            previewDiv.innerHTML = '';
            
            files.forEach((file, index) => {
                if (file.size > 5 * 1024 * 1024) {
                    showAlert(`${file.name}Ïùò ÌååÏùº ÌÅ¨Í∏∞Í∞Ä 5MBÎ•º Ï¥àÍ≥ºÌï©ÎãàÎã§.`, 'error');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const photoDiv = document.createElement('div');
                    photoDiv.style.cssText = `
                        display: inline-block;
                        margin: 0.5rem;
                        border: 1px solid #d1d5db;
                        border-radius: 8px;
                        overflow: hidden;
                        position: relative;
                    `;
                    
                    photoDiv.innerHTML = `
                        <img src="${e.target.result}" alt="ÎØ∏Î¶¨Î≥¥Í∏∞" style="width: 100px; height: 100px; object-fit: cover;">
                        <div style="padding: 0.5rem; font-size: 0.8rem; color: #6b7280;">
                            ${file.name}<br>
                            ${(file.size / 1024 / 1024).toFixed(2)}MB
                        </div>
                    `;
                    
                    previewDiv.appendChild(photoDiv);
                };
                reader.readAsDataURL(file);
            });
        }

        function resetPhotoUpload() {
            document.getElementById('facility-photos').value = '';
            document.getElementById('photo-preview').innerHTML = '';
        }

        // Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ìï®ÏàòÎì§
        function loadAllRequests() {
            const tbody = document.getElementById('all-requests-tbody');
            tbody.innerHTML = '';
            
            if (requests.length === 0) {
                tbody.innerHTML = '<tr><td colspan="11" style="text-align: center; color: #6b7280; padding: 2rem;">Îì±Î°ùÎêú ÏöîÏ≤≠Ïù¥ ÏóÜÏäµÎãàÎã§.</td></tr>';
                return;
            }
            
            requests.forEach(request => {
                const row = document.createElement('tr');
                row.className = 'clickable-row';
                row.onclick = () => showRequestDetail(request);
                createAllRequestRow(row, request);
                tbody.appendChild(row);
            });
            
            updateAllStats();
        }

        function loadPurchaseRequests() {
            const tbody = document.getElementById('purchase-requests-tbody');
            tbody.innerHTML = '';
            
            const purchaseRequests = requests.filter(r => r.type === 'purchase');
            
            if (purchaseRequests.length === 0) {
                tbody.innerHTML = '<tr><td colspan="10" style="text-align: center; color: #6b7280; padding: 2rem;">Îì±Î°ùÎêú Íµ¨Îß§ ÏöîÏ≤≠Ïù¥ ÏóÜÏäµÎãàÎã§.</td></tr>';
                return;
            }
            
            purchaseRequests.forEach(request => {
                const row = document.createElement('tr');
                row.className = 'clickable-row';
                row.onclick = () => showRequestDetail(request);
                createPurchaseRequestRow(row, request);
                tbody.appendChild(row);
            });
        }

        function loadFacilityRequests() {
            const tbody = document.getElementById('facility-requests-tbody');
            tbody.innerHTML = '';
            
            const facilityRequests = requests.filter(r => r.type === 'facility');
            
            if (facilityRequests.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" style="text-align: center; color: #6b7280; padding: 2rem;">Îì±Î°ùÎêú ÏãúÏÑ§ Í¥ÄÎ¶¨ ÏöîÏ≤≠Ïù¥ ÏóÜÏäµÎãàÎã§.</td></tr>';
                return;
            }
            
            facilityRequests.forEach(request => {
                const row = document.createElement('tr');
                row.className = 'clickable-row';
                row.onclick = () => showRequestDetail(request);
                createFacilityRequestRow(row, request);
                tbody.appendChild(row);
            });
        }

        // ÌÖåÏù¥Î∏î Ìñâ ÏÉùÏÑ± Ìï®ÏàòÎì§
        function createAllRequestRow(row, request) {
            const typeIcon = request.type === 'purchase' ? 'üõí' : 'üîß';
            const typeName = request.type === 'purchase' ? 'Íµ¨Îß§ÏöîÏ≤≠' : 'ÏãúÏÑ§Í¥ÄÎ¶¨';
            
            row.innerHTML = `
                <td><span class="badge">${typeIcon} ${typeName}</span></td>
                <td style="max-width: 200px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${request.title}</td>
                <td>${request.requestedBy}</td>
                <td>${request.department}</td>
                <td>${request.type === 'purchase' ? request.item : request.facility}</td>
                <td>${request.type === 'purchase' ? formatQuantity(request.quantity) : request.location}</td>
                <td>
                    ${request.type === 'purchase' && request.budget
                        ? `<span style="font-weight: 600; color: #059669;">${request.budget.toLocaleString()}Ïõê</span>`
                        : request.type === 'purchase' ? '-' : '-'}
                </td>
                <td><span class="badge ${getPriorityBadgeClass(request.priority || 'Î≥¥ÌÜµ')}">${request.priority || 'Î≥¥ÌÜµ'}</span></td>
                <td><span class="badge ${getStatusBadgeClass(request.status)}">${request.status}</span></td>
                <td>${formatDate(request.createdAt)}</td>
                <td>
                    <select onchange="updateStatus(${request.id}, this.value)" onclick="event.stopPropagation()">
                        <option value="ÎåÄÍ∏∞" ${request.status === 'ÎåÄÍ∏∞' ? 'selected' : ''}>ÎåÄÍ∏∞</option>
                        <option value="ÏßÑÌñâÏ§ë" ${request.status === 'ÏßÑÌñâÏ§ë' ? 'selected' : ''}>ÏßÑÌñâÏ§ë</option>
                        <option value="ÏôÑÎ£å" ${request.status === 'ÏôÑÎ£å' ? 'selected' : ''}>ÏôÑÎ£å</option>
                        <option value="Ï∑®ÏÜå" ${request.status === 'Ï∑®ÏÜå' ? 'selected' : ''}>Ï∑®ÏÜå</option>
                    </select>
                </td>
            `;
        }

        function createPurchaseRequestRow(row, request) {
            row.innerHTML = `
                <td style="max-width: 200px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${request.title}</td>
                <td>${request.requestedBy}</td>
                <td>${request.department}</td>
                <td>${request.item}</td>
                <td><span class="badge" style="background: #f3f4f6; color: #374151;">${formatQuantity(request.quantity)}</span></td>
                <td style="font-weight: 600; color: #059669; text-align: right;">${request.budget ? request.budget.toLocaleString() + 'Ïõê' : '-'}</td>
                <td><span class="badge ${getPriorityBadgeClass(request.priority || 'Î≥¥ÌÜµ')}">${request.priority || 'Î≥¥ÌÜµ'}</span></td>
                <td><span class="badge ${getStatusBadgeClass(request.status)}">${request.status}</span></td>
                <td>${formatDate(request.createdAt)}</td>
                <td>
                    <select onchange="updateStatus(${request.id}, this.value)" onclick="event.stopPropagation()">
                        <option value="ÎåÄÍ∏∞" ${request.status === 'ÎåÄÍ∏∞' ? 'selected' : ''}>ÎåÄÍ∏∞</option>
                        <option value="ÏßÑÌñâÏ§ë" ${request.status === 'ÏßÑÌñâÏ§ë' ? 'selected' : ''}>ÏßÑÌñâÏ§ë</option>
                        <option value="ÏôÑÎ£å" ${request.status === 'ÏôÑÎ£å' ? 'selected' : ''}>ÏôÑÎ£å</option>
                        <option value="Ï∑®ÏÜå" ${request.status === 'Ï∑®ÏÜå' ? 'selected' : ''}>Ï∑®ÏÜå</option>
                    </select>
                </td>
            `;
        }

        function createFacilityRequestRow(row, request) {
            row.innerHTML = `
                <td style="max-width: 200px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${request.title}</td>
                <td>${request.requestedBy}</td>
                <td>${request.department}</td>
                <td>${request.facility}</td>
                <td>${request.location}</td>
                <td><span class="badge ${getPriorityBadgeClass(request.priority || 'Î≥¥ÌÜµ')}">${request.priority || 'Î≥¥ÌÜµ'}</span></td>
                <td><span class="badge ${getStatusBadgeClass(request.status)}">${request.status}</span></td>
                <td>${formatDate(request.createdAt)}</td>
                <td>
                    <select onchange="updateStatus(${request.id}, this.value)" onclick="event.stopPropagation()">
                        <option value="ÎåÄÍ∏∞" ${request.status === 'ÎåÄÍ∏∞' ? 'selected' : ''}>ÎåÄÍ∏∞</option>
                        <option value="ÏßÑÌñâÏ§ë" ${request.status === 'ÏßÑÌñâÏ§ë' ? 'selected' : ''}>ÏßÑÌñâÏ§ë</option>
                        <option value="ÏôÑÎ£å" ${request.status === 'ÏôÑÎ£å' ? 'selected' : ''}>ÏôÑÎ£å</option>
                        <option value="Ï∑®ÏÜå" ${request.status === 'Ï∑®ÏÜå' ? 'selected' : ''}>Ï∑®ÏÜå</option>
                    </select>
                </td>
            `;
        }

        // Ïú†Ìã∏Î¶¨Ìã∞ Ìï®ÏàòÎì§
        function formatQuantity(quantity) {
            if (!quantity) return '-';
            
            // Ïà´ÏûêÎßå ÏûàÎäî Í≤ΩÏö∞ "Í∞ú" Ï∂îÍ∞Ä
            if (/^\d+$/.test(quantity.toString())) {
                return quantity + 'Í∞ú';
            }
            
            // Ïù¥ÎØ∏ Îã®ÏúÑÍ∞Ä ÏûàÍ±∞ÎÇò Î¨∏ÏûêÍ∞Ä Ìè¨Ìï®Îêú Í≤ΩÏö∞ Í∑∏ÎåÄÎ°ú Î∞òÌôò
            return quantity.toString();
        }

        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleDateString('ko-KR') + ' ' + date.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
        }

        function getStatusBadgeClass(status) {
            switch (status) {
                case 'ÎåÄÍ∏∞': return 'status-pending';
                case 'ÏßÑÌñâÏ§ë': return 'status-progress';
                case 'ÏôÑÎ£å': return 'status-completed';
                case 'Ï∑®ÏÜå': return 'status-cancelled';
                default: return 'status-pending';
            }
        }

        function getPriorityBadgeClass(priority) {
            switch (priority) {
                case 'Í∏¥Í∏â': return 'priority-urgent';
                case 'ÎÜíÏùå': return 'priority-high';
                case 'Î≥¥ÌÜµ': return 'priority-normal';
                case 'ÎÇÆÏùå': return 'priority-low';
                default: return 'priority-normal';
            }
        }

        function updateAllStats() {
            const total = requests.length;
            const pending = requests.filter(r => r.status === 'ÎåÄÍ∏∞').length;
            const progress = requests.filter(r => r.status === 'ÏßÑÌñâÏ§ë').length;
            const completed = requests.filter(r => r.status === 'ÏôÑÎ£å').length;
            
            document.getElementById('total-requests').textContent = total;
            document.getElementById('pending-requests').textContent = pending;
            document.getElementById('progress-requests').textContent = progress;
            document.getElementById('completed-requests').textContent = completed;
        }

        // ÏÉÅÏÑ∏ Ï†ïÎ≥¥ Î™®Îã¨
        function showRequestDetail(request) {
            const modal = document.getElementById('detail-modal');
            const title = document.getElementById('modal-title');
            const content = document.getElementById('modal-content');
            
            title.textContent = `${request.type === 'purchase' ? 'Íµ¨Îß§ ÏöîÏ≤≠' : 'ÏãúÏÑ§ Í¥ÄÎ¶¨'} ÏÉÅÏÑ∏ Ï†ïÎ≥¥`;
            
            let detailHTML = `
                <div style="margin-bottom: 1rem;">
                    <strong>üìù Ï†úÎ™©:</strong> ${request.title}
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                    <div><strong>üë§ ÏöîÏ≤≠Ïûê:</strong> ${request.requestedBy}</div>
                    <div><strong>üè¢ Î∂ÄÏÑú:</strong> ${request.department}</div>
                </div>
            `;
            
            if (request.type === 'purchase') {
                detailHTML += `
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                        <div><strong>üì¶ Î¨ºÌíàÎ™Ö:</strong> ${request.item}</div>
                        <div><strong>üìä ÏàòÎüâ:</strong> ${formatQuantity(request.quantity)}</div>
                        <div><strong>üí∞ ÏòàÏÇ∞:</strong> ${request.budget ? request.budget.toLocaleString() + 'Ïõê' : '-'}</div>
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <strong>üìù Íµ¨Îß§ ÏÇ¨Ïú†:</strong><br>
                        <div style="background: #f9fafb; padding: 1rem; border-radius: 8px; margin-top: 0.5rem;">${request.reason}</div>
                    </div>
                `;
                
                if (request.quoteFile) {
                    detailHTML += `
                        <div style="margin-bottom: 1rem;">
                            <strong>üìé Í≤¨Ï†ÅÏÑú:</strong> ${request.quoteFile.name}
                            <span style="color: #6b7280; font-size: 0.9rem;">(${(request.quoteFile.size / 1024 / 1024).toFixed(2)}MB)</span>
                        </div>
                    `;
                }
            } else {
                detailHTML += `
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                        <div><strong>üèóÔ∏è ÏãúÏÑ§Î™Ö:</strong> ${request.facility}</div>
                        <div><strong>üìç ÏúÑÏπò:</strong> ${request.location}</div>
                    </div>
                    ${request.phone ? `<div style="margin-bottom: 1rem;"><strong>üìû Ïó∞ÎùΩÏ≤ò:</strong> ${request.phone}</div>` : ''}
                    <div style="margin-bottom: 1rem;">
                        <strong>üìã Î¨∏Ï†ú ÏÉÅÌô©:</strong><br>
                        <div style="background: #f9fafb; padding: 1rem; border-radius: 8px; margin-top: 0.5rem;">${request.description}</div>
                    </div>
                `;
                
                if (request.facilityPhotos && request.facilityPhotos.length > 0) {
                    detailHTML += `
                        <div style="margin-bottom: 1rem;">
                            <strong>üì∑ Ï≤®Î∂Ä ÏÇ¨ÏßÑ:</strong> ${request.facilityPhotos.length}Ïû•
                        </div>
                    `;
                }
            }
            
            detailHTML += `
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                    <div><strong>‚≠ê Ïö∞ÏÑ†ÏàúÏúÑ:</strong> <span class="badge ${getPriorityBadgeClass(request.priority || 'Î≥¥ÌÜµ')}">${request.priority || 'Î≥¥ÌÜµ'}</span></div>
                    <div><strong>üìä ÏÉÅÌÉú:</strong> <span class="badge ${getStatusBadgeClass(request.status)}">${request.status}</span></div>
                    <div><strong>üìÖ Îì±Î°ùÏùº:</strong> ${formatDate(request.createdAt)}</div>
                </div>
            `;
            
            if (request.updatedAt && request.updatedAt !== request.createdAt) {
                detailHTML += `
                    <div style="margin-bottom: 1rem;">
                        <strong>üîÑ ÏàòÏ†ïÏùº:</strong> ${formatDate(request.updatedAt)}
                    </div>
                `;
            }
            
            content.innerHTML = detailHTML;
            modal.style.display = 'block';
        }

        function closeModal() {
            document.getElementById('detail-modal').style.display = 'none';
        }

        // Excel ÎÇ¥Î≥¥ÎÇ¥Í∏∞
        function exportToExcel(type) {
            let data = [];
            let filename = '';
            
            if (type === 'all') {
                data = requests.map(request => ({
                    'Ïú†Ìòï': request.type === 'purchase' ? 'Íµ¨Îß§ÏöîÏ≤≠' : 'ÏãúÏÑ§Í¥ÄÎ¶¨',
                    'Ï†úÎ™©': request.title,
                    'ÏöîÏ≤≠Ïûê': request.requestedBy,
                    'Î∂ÄÏÑú': request.department,
                    'Î¨ºÌíà/ÏãúÏÑ§': request.type === 'purchase' ? request.item : request.facility,
                    'ÏàòÎüâ/ÏúÑÏπò': request.quantity ? formatQuantity(request.quantity) : request.location || '-',
                    'ÏòàÏÇ∞': request.type === 'purchase' && request.budget ? request.budget.toLocaleString() + 'Ïõê' : '-',
                    'Ïö∞ÏÑ†ÏàúÏúÑ': request.priority || 'Î≥¥ÌÜµ',
                    'ÏÉÅÌÉú': request.status,
                    'Îì±Î°ùÏùº': formatDate(request.createdAt)
                }));
                filename = 'Ï†ÑÏ≤¥_ÏöîÏ≤≠_Î™©Î°ù';
            } else if (type === 'purchase') {
                const purchaseRequests = requests.filter(r => r.type === 'purchase');
                data = purchaseRequests.map(request => ({
                    'Ï†úÎ™©': request.title,
                    'ÏöîÏ≤≠Ïûê': request.requestedBy,
                    'Î∂ÄÏÑú': request.department,
                    'Î¨ºÌíàÎ™Ö': request.item,
                    'ÏàòÎüâ': formatQuantity(request.quantity),
                    'ÏòàÏÇ∞ (Ïõê)': request.budget ? request.budget.toLocaleString() : '-',
                    'Ïö∞ÏÑ†ÏàúÏúÑ': request.priority || 'Î≥¥ÌÜµ',
                    'ÏÉÅÌÉú': request.status,
                    'Íµ¨Îß§ ÏÇ¨Ïú†': request.reason,
                    'Îì±Î°ùÏùº': formatDate(request.createdAt)
                }));
                filename = 'Íµ¨Îß§_ÏöîÏ≤≠_Î™©Î°ù';
            } else if (type === 'facility') {
                const facilityRequests = requests.filter(r => r.type === 'facility');
                data = facilityRequests.map(request => ({
                    'Ï†úÎ™©': request.title,
                    'ÏöîÏ≤≠Ïûê': request.requestedBy,
                    'Î∂ÄÏÑú': request.department,
                    'ÏãúÏÑ§Î™Ö': request.facility,
                    'ÏúÑÏπò': request.location,
                    'Ïó∞ÎùΩÏ≤ò': request.phone || '-',
                    'Ïö∞ÏÑ†ÏàúÏúÑ': request.priority || 'Î≥¥ÌÜµ',
                    'ÏÉÅÌÉú': request.status,
                    'Î¨∏Ï†ú ÏÉÅÌô©': request.description,
                    'Îì±Î°ùÏùº': formatDate(request.createdAt)
                }));
                filename = 'ÏãúÏÑ§Í¥ÄÎ¶¨_ÏöîÏ≤≠_Î™©Î°ù';
            }
            
            if (data.length === 0) {
                showAlert('ÎÇ¥Î≥¥ÎÇº Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.', 'error');
                return;
            }
            
            // SheetJSÎ•º ÏÇ¨Ïö©Ìïú Excel ÏÉùÏÑ±
            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "ÏöîÏ≤≠ Î™©Î°ù");
            
            // ÌååÏùº Îã§Ïö¥Î°úÎìú
            const today = new Date().toISOString().split('T')[0];
            XLSX.writeFile(wb, `${filename}_${today}.xlsx`);
            
            showAlert('Excel ÌååÏùºÏù¥ Îã§Ïö¥Î°úÎìúÎêòÏóàÏäµÎãàÎã§.', 'success');
        }

        // Ï†ÄÏû• Ìï®Ïàò
        function saveToStorage() {
            try {
                localStorage.setItem('requests', JSON.stringify(requests));
            } catch (error) {
                console.error('Î°úÏª¨ Ï†ÄÏû• Ïã§Ìå®:', error);
            }
        }

        // Service Worker Îì±Î°ù
        async function registerServiceWorker() {
            if ('serviceWorker' in navigator) {
                try {
                    const registration = await navigator.serviceWorker.register('/sw.js');
                    console.log('‚úÖ Service Worker Îì±Î°ù ÏÑ±Í≥µ:', registration.scope);
                    
                    // ÏóÖÎç∞Ïù¥Ìä∏ ÌôïÏù∏
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                // ÏÉà Î≤ÑÏ†Ñ ÏÇ¨Ïö© Í∞ÄÎä•
                                showUpdateAvailablePrompt();
                            }
                        });
                    });
                    
                } catch (error) {
                    console.error('‚ùå Service Worker Îì±Î°ù Ïã§Ìå®:', error);
                }
            } else {
                console.log('üö´ Ïù¥ Î∏åÎùºÏö∞Ï†ÄÎäî Service WorkerÎ•º ÏßÄÏõêÌïòÏßÄ ÏïäÏäµÎãàÎã§.');
            }
        }

        // PWA ÏÑ§Ïπò ÌîÑÎ°¨ÌîÑÌä∏ ÏÑ§Ï†ï
        function setupPWAInstallPrompt() {
            let deferredPrompt;
            
            window.addEventListener('beforeinstallprompt', (e) => {
                console.log('üì± PWA ÏÑ§Ïπò ÌîÑÎ°¨ÌîÑÌä∏ Ï§ÄÎπÑ');
                e.preventDefault();
                deferredPrompt = e;
                
                // ÏÑ§Ïπò Î≤ÑÌäº ÌëúÏãú (Ìó§ÎçîÏóê Ï∂îÍ∞Ä)
                showInstallButton(deferredPrompt);
            });
            
            window.addEventListener('appinstalled', (evt) => {
                console.log('üéâ PWA ÏÑ§Ïπò ÏôÑÎ£å');
                showAlert('Ïï±Ïù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú ÏÑ§ÏπòÎêòÏóàÏäµÎãàÎã§!', 'success');
                hideInstallButton();
            });
        }

        // ÏÑ§Ïπò Î≤ÑÌäº ÌëúÏãú
        function showInstallButton(deferredPrompt) {
            const syncStatus = document.getElementById('sync-status');
            if (!syncStatus) return;
            
            const installBtn = document.createElement('button');
            installBtn.id = 'install-btn';
            installBtn.innerHTML = 'üì± Ïï± ÏÑ§Ïπò';
            installBtn.style.cssText = `
                margin-left: 1rem;
                padding: 0.5rem 1rem;
                background: #10b981;
                color: white;
                border: none;
                border-radius: 20px;
                font-size: 0.8rem;
                cursor: pointer;
                transition: all 0.3s ease;
            `;
            
            installBtn.onclick = async () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    console.log('PWA ÏÑ§Ïπò ÏÑ†ÌÉù:', outcome);
                    deferredPrompt = null;
                    hideInstallButton();
                }
            };
            
            syncStatus.parentElement.appendChild(installBtn);
        }

        // ÏÑ§Ïπò Î≤ÑÌäº Ïà®Í∏∞Í∏∞
        function hideInstallButton() {
            const installBtn = document.getElementById('install-btn');
            if (installBtn) {
                installBtn.remove();
            }
        }

        // ÏóÖÎç∞Ïù¥Ìä∏ ÏÇ¨Ïö© Í∞ÄÎä• ÌîÑÎ°¨ÌîÑÌä∏
        function showUpdateAvailablePrompt() {
            const updatePrompt = confirm(
                'ÏÉàÎ°úÏö¥ Î≤ÑÏ†ÑÏù¥ ÏÇ¨Ïö© Í∞ÄÎä•Ìï©ÎãàÎã§.\nÌéòÏù¥ÏßÄÎ•º ÏÉàÎ°úÍ≥†Ïπ®ÌïòÏó¨ ÏóÖÎç∞Ïù¥Ìä∏ÌïòÏãúÍ≤†ÏäµÎãàÍπå?'
            );
            
            if (updatePrompt) {
                // Service WorkerÏóêÍ≤å skipWaiting Ïã†Ìò∏ Ï†ÑÏÜ°
                if (navigator.serviceWorker.controller) {
                    navigator.serviceWorker.controller.postMessage({ type: 'SKIP_WAITING' });
                }
                window.location.reload();
            }
        }

        // Ï¥àÍ∏∞Ìôî
        document.addEventListener('DOMContentLoaded', function() {
            // Service Worker Îì±Î°ù
            registerServiceWorker();
            
            // Firebase Ïó∞Í≤∞ ÏãúÎèÑ
            setTimeout(() => {
                initializeFirebaseAuth();
            }, 500);
            
            // ÎÑ§Ìä∏ÏõåÌÅ¨ ÏÉÅÌÉú Î™®ÎãàÌÑ∞ÎßÅ
            window.addEventListener('online', function() {
                console.log('üåê ÎÑ§Ìä∏ÏõåÌÅ¨ Ïó∞Í≤∞Îê®');
                if (!isFirebaseConnected) {
                    initializeFirebaseAuth();
                }
            });
            
            window.addEventListener('offline', function() {
                console.log('üì± Ïò§ÌîÑÎùºÏù∏ ÏÉÅÌÉú');
                showSyncStatus('offline', 'Ïò§ÌîÑÎùºÏù∏ Î™®Îìú');
                isFirebaseConnected = false;
            });
            
            // PWA ÏÑ§Ïπò ÌîÑÎ°¨ÌîÑÌä∏ Ï≤òÎ¶¨
            setupPWAInstallPrompt();
            
            // ÌéòÏù¥Îìú Ïù∏ Ïï†ÎãàÎ©îÏù¥ÏÖò
            setTimeout(() => {
                document.body.style.opacity = '1';
            }, 100);
            
            console.log('üéØ ÌÜµÌï© ÏöîÏ≤≠ Í¥ÄÎ¶¨ ÏãúÏä§ÌÖúÏù¥ Ï¥àÍ∏∞ÌôîÎêòÏóàÏäµÎãàÎã§.');
        });

        // Service Worker Î©îÏãúÏßÄ ÏàòÏã†
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.addEventListener('message', event => {
                console.log('üí¨ Service Worker Î©îÏãúÏßÄ:', event.data);
                
                if (event.data.type === 'SYNC_LOCAL_DATA') {
                    // Î∞±Í∑∏ÎùºÏö¥Îìú ÎèôÍ∏∞ÌôîÎêú Îç∞Ïù¥ÌÑ∞ Ï≤òÎ¶¨
                    console.log('üîÑ Î∞±Í∑∏ÎùºÏö¥Îìú ÎèôÍ∏∞Ìôî Îç∞Ïù¥ÌÑ∞ ÏàòÏã†');
                    // ÌïÑÏöî Ïãú UI ÏóÖÎç∞Ïù¥Ìä∏
                }
            });
        }
    </script>

    <!-- SheetJS ÎùºÏù¥Î∏åÎü¨Î¶¨ (Excel ÌååÏùº ÏÉùÏÑ±Ïö©) -->
    <script src="https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

</body>
</html>
