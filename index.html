<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üè¢ Ï¥ùÎ¨¥Ï≤ò ÌÜµÌï© ÏöîÏ≤≠ Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú</title>
    
    <!-- PWA ÏÑ§Ï†ï -->
    <meta name="description" content="Ï¥ùÎ¨¥Ï≤ò Íµ¨Îß§ ÏöîÏ≤≠ Î∞è ÏãúÏÑ§ Í¥ÄÎ¶¨ ÌÜµÌï© ÌîåÎû´Ìèº">
    <meta name="theme-color" content="#3b82f6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ÏöîÏ≤≠Í¥ÄÎ¶¨">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- Îß§ÎãàÌéòÏä§Ìä∏ ÌååÏùº -->
    <link rel="manifest" href="manifest.json">
    
    <!-- ÌååÎπÑÏΩò Î∞è ÏïÑÏù¥ÏΩò -->
    <link rel="icon" type="image/png" sizes="32x32" href="icon-32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icon-16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icon-180.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icon-152.png">
    <link rel="apple-touch-icon" sizes="144x144" href="icon-144.png">
    <link rel="apple-touch-icon" sizes="120x120" href="icon-120.png">
    <link rel="apple-touch-icon" sizes="114x114" href="icon-114.png">
    <link rel="apple-touch-icon" sizes="76x76" href="icon-76.png">
    <link rel="apple-touch-icon" sizes="72x72" href="icon-72.png">
    <link rel="apple-touch-icon" sizes="60x60" href="icon-60.png">
    <link rel="apple-touch-icon" sizes="57x57" href="icon-57.png">
    
    <!-- Windows ÌÉÄÏùº -->
    <meta name="msapplication-TileColor" content="#3b82f6">
    <meta name="msapplication-TileImage" content="icon-144.png">
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, updateDoc, doc, deleteDoc, getDocs } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getAuth, signInAnonymously, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        
        // Firebase ÏÑ§Ï†ï (ÏÇ¨Ïö©ÏûêÍ∞Ä Ïã§Ï†ú ÌîÑÎ°úÏ†ùÌä∏ ÏÑ§Ï†ïÏúºÎ°ú ÍµêÏ≤¥Ìï¥Ïïº Ìï®)
        const firebaseConfig = {
            apiKey: "your-api-key-here",
            authDomain: "your-project.firebaseapp.com",
            projectId: "your-project-id",
            storageBucket: "your-project.appspot.com",
            messagingSenderId: "123456789",
            appId: "your-app-id"
        };
        
        // Firebase Ï¥àÍ∏∞Ìôî
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        
        // Ï†ÑÏó≠ Î≥ÄÏàòÎ°ú ÏÑ§Ï†ï
        window.firebaseDB = db;
        window.firebaseAuth = auth;
        
        console.log('üî• Firebase Ï¥àÍ∏∞Ìôî ÏôÑÎ£å');
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #ff7f50 0%, #ff6347 50%, #ff4500 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .header {
            background: white;
            padding: 1.5rem 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header h1 {
            color: #dc2626;
            font-size: 2rem;
            margin-bottom: 0.5rem;
            text-shadow: 0 2px 4px rgba(220, 38, 38, 0.2);
        }
        
        .header p {
            color: #6b7280;
            font-size: 1rem;
        }
        
        .nav-tabs {
            background: white;
            padding: 0 2rem;
            border-bottom: 2px solid #e5e7eb;
            display: flex;
            gap: 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .nav-tab {
            padding: 1.2rem 2rem;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            color: #6b7280;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .nav-tab.active {
            color: #dc2626;
            border-bottom-color: #dc2626;
            background: linear-gradient(to bottom, #fef2f2, white);
            font-weight: 700;
            box-shadow: 0 2px 8px rgba(220, 38, 38, 0.2);
        }
        
        .nav-tab:hover:not(.active) {
            color: #374151;
            background: #f9fafb;
        }
        
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
        }
        
        .tab-content {
            display: none;
            background: white;
            border-radius: 16px;
            padding: 2.5rem;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            animation: fadeIn 0.5s ease-out;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group.full-width {
            grid-column: 1 / -1;
        }
        
        label {
            display: block;
            margin-bottom: 0.75rem;
            font-weight: 600;
            color: #374151;
            font-size: 1rem;
        }
        
        .emoji {
            margin-right: 0.5rem;
            font-size: 1.1em;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            font-family: inherit;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #ff6347;
            box-shadow: 0 0 0 4px rgba(255, 127, 80, 0.2);
            transform: translateY(-1px);
        }
        
        textarea {
            resize: vertical;
            min-height: 120px;
        }
        
        .btn {
            padding: 1rem 2.5rem;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            text-decoration: none;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #ff7f50 0%, #ff6347 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 127, 80, 0.4);
            font-weight: 700;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #ff6347 0%, #ff4500 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 99, 71, 0.5);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.3);
        }
        
        .btn-danger:hover {
            background: linear-gradient(135deg, #b91c1c 0%, #991b1b 100%);
            transform: translateY(-2px);
        }
        
        .btn-full {
            width: 100%;
        }
        
        .alert {
            padding: 1.25rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            border-left: 5px solid;
            font-weight: 500;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .alert-success {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-color: #22c55e;
            color: #15803d;
        }
        
        .alert-error {
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            border-color: #ef4444;
            color: #dc2626;
        }
        
        .requests-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1.5rem;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        
        .requests-table th,
        .requests-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #f3f4f6;
        }
        
        .requests-table th {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            font-weight: 700;
            color: #374151;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .requests-table tbody tr:hover {
            background: #f9fafb;
        }
        
        .badge {
            padding: 0.4rem 1rem;
            border-radius: 50px;
            font-size: 0.85rem;
            font-weight: 600;
            display: inline-block;
        }
        
        .badge-waiting {
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
            color: #374151;
        }
        
        .badge-progress {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            color: #1e40af;
        }
        
        .badge-completed {
            background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
            color: #15803d;
        }
        
        .badge-cancelled {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            color: #dc2626;
        }
        
        .priority-low { 
            background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%); 
            color: #15803d; 
        }
        .priority-normal { 
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); 
            color: #d97706; 
        }
        .priority-high { 
            background: linear-gradient(135deg, #fed7aa 0%, #fdba74 100%); 
            color: #ea580c; 
        }
        .priority-urgent { 
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); 
            color: #dc2626; 
        }
        
        .login-form {
            max-width: 450px;
            margin: 2rem auto;
        }
        
        .admin-info {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 2px solid #0ea5e9;
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 1.5rem;
            text-align: center;
            color: #0369a1;
            font-weight: 500;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2.5rem;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            padding: 2rem 1.5rem;
            border-radius: 16px;
            text-align: center;
            border-left: 5px solid;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-4px);
        }
        
        .stat-waiting { border-color: #6b7280; }
        .stat-progress { border-color: #2563eb; }
        .stat-completed { border-color: #16a34a; }
        .stat-cancelled { border-color: #dc2626; }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            color: #6b7280;
            font-size: 1rem;
            font-weight: 500;
        }
        
        .section-title {
            font-size: 2rem;
            font-weight: 800;
            color: #1f2937;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 0;
            border-bottom: 3px solid #f3f4f6;
            position: relative;
        }
        
        .section-title::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            width: 60px;
            height: 3px;
            background: linear-gradient(135deg, #ff7f50, #ff4500);
            border-radius: 2px;
        }
        
        .section-title .emoji {
            background: linear-gradient(135deg, #ff7f50, #ff4500);
            padding: 0.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(255, 127, 80, 0.3);
        }
        
        .footer {
            background: white;
            padding: 2.5rem;
            text-align: center;
            color: #6b7280;
            margin-top: 3rem;
            border-top: 2px solid #f3f4f6;
        }
        
        .footer p {
            margin-bottom: 0.5rem;
        }
        
        .admin-tab-content {
            display: none;
        }
        
        .admin-tab-content.active {
            display: block;
        }
        
        .admin-sub-tab {
            font-size: 0.95rem;
            padding: 1rem 1.5rem;
        }
        
        /* Íµ¨Îß§ ÏöîÏ≤≠ ÌÉ≠ Ï†ÑÏö© Ïä§ÌÉÄÏùº */
        .purchase-tab.active {
            color: #059669 !important;
            border-bottom-color: #059669 !important;
            background: linear-gradient(to bottom, #f0fdf4, white) !important;
        }
        
        /* ÏãúÏÑ§ Í¥ÄÎ¶¨ ÌÉ≠ Ï†ÑÏö© Ïä§ÌÉÄÏùº */
        .facility-tab.active {
            color: #2563eb !important;
            border-bottom-color: #2563eb !important;
            background: linear-gradient(to bottom, #eff6ff, white) !important;
        }
        
        /* Í¥ÄÎ¶¨Ïûê ÌÉ≠ Ï†ÑÏö© Ïä§ÌÉÄÏùº */
        .admin-tab.active {
            color: #7c2d12 !important;
            border-bottom-color: #7c2d12 !important;
            background: linear-gradient(to bottom, #fef7ed, white) !important;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 0 1rem;
            }
            
            .header {
                padding: 1rem;
            }
            
            .nav-tabs {
                padding: 0 1rem;
                overflow-x: auto;
                flex-wrap: nowrap;
            }
            
            .nav-tab {
                padding: 1rem 1.5rem;
                white-space: nowrap;
            }
            
            .tab-content {
                padding: 1.5rem;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .requests-table {
                font-size: 0.85rem;
            }
        }
        
        /* ÌååÏùº ÏóÖÎ°úÎìú Ïä§ÌÉÄÏùº */
        .file-info {
            font-size: 0.8rem;
            color: #6b7280;
            margin-left: 8px;
        }
        
        .file-upload-container {
            position: relative;
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            padding: 20px;
            background-color: #f9fafb;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .file-upload-container:hover {
            border-color: #ff6347;
            background-color: #fef2f2;
        }
        
        .file-upload-container.dragover {
            border-color: #ff6347;
            background-color: #fef2f2;
            transform: scale(1.02);
        }
        
        .file-input {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }
        
        .file-upload-display {
            text-align: center;
            pointer-events: none;
        }
        
        .file-upload-text {
            display: block;
            color: #6b7280;
            font-size: 0.9rem;
            margin-bottom: 8px;
        }
        
        .file-name {
            display: block;
            color: #ff6347;
            font-weight: 600;
            font-size: 0.9rem;
            margin-top: 8px;
        }
        
        .file-name:empty {
            display: none;
        }
        
        .file-upload-container.has-file {
            border-color: #10b981;
            background-color: #f0fdf4;
        }
        
        .file-upload-container.has-file .file-upload-text {
            color: #059669;
        }
        
        /* ÏÇ¨ÏßÑ ÏóÖÎ°úÎìú Ï†ÑÏö© Ïä§ÌÉÄÏùº */
        .photo-upload-container {
            position: relative;
            border: 2px dashed #d1d5db;
            border-radius: 12px;
            padding: 24px;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            transition: all 0.3s ease;
            cursor: pointer;
            min-height: 120px;
        }
        
        .photo-upload-container:hover {
            border-color: #2563eb;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(37, 99, 235, 0.1);
        }
        
        .photo-upload-container.dragover {
            border-color: #2563eb;
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            transform: scale(1.02);
            box-shadow: 0 8px 32px rgba(37, 99, 235, 0.2);
        }
        
        .photo-input {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }
        
        .photo-upload-display {
            text-align: center;
            pointer-events: none;
        }
        
        .photo-upload-text {
            display: block;
            color: #6b7280;
            font-size: 1rem;
            font-weight: 500;
            margin-bottom: 12px;
        }
        
        .photo-preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            justify-content: center;
            margin-top: 16px;
        }
        
        .photo-preview-item {
            position: relative;
            width: 120px;
            height: 120px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease;
        }
        
        .photo-preview-item:hover {
            transform: scale(1.05);
        }
        
        .photo-preview-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
        }
        
        .photo-remove-btn {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 24px;
            height: 24px;
            background: rgba(239, 68, 68, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        
        .photo-remove-btn:hover {
            background: rgba(220, 38, 38, 1);
            transform: scale(1.1);
        }
        
        .photo-upload-container.has-photos {
            border-color: #2563eb;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
        }
        
        .photo-upload-container.has-photos .photo-upload-text {
            color: #2563eb;
            font-weight: 600;
        }
        
        .photo-info {
            font-size: 0.75rem;
            color: #6b7280;
            margin-top: 8px;
            text-align: center;
        }
        
        /* Î™®Îã¨ Ïä§ÌÉÄÏùº */
        .modal {
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            animation: modalFadeIn 0.3s ease;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 16px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            animation: modalSlideIn 0.3s ease;
        }
        
        .modal-large {
            max-width: 1200px;
            max-height: 90vh;
        }
        
        @keyframes modalSlideIn {
            from { 
                transform: translateY(-20px) scale(0.95);
                opacity: 0;
            }
            to { 
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }
        
        .modal-header {
            background: linear-gradient(135deg, #ff6347 0%, #ff4500 100%);
            color: white;
            padding: 20px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 16px 16px 0 0;
        }
        
        .modal-header h2 {
            margin: 0;
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .modal-close {
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            padding: 4px 8px;
            border-radius: 8px;
        }
        
        .modal-close:hover {
            background-color: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }
        
        .modal-body {
            padding: 24px;
            max-height: 60vh;
            overflow-y: auto;
        }
        
        .detail-section {
            margin-bottom: 24px;
            padding: 16px;
            background: #f8fafc;
            border-radius: 12px;
            border-left: 4px solid #ff6347;
        }
        
        .detail-section h3 {
            margin: 0 0 12px 0;
            color: #1f2937;
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .detail-row {
            display: grid;
            grid-template-columns: 120px 1fr;
            gap: 12px;
            margin-bottom: 8px;
            align-items: start;
        }
        
        .detail-label {
            font-weight: 600;
            color: #4b5563;
            font-size: 0.9rem;
        }
        
        .detail-value {
            color: #1f2937;
            word-wrap: break-word;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .file-list {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 8px;
        }
        
        .file-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .file-item:hover {
            border-color: #3b82f6;
            background: #eff6ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(59, 130, 246, 0.15);
        }
        
        .file-icon {
            font-size: 1.2rem;
        }
        
        .file-info {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .file-name {
            font-weight: 500;
            font-size: 0.9rem;
            color: #1f2937;
            max-width: 150px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .file-size {
            font-size: 0.75rem;
            color: #6b7280;
        }
        
        .photo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 12px;
        }
        
        .photo-item {
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease;
            cursor: pointer;
        }
        
        .photo-item:hover {
            transform: scale(1.05);
        }
        
        .photo-thumb {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }
        
        .photo-info-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.7));
            color: white;
            padding: 12px;
            font-size: 0.8rem;
        }
        
        .clickable-row {
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        
        .clickable-row:hover {
            background-color: #f3f4f6 !important;
        }
        
        @media (max-width: 768px) {
            .modal-content {
                width: 95%;
                margin: 10% auto;
            }
            
            .detail-row {
                grid-template-columns: 1fr;
                gap: 4px;
            }
            
            .photo-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
        }
        
        /* ==================== Î∞òÏùëÌòï ÎîîÏûêÏù∏ Í∞úÏÑ† ==================== */
        
        /* ÌÉúÎ∏îÎ¶ø (768px ~ 1024px) */
        @media (max-width: 1024px) {
            .container {
                max-width: 100%;
                padding: 1rem;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .nav-tabs {
                flex-wrap: wrap;
                gap: 0.5rem;
            }
            
            .nav-tab {
                min-width: 120px;
                padding: 0.75rem 1rem;
                font-size: 0.9rem;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }
            
            /* Í≥†Í∏â Í≤ÄÏÉâ ÌïÑÌÑ∞ */
            #advanced-search-panel > div {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 1rem;
            }
            
            /* Í¥ÄÎ¶¨Ïûê ÏÑúÎ∏å ÌÉ≠ */
            .admin-sub-tabs {
                flex-wrap: wrap;
                gap: 0.5rem;
            }
            
            .admin-sub-tab {
                font-size: 0.8rem;
                padding: 0.5rem 1rem;
            }
        }
        
        /* Î™®Î∞îÏùº (ÏµúÎåÄ 768px) */
        @media (max-width: 768px) {
            .container {
                padding: 0.5rem;
            }
            
            .header {
                padding: 1rem;
                margin-bottom: 1rem;
            }
            
            .header h1 {
                font-size: 1.5rem;
                margin: 0 0 0.5rem 0;
            }
            
            .header p {
                font-size: 0.9rem;
            }
            
            /* ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò ÌÉ≠ Î™®Î∞îÏùº ÏµúÏ†ÅÌôî */
            .nav-tabs {
                flex-direction: column;
                gap: 0.5rem;
                margin-bottom: 1rem;
            }
            
            .nav-tab {
                width: 100%;
                padding: 1rem;
                font-size: 1rem;
                border-radius: 10px;
            }
            
            /* Ìèº ÏöîÏÜå Î™®Î∞îÏùº ÏµúÏ†ÅÌôî */
            .form-group input,
            .form-group select,
            .form-group textarea {
                font-size: 16px; /* iOS Ï§å Î∞©ÏßÄ */
                padding: 1rem;
            }
            
            .btn {
                width: 100%;
                padding: 1rem;
                font-size: 1rem;
                margin-bottom: 0.5rem;
            }
            
            /* ÌÜµÍ≥Ñ Ïπ¥Îìú Î™®Î∞îÏùº ÏµúÏ†ÅÌôî */
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
            
            .stat-card {
                padding: 1rem;
            }
            
            .stat-number {
                font-size: 1.5rem;
            }
            
            /* ÌÖåÏù¥Î∏î Î™®Î∞îÏùº ÏµúÏ†ÅÌôî */
            .requests-table {
                font-size: 0.8rem;
            }
            
            .requests-table th,
            .requests-table td {
                padding: 0.5rem 0.25rem;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                max-width: 100px;
            }
            
            /* Í≥†Í∏â Í≤ÄÏÉâ Î™®Î∞îÏùº ÏµúÏ†ÅÌôî */
            #advanced-search-panel > div {
                grid-template-columns: 1fr !important;
                gap: 1rem;
            }
            
            #advanced-search-panel input,
            #advanced-search-panel select {
                font-size: 16px;
                padding: 0.75rem;
            }
            
            /* Í¥ÄÎ¶¨Ïûê ÏÑúÎ∏å ÌÉ≠ Î™®Î∞îÏùº ÏµúÏ†ÅÌôî */
            .admin-sub-tabs {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .admin-sub-tab {
                width: 100%;
                padding: 0.75rem;
                font-size: 0.9rem;
            }
            
            /* Î™®Îã¨ Î™®Î∞îÏùº ÏµúÏ†ÅÌôî */
            .modal-content {
                width: 95%;
                max-width: none;
                margin: 1rem;
                max-height: 90vh;
                overflow-y: auto;
            }
            
            /* ÌååÏùº ÏóÖÎ°úÎìú ÏòÅÏó≠ Î™®Î∞îÏùº ÏµúÏ†ÅÌôî */
            .file-upload-area {
                padding: 1.5rem 1rem;
            }
            
            .file-upload-text {
                font-size: 0.9rem;
            }
            
            /* ÏÇ¨ÏßÑ Í∑∏Î¶¨Îìú Î™®Î∞îÏùº ÏµúÏ†ÅÌôî */
            .photo-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.5rem;
            }
            
            .photo-item {
                aspect-ratio: 1;
            }
            
            /* Í∏∞ÏïàÏÑú ÏÉùÏÑ± ÏÑπÏÖò Î™®Î∞îÏùº ÏµúÏ†ÅÌôî */
            .section-title {
                font-size: 1.2rem;
            }
            
            #purchase-draft-preview,
            #facility-draft-preview {
                font-size: 0.8rem;
                padding: 1rem;
                max-height: 300px;
                overflow-y: auto;
            }
        }
        
        /* Ï¥àÏÜåÌòï Î™®Î∞îÏùº (ÏµúÎåÄ 480px) */
        @media (max-width: 480px) {
            .container {
                padding: 0.25rem;
            }
            
            .header {
                padding: 0.75rem;
            }
            
            .header h1 {
                font-size: 1.25rem;
            }
            
            .form-group {
                margin-bottom: 1rem;
            }
            
            .form-group label {
                font-size: 0.9rem;
                margin-bottom: 0.5rem;
            }
            
            .requests-table th,
            .requests-table td {
                font-size: 0.7rem;
                padding: 0.25rem;
                max-width: 80px;
            }
            
            .stat-card {
                padding: 0.75rem;
            }
            
            .stat-number {
                font-size: 1.25rem;
            }
            
            .stat-label {
                font-size: 0.8rem;
            }
            
            /* Î≤ÑÌäº Í∑∏Î£π ÏÑ∏Î°ú Î∞∞Ïπò */
            .btn-group {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .modal-content {
                margin: 0.5rem;
                padding: 1rem;
            }
        }
        
        /* ÌÑ∞Ïπò ÎîîÎ∞îÏù¥Ïä§ ÏµúÏ†ÅÌôî */
        @media (hover: none) and (pointer: coarse) {
            .btn,
            .nav-tab,
            .admin-sub-tab {
                min-height: 44px; /* iOS Í∂åÏû• ÌÑ∞Ïπò ÏòÅÏó≠ */
            }
            
            .requests-table tr:hover {
                background-color: transparent;
            }
            
            .requests-table tr:active {
                background-color: #f3f4f6;
            }
            
            /* ÎìúÎ°≠Ï°¥ ÌÑ∞Ïπò ÏµúÏ†ÅÌôî */
            .file-upload-area {
                min-height: 120px;
                border-width: 3px;
            }
            
            .file-upload-area.dragover {
                background-color: #e0f2fe;
                border-color: #0284c7;
            }
        }
        
        /* Îã§ÌÅ¨Î™®Îìú ÏßÄÏõê Ï§ÄÎπÑ */
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-color: #1a1a1a;
                --text-color: #ffffff;
                --card-bg: #2d2d2d;
                --border-color: #444444;
            }
            
            /* Îã§ÌÅ¨Î™®Îìú Ïä§ÌÉÄÏùºÏùÄ ÌïÑÏöîÏãú Ï∂îÍ∞Ä Íµ¨ÌòÑ */
        }
        
        /* Ïù∏ÏáÑ ÏµúÏ†ÅÌôî */
        @media print {
            .nav-tabs,
            .btn,
            #advanced-search-panel {
                display: none !important;
            }
            
            .container {
                max-width: none;
                margin: 0;
                padding: 0;
            }
            
            .requests-table {
                font-size: 0.8rem;
            }
            
            .stat-card {
                border: 1px solid #000;
                break-inside: avoid;
            }
        }
        
        /* ==================== UX Í∞úÏÑ† - Ïï†ÎãàÎ©îÏù¥ÏÖò Î∞è Ìö®Í≥º ==================== */
        
        /* ÌéòÏù¥Îìú Ïù∏ Ïï†ÎãàÎ©îÏù¥ÏÖò */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        /* Î°úÎî© Ïä§ÌîºÎÑà */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 0.5rem;
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .loading-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .loading-content {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: fadeIn 0.3s ease;
        }
        
        .loading-spinner-large {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        /* Î≤ÑÌäº Ìò∏Î≤Ñ Ìö®Í≥º Í∞úÏÑ† */
        .btn {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .btn:active {
            transform: translateY(0);
            transition: all 0.1s ease;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .btn:active::before {
            width: 300px;
            height: 300px;
        }
        
        /* Ïπ¥Îìú Ìò∏Î≤Ñ Ìö®Í≥º */
        .stat-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .stat-card:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
        }
        
        /* ÌÖåÏù¥Î∏î Ìñâ Ìò∏Î≤Ñ Ìö®Í≥º Í∞úÏÑ† */
        .requests-table tbody tr {
            transition: all 0.2s ease;
        }
        
        .requests-table tbody tr:hover {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            transform: translateX(4px);
            box-shadow: 4px 0 12px rgba(0, 0, 0, 0.1);
        }
        
        /* ÏûÖÎ†• ÌïÑÎìú Ìè¨Ïª§Ïä§ Ìö®Í≥º */
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            transform: scale(1.02);
            transition: all 0.3s ease;
        }
        
        /* ÌÉ≠ Ï†ÑÌôò Ïï†ÎãàÎ©îÏù¥ÏÖò */
        .tab-content {
            animation: fadeIn 0.5s ease;
        }
        
        .nav-tab {
            transition: all 0.3s ease;
            position: relative;
        }
        
        .nav-tab::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 3px;
            background: currentColor;
            transition: all 0.3s ease;
            transform: translateX(-50%);
        }
        
        .nav-tab.active::after {
            width: 80%;
        }
        
        /* ÏÑ±Í≥µ/Ïò§Î•ò Î©îÏãúÏßÄ Ïï†ÎãàÎ©îÏù¥ÏÖò */
        .alert {
            animation: slideIn 0.5s ease;
        }
        
        .alert.success {
            animation: fadeIn 0.5s ease, pulse 0.3s ease 0.2s;
        }
        
        .alert.error {
            animation: fadeIn 0.5s ease, shake 0.5s ease 0.2s;
        }
        
        /* Î™®Îã¨ Ïï†ÎãàÎ©îÏù¥ÏÖò */
        .modal {
            animation: fadeIn 0.3s ease;
        }
        
        .modal-content {
            animation: fadeIn 0.4s ease;
        }
        
        /* ÌååÏùº ÏóÖÎ°úÎìú ÎìúÎûòÍ∑∏ Ìö®Í≥º */
        .file-upload-area {
            transition: all 0.3s ease;
        }
        
        .file-upload-area.dragover {
            transform: scale(1.02);
            animation: pulse 1s ease infinite;
        }
        
        /* ÏûêÎèôÏôÑÏÑ± ÎìúÎ°≠Îã§Ïö¥ Ïä§ÌÉÄÏùº */
        .autocomplete-container {
            position: relative;
        }
        
        .autocomplete-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #e5e7eb;
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            display: none;
        }
        
        .autocomplete-dropdown.active {
            display: block;
            animation: fadeIn 0.2s ease;
        }
        
        .autocomplete-item {
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            border-bottom: 1px solid #f3f4f6;
        }
        
        .autocomplete-item:hover,
        .autocomplete-item.selected {
            background: #3b82f6;
            color: white;
        }
        
        .autocomplete-item:last-child {
            border-bottom: none;
        }
        
        /* ÏßÑÌñâÎ•† ÌëúÏãú */
        .progress-bar {
            width: 100%;
            height: 4px;
            background: #e5e7eb;
            border-radius: 2px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            border-radius: 2px;
            transition: width 0.3s ease;
        }
        
        /* Ìà¥ÌåÅ Ïä§ÌÉÄÏùº */
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip::before {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #1f2937;
            color: white;
            padding: 0.5rem 0.75rem;
            border-radius: 4px;
            font-size: 0.8rem;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 1000;
            margin-bottom: 5px;
        }
        
        .tooltip::after {
            content: '';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: #1f2937;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .tooltip:hover::before,
        .tooltip:hover::after {
            opacity: 1;
            visibility: visible;
        }
        
        /* Ïä§ÏºàÎ†àÌÜ§ Î°úÎî© */
        .skeleton {
            background: linear-gradient(90deg, #f3f4f6 25%, #e5e7eb 50%, #f3f4f6 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
        }
        
        @keyframes skeleton-loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        .skeleton-text {
            height: 1em;
            border-radius: 4px;
            margin-bottom: 0.5rem;
        }
        
        .skeleton-text:last-child {
            width: 60%;
        }
    </style>
</head>
<body>
    <!-- Î°úÎî© Ïò§Î≤ÑÎ†àÏù¥ -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-content">
            <div class="loading-spinner-large"></div>
            <div style="color: #374151; font-weight: 600; margin-bottom: 0.5rem;">Ï≤òÎ¶¨ Ï§ë...</div>
            <div style="color: #6b7280; font-size: 0.9rem;" id="loading-message">Ïû†ÏãúÎßå Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî.</div>
        </div>
    </div>

    <!-- Ìó§Îçî -->
    <header class="header">
        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;">
            <div>
                <h1>üè¢ Ï¥ùÎ¨¥Ï≤ò ÌÜµÌï© ÏöîÏ≤≠ Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú</h1>
                <p>Íµ¨Îß§ ÏöîÏ≤≠ Î∞è ÏãúÏÑ§ Í¥ÄÎ¶¨ ÌÜµÌï© ÌîåÎû´Ìèº</p>
            </div>
            <div id="sync-status" style="background: rgba(255, 255, 255, 0.1); padding: 0.5rem 1rem; border-radius: 20px; backdrop-filter: blur(10px); min-width: 150px; text-align: center;">
                <span style="color: #f59e0b;">üîÑ</span>
                <span style="font-size: 0.8rem; margin-left: 0.25rem;">Ïó∞Í≤∞ Ï§ë...</span>
            </div>
        </div>
    </header>

    <!-- ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò ÌÉ≠ -->
    <nav class="nav-tabs">
        <button class="nav-tab purchase-tab active" onclick="showTab('purchase')">
            <span class="emoji">üõí</span>Íµ¨Îß§ ÏöîÏ≤≠
        </button>
        <button class="nav-tab facility-tab" onclick="showTab('facility')">
            <span class="emoji">üîß</span>ÏãúÏÑ§ Í¥ÄÎ¶¨
        </button>
        <button class="nav-tab admin-tab" onclick="showTab('admin')" id="admin-tab">
            <span class="emoji">üë®‚Äçüíº</span>Í¥ÄÎ¶¨Ïûê
        </button>
    </nav>

    <div class="container">
        <!-- ÏïåÎ¶º ÏòÅÏó≠ -->
        <div id="alert-container"></div>

        <!-- Íµ¨Îß§ ÏöîÏ≤≠ ÌÉ≠ -->
        <div id="purchase-tab" class="tab-content active">
            <h2 class="section-title">
                <span class="emoji">üõí</span>Íµ¨Îß§ ÏöîÏ≤≠
            </h2>
            
            <form id="purchase-form">
                <div class="form-grid">
                    <div class="form-group full-width">
                        <label for="purchase-title">
                            <span class="emoji">üìã</span>ÏöîÏ≤≠ Ï†úÎ™© *
                        </label>
                        <input 
                            type="text" 
                            id="purchase-title" 
                            name="title"
                            placeholder="Ïòà: ÎÖ∏Ìä∏Î∂Å Íµ¨Îß§ ÏöîÏ≤≠, ÏÇ¨Î¨¥Ïö©Ìíà Íµ¨Îß§ ÏöîÏ≤≠"
                            required
                        />
                    </div>

                    <div class="form-group">
                        <label for="purchase-department">
                            <span class="emoji">üè¢</span>Î∂ÄÏÑúÎ™Ö *
                        </label>
                        <input 
                            type="text" 
                            id="purchase-department" 
                            name="department"
                            placeholder="Ïòà: ITÌåÄ, ÎßàÏºÄÌåÖÌåÄ, Ï¥ùÎ¨¥ÌåÄ"
                            required
                        />
                    </div>

                    <div class="form-group">
                        <label for="purchase-requestedBy">
                            <span class="emoji">üë§</span>ÏöîÏ≤≠ÏûêÎ™Ö *
                        </label>
                        <input 
                            type="text" 
                            id="purchase-requestedBy" 
                            name="requestedBy"
                            placeholder="ÏöîÏ≤≠Ïûê Ïù¥Î¶Ñ"
                            required
                        />
                    </div>

                    <div class="form-group">
                        <label for="purchase-item">
                            <span class="emoji">üì¶</span>Î¨ºÌíàÎ™Ö *
                        </label>
                        <input 
                            type="text" 
                            id="purchase-item" 
                            name="item"
                            placeholder="Ïòà: ÎÖ∏Ìä∏Î∂Å, ÎßàÏö∞Ïä§, Î™®ÎãàÌÑ∞"
                            required
                        />
                    </div>

                    <div class="form-group">
                        <label for="purchase-quantity">
                            <span class="emoji">üì¶</span>ÏàòÎüâ *
                        </label>
                        <input 
                            type="text" 
                            id="purchase-quantity" 
                            name="quantity"
                            placeholder="Ïòà: 5Í∞ú, 1Î∞ïÏä§, 10ÏÑ∏Ìä∏, 1Ïãù"
                            required
                        />
                    </div>

                    <div class="form-group">
                        <label for="purchase-budget">
                            <span class="emoji">üí∞</span>ÏòàÏÇ∞ (Ïõê) *
                        </label>
                        <input type="text" id="purchase-budget" placeholder="Ïòà: 1000000 ÎòêÎäî 1,000,000" required pattern="[0-9,]+" title="Ïà´ÏûêÎßå ÏûÖÎ†•ÌïòÏÑ∏Ïöî (ÏâºÌëú ÏÇ¨Ïö© Í∞ÄÎä•)">
                    </div>

                    <div class="form-group">
                        <label for="purchase-priority">
                            <span class="emoji">‚ö°</span>Ïö∞ÏÑ†ÏàúÏúÑ
                        </label>
                        <select id="purchase-priority" name="priority">
                            <option value="ÎÇÆÏùå">ÎÇÆÏùå</option>
                            <option value="Î≥¥ÌÜµ" selected>Î≥¥ÌÜµ</option>
                            <option value="ÎÜíÏùå">ÎÜíÏùå</option>
                            <option value="Í∏¥Í∏â">Í∏¥Í∏â</option>
                        </select>
                    </div>

                    <div class="form-group full-width">
                        <label for="purchase-reason">
                            <span class="emoji">üìù</span>Íµ¨Îß§ ÏÇ¨Ïú† *
                        </label>
                        <textarea 
                            id="purchase-reason" 
                            name="reason"
                            placeholder="Íµ¨Îß§Í∞Ä ÌïÑÏöîÌïú Ïù¥Ïú†Î•º ÏûêÏÑ∏Ìûà ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî..."
                            required
                        ></textarea>
                    </div>

                    <div class="form-group full-width">
                        <label for="purchase-quote-file">
                            <span class="emoji">üìé</span>Í≤¨Ï†ÅÏÑú Ï≤®Î∂Ä (ÏÑ†ÌÉù)
                            <span class="file-info">PDF, Excel, ÌïúÍ∏Ä ÌååÏùºÎßå Í∞ÄÎä• (ÏµúÎåÄ 10MB)</span>
                        </label>
                        <div class="file-upload-container">
                            <input 
                                type="file" 
                                id="purchase-quote-file" 
                                name="quoteFile"
                                accept=".pdf,.xlsx,.xls,.hwp,.hwpx"
                                class="file-input"
                            />
                            <div class="file-upload-display">
                                <span class="file-upload-text">ÌååÏùºÏùÑ ÏÑ†ÌÉùÌïòÍ±∞ÎÇò ÎìúÎûòÍ∑∏ÌïòÏó¨ ÏóÖÎ°úÎìú</span>
                                <span class="file-name" id="selected-file-name"></span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button type="submit" class="btn btn-primary btn-full">
                    <span class="emoji">‚úÖ</span>Íµ¨Îß§ ÏöîÏ≤≠ Ï†úÏ∂ú
                </button>
            </form>
            
            <!-- Íµ¨Îß§ ÏöîÏ≤≠ Í∏∞ÏïàÏÑú ÏÉùÏÑ± ÏÑπÏÖò -->
            <div style="margin-top: 3rem; background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); padding: 2rem; border-radius: 20px; border: 3px solid #2563eb; box-shadow: 0 8px 32px rgba(37, 99, 235, 0.2);">
                <h3 class="section-title">
                    <span class="emoji">üìù</span>Í∏∞ÏïàÏÑú ÏûêÎèô ÏÉùÏÑ±
                    <span style="font-size: 0.8rem; color: #6b7280; font-weight: normal; margin-left: 1rem;">ÏúÑ Ï†ïÎ≥¥Î•º Î∞îÌÉïÏúºÎ°ú Í∏∞ÏïàÏÑúÎ•º ÏÉùÏÑ±Ìï©ÎãàÎã§</span>
                </h3>
                
                <div style="background: rgba(37, 99, 235, 0.1); padding: 1rem; border-radius: 8px; margin-bottom: 2rem; border-left: 4px solid #2563eb;">
                    <div style="color: #1e40af; font-size: 0.9rem; line-height: 1.6;">
                        üí° <strong>Tip:</strong> ÏÉùÏÑ±Îêú Í∏∞ÏïàÏÑúÍ∞Ä ÎßàÏùåÏóê Îì§ÏßÄ ÏïäÏúºÏãúÎÇòÏöî? Í¥ÄÎ¶¨ÏûêÏóêÍ≤å Í∞úÏÑ† ÏöîÏ≤≠ÏùÑ ÌïòÏãúÎ©¥ Îã§ÏùåÎ∂ÄÌÑ∞ Îçî ÎÇòÏùÄ Í∏∞ÏïàÏÑúÍ∞Ä ÏÉùÏÑ±Îê©ÎãàÎã§!
                        <br>Ïòà: "Í≤¨Ï†ÅÏÑú Ï≤®Î∂Ä ÎÇ¥Ïö© Ï†úÏô∏Ìï¥Ï£ºÏÑ∏Ïöî", "Îçî Í∞ÑÎã®ÌïòÍ≤å ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî"
                    </div>
                </div>
                
                <div style="display: flex; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap;">
                    <button onclick="generatePurchaseDraft()" class="btn" style="background: #2563eb; color: white; padding: 0.75rem 1.5rem;">
                        <span class="emoji">‚ö°</span>Í∏∞ÏïàÏÑú ÏÉùÏÑ±
                    </button>
                    
                    <button onclick="copyPurchaseDraftToClipboard()" class="btn" style="background: #059669; color: white; padding: 0.75rem 1.5rem;">
                        <span class="emoji">üìã</span>ÌÅ¥Î¶ΩÎ≥¥Îìú Î≥µÏÇ¨
                    </button>
                    
                    <button onclick="clearPurchaseDraft()" class="btn" style="background: #6b7280; color: white; padding: 0.75rem 1.5rem;">
                        <span class="emoji">üóëÔ∏è</span>Ï¥àÍ∏∞Ìôî
                    </button>
                </div>
                
                <div id="purchase-draft-preview" style="border: 2px solid #e5e7eb; border-radius: 8px; padding: 2rem; min-height: 300px; white-space: pre-wrap; font-family: 'Malgun Gothic', sans-serif; line-height: 1.8; background: white;">
                    ÏúÑÏùò "Í∏∞ÏïàÏÑú ÏÉùÏÑ±" Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÎ©¥ ÏûÖÎ†•ÌïòÏã† Íµ¨Îß§ ÏöîÏ≤≠ Ï†ïÎ≥¥Î•º Î∞îÌÉïÏúºÎ°ú Í∏∞ÏïàÏÑúÍ∞Ä ÏûêÎèô ÏÉùÏÑ±Îê©ÎãàÎã§.
                </div>
            </div>
        </div>

        <!-- ÏãúÏÑ§ Í¥ÄÎ¶¨ ÌÉ≠ -->
        <div id="facility-tab" class="tab-content">
            <h2 class="section-title">
                <span class="emoji">üîß</span>ÏãúÏÑ§ Í¥ÄÎ¶¨ ÏöîÏ≤≠
            </h2>
            
            <form id="facility-form">
                <div class="form-grid">
                    <div class="form-group full-width">
                        <label for="facility-title">
                            <span class="emoji">üìã</span>ÏöîÏ≤≠ Ï†úÎ™© *
                        </label>
                        <input 
                            type="text" 
                            id="facility-title" 
                            name="title"
                            placeholder="ÏãúÏÑ§ Í¥ÄÎ¶¨ ÏöîÏ≤≠ Ï†úÎ™©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî"
                            required
                        />
                    </div>
                    
                    <div class="form-group">
                        <label for="facility-type">
                            <span class="emoji">üèóÔ∏è</span>ÏãúÏÑ§ Ïú†Ìòï *
                        </label>
                        <select id="facility-type" name="facilityType" required>
                            <option value="">ÏãúÏÑ§ Ïú†Ìòï ÏÑ†ÌÉù</option>
                            <option value="Ï†ÑÍ∏∞ÏÑ§ÎπÑ">Ï†ÑÍ∏∞ÏÑ§ÎπÑ</option>
                            <option value="ÎÉâÎÇúÎ∞©">ÎÉâÎÇúÎ∞©</option>
                            <option value="Í∏âÎ∞∞Ïàò">Í∏âÎ∞∞Ïàò</option>
                            <option value="ÌÜµÏã†ÏÑ§ÎπÑ">ÌÜµÏã†ÏÑ§ÎπÑ</option>
                            <option value="Î≥¥ÏïàÏÑ§ÎπÑ">Î≥¥ÏïàÏÑ§ÎπÑ</option>
                            <option value="Í±¥Ï∂ïÎ¨º">Í±¥Ï∂ïÎ¨º</option>
                            <option value="Ï°∞Í≤Ω">Ï°∞Í≤Ω</option>
                            <option value="Í∏∞ÌÉÄ">Í∏∞ÌÉÄ</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="facility-priority">
                            <span class="emoji">‚ö°</span>Ïö∞ÏÑ†ÏàúÏúÑ
                        </label>
                        <select id="facility-priority" name="priority">
                            <option value="ÎÇÆÏùå">ÎÇÆÏùå</option>
                            <option value="Î≥¥ÌÜµ" selected>Î≥¥ÌÜµ</option>
                            <option value="ÎÜíÏùå">ÎÜíÏùå</option>
                            <option value="Í∏¥Í∏â">Í∏¥Í∏â</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="facility-requestedBy">
                            <span class="emoji">üë§</span>ÏöîÏ≤≠ÏûêÎ™Ö *
                        </label>
                        <input 
                            type="text" 
                            id="facility-requestedBy" 
                            name="requestedBy"
                            placeholder="ÏöîÏ≤≠Ïûê Ïù¥Î¶Ñ"
                            required
                        />
                    </div>
                    
                    <div class="form-group">
                        <label for="facility-department">
                            <span class="emoji">üè¢</span>ÏÜåÏÜç Î∂ÄÏÑú *
                        </label>
                        <input 
                            type="text" 
                            id="facility-department" 
                            name="department"
                            placeholder="ÏÜåÏÜç Î∂ÄÏÑúÎ™Ö"
                            required
                        />
                    </div>
                    
                    <div class="form-group">
                        <label for="facility-phone">
                            <span class="emoji">üìû</span>Ïó∞ÎùΩÏ≤ò
                        </label>
                        <input 
                            type="tel" 
                            id="facility-phone" 
                            name="phone"
                            placeholder="010-0000-0000"
                        />
                    </div>
                    
                    <div class="form-group">
                        <label for="facility-location">
                            <span class="emoji">üìç</span>ÏúÑÏπò
                        </label>
                        <input 
                            type="text" 
                            id="facility-location" 
                            name="location"
                            placeholder="Í±¥Î¨ºÎ™Ö, Ï∏µÏàò, Ìò∏Ïã§ Îì±"
                        />
                    </div>
                    
                    <div class="form-group full-width">
                        <label for="facility-description">
                            <span class="emoji">üìù</span>ÏÉÅÏÑ∏ ÏÑ§Î™Ö *
                        </label>
                        <textarea 
                            id="facility-description" 
                            name="description"
                            placeholder="ÏãúÏÑ§ Í¥ÄÎ¶¨ ÏöîÏ≤≠Ïóê ÎåÄÌïú ÏÉÅÏÑ∏Ìïú ÏÑ§Î™ÖÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî"
                            required
                        ></textarea>
                    </div>

                    <div class="form-group full-width">
                        <label for="facility-photo">
                            <span class="emoji">üì∑</span>ÏãúÏÑ§ ÏÇ¨ÏßÑ Ï≤®Î∂Ä (ÏÑ†ÌÉù)
                            <span class="file-info">JPG, PNG, GIF ÌååÏùºÎßå Í∞ÄÎä• (ÏµúÎåÄ 5MB, ÏµúÎåÄ 3Í∞ú)</span>
                        </label>
                        <div class="photo-upload-container">
                            <input 
                                type="file" 
                                id="facility-photo" 
                                name="facilityPhotos"
                                accept="image/jpeg,image/jpg,image/png,image/gif"
                                class="photo-input"
                                multiple
                                maxlength="3"
                            />
                            <div class="photo-upload-display">
                                <span class="photo-upload-text">üì∑ ÏÇ¨ÏßÑÏùÑ ÏÑ†ÌÉùÌïòÍ±∞ÎÇò ÎìúÎûòÍ∑∏ÌïòÏó¨ ÏóÖÎ°úÎìú (ÏµúÎåÄ 3Í∞ú)</span>
                                <div class="photo-preview-container" id="facility-photo-preview"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button type="submit" class="btn btn-primary btn-full">
                    <span class="emoji">üì§</span>ÏãúÏÑ§ Í¥ÄÎ¶¨ ÏöîÏ≤≠ Ï†úÏ∂ú
                </button>
            </form>
            
            <!-- ÏãúÏÑ§ Í¥ÄÎ¶¨ Í∏∞ÏïàÏÑú ÏÉùÏÑ± ÏÑπÏÖò -->
            <div style="margin-top: 3rem; background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); padding: 2rem; border-radius: 20px; border: 3px solid #22c55e; box-shadow: 0 8px 32px rgba(34, 197, 94, 0.2);">
                <h3 class="section-title">
                    <span class="emoji">üìù</span>Í∏∞ÏïàÏÑú ÏûêÎèô ÏÉùÏÑ±
                    <span style="font-size: 0.8rem; color: #6b7280; font-weight: normal; margin-left: 1rem;">ÏúÑ Ï†ïÎ≥¥Î•º Î∞îÌÉïÏúºÎ°ú Í∏∞ÏïàÏÑúÎ•º ÏÉùÏÑ±Ìï©ÎãàÎã§</span>
                </h3>
                
                <div style="background: rgba(34, 197, 94, 0.1); padding: 1rem; border-radius: 8px; margin-bottom: 2rem; border-left: 4px solid #22c55e;">
                    <div style="color: #166534; font-size: 0.9rem; line-height: 1.6;">
                        üí° <strong>Tip:</strong> ÏÉùÏÑ±Îêú Í∏∞ÏïàÏÑúÍ∞Ä ÎßàÏùåÏóê Îì§ÏßÄ ÏïäÏúºÏãúÎÇòÏöî? Í¥ÄÎ¶¨ÏûêÏóêÍ≤å Í∞úÏÑ† ÏöîÏ≤≠ÏùÑ ÌïòÏãúÎ©¥ Îã§ÏùåÎ∂ÄÌÑ∞ Îçî ÎÇòÏùÄ Í∏∞ÏïàÏÑúÍ∞Ä ÏÉùÏÑ±Îê©ÎãàÎã§!
                        <br>Ïòà: "Îçî Í∞ÑÎã®ÌïòÍ≤å ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî", "Í∏¥Í∏âÏÑ± Î¨∏Íµ¨Î•º Ï∂îÍ∞ÄÌï¥Ï£ºÏÑ∏Ïöî"
                    </div>
                </div>
                
                <div style="display: flex; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap;">
                    <button onclick="generateFacilityDraft()" class="btn" style="background: #22c55e; color: white; padding: 0.75rem 1.5rem;">
                        <span class="emoji">‚ö°</span>Í∏∞ÏïàÏÑú ÏÉùÏÑ±
                    </button>
                    
                    <button onclick="copyFacilityDraftToClipboard()" class="btn" style="background: #059669; color: white; padding: 0.75rem 1.5rem;">
                        <span class="emoji">üìã</span>ÌÅ¥Î¶ΩÎ≥¥Îìú Î≥µÏÇ¨
                    </button>
                    
                    <button onclick="clearFacilityDraft()" class="btn" style="background: #6b7280; color: white; padding: 0.75rem 1.5rem;">
                        <span class="emoji">üóëÔ∏è</span>Ï¥àÍ∏∞Ìôî
                    </button>
                </div>
                
                <div id="facility-draft-preview" style="border: 2px solid #e5e7eb; border-radius: 8px; padding: 2rem; min-height: 300px; white-space: pre-wrap; font-family: 'Malgun Gothic', sans-serif; line-height: 1.8; background: white;">
                    ÏúÑÏùò "Í∏∞ÏïàÏÑú ÏÉùÏÑ±" Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÎ©¥ ÏûÖÎ†•ÌïòÏã† ÏãúÏÑ§ Í¥ÄÎ¶¨ ÏöîÏ≤≠ Ï†ïÎ≥¥Î•º Î∞îÌÉïÏúºÎ°ú Í∏∞ÏïàÏÑúÍ∞Ä ÏûêÎèô ÏÉùÏÑ±Îê©ÎãàÎã§.
                </div>
            </div>
        </div>

        <!-- Í¥ÄÎ¶¨Ïûê ÌÉ≠ -->
        <div id="admin-tab-content" class="tab-content">
            <!-- Î°úÍ∑∏Ïù∏ Ìèº -->
            <div id="admin-login" class="login-form">
                <h2 class="section-title" style="justify-content: center;">
                    <span class="emoji">üë®‚Äçüíº</span>Í¥ÄÎ¶¨Ïûê Î°úÍ∑∏Ïù∏
                </h2>
                
                <form id="admin-form">
                    <div class="form-group">
                        <label for="admin-username">
                            <span class="emoji">üÜî</span>ÏïÑÏù¥Îîî
                        </label>
                        <input 
                            type="text" 
                            id="admin-username" 
                            name="username"
                            placeholder="Í¥ÄÎ¶¨Ïûê ÏïÑÏù¥Îîî"
                            required
                        />
                    </div>
                    
                    <div class="form-group">
                        <label for="admin-password">
                            <span class="emoji">üîê</span>ÎπÑÎ∞ÄÎ≤àÌò∏
                        </label>
                        <input 
                            type="password" 
                            id="admin-password" 
                            name="password"
                            placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏"
                            required
                        />
                    </div>
                    
                    <button type="submit" class="btn btn-primary btn-full">
                        <span class="emoji">üîë</span>Î°úÍ∑∏Ïù∏
                    </button>
                </form>
                
            </div>
            
                            <!-- Í¥ÄÎ¶¨Ïûê Ìå®ÎÑê -->
            <div id="admin-panel" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;">
                    <h2 class="section-title" style="margin-bottom: 0;">
                        <span class="emoji">üë®‚Äçüíº</span>Í¥ÄÎ¶¨Ïûê ÎåÄÏãúÎ≥¥Îìú
                    </h2>
                    <button class="btn btn-danger" onclick="logout()">
                        <span class="emoji">üö™</span>Î°úÍ∑∏ÏïÑÏõÉ
                    </button>
                </div>
                
                <!-- Í¥ÄÎ¶¨Ïûê ÌïòÏúÑ ÌÉ≠ -->
                <div class="nav-tabs" style="margin-bottom: 2rem; border-radius: 15px; overflow: hidden; background: linear-gradient(135deg, #fef7ed, #fed7aa); border: 2px solid #fdba74; box-shadow: 0 8px 32px rgba(251, 146, 60, 0.2);">
                    <button class="nav-tab admin-sub-tab active" onclick="showAdminTab('all', this)" style="background: linear-gradient(135deg, #fb923c, #f97316); color: white; font-weight: 700; border: 2px solid #ea580c;">
                        <span class="emoji" style="background: rgba(255,255,255,0.2); padding: 0.3rem; border-radius: 8px; margin-right: 0.5rem;">üìä</span>Ï†ÑÏ≤¥ ÌòÑÌô©
                    </button>
                    <button class="nav-tab admin-sub-tab" onclick="showAdminTab('purchase', this)" style="color: #9a3412; font-weight: 600;">
                        <span class="emoji" style="background: rgba(34, 197, 94, 0.1); padding: 0.3rem; border-radius: 8px; margin-right: 0.5rem;">üõí</span>Íµ¨Îß§ ÏöîÏ≤≠
                    </button>
                    <button class="nav-tab admin-sub-tab" onclick="showAdminTab('facility', this)" style="color: #9a3412; font-weight: 600;">
                        <span class="emoji" style="background: rgba(37, 99, 235, 0.1); padding: 0.3rem; border-radius: 8px; margin-right: 0.5rem;">üîß</span>ÏãúÏÑ§ Í¥ÄÎ¶¨
                    </button>
                    <button class="nav-tab admin-sub-tab" onclick="showAdminTab('template', this)" style="color: #9a3412; font-weight: 600;">
                        <span class="emoji" style="background: rgba(168, 85, 247, 0.1); padding: 0.3rem; border-radius: 8px; margin-right: 0.5rem;">üìù</span>Í∏∞ÏïàÏÑú ÌÖúÌîåÎ¶ø
                    </button>
                </div>

                <!-- Ï†ÑÏ≤¥ ÌòÑÌô© ÌÉ≠ -->
                <div id="admin-all-tab" class="admin-tab-content" style="display: block;">
                    <!-- Ï†ÑÏ≤¥ ÌÜµÍ≥Ñ Ïπ¥Îìú -->
                    <div class="stats-grid">
                        <div class="stat-card stat-waiting">
                            <div class="stat-number" id="stat-all-waiting">0</div>
                            <div class="stat-label">Ï†ÑÏ≤¥ ÎåÄÍ∏∞</div>
                        </div>
                        <div class="stat-card stat-progress">
                            <div class="stat-number" id="stat-all-progress">0</div>
                            <div class="stat-label">Ï†ÑÏ≤¥ ÏßÑÌñâÏ§ë</div>
                        </div>
                        <div class="stat-card stat-completed">
                            <div class="stat-number" id="stat-all-completed">0</div>
                            <div class="stat-label">Ï†ÑÏ≤¥ ÏôÑÎ£å</div>
                        </div>
                        <div class="stat-card stat-cancelled">
                            <div class="stat-number" id="stat-all-cancelled">0</div>
                            <div class="stat-label">Ï†ÑÏ≤¥ Ï∑®ÏÜå</div>
                        </div>
                    </div>

                    <!-- Í≥†Í∏â Í≤ÄÏÉâ Î∞è ÌïÑÌÑ∞ÎßÅ -->
                    <div style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); padding: 2rem; border-radius: 20px; border: 3px solid #64748b; box-shadow: 0 8px 32px rgba(100, 116, 139, 0.2); margin-bottom: 2rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                            <h3 style="color: #1e293b; font-size: 1.4rem; font-weight: 700; margin: 0;">
                                <span class="emoji" style="background: rgba(100, 116, 139, 0.1); padding: 0.3rem; border-radius: 8px; margin-right: 0.5rem;">üîç</span>Í≥†Í∏â Í≤ÄÏÉâ Î∞è ÌïÑÌÑ∞ÎßÅ
                            </h3>
                            <button onclick="toggleAdvancedSearch()" class="btn" style="background: #64748b; color: white; padding: 0.5rem 1rem; font-size: 0.9rem;">
                                <span id="search-toggle-text">ÌïÑÌÑ∞ Ïó¥Í∏∞</span>
                            </button>
                        </div>
                        
                        <div id="advanced-search-panel" style="display: none;">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem;">
                                <!-- Î∂ÄÏÑúÎ≥Ñ ÌïÑÌÑ∞ -->
                                <div>
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">
                                        üè¢ Î∂ÄÏÑúÎ≥Ñ ÌïÑÌÑ∞
                                    </label>
                                    <select id="filter-department" style="width: 100%; padding: 0.75rem; border-radius: 8px; border: 2px solid #d1d5db;">
                                        <option value="">Ï†ÑÏ≤¥ Î∂ÄÏÑú</option>
                                        <option value="ITÌåÄ">ITÌåÄ</option>
                                        <option value="ÎßàÏºÄÌåÖÌåÄ">ÎßàÏºÄÌåÖÌåÄ</option>
                                        <option value="Ï¥ùÎ¨¥ÌåÄ">Ï¥ùÎ¨¥ÌåÄ</option>
                                        <option value="Ïù∏ÏÇ¨ÌåÄ">Ïù∏ÏÇ¨ÌåÄ</option>
                                        <option value="ÏòÅÏóÖÌåÄ">ÏòÅÏóÖÌåÄ</option>
                                        <option value="Í∏∞ÌöçÌåÄ">Í∏∞ÌöçÌåÄ</option>
                                    </select>
                                </div>
                                
                                <!-- Îã¥ÎãπÏûêÎ≥Ñ ÌïÑÌÑ∞ -->
                                <div>
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">
                                        üë§ Îã¥ÎãπÏûêÎ≥Ñ ÌïÑÌÑ∞
                                    </label>
                                    <input type="text" id="filter-requester" placeholder="Îã¥ÎãπÏûêÎ™Ö ÏûÖÎ†•" style="width: 100%; padding: 0.75rem; border-radius: 8px; border: 2px solid #d1d5db;">
                                </div>
                                
                                <!-- ÏÉÅÌÉúÎ≥Ñ ÌïÑÌÑ∞ -->
                                <div>
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">
                                        üìä ÏÉÅÌÉúÎ≥Ñ ÌïÑÌÑ∞
                                    </label>
                                    <select id="filter-status" style="width: 100%; padding: 0.75rem; border-radius: 8px; border: 2px solid #d1d5db;">
                                        <option value="">Ï†ÑÏ≤¥ ÏÉÅÌÉú</option>
                                        <option value="ÎåÄÍ∏∞">ÎåÄÍ∏∞</option>
                                        <option value="ÏßÑÌñâÏ§ë">ÏßÑÌñâÏ§ë</option>
                                        <option value="ÏôÑÎ£å">ÏôÑÎ£å</option>
                                        <option value="Ï∑®ÏÜå">Ï∑®ÏÜå</option>
                                        <option value="Î≥¥Î•ò">Î≥¥Î•ò</option>
                                    </select>
                                </div>
                                
                                <!-- Ïö∞ÏÑ†ÏàúÏúÑ ÌïÑÌÑ∞ -->
                                <div>
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">
                                        ‚ö° Ïö∞ÏÑ†ÏàúÏúÑ ÌïÑÌÑ∞
                                    </label>
                                    <select id="filter-priority" style="width: 100%; padding: 0.75rem; border-radius: 8px; border: 2px solid #d1d5db;">
                                        <option value="">Ï†ÑÏ≤¥ Ïö∞ÏÑ†ÏàúÏúÑ</option>
                                        <option value="Í∏¥Í∏â">Í∏¥Í∏â</option>
                                        <option value="ÎÜíÏùå">ÎÜíÏùå</option>
                                        <option value="Î≥¥ÌÜµ">Î≥¥ÌÜµ</option>
                                        <option value="ÎÇÆÏùå">ÎÇÆÏùå</option>
                                    </select>
                                </div>
                                
                                <!-- ÏòàÏÇ∞ Î≤îÏúÑ ÌïÑÌÑ∞ -->
                                <div>
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">
                                        üí∞ ÏòàÏÇ∞ Î≤îÏúÑ (Ïõê)
                                    </label>
                                    <div style="display: grid; grid-template-columns: 1fr auto 1fr; gap: 0.5rem; align-items: center;">
                                        <input type="number" id="filter-budget-min" placeholder="ÏµúÏÜå Í∏àÏï°" style="padding: 0.5rem; border-radius: 6px; border: 2px solid #d1d5db;">
                                        <span style="color: #6b7280;">~</span>
                                        <input type="number" id="filter-budget-max" placeholder="ÏµúÎåÄ Í∏àÏï°" style="padding: 0.5rem; border-radius: 6px; border: 2px solid #d1d5db;">
                                    </div>
                                </div>
                                
                                <!-- ÎÇ†Ïßú Î≤îÏúÑ ÌïÑÌÑ∞ -->
                                <div>
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">
                                        üìÖ Îì±Î°ùÏùº Î≤îÏúÑ
                                    </label>
                                    <div style="display: grid; grid-template-columns: 1fr auto 1fr; gap: 0.5rem; align-items: center;">
                                        <input type="date" id="filter-date-start" style="padding: 0.5rem; border-radius: 6px; border: 2px solid #d1d5db;">
                                        <span style="color: #6b7280;">~</span>
                                        <input type="date" id="filter-date-end" style="padding: 0.5rem; border-radius: 6px; border: 2px solid #d1d5db;">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Í≤ÄÏÉâ Î∞è Ï¥àÍ∏∞Ìôî Î≤ÑÌäº -->
                            <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                                <button onclick="applyAdvancedFilters()" class="btn" style="background: #3b82f6; color: white; padding: 0.75rem 2rem;">
                                    <span class="emoji">üîç</span>Í≤ÄÏÉâ Ï†ÅÏö©
                                </button>
                                <button onclick="resetAdvancedFilters()" class="btn" style="background: #6b7280; color: white; padding: 0.75rem 2rem;">
                                    <span class="emoji">üîÑ</span>ÌïÑÌÑ∞ Ï¥àÍ∏∞Ìôî
                                </button>
                                <button onclick="exportFilteredData()" class="btn" style="background: #059669; color: white; padding: 0.75rem 2rem;">
                                    <span class="emoji">üìä</span>ÌïÑÌÑ∞Îêú Îç∞Ïù¥ÌÑ∞ Excel ÎÇ¥Î≥¥ÎÇ¥Í∏∞
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Ïú†ÌòïÎ≥Ñ ÌÜµÍ≥Ñ -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 2rem; margin-bottom: 2.5rem;">
                        <div style="background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); padding: 2rem; border-radius: 20px; border: 3px solid #22c55e; box-shadow: 0 8px 32px rgba(34, 197, 94, 0.2); transition: transform 0.3s ease;" onmouseover="this.style.transform='translateY(-4px)'" onmouseout="this.style.transform='translateY(0)'">
                            <div style="display: flex; align-items: center; margin-bottom: 1.5rem;">
                                <div style="background: linear-gradient(135deg, #22c55e, #16a34a); width: 60px; height: 60px; border-radius: 15px; display: flex; align-items: center; justify-content: center; margin-right: 1rem; box-shadow: 0 4px 15px rgba(34, 197, 94, 0.3);">
                                    <span style="font-size: 1.8rem;">üõí</span>
                                </div>
                                <div>
                                    <h4 style="color: #15803d; font-size: 1.3rem; font-weight: 700; margin: 0;">Íµ¨Îß§ ÏöîÏ≤≠ ÌòÑÌô©</h4>
                                    <p style="color: #059669; font-size: 0.9rem; margin: 0; margin-top: 0.25rem;">Purchase Requests Status</p>
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                                <div style="background: white; padding: 1rem; border-radius: 12px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                                    <div style="color: #6b7280; font-size: 0.8rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">ÎåÄÍ∏∞</div>
                                    <div style="color: #15803d; font-size: 1.5rem; font-weight: 700; margin-top: 0.25rem;" id="purchase-waiting">0</div>
                                </div>
                                <div style="background: white; padding: 1rem; border-radius: 12px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                                    <div style="color: #6b7280; font-size: 0.8rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">ÏßÑÌñâÏ§ë</div>
                                    <div style="color: #15803d; font-size: 1.5rem; font-weight: 700; margin-top: 0.25rem;" id="purchase-progress">0</div>
                                </div>
                                <div style="background: white; padding: 1rem; border-radius: 12px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                                    <div style="color: #6b7280; font-size: 0.8rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">ÏôÑÎ£å</div>
                                    <div style="color: #15803d; font-size: 1.5rem; font-weight: 700; margin-top: 0.25rem;" id="purchase-completed">0</div>
                                </div>
                                <div style="background: white; padding: 1rem; border-radius: 12px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                                    <div style="color: #6b7280; font-size: 0.8rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Ï∑®ÏÜå</div>
                                    <div style="color: #15803d; font-size: 1.5rem; font-weight: 700; margin-top: 0.25rem;" id="purchase-cancelled">0</div>
                                </div>
                            </div>
                        </div>
                        
                        <div style="background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); padding: 2rem; border-radius: 20px; border: 3px solid #2563eb; box-shadow: 0 8px 32px rgba(37, 99, 235, 0.2); transition: transform 0.3s ease;" onmouseover="this.style.transform='translateY(-4px)'" onmouseout="this.style.transform='translateY(0)'">
                            <div style="display: flex; align-items: center; margin-bottom: 1.5rem;">
                                <div style="background: linear-gradient(135deg, #2563eb, #1d4ed8); width: 60px; height: 60px; border-radius: 15px; display: flex; align-items: center; justify-content: center; margin-right: 1rem; box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);">
                                    <span style="font-size: 1.8rem;">üîß</span>
                                </div>
                                <div>
                                    <h4 style="color: #1e40af; font-size: 1.3rem; font-weight: 700; margin: 0;">ÏãúÏÑ§ Í¥ÄÎ¶¨ ÌòÑÌô©</h4>
                                    <p style="color: #2563eb; font-size: 0.9rem; margin: 0; margin-top: 0.25rem;">Facility Management Status</p>
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                                <div style="background: white; padding: 1rem; border-radius: 12px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                                    <div style="color: #6b7280; font-size: 0.8rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">ÎåÄÍ∏∞</div>
                                    <div style="color: #1e40af; font-size: 1.5rem; font-weight: 700; margin-top: 0.25rem;" id="facility-waiting">0</div>
                                </div>
                                <div style="background: white; padding: 1rem; border-radius: 12px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                                    <div style="color: #6b7280; font-size: 0.8rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">ÏßÑÌñâÏ§ë</div>
                                    <div style="color: #1e40af; font-size: 1.5rem; font-weight: 700; margin-top: 0.25rem;" id="facility-progress">0</div>
                                </div>
                                <div style="background: white; padding: 1rem; border-radius: 12px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                                    <div style="color: #6b7280; font-size: 0.8rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">ÏôÑÎ£å</div>
                                    <div style="color: #1e40af; font-size: 1.5rem; font-weight: 700; margin-top: 0.25rem;" id="facility-completed">0</div>
                                </div>
                                <div style="background: white; padding: 1rem; border-radius: 12px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                                    <div style="color: #6b7280; font-size: 0.8rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Ï∑®ÏÜå</div>
                                    <div style="color: #1e40af; font-size: 1.5rem; font-weight: 700; margin-top: 0.25rem;" id="facility-cancelled">0</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Ï†ÑÏ≤¥ ÏöîÏ≤≠ Î™©Î°ù -->
                    <div>
                        <h3 class="section-title">
                            <span class="emoji">üìã</span>Ï†ÑÏ≤¥ ÏöîÏ≤≠ Î™©Î°ù
                        </h3>
                        
                        <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; align-items: center; flex-wrap: wrap;">
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <label for="all-status-filter" style="margin-bottom: 0; font-weight: 600;">ÏÉÅÌÉú ÌïÑÌÑ∞:</label>
                                <select id="all-status-filter" onchange="loadAllRequests()" style="padding: 0.5rem; border-radius: 6px;">
                                    <option value="">Ï†ÑÏ≤¥</option>
                                    <option value="ÎåÄÍ∏∞">ÎåÄÍ∏∞</option>
                                    <option value="ÏßÑÌñâÏ§ë">ÏßÑÌñâÏ§ë</option>
                                    <option value="ÏôÑÎ£å">ÏôÑÎ£å</option>
                                    <option value="Ï∑®ÏÜå">Ï∑®ÏÜå</option>
                                </select>
                            </div>
                            
                            <button class="btn" onclick="loadAllRequests()" style="background: #6b7280; color: white; padding: 0.5rem 1rem; font-size: 0.9rem;">
                                <span class="emoji">üîÑ</span>ÏÉàÎ°úÍ≥†Ïπ®
                            </button>
                            
                            <button class="btn" onclick="exportToExcel('all')" style="background: #059669; color: white; padding: 0.5rem 1rem; font-size: 0.9rem;">
                                <span class="emoji">üìä</span>Excel Îã§Ïö¥Î°úÎìú
                            </button>
                        </div>
                        
                        <table class="requests-table">
                            <thead>
                                <tr>
                                    <th>Ïú†Ìòï</th>
                                    <th>Ï†úÎ™©/Î¨ºÌíà</th>
                                    <th>ÏàòÎüâ</th>
                                    <th>ÏòàÏÇ∞</th>
                                    <th>Ïö∞ÏÑ†ÏàúÏúÑ</th>
                                    <th>ÏÉÅÌÉú</th>
                                    <th>ÏöîÏ≤≠Ïûê</th>
                                    <th>Î∂ÄÏÑú</th>
                                    <th>Îì±Î°ùÏùº</th>
                                    <th>Í¥ÄÎ¶¨</th>
                                </tr>
                            </thead>
                            <tbody id="all-requests-tbody">
                                <!-- ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ± -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Íµ¨Îß§ ÏöîÏ≤≠ ÌÉ≠ -->
                <div id="admin-purchase-tab" class="admin-tab-content" style="display: none;">
                    <!-- Íµ¨Îß§ ÏöîÏ≤≠ ÌÜµÍ≥Ñ -->
                    <div class="stats-grid">
                        <div class="stat-card stat-waiting">
                            <div class="stat-number" id="stat-purchase-waiting">0</div>
                            <div class="stat-label">ÎåÄÍ∏∞ Ï§ë</div>
                        </div>
                        <div class="stat-card stat-progress">
                            <div class="stat-number" id="stat-purchase-progress">0</div>
                            <div class="stat-label">ÏßÑÌñâ Ï§ë</div>
                        </div>
                        <div class="stat-card stat-completed">
                            <div class="stat-number" id="stat-purchase-completed">0</div>
                            <div class="stat-label">ÏôÑÎ£å</div>
                        </div>
                        <div class="stat-card stat-cancelled">
                            <div class="stat-number" id="stat-purchase-cancelled">0</div>
                            <div class="stat-label">Ï∑®ÏÜå</div>
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="section-title">
                            <span class="emoji">üõí</span>Íµ¨Îß§ ÏöîÏ≤≠ Î™©Î°ù
                        </h3>
                        
                        <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; align-items: center; flex-wrap: wrap;">
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <label for="purchase-status-filter" style="margin-bottom: 0; font-weight: 600;">ÏÉÅÌÉú ÌïÑÌÑ∞:</label>
                                <select id="purchase-status-filter" onchange="loadPurchaseRequests()" style="padding: 0.5rem; border-radius: 6px;">
                                    <option value="">Ï†ÑÏ≤¥</option>
                                    <option value="ÎåÄÍ∏∞">ÎåÄÍ∏∞</option>
                                    <option value="ÏßÑÌñâÏ§ë">ÏßÑÌñâÏ§ë</option>
                                    <option value="ÏôÑÎ£å">ÏôÑÎ£å</option>
                                    <option value="Ï∑®ÏÜå">Ï∑®ÏÜå</option>
                                </select>
                            </div>
                            
                            <button class="btn" onclick="loadPurchaseRequests()" style="background: #6b7280; color: white; padding: 0.5rem 1rem; font-size: 0.9rem;">
                                <span class="emoji">üîÑ</span>ÏÉàÎ°úÍ≥†Ïπ®
                            </button>
                            
                            <button class="btn" onclick="exportToExcel('purchase')" style="background: #22c55e; color: white; padding: 0.5rem 1rem; font-size: 0.9rem;">
                                <span class="emoji">üìä</span>Excel Îã§Ïö¥Î°úÎìú
                            </button>
                        </div>
                        
                        <table class="requests-table">
                            <thead>
                                <tr>
                                    <th>ÏöîÏ≤≠ Ï†úÎ™©</th>
                                    <th>Î¨ºÌíàÎ™Ö</th>
                                    <th>ÏàòÎüâ</th>
                                    <th>ÏòàÏÇ∞ (Ïõê)</th>
                                    <th>Ïö∞ÏÑ†ÏàúÏúÑ</th>
                                    <th>ÏÉÅÌÉú</th>
                                    <th>ÏöîÏ≤≠Ïûê</th>
                                    <th>Î∂ÄÏÑú</th>
                                    <th>Íµ¨Îß§ ÏÇ¨Ïú†</th>
                                    <th>Í≤¨Ï†ÅÏÑú</th>
                                    <th>Îì±Î°ùÏùº</th>
                                    <th>Í¥ÄÎ¶¨</th>
                                </tr>
                            </thead>
                            <tbody id="purchase-requests-tbody">
                                <!-- ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ± -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- ÏãúÏÑ§ Í¥ÄÎ¶¨ ÌÉ≠ -->
                <div id="admin-facility-tab" class="admin-tab-content" style="display: none;">
                    <!-- ÏãúÏÑ§ Í¥ÄÎ¶¨ ÌÜµÍ≥Ñ -->
                    <div class="stats-grid">
                        <div class="stat-card stat-waiting">
                            <div class="stat-number" id="stat-facility-waiting">0</div>
                            <div class="stat-label">ÎåÄÍ∏∞ Ï§ë</div>
                        </div>
                        <div class="stat-card stat-progress">
                            <div class="stat-number" id="stat-facility-progress">0</div>
                            <div class="stat-label">ÏßÑÌñâ Ï§ë</div>
                        </div>
                        <div class="stat-card stat-completed">
                            <div class="stat-number" id="stat-facility-completed">0</div>
                            <div class="stat-label">ÏôÑÎ£å</div>
                        </div>
                        <div class="stat-card stat-cancelled">
                            <div class="stat-number" id="stat-facility-cancelled">0</div>
                            <div class="stat-label">Ï∑®ÏÜå</div>
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="section-title">
                            <span class="emoji">üîß</span>ÏãúÏÑ§ Í¥ÄÎ¶¨ ÏöîÏ≤≠ Î™©Î°ù
                        </h3>
                        
                        <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; align-items: center; flex-wrap: wrap;">
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <label for="facility-status-filter" style="margin-bottom: 0; font-weight: 600;">ÏÉÅÌÉú ÌïÑÌÑ∞:</label>
                                <select id="facility-status-filter" onchange="loadFacilityRequests()" style="padding: 0.5rem; border-radius: 6px;">
                                    <option value="">Ï†ÑÏ≤¥</option>
                                    <option value="ÎåÄÍ∏∞">ÎåÄÍ∏∞</option>
                                    <option value="ÏßÑÌñâÏ§ë">ÏßÑÌñâÏ§ë</option>
                                    <option value="ÏôÑÎ£å">ÏôÑÎ£å</option>
                                    <option value="Ï∑®ÏÜå">Ï∑®ÏÜå</option>
                                </select>
                            </div>
                            
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <label for="facility-priority-filter" style="margin-bottom: 0; font-weight: 600;">Ïö∞ÏÑ†ÏàúÏúÑ ÌïÑÌÑ∞:</label>
                                <select id="facility-priority-filter" onchange="loadFacilityRequests()" style="padding: 0.5rem; border-radius: 6px;">
                                    <option value="">Ï†ÑÏ≤¥</option>
                                    <option value="Í∏¥Í∏â">Í∏¥Í∏â</option>
                                    <option value="ÎÜíÏùå">ÎÜíÏùå</option>
                                    <option value="Î≥¥ÌÜµ">Î≥¥ÌÜµ</option>
                                    <option value="ÎÇÆÏùå">ÎÇÆÏùå</option>
                                </select>
                            </div>
                            
                            <button class="btn" onclick="loadFacilityRequests()" style="background: #6b7280; color: white; padding: 0.5rem 1rem; font-size: 0.9rem;">
                                <span class="emoji">üîÑ</span>ÏÉàÎ°úÍ≥†Ïπ®
                            </button>
                            
                            <button class="btn" onclick="exportToExcel('facility')" style="background: #2563eb; color: white; padding: 0.5rem 1rem; font-size: 0.9rem;">
                                <span class="emoji">üìä</span>Excel Îã§Ïö¥Î°úÎìú
                            </button>
                        </div>
                        
                        <table class="requests-table">
                            <thead>
                                <tr>
                                    <th>Ï†úÎ™©</th>
                                    <th>ÏãúÏÑ§ Ïú†Ìòï</th>
                                    <th>Ïö∞ÏÑ†ÏàúÏúÑ</th>
                                    <th>ÏÉÅÌÉú</th>
                                    <th>ÏöîÏ≤≠Ïûê</th>
                                    <th>Î∂ÄÏÑú</th>
                                    <th>ÏúÑÏπò</th>
                                    <th>ÏÇ¨ÏßÑ</th>
                                    <th>Îì±Î°ùÏùº</th>
                                    <th>Í¥ÄÎ¶¨</th>
                                </tr>
                            </thead>
                            <tbody id="facility-requests-tbody">
                                <!-- ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ± -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Í∏∞ÏïàÏÑú ÌÖúÌîåÎ¶ø ÌÉ≠ -->
                <div id="admin-template-tab" class="admin-tab-content" style="display: none;">
                    <div style="display: grid; gap: 2rem;">
                        
                        <!-- ÌïôÏäµ Îç∞Ïù¥ÌÑ∞ ÏûÖÎ†• ÏÑπÏÖò -->
                        <div style="background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%); padding: 2rem; border-radius: 20px; border: 3px solid #a855f7; box-shadow: 0 8px 32px rgba(168, 85, 247, 0.2);">
                            <h3 class="section-title">
                                <span class="emoji">üéì</span>Í∏∞ÏïàÏÑú ÌïôÏäµ Îç∞Ïù¥ÌÑ∞ ÏûÖÎ†•
                            </h3>
                            
                            <div style="margin-bottom: 2rem;">
                                <label style="display: block; margin-bottom: 1rem; font-weight: 600;">
                                    üìã Í∏∞ÏïàÏÑú Ïú†Ìòï ÏÑ†ÌÉù
                                </label>
                                <select id="template-type" style="width: 100%; padding: 0.75rem; border-radius: 8px; border: 2px solid #d1d5db;">
                                    <option value="purchase">Íµ¨Îß§ ÏöîÏ≤≠ Í∏∞ÏïàÏÑú</option>
                                    <option value="facility">ÏãúÏÑ§ ÏàòÎ¶¨ Í∏∞ÏïàÏÑú</option>
                                </select>
                            </div>
                            
                            <div style="margin-bottom: 2rem;">
                                <label style="display: block; margin-bottom: 1rem; font-weight: 600;">
                                    üìÑ Í∏∞Ï°¥ Í∏∞ÏïàÏÑú ÏÉòÌîå ÏûÖÎ†• (ÌïôÏäµÏö©)
                                </label>
                                <textarea 
                                    id="sample-template" 
                                    placeholder="Í∏∞Ï°¥Ïóê ÏûëÏÑ±ÌïòÏã† Í∏∞ÏïàÏÑú ÎÇ¥Ïö©ÏùÑ Î∂ôÏó¨ÎÑ£Ïñ¥ Ï£ºÏÑ∏Ïöî. Ïó¨Îü¨ Í∞úÏùò ÏÉòÌîåÏùÑ ÏûÖÎ†•ÌïòÏãúÎ©¥ Îçî Ï†ïÌôïÌïú ÌÖúÌîåÎ¶øÏùÑ ÏÉùÏÑ±Ìï† Ïàò ÏûàÏäµÎãàÎã§."
                                    style="width: 100%; height: 300px; padding: 1rem; border-radius: 8px; border: 2px solid #d1d5db; font-family: 'Malgun Gothic', sans-serif; line-height: 1.6;"
                                ></textarea>
                            </div>
                            
                            <button onclick="learnTemplate()" class="btn" style="background: #a855f7; color: white; padding: 0.75rem 1.5rem;">
                                <span class="emoji">üß†</span>ÌÖúÌîåÎ¶ø ÌïôÏäµÌïòÍ∏∞
                            </button>
                        </div>
                        
                        <!-- ÌïôÏäµÎêú ÌÖúÌîåÎ¶ø Í¥ÄÎ¶¨ -->
                        <div style="background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); padding: 2rem; border-radius: 20px; border: 3px solid #22c55e; box-shadow: 0 8px 32px rgba(34, 197, 94, 0.2);">
                            <h3 class="section-title">
                                <span class="emoji">üìã</span>ÌïôÏäµÎêú ÌÖúÌîåÎ¶ø Í¥ÄÎ¶¨
                            </h3>
                            
                            <div id="learned-templates" style="margin-bottom: 2rem;">
                                <!-- ÌïôÏäµÎêú ÌÖúÌîåÎ¶ø Î™©Î°ùÏù¥ Ïó¨Í∏∞Ïóê ÌëúÏãú -->
                                <div style="color: #6b7280; text-align: center; padding: 2rem;">
                                    ÏïÑÏßÅ ÌïôÏäµÎêú ÌÖúÌîåÎ¶øÏù¥ ÏóÜÏäµÎãàÎã§. ÏúÑÏóêÏÑú Í∏∞ÏïàÏÑú ÏÉòÌîåÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.
                                </div>
                            </div>
                        </div>
                        
                        <!-- ÏÇ¨Ïö©Ïûê ÌîºÎìúÎ∞± ÌïôÏäµ ÏÑπÏÖò -->
                        <div style="background: linear-gradient(135deg, #fef7ed 0%, #fed7aa 100%); padding: 2rem; border-radius: 20px; border: 3px solid #f97316; box-shadow: 0 8px 32px rgba(249, 115, 22, 0.2);">
                            <h3 class="section-title">
                                <span class="emoji">üß†</span>ÏÇ¨Ïö©Ïûê ÌîºÎìúÎ∞± ÌïôÏäµ
                                <span style="font-size: 0.8rem; color: #6b7280; font-weight: normal; margin-left: 1rem;">Í∏∞ÏïàÏÑú ÏÉùÏÑ± Í∑úÏπôÏùÑ Í∞úÏÑ†Ìï©ÎãàÎã§</span>
                            </h3>
                            
                            <div style="margin-bottom: 2rem;">
                                <label style="display: block; margin-bottom: 1rem; font-weight: 600;">
                                    üí¨ ÌîºÎìúÎ∞± Î∞è ÏöîÏ≤≠ÏÇ¨Ìï≠
                                </label>
                                <textarea 
                                    id="feedback-input" 
                                    placeholder="‚úÖ Ìö®Í≥ºÏ†ÅÏù∏ ÌîºÎìúÎ∞± ÏòàÏãú:

üö´ Ï†úÏô∏ ÏöîÏ≤≠:
‚Ä¢ 'Í≤¨Ï†ÅÏÑú Ï≤®Î∂Ä' Í¥ÄÎ†® ÎÇ¥Ïö©Ïù¥ ÏïàÎì§Ïñ¥Í∞ÄÍ≤å Ìï¥Ï§ò
‚Ä¢ Ï≤®Î∂Ä ÎÇ¥Ïö©ÏùÑ ÎπºÏ§ò
‚Ä¢ 'Ïù¥ÏÉÅÍ≥º Í∞ôÏù¥' Î¨∏Íµ¨Î•º ÏÇ≠Ï†úÌï¥Ï§ò

üèóÔ∏è Íµ¨Ï°∞Ï†Å ÏÇ≠Ï†ú:
‚Ä¢ 3Î≤à ÌïÑÏöîÏÑ± Î∂ÄÌÑ∞ ÏïÑÎûòÏùò ÎÇ¥Ïö©ÏùÑ ÏÇ≠Ï†úÌï¥Ï§ò
‚Ä¢ ÌïÑÏöîÏÑ± Ïù¥ÌõÑ Î™®Îì† ÎÇ¥Ïö©ÏùÑ Ï†úÏô∏Ìï¥Ï§ò
‚Ä¢ Í∏∞ÌÉÄÏÇ¨Ìï≠ Î∂ÄÌÑ∞ ÏïÑÎûòÎ•º ÎπºÏ§ò

‚ûï Ï∂îÍ∞Ä ÏöîÏ≤≠:
‚Ä¢ 'Í∏¥Í∏â Ï≤òÎ¶¨ ÏöîÎßù' Î¨∏Íµ¨Î•º Ï∂îÍ∞ÄÌï¥Ï§ò
‚Ä¢ Í≤ÄÌÜ† ÏöîÏ≤≠ Î¨∏Íµ¨Î•º ÎÑ£Ïñ¥Ï§ò

‚úÇÔ∏è Í∞ÑÏÜåÌôî ÏöîÏ≤≠:
‚Ä¢ Îçî Í∞ÑÎã®ÌïòÍ≤å ÏûëÏÑ±Ìï¥Ï§ò
‚Ä¢ ÌïÑÏöîÏÑ± Î∂ÄÎ∂ÑÏùÑ ÏßßÍ≤å Ìï¥Ï§ò

üîÑ ÍµêÏ≤¥ ÏöîÏ≤≠:
‚Ä¢ 'Í≤ÄÌÜ†' Î•º 'ÏäπÏù∏' Î°ú Î∞îÍøîÏ§ò
‚Ä¢ Î∂ÄÏÑúÎ™ÖÏùÑ ÎåÄÏã† 'Îã¥ÎãπÌåÄ' ÏúºÎ°ú Ïç®Ï§ò

üí° Tip: Íµ¨Ï≤¥Ï†ÅÏù¥Í≥† Î™ÖÌôïÌïú ÌëúÌòÑÏùºÏàòÎ°ù Îçî Ï†ïÌôïÌïòÍ≤å Ï†ÅÏö©Îê©ÎãàÎã§!"
                                    style="width: 100%; height: 200px; padding: 1rem; border-radius: 8px; border: 2px solid #d1d5db; font-family: 'Malgun Gothic', sans-serif; line-height: 1.6; resize: vertical;"
                                ></textarea>
                            </div>
                            
                            <div style="margin-bottom: 2rem;">
                                <label style="display: block; margin-bottom: 1rem; font-weight: 600;">
                                    üéØ Ï†ÅÏö© ÎåÄÏÉÅ
                                </label>
                                <select id="feedback-target" style="width: 100%; padding: 0.75rem; border-radius: 8px; border: 2px solid #d1d5db;">
                                    <option value="both">Íµ¨Îß§ ÏöîÏ≤≠ + ÏãúÏÑ§ Í¥ÄÎ¶¨</option>
                                    <option value="purchase">Íµ¨Îß§ ÏöîÏ≤≠Îßå</option>
                                    <option value="facility">ÏãúÏÑ§ Í¥ÄÎ¶¨Îßå</option>
                                </select>
                            </div>
                            
                            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                                <button onclick="learnFeedback()" class="btn" style="background: #f97316; color: white; padding: 0.75rem 1.5rem;">
                                    <span class="emoji">üß†</span>ÌîºÎìúÎ∞± ÌïôÏäµÌïòÍ∏∞
                                </button>
                                
                                <button onclick="testFeedbackRules()" class="btn" style="background: #2563eb; color: white; padding: 0.75rem 1.5rem;">
                                    <span class="emoji">üß™</span>Í∑úÏπô ÌÖåÏä§Ìä∏
                                </button>
                                
                                <button onclick="debugFeedbackSystem()" class="btn" style="background: #7c3aed; color: white; padding: 0.75rem 1.5rem;">
                                    <span class="emoji">üîç</span>ÏãúÏä§ÌÖú ÎîîÎ≤ÑÍ∑∏
                                </button>
                            </div>
                        </div>
                        
                        <!-- ÌïôÏäµÎêú ÌîºÎìúÎ∞± Í∑úÏπô Í¥ÄÎ¶¨ -->
                        <div style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); padding: 2rem; border-radius: 20px; border: 3px solid #64748b; box-shadow: 0 8px 32px rgba(100, 116, 139, 0.2);">
                            <h3 class="section-title">
                                <span class="emoji">‚öôÔ∏è</span>ÌïôÏäµÎêú ÌîºÎìúÎ∞± Í∑úÏπô
                            </h3>
                            
                            <div id="feedback-rules-list" style="margin-bottom: 2rem;">
                                <!-- ÌïôÏäµÎêú Í∑úÏπô Î™©Î°ùÏù¥ Ïó¨Í∏∞Ïóê ÌëúÏãú -->
                                <div style="color: #6b7280; text-align: center; padding: 2rem;">
                                    ÏïÑÏßÅ ÌïôÏäµÎêú ÌîºÎìúÎ∞± Í∑úÏπôÏù¥ ÏóÜÏäµÎãàÎã§.
                                </div>
                            </div>
                            
                            <button onclick="clearAllFeedbackRules()" class="btn" style="background: #ef4444; color: white; padding: 0.75rem 1.5rem;">
                                <span class="emoji">üóëÔ∏è</span>Î™®Îì† Í∑úÏπô Ï¥àÍ∏∞Ìôî
                            </button>
                        </div>
                        
                        <!-- ÌÖúÌîåÎ¶ø ÌïôÏäµ ÏïàÎÇ¥ -->
                        <div style="background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%); padding: 2rem; border-radius: 20px; border: 3px solid #f59e0b; box-shadow: 0 8px 32px rgba(245, 158, 11, 0.2);">
                            <h3 class="section-title">
                                <span class="emoji">üí°</span>Í∏∞ÏïàÏÑú ÏÉùÏÑ± ÏÇ¨Ïö©Î≤ï
                            </h3>
                            
                            <div style="color: #92400e; line-height: 1.8;">
                                <p><strong>üìã Í¥ÄÎ¶¨Ïûê Ïó≠Ìï†:</strong></p>
                                <ul style="margin-left: 1.5rem; margin-bottom: 1.5rem;">
                                    <li>Í∏∞Ï°¥ Í∏∞ÏïàÏÑú ÏÉòÌîåÏùÑ ÏûÖÎ†•ÌïòÏó¨ ÌÖúÌîåÎ¶ø ÌïôÏäµ</li>
                                    <li>ÏÇ¨Ïö©Ïûê ÌîºÎìúÎ∞±ÏùÑ ÌïôÏäµÌïòÏó¨ Í∏∞ÏïàÏÑú ÏÉùÏÑ± Í∑úÏπô Í∞úÏÑ†</li>
                                    <li>ÌïôÏäµÎêú ÌÖúÌîåÎ¶ø Î∞è ÌîºÎìúÎ∞± Í∑úÏπô Í¥ÄÎ¶¨ (ÏÇ≠Ï†ú/ÏàòÏ†ï)</li>
                                </ul>
                                
                                <p><strong>üë§ ÏÇ¨Ïö©Ïûê Ïó≠Ìï†:</strong></p>
                                <ul style="margin-left: 1.5rem; margin-bottom: 1.5rem;">
                                    <li>Íµ¨Îß§ ÏöîÏ≤≠ ÌÉ≠ ‚Üí Ìèº ÏûëÏÑ± ÌõÑ ÌïòÎã®Ïùò "Í∏∞ÏïàÏÑú ÏÉùÏÑ±" Î≤ÑÌäº ÌÅ¥Î¶≠</li>
                                    <li>ÏãúÏÑ§ Í¥ÄÎ¶¨ ÌÉ≠ ‚Üí Ìèº ÏûëÏÑ± ÌõÑ ÌïòÎã®Ïùò "Í∏∞ÏïàÏÑú ÏÉùÏÑ±" Î≤ÑÌäº ÌÅ¥Î¶≠</li>
                                    <li>ÏÉùÏÑ±Îêú Í∏∞ÏïàÏÑúÎ•º ÌÅ¥Î¶ΩÎ≥¥ÎìúÎ°ú Î≥µÏÇ¨ÌïòÏó¨ Í∑∏Î£πÏõ®Ïñ¥ÏóêÏÑú ÌôúÏö©</li>
                                </ul>
                                
                                <p><strong>üß† ÌîºÎìúÎ∞± ÌïôÏäµ ÏòàÏãú:</strong></p>
                                <ul style="margin-left: 1.5rem; margin-bottom: 1.5rem; font-size: 0.9rem; color: #7c2d12;">
                                    <li>"Í≤¨Ï†ÅÏÑú Ï≤®Î∂Ä Í¥ÄÎ†® ÎÇ¥Ïö©Ïù¥ ÏïàÎì§Ïñ¥Í∞ÄÍ≤å Ìï¥Ï§ò"</li>
                                    <li>"Îçî Í∞ÑÎã®ÌïòÍ≤å ÏûëÏÑ±Ìï¥Ï§ò"</li>
                                    <li>"Í∏¥Í∏â Ï≤òÎ¶¨ ÏöîÎßù Î¨∏Íµ¨Î•º Ï∂îÍ∞ÄÌï¥Ï§ò"</li>
                                </ul>
                                
                                <div style="background: rgba(245, 158, 11, 0.1); padding: 1rem; border-radius: 8px; border-left: 4px solid #f59e0b;">
                                    <strong>‚ú® Tip:</strong> ÌîºÎìúÎ∞± ÌïôÏäµÏùÑ ÌÜµÌï¥ Í∏∞ÏïàÏÑúÍ∞Ä Í≥ÑÏÜç Í∞úÏÑ†Îê©ÎãàÎã§. Î∂àÎßåÏÇ¨Ìï≠Ïù¥ÎÇò ÏöîÏ≤≠ÏÇ¨Ìï≠ÏùÑ ÏûêÏó∞Ïñ¥Î°ú ÏûÖÎ†•ÌïòÎ©¥ ÏûêÎèôÏúºÎ°ú Í∑úÏπôÌôîÎê©ÎãàÎã§!
                                </div>
                            </div>
                        </div>
                        
                    </div>
                </div>
                
            </div>
        </div>
    </div>

    <!-- ÏöîÏ≤≠ ÏÉÅÏÑ∏ Î™®Îã¨ -->
    <div id="detail-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">ÏöîÏ≤≠ ÏÉÅÏÑ∏ Ï†ïÎ≥¥</h2>
                <span class="modal-close" onclick="closeDetailModal()">&times;</span>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ± -->
            </div>
        </div>
    </div>

    <!-- ÌååÏùº ÎØ∏Î¶¨Î≥¥Í∏∞ Î™®Îã¨ -->
    <div id="file-preview-modal" class="modal" style="display: none;">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 id="file-modal-title">ÌååÏùº ÎØ∏Î¶¨Î≥¥Í∏∞</h2>
                <span class="modal-close" onclick="closeFileModal()">&times;</span>
            </div>
            <div class="modal-body" id="file-modal-body">
                <!-- ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ± -->
            </div>
        </div>
    </div>

    <!-- Ìë∏ÌÑ∞ -->
    <footer class="footer">
        <p><strong>¬© 2024 ÌÜµÌï© ÏöîÏ≤≠ Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú. All rights reserved.</strong></p>
        <p>Íµ¨Îß§ Î∞è ÏãúÏÑ§ Í¥ÄÎ¶¨ Î¨∏Ïùò: <strong>support@system.com</strong></p>
    </footer>

    <script>
        // Ï†ÑÏó≠ Î≥ÄÏàò
        let isAdmin = false;
        let requests = [];
        let requestIdCounter = 1;

        // Ï¥àÍ∏∞Ìôî
        document.addEventListener('DOMContentLoaded', function() {
            loadSampleData();
            
            // Ìèº Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
            document.getElementById('purchase-form').addEventListener('submit', submitPurchaseRequest);
            document.getElementById('facility-form').addEventListener('submit', submitFacilityRequest);
            document.getElementById('admin-form').addEventListener('submit', adminLogin);
            
            // ÌååÏùº ÏóÖÎ°úÎìú ÏÑ§Ï†ï
            setupFileUpload();
            
            // ÏÇ¨ÏßÑ ÏóÖÎ°úÎìú ÏÑ§Ï†ï
            setupPhotoUpload();
        });

        // ÏÉòÌîå Îç∞Ïù¥ÌÑ∞ Î°úÎìú
        function loadSampleData() {
            const storedRequests = localStorage.getItem('integratedRequests');
            const storedCounter = localStorage.getItem('requestIdCounter');
            
            if (storedCounter) {
                requestIdCounter = parseInt(storedCounter);
            }
            
            if (!storedRequests) {
                requests = [
                    {
                        id: 1,
                        type: 'facility',
                        title: 'Í∞ïÏùòÏã§ ÏóêÏñ¥Ïª® Í≥†Ïû•',
                        description: '301Ìò∏ Í∞ïÏùòÏã§ ÏóêÏñ¥Ïª®Ïù¥ ÏûëÎèôÌïòÏßÄ ÏïäÏäµÎãàÎã§',
                        facilityType: 'ÎÉâÎÇúÎ∞©',
                        priority: 'ÎÜíÏùå',
                        status: 'ÏßÑÌñâÏ§ë',
                        requestedBy: 'ÍπÄÍµêÏàò',
                        department: 'Ïª¥Ìì®ÌÑ∞Í≥µÌïôÍ≥º',
                        phone: '010-1234-5678',
                        location: 'Í≥µÌïôÍ¥Ä 301Ìò∏',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 2,
                        type: 'purchase',
                        department: 'ITÌåÄ',
                        item: 'ÎÖ∏Ìä∏Î∂Å',
                        quantity: 2,
                        reason: 'Ïã†ÏûÖÏÇ¨Ïõê ÏóÖÎ¨¥Ïö©',
                        status: 'ÎåÄÍ∏∞',
                        requestedBy: 'Ïù¥Í¥ÄÎ¶¨',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 3,
                        type: 'facility',
                        title: 'ÌôîÏû•Ïã§ Ï°∞Î™Ö ÍµêÏ≤¥',
                        description: 'ÌôîÏû•Ïã§ LED Ï°∞Î™ÖÏù¥ ÍπúÎπ°ÏûÖÎãàÎã§',
                        facilityType: 'Ï†ÑÍ∏∞ÏÑ§ÎπÑ',
                        priority: 'Î≥¥ÌÜµ',
                        status: 'ÏôÑÎ£å',
                        requestedBy: 'Î∞ïÍ¥ÄÎ¶¨',
                        department: 'ÏãúÏÑ§Í¥ÄÎ¶¨ÌåÄ',
                        phone: '010-9876-5432',
                        location: 'Î≥∏Í¥Ä 1Ï∏µ ÌôîÏû•Ïã§',
                        createdAt: new Date(Date.now() - 86400000).toISOString()
                    },
                    {
                        id: 4,
                        type: 'purchase',
                        department: 'ÎßàÏºÄÌåÖÌåÄ',
                        item: 'ÌîÑÎ¶∞ÌÑ∞',
                        quantity: 1,
                        reason: 'Í∏∞Ï°¥ ÌîÑÎ¶∞ÌÑ∞ Í≥†Ïû•ÏúºÎ°ú ÍµêÏ≤¥ ÌïÑÏöî',
                        status: 'Ï∑®ÏÜå',
                        requestedBy: 'ÏµúÏßÅÏõê',
                        createdAt: new Date(Date.now() - 172800000).toISOString()
                    }
                ];
                requestIdCounter = 5;
                saveToStorage();
            } else {
                requests = JSON.parse(storedRequests);
            }
        }

        // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄÏóê Ï†ÄÏû•
        function saveToStorage() {
            localStorage.setItem('integratedRequests', JSON.stringify(requests));
            localStorage.setItem('requestIdCounter', requestIdCounter.toString());
        }

        // ÏïåÎ¶º ÌëúÏãú
        function showAlert(message, type) {
            const container = document.getElementById('alert-container');
            const alertClass = type === 'success' ? 'alert-success' : 'alert-error';
            const icon = type === 'success' ? '‚úÖ' : '‚ùå';
            
            container.innerHTML = `<div class="alert ${alertClass}"><span class="emoji">${icon}</span>${message}</div>`;
            
            setTimeout(() => {
                container.innerHTML = '';
            }, 5000);
        }

        // ÌÉ≠ Ï†ÑÌôò
        function showTab(tabName) {
            // Î™®Îì† ÌÉ≠ ÎπÑÌôúÏÑ±Ìôî
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // ÏÑ†ÌÉùÎêú ÌÉ≠ ÌôúÏÑ±Ìôî
            event.target.closest('.nav-tab').classList.add('active');
            
            if (tabName === 'purchase') {
                document.getElementById('purchase-tab').classList.add('active');
            } else if (tabName === 'facility') {
                document.getElementById('facility-tab').classList.add('active');
            } else if (tabName === 'admin') {
                document.getElementById('admin-tab-content').classList.add('active');
                if (isAdmin) {
                    showAdminTab('all');
                }
            }
        }
        // ÏòàÏÇ∞ ÏûÖÎ†•Í∞í Ï†ïÎ¶¨ (ÏâºÌëú Ï†úÍ±∞, Ïà´ÏûêÎßå Ï∂îÏ∂ú)
        function cleanBudgetInput(value) {
            if (!value) return '';
            return value.toString().replace(/[^0-9]/g, '');
        }
        // Íµ¨Îß§ ÏöîÏ≤≠ Ï†úÏ∂ú
        async function submitPurchaseRequest(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const fileInput = document.getElementById('purchase-quote-file');
            const file = fileInput.files[0];
            
            const requestData = {
                id: requestIdCounter++,
                type: 'purchase',
                title: formData.get('title'),
                department: formData.get('department'),
                item: formData.get('item'),
                quantity: formData.get('quantity'),
                budget: parseInt(cleanBudgetInput(formData.get('budget'))),
                reason: formData.get('reason'),
                status: 'ÎåÄÍ∏∞',
                requestedBy: formData.get('requestedBy'),
                priority: formData.get('priority') || 'Î≥¥ÌÜµ',
                quoteFile: file ? {
                    name: file.name,
                    size: file.size,
                    type: file.type,
                    lastModified: file.lastModified
                } : null,
                createdAt: new Date().toISOString()
            };
            
            // FirebaseÏóê Ï†ÄÏû• ÏãúÎèÑ
            if (isFirebaseConnected) {
                try {
                    showLoading('FirebaseÏóê Ï†ÄÏû• Ï§ë...');
                    const firebaseId = await saveRequestToFirebase(requestData);
                    requestData.firebaseId = firebaseId;
                    hideLoading();
                    showAlert('Íµ¨Îß§ ÏöîÏ≤≠Ïù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï†úÏ∂úÎêòÏóàÏäµÎãàÎã§! (Ïã§ÏãúÍ∞Ñ ÎèôÍ∏∞Ìôî)', 'success');
                } catch (error) {
                    hideLoading();
                    // Firebase Ïã§Ìå® Ïãú Î°úÏª¨Ïóê Ï†ÄÏû•
                    requests.unshift(requestData);
                    saveToStorage();
                    showAlert('Íµ¨Îß§ ÏöîÏ≤≠Ïù¥ Ï†úÏ∂úÎêòÏóàÏäµÎãàÎã§. (Î°úÏª¨ Ï†ÄÏû•)', 'success');
                }
            } else {
                // Ïò§ÌîÑÎùºÏù∏ Î™®Îìú: Î°úÏª¨ÏóêÎßå Ï†ÄÏû•
                requests.unshift(requestData);
                saveToStorage();
                showAlert('Íµ¨Îß§ ÏöîÏ≤≠Ïù¥ Ï†úÏ∂úÎêòÏóàÏäµÎãàÎã§. (Ïò§ÌîÑÎùºÏù∏ Î™®Îìú)', 'success');
            }
            e.target.reset();
            
            // ÌååÏùº ÏóÖÎ°úÎìú UI Ï¥àÍ∏∞Ìôî
            resetFileUpload();
            
            console.log('üõí ÏÉàÎ°úÏö¥ Íµ¨Îß§ ÏöîÏ≤≠:', requestData);
        }

        // ÏãúÏÑ§ Í¥ÄÎ¶¨ ÏöîÏ≤≠ Ï†úÏ∂ú
        async function submitFacilityRequest(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            
            // ÏÇ¨ÏßÑ Îç∞Ïù¥ÌÑ∞ Ï≤òÎ¶¨
            const photoData = selectedPhotos.map(photo => ({
                name: photo.name,
                size: photo.size,
                type: photo.type,
                lastModified: photo.lastModified
            }));
            
            const requestData = {
                id: requestIdCounter++,
                type: 'facility',
                title: formData.get('title'),
                description: formData.get('description'),
                facilityType: formData.get('facilityType'),
                priority: formData.get('priority'),
                status: 'ÎåÄÍ∏∞',
                requestedBy: formData.get('requestedBy'),
                department: formData.get('department'),
                phone: formData.get('phone') || '',
                location: formData.get('location') || '',
                facilityPhotos: photoData.length > 0 ? photoData : null,
                createdAt: new Date().toISOString()
            };
            
            // FirebaseÏóê Ï†ÄÏû• ÏãúÎèÑ
            if (isFirebaseConnected) {
                try {
                    showLoading('FirebaseÏóê Ï†ÄÏû• Ï§ë...');
                    const firebaseId = await saveRequestToFirebase(requestData);
                    requestData.firebaseId = firebaseId;
                    hideLoading();
                    showAlert('ÏãúÏÑ§ Í¥ÄÎ¶¨ ÏöîÏ≤≠Ïù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï†úÏ∂úÎêòÏóàÏäµÎãàÎã§! (Ïã§ÏãúÍ∞Ñ ÎèôÍ∏∞Ìôî)', 'success');
                } catch (error) {
                    hideLoading();
                    // Firebase Ïã§Ìå® Ïãú Î°úÏª¨Ïóê Ï†ÄÏû•
                    requests.unshift(requestData);
                    saveToStorage();
                    showAlert('ÏãúÏÑ§ Í¥ÄÎ¶¨ ÏöîÏ≤≠Ïù¥ Ï†úÏ∂úÎêòÏóàÏäµÎãàÎã§. (Î°úÏª¨ Ï†ÄÏû•)', 'success');
                }
            } else {
                // Ïò§ÌîÑÎùºÏù∏ Î™®Îìú: Î°úÏª¨ÏóêÎßå Ï†ÄÏû•
                requests.unshift(requestData);
                saveToStorage();
                showAlert('ÏãúÏÑ§ Í¥ÄÎ¶¨ ÏöîÏ≤≠Ïù¥ Ï†úÏ∂úÎêòÏóàÏäµÎãàÎã§. (Ïò§ÌîÑÎùºÏù∏ Î™®Îìú)', 'success');
            }
            e.target.reset();
            
            // ÏÇ¨ÏßÑ ÏóÖÎ°úÎìú UI Ï¥àÍ∏∞Ìôî
            resetPhotoUpload();
            
            console.log('üîß ÏÉàÎ°úÏö¥ ÏãúÏÑ§ Í¥ÄÎ¶¨ ÏöîÏ≤≠:', requestData);
        }

        // Í¥ÄÎ¶¨Ïûê Î°úÍ∑∏Ïù∏
        function adminLogin(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const username = formData.get('username');
            const password = formData.get('password');
            
            if (username === 'admin' && password === 'admin123') {
                isAdmin = true;
                document.getElementById('admin-login').style.display = 'none';
                document.getElementById('admin-panel').style.display = 'block';
                document.getElementById('admin-tab').innerHTML = '<span class="emoji">üë®‚Äçüíº</span>Í¥ÄÎ¶¨Ïûê (Î°úÍ∑∏Ïù∏Îê®)';
                
                showAlert('Í¥ÄÎ¶¨ÏûêÎ°ú Î°úÍ∑∏Ïù∏ÎêòÏóàÏäµÎãàÎã§.', 'success');
                showAdminTab('all');
            } else {
                showAlert('ÏûòÎ™ªÎêú Í¥ÄÎ¶¨Ïûê Ï†ïÎ≥¥ÏûÖÎãàÎã§.', 'error');
            }
        }

        // Î°úÍ∑∏ÏïÑÏõÉ
        function logout() {
            isAdmin = false;
            document.getElementById('admin-login').style.display = 'block';
            document.getElementById('admin-panel').style.display = 'none';
            document.getElementById('admin-tab').innerHTML = '<span class="emoji">üë®‚Äçüíº</span>Í¥ÄÎ¶¨Ïûê';
            document.getElementById('admin-form').reset();
            showAlert('Î°úÍ∑∏ÏïÑÏõÉÎêòÏóàÏäµÎãàÎã§.', 'success');
        }

        // Í¥ÄÎ¶¨Ïûê ÌÉ≠ Ï†ÑÌôò
        function showAdminTab(tabName, element) {
            console.log('üîÑ Í¥ÄÎ¶¨Ïûê ÌÉ≠ Ï†ÑÌôò:', tabName);
            
            // Î™®Îì† Í¥ÄÎ¶¨Ïûê ÌïòÏúÑ ÌÉ≠ ÎπÑÌôúÏÑ±Ìôî Î∞è Ïä§ÌÉÄÏùº Ï¥àÍ∏∞Ìôî
            document.querySelectorAll('.admin-sub-tab').forEach(tab => {
                tab.classList.remove('active');
                tab.style.background = '';
                tab.style.color = '#9a3412';
                tab.style.fontWeight = '600';
                tab.style.border = '';
            });
            
            // Î™®Îì† Í¥ÄÎ¶¨Ïûê ÌÉ≠ Ïª®ÌÖêÏ∏† Ïà®Í∏∞Í∏∞
            document.querySelectorAll('.admin-tab-content').forEach(content => {
                content.style.display = 'none';
                content.classList.remove('active');
            });
            
            // ÏÑ†ÌÉùÎêú ÌÉ≠ ÌôúÏÑ±Ìôî Î∞è Ïä§ÌÉÄÏùº Ï†ÅÏö©
            if (element) {
                element.classList.add('active');
                if (tabName === 'all') {
                    element.style.background = 'linear-gradient(135deg, #fb923c, #f97316)';
                    element.style.color = 'white';
                    element.style.border = '2px solid #ea580c';
                } else if (tabName === 'purchase') {
                    element.style.background = 'linear-gradient(135deg, #22c55e, #16a34a)';
                    element.style.color = 'white';
                    element.style.border = '2px solid #15803d';
                } else if (tabName === 'facility') {
                    element.style.background = 'linear-gradient(135deg, #2563eb, #1d4ed8)';
                    element.style.color = 'white';
                    element.style.border = '2px solid #1e40af';
                } else if (tabName === 'template') {
                    element.style.background = 'linear-gradient(135deg, #a855f7, #9333ea)';
                    element.style.color = 'white';
                    element.style.border = '2px solid #7c3aed';
                }
                element.style.fontWeight = '700';
                console.log('‚úÖ ÌÉ≠ Î≤ÑÌäº ÌôúÏÑ±Ìôî:', element.textContent.trim());
            } else {
                // tabNameÏóê Îî∞Îùº Ìï¥Îãπ Î≤ÑÌäº Ï∞æÏïÑÏÑú ÌôúÏÑ±Ìôî
                const tabButton = Array.from(document.querySelectorAll('.admin-sub-tab')).find(tab => {
                    if (tabName === 'all' && tab.textContent.includes('Ï†ÑÏ≤¥')) return true;
                    if (tabName === 'purchase' && tab.textContent.includes('Íµ¨Îß§')) return true;
                    if (tabName === 'facility' && tab.textContent.includes('ÏãúÏÑ§')) return true;
                    if (tabName === 'template' && tab.textContent.includes('Í∏∞ÏïàÏÑú')) return true;
                    return false;
                });
                if (tabButton) {
                    tabButton.classList.add('active');
                    showAdminTab(tabName, tabButton); // Ïû¨Í∑Ä Ìò∏Ï∂úÎ°ú Ïä§ÌÉÄÏùº Ï†ÅÏö©
                    console.log('‚úÖ ÌÉ≠ Î≤ÑÌäº ÌôúÏÑ±Ìôî:', tabButton.textContent.trim());
                    return; // Ïû¨Í∑Ä Ìò∏Ï∂ú ÌõÑ Î¶¨ÌÑ¥
                }
            }
            
            // Ìï¥Îãπ Ïª®ÌÖêÏ∏† ÌÉ≠ ÌëúÏãú
            const contentTab = document.getElementById(`admin-${tabName}-tab`);
            if (contentTab) {
                contentTab.style.display = 'block';
                contentTab.classList.add('active');
                console.log('‚úÖ Ïª®ÌÖêÏ∏† ÏòÅÏó≠ ÌôúÏÑ±Ìôî:', `admin-${tabName}-tab`);
            } else {
                console.error('‚ùå Ïª®ÌÖêÏ∏† ÏòÅÏó≠ÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§:', `admin-${tabName}-tab`);
            }
            
            // Ìï¥Îãπ ÌÉ≠ Îç∞Ïù¥ÌÑ∞ Î°úÎìú
            if (tabName === 'all') {
                console.log('üìä Ï†ÑÏ≤¥ ÌòÑÌô© ÌÉ≠ Î°úÎìú ÏãúÏûë');
                loadAllRequests();
            } else if (tabName === 'purchase') {
                console.log('üõí Íµ¨Îß§ ÏöîÏ≤≠ ÌÉ≠ Î°úÎìú ÏãúÏûë');
                loadPurchaseRequests();
            } else if (tabName === 'facility') {
                console.log('üîß ÏãúÏÑ§ Í¥ÄÎ¶¨ ÌÉ≠ Î°úÎìú ÏãúÏûë');
                loadFacilityRequests();
            } else if (tabName === 'template') {
                console.log('üìù Í∏∞ÏïàÏÑú ÌÖúÌîåÎ¶ø ÌÉ≠ Î°úÎìú ÏãúÏûë');
                loadTemplateTab();
            }
        }

        // Ï†ÑÏ≤¥ ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
        function updateAllStats() {
            const allStats = {
                ÎåÄÍ∏∞: requests.filter(r => r.status === 'ÎåÄÍ∏∞').length,
                ÏßÑÌñâÏ§ë: requests.filter(r => r.status === 'ÏßÑÌñâÏ§ë').length,
                ÏôÑÎ£å: requests.filter(r => r.status === 'ÏôÑÎ£å').length,
                Ï∑®ÏÜå: requests.filter(r => r.status === 'Ï∑®ÏÜå').length
            };
            
            const purchaseStats = {
                ÎåÄÍ∏∞: requests.filter(r => r.type === 'purchase' && r.status === 'ÎåÄÍ∏∞').length,
                ÏßÑÌñâÏ§ë: requests.filter(r => r.type === 'purchase' && r.status === 'ÏßÑÌñâÏ§ë').length,
                ÏôÑÎ£å: requests.filter(r => r.type === 'purchase' && r.status === 'ÏôÑÎ£å').length,
                Ï∑®ÏÜå: requests.filter(r => r.type === 'purchase' && r.status === 'Ï∑®ÏÜå').length
            };
            
            const facilityStats = {
                ÎåÄÍ∏∞: requests.filter(r => r.type === 'facility' && r.status === 'ÎåÄÍ∏∞').length,
                ÏßÑÌñâÏ§ë: requests.filter(r => r.type === 'facility' && r.status === 'ÏßÑÌñâÏ§ë').length,
                ÏôÑÎ£å: requests.filter(r => r.type === 'facility' && r.status === 'ÏôÑÎ£å').length,
                Ï∑®ÏÜå: requests.filter(r => r.type === 'facility' && r.status === 'Ï∑®ÏÜå').length
            };
            
            // Ï†ÑÏ≤¥ ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('stat-all-waiting').textContent = allStats.ÎåÄÍ∏∞;
            document.getElementById('stat-all-progress').textContent = allStats.ÏßÑÌñâÏ§ë;
            document.getElementById('stat-all-completed').textContent = allStats.ÏôÑÎ£å;
            document.getElementById('stat-all-cancelled').textContent = allStats.Ï∑®ÏÜå;
            
            // Íµ¨Îß§ ÏöîÏ≤≠ ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('purchase-waiting').textContent = purchaseStats.ÎåÄÍ∏∞;
            document.getElementById('purchase-progress').textContent = purchaseStats.ÏßÑÌñâÏ§ë;
            document.getElementById('purchase-completed').textContent = purchaseStats.ÏôÑÎ£å;
            document.getElementById('purchase-cancelled').textContent = purchaseStats.Ï∑®ÏÜå;
            
            // ÏãúÏÑ§ Í¥ÄÎ¶¨ ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('facility-waiting').textContent = facilityStats.ÎåÄÍ∏∞;
            document.getElementById('facility-progress').textContent = facilityStats.ÏßÑÌñâÏ§ë;
            document.getElementById('facility-completed').textContent = facilityStats.ÏôÑÎ£å;
            document.getElementById('facility-cancelled').textContent = facilityStats.Ï∑®ÏÜå;
        }

        // Íµ¨Îß§ ÏöîÏ≤≠ ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
        function updatePurchaseStats() {
            const purchaseRequests = requests.filter(r => r.type === 'purchase');
            const stats = {
                ÎåÄÍ∏∞: purchaseRequests.filter(r => r.status === 'ÎåÄÍ∏∞').length,
                ÏßÑÌñâÏ§ë: purchaseRequests.filter(r => r.status === 'ÏßÑÌñâÏ§ë').length,
                ÏôÑÎ£å: purchaseRequests.filter(r => r.status === 'ÏôÑÎ£å').length,
                Ï∑®ÏÜå: purchaseRequests.filter(r => r.status === 'Ï∑®ÏÜå').length
            };
            
            document.getElementById('stat-purchase-waiting').textContent = stats.ÎåÄÍ∏∞;
            document.getElementById('stat-purchase-progress').textContent = stats.ÏßÑÌñâÏ§ë;
            document.getElementById('stat-purchase-completed').textContent = stats.ÏôÑÎ£å;
            document.getElementById('stat-purchase-cancelled').textContent = stats.Ï∑®ÏÜå;
        }

        // ÏãúÏÑ§ Í¥ÄÎ¶¨ ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
        function updateFacilityStats() {
            const facilityRequests = requests.filter(r => r.type === 'facility');
            const stats = {
                ÎåÄÍ∏∞: facilityRequests.filter(r => r.status === 'ÎåÄÍ∏∞').length,
                ÏßÑÌñâÏ§ë: facilityRequests.filter(r => r.status === 'ÏßÑÌñâÏ§ë').length,
                ÏôÑÎ£å: facilityRequests.filter(r => r.status === 'ÏôÑÎ£å').length,
                Ï∑®ÏÜå: facilityRequests.filter(r => r.status === 'Ï∑®ÏÜå').length
            };
            
            document.getElementById('stat-facility-waiting').textContent = stats.ÎåÄÍ∏∞;
            document.getElementById('stat-facility-progress').textContent = stats.ÏßÑÌñâÏ§ë;
            document.getElementById('stat-facility-completed').textContent = stats.ÏôÑÎ£å;
            document.getElementById('stat-facility-cancelled').textContent = stats.Ï∑®ÏÜå;
        }

        // Ï†ÑÏ≤¥ ÏöîÏ≤≠ Î™©Î°ù Î°úÎìú
        function loadAllRequests() {
            if (!isAdmin) return;
            
            console.log('üîç Ï†ÑÏ≤¥ ÏöîÏ≤≠ Î™©Î°ù Î°úÎìú Ï§ë...', requests.length, 'Í∞ú ÏöîÏ≤≠');
            
            const tbody = document.getElementById('all-requests-tbody');
            if (!tbody) {
                console.error('‚ùå all-requests-tbody ÌÖåÏù¥Î∏îÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                return;
            }
            
            tbody.innerHTML = '';
            
            const statusFilter = document.getElementById('all-status-filter');
            const filteredRequests = statusFilter && statusFilter.value 
                ? requests.filter(r => r.status === statusFilter.value)
                : requests;
            
            console.log('üìä ÌïÑÌÑ∞ÎßÅÎêú ÏöîÏ≤≠:', filteredRequests.length, 'Í∞ú');
            
            if (filteredRequests.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; color: #6b7280; padding: 2rem;">ÏöîÏ≤≠Ïù¥ ÏóÜÏäµÎãàÎã§.</td></tr>';
                return;
            }
            
            filteredRequests.forEach(request => {
                const row = document.createElement('tr');
                row.className = 'clickable-row';
                row.onclick = () => showRequestDetail(request);
                createAllRequestRow(row, request);
                tbody.appendChild(row);
            });
            
            updateAllStats();
        }

        // Íµ¨Îß§ ÏöîÏ≤≠ Î™©Î°ù Î°úÎìú
        function loadPurchaseRequests() {
            if (!isAdmin) return;
            
            console.log('üõí Íµ¨Îß§ ÏöîÏ≤≠ Î™©Î°ù Î°úÎìú Ï§ë...');
            
            const tbody = document.getElementById('purchase-requests-tbody');
            if (!tbody) {
                console.error('‚ùå purchase-requests-tbody ÌÖåÏù¥Î∏îÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                return;
            }
            
            tbody.innerHTML = '';
            
            const statusFilter = document.getElementById('purchase-status-filter');
            let purchaseRequests = requests.filter(r => r.type === 'purchase');
            
            console.log('üõí Ï†ÑÏ≤¥ Íµ¨Îß§ ÏöîÏ≤≠:', purchaseRequests.length, 'Í∞ú');
            
            if (statusFilter && statusFilter.value) {
                purchaseRequests = purchaseRequests.filter(r => r.status === statusFilter.value);
            }
            
            console.log('üõí ÌïÑÌÑ∞ÎßÅÎêú Íµ¨Îß§ ÏöîÏ≤≠:', purchaseRequests.length, 'Í∞ú');
            
            if (purchaseRequests.length === 0) {
                tbody.innerHTML = '<tr><td colspan="12" style="text-align: center; color: #6b7280; padding: 2rem;">Íµ¨Îß§ ÏöîÏ≤≠Ïù¥ ÏóÜÏäµÎãàÎã§.</td></tr>';
                return;
            }
            
            purchaseRequests.forEach(request => {
                const row = document.createElement('tr');
                row.className = 'clickable-row';
                row.onclick = () => showRequestDetail(request);
                createPurchaseRequestRow(row, request);
                tbody.appendChild(row);
            });
            
            updatePurchaseStats();
        }

        // ÏãúÏÑ§ Í¥ÄÎ¶¨ ÏöîÏ≤≠ Î™©Î°ù Î°úÎìú
        function loadFacilityRequests() {
            if (!isAdmin) return;
            
            console.log('üîß ÏãúÏÑ§ Í¥ÄÎ¶¨ ÏöîÏ≤≠ Î™©Î°ù Î°úÎìú Ï§ë...');
            
            const tbody = document.getElementById('facility-requests-tbody');
            if (!tbody) {
                console.error('‚ùå facility-requests-tbody ÌÖåÏù¥Î∏îÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                return;
            }
            
            tbody.innerHTML = '';
            
            const statusFilter = document.getElementById('facility-status-filter');
            const priorityFilter = document.getElementById('facility-priority-filter');
            let facilityRequests = requests.filter(r => r.type === 'facility');
            
            console.log('üîß Ï†ÑÏ≤¥ ÏãúÏÑ§ Í¥ÄÎ¶¨ ÏöîÏ≤≠:', facilityRequests.length, 'Í∞ú');
            
            if (statusFilter && statusFilter.value) {
                facilityRequests = facilityRequests.filter(r => r.status === statusFilter.value);
            }
            
            if (priorityFilter && priorityFilter.value) {
                facilityRequests = facilityRequests.filter(r => r.priority === priorityFilter.value);
            }
            
            console.log('üîß ÌïÑÌÑ∞ÎßÅÎêú ÏãúÏÑ§ Í¥ÄÎ¶¨ ÏöîÏ≤≠:', facilityRequests.length, 'Í∞ú');
            
            if (facilityRequests.length === 0) {
                tbody.innerHTML = '<tr><td colspan="10" style="text-align: center; color: #6b7280; padding: 2rem;">ÏãúÏÑ§ Í¥ÄÎ¶¨ ÏöîÏ≤≠Ïù¥ ÏóÜÏäµÎãàÎã§.</td></tr>';
                return;
            }
            
            facilityRequests.forEach(request => {
                const row = document.createElement('tr');
                row.className = 'clickable-row';
                row.onclick = () => showRequestDetail(request);
                createFacilityRequestRow(row, request);
                tbody.appendChild(row);
            });
            
            updateFacilityStats();
        }

        // Ï†ÑÏ≤¥ ÏöîÏ≤≠ Ìñâ ÏÉùÏÑ±
        function createAllRequestRow(row, request) {
            const statusClass = {
                'ÎåÄÍ∏∞': 'badge-waiting',
                'ÏßÑÌñâÏ§ë': 'badge-progress',
                'ÏôÑÎ£å': 'badge-completed',
                'Ï∑®ÏÜå': 'badge-cancelled'
            }[request.status];
            
            const priorityClass = request.type === 'facility' ? {
                'ÎÇÆÏùå': 'priority-low',
                'Î≥¥ÌÜµ': 'priority-normal',
                'ÎÜíÏùå': 'priority-high',
                'Í∏¥Í∏â': 'priority-urgent'
            }[request.priority] : '';
            
            const typeIcon = request.type === 'purchase' ? 'üõí' : 'üîß';
            const typeLabel = request.type === 'purchase' ? 'Íµ¨Îß§' : 'ÏãúÏÑ§';
            
            row.innerHTML = `
                <td style="font-weight: 600;">
                    <span class="emoji">${typeIcon}</span>${typeLabel}
                </td>
                <td>
                    <div style="font-weight: 600; margin-bottom: 0.25rem;">
                        ${request.type === 'purchase' ? request.item : request.title}
                    </div>
                    <div style="font-size: 0.85rem; color: #6b7280;">
                        ${request.type === 'purchase' 
                            ? `ÏàòÎüâ: ${formatQuantity(request.quantity)}` 
                            : request.facilityType}
                    </div>
                    ${request.location ? `<div style="font-size: 0.8rem; color: #9ca3af; margin-top: 0.25rem;"><span class="emoji">üìç</span>${request.location}</div>` : ''}
                </td>
                <td>
                    ${request.type === 'purchase' && request.budget 
                        ? `<span style="font-weight: 600; color: #059669;">${request.budget.toLocaleString()}Ïõê</span>` 
                        : request.type === 'purchase' ? '-' : '-'}
                </td>
                <td>
                    ${request.type === 'facility' 
                        ? `<span class="badge ${priorityClass}">${request.priority}</span>`
                        : `<span class="badge ${getPriorityBadgeClass(request.priority || 'Î≥¥ÌÜµ')}">${request.priority || 'Î≥¥ÌÜµ'}</span>`}
                </td>
                <td>
                    <span class="badge ${statusClass}">${request.status}</span>
                </td>
                <td>
                    <div style="font-weight: 500;">${request.requestedBy}</div>
                    ${request.phone ? `<div style="font-size: 0.8rem; color: #6b7280;">${request.phone}</div>` : ''}
                </td>
                <td>${request.department}</td>
                <td style="font-size: 0.85rem;">${formatDate(request.createdAt)}</td>
                <td>
                    <select onchange="updateStatus(${request.id}, this.value)" onclick="event.stopPropagation()" style="padding: 0.4rem; font-size: 0.85rem; border-radius: 6px; border: 1px solid #d1d5db;">
                        <option value="ÎåÄÍ∏∞" ${request.status === 'ÎåÄÍ∏∞' ? 'selected' : ''}>ÎåÄÍ∏∞</option>
                        <option value="ÏßÑÌñâÏ§ë" ${request.status === 'ÏßÑÌñâÏ§ë' ? 'selected' : ''}>ÏßÑÌñâÏ§ë</option>
                        <option value="ÏôÑÎ£å" ${request.status === 'ÏôÑÎ£å' ? 'selected' : ''}>ÏôÑÎ£å</option>
                        <option value="Ï∑®ÏÜå" ${request.status === 'Ï∑®ÏÜå' ? 'selected' : ''}>Ï∑®ÏÜå</option>
                    </select>
                </td>
            `;
        }

        // Íµ¨Îß§ ÏöîÏ≤≠ Ìñâ ÏÉùÏÑ±
        function createPurchaseRequestRow(row, request) {
            const statusClass = {
                'ÎåÄÍ∏∞': 'badge-waiting',
                'ÏßÑÌñâÏ§ë': 'badge-progress',
                'ÏôÑÎ£å': 'badge-completed',
                'Ï∑®ÏÜå': 'badge-cancelled'
            }[request.status];
            
            // ÌååÏùº Ï†ïÎ≥¥ Ï≤òÎ¶¨
            let fileInfo = '';
            if (request.quoteFile) {
                const sizeInMB = (request.quoteFile.size / (1024 * 1024)).toFixed(2);
                fileInfo = `<span class="badge" style="background: #10b981; color: white; font-size: 0.8rem;" title="${request.quoteFile.name} (${sizeInMB}MB)">
                    üìé ${request.quoteFile.name.length > 15 ? request.quoteFile.name.substring(0, 15) + '...' : request.quoteFile.name}
                </span>`;
            } else {
                fileInfo = '<span style="color: #9ca3af; font-size: 0.8rem;">ÏóÜÏùå</span>';
            }
            
            row.innerHTML = `
                <td style="font-weight: 600; max-width: 180px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${request.title || request.item}">${request.title || request.item}</td>
                <td style="font-weight: 500;">${request.item}</td>
                <td><span class="badge" style="background: #f3f4f6; color: #374151;">${formatQuantity(request.quantity)}</span></td>
                <td style="font-weight: 600; color: #059669; text-align: right;">${request.budget ? request.budget.toLocaleString() + 'Ïõê' : '-'}</td>
                <td><span class="badge ${getPriorityBadgeClass(request.priority || 'Î≥¥ÌÜµ')}">${request.priority || 'Î≥¥ÌÜµ'}</span></td>
                <td><span class="badge ${statusClass}">${request.status}</span></td>
                <td style="font-weight: 500;">${request.requestedBy}</td>
                <td>${request.department}</td>
                <td style="font-size: 0.9rem; max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${request.reason}">${request.reason}</td>
                <td style="text-align: center;">${fileInfo}</td>
                <td style="font-size: 0.85rem;">${formatDate(request.createdAt)}</td>
                <td>
                    <select onchange="updateStatus(${request.id}, this.value)" onclick="event.stopPropagation()" style="padding: 0.4rem; font-size: 0.85rem; border-radius: 6px; border: 1px solid #d1d5db;">
                        <option value="ÎåÄÍ∏∞" ${request.status === 'ÎåÄÍ∏∞' ? 'selected' : ''}>ÎåÄÍ∏∞</option>
                        <option value="ÏßÑÌñâÏ§ë" ${request.status === 'ÏßÑÌñâÏ§ë' ? 'selected' : ''}>ÏßÑÌñâÏ§ë</option>
                        <option value="ÏôÑÎ£å" ${request.status === 'ÏôÑÎ£å' ? 'selected' : ''}>ÏôÑÎ£å</option>
                        <option value="Ï∑®ÏÜå" ${request.status === 'Ï∑®ÏÜå' ? 'selected' : ''}>Ï∑®ÏÜå</option>
                    </select>
                </td>
            `;
        }
        
        // ÏÇ¨ÏßÑ ÌëúÏãú ÏÖÄ ÏÉùÏÑ±
        function createPhotoDisplayCell(facilityPhotos) {
            if (!facilityPhotos || facilityPhotos.length === 0) {
                return '<span style="color: #9ca3af; font-size: 0.8rem;">ÏóÜÏùå</span>';
            }
            
            const photoCount = facilityPhotos.length;
            return `<span class="badge" style="background: #3b82f6; color: white; font-size: 0.8rem; cursor: pointer;" 
                       onclick="event.stopPropagation(); showPhotoModal(${JSON.stringify(facilityPhotos).replace(/"/g, '&quot;')})" 
                       title="ÏÇ¨ÏßÑ ${photoCount}Í∞ú Î≥¥Í∏∞">
                üì∑ ${photoCount}Í∞ú
            </span>`;
        }
        
        // ÏÇ¨ÏßÑ Î™®Îã¨ ÌëúÏãú
        function showPhotoModal(photos) {
            showFilePreview(photos, 'ÏãúÏÑ§ ÏÇ¨ÏßÑ');
        }

        // ÏãúÏÑ§ Í¥ÄÎ¶¨ ÏöîÏ≤≠ Ìñâ ÏÉùÏÑ±
        function createFacilityRequestRow(row, request) {
            const statusClass = {
                'ÎåÄÍ∏∞': 'badge-waiting',
                'ÏßÑÌñâÏ§ë': 'badge-progress',
                'ÏôÑÎ£å': 'badge-completed',
                'Ï∑®ÏÜå': 'badge-cancelled'
            }[request.status];
            
            const priorityClass = {
                'ÎÇÆÏùå': 'priority-low',
                'Î≥¥ÌÜµ': 'priority-normal',
                'ÎÜíÏùå': 'priority-high',
                'Í∏¥Í∏â': 'priority-urgent'
            }[request.priority];
            
            row.innerHTML = `
                <td>
                    <div style="font-weight: 600; margin-bottom: 0.25rem;">${request.title}</div>
                    <div style="font-size: 0.8rem; color: #6b7280; max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${request.description}">${request.description}</div>
                </td>
                <td><span class="badge" style="background: #f3f4f6; color: #374151;">${request.facilityType}</span></td>
                <td><span class="badge ${priorityClass}">${request.priority}</span></td>
                <td><span class="badge ${statusClass}">${request.status}</span></td>
                <td>
                    <div style="font-weight: 500;">${request.requestedBy}</div>
                    ${request.phone ? `<div style="font-size: 0.8rem; color: #6b7280;">${request.phone}</div>` : ''}
                </td>
                <td>${request.department}</td>
                <td style="font-size: 0.85rem;">${request.location || '-'}</td>
                <td style="text-align: center;">${createPhotoDisplayCell(request.facilityPhotos)}</td>
                <td style="font-size: 0.85rem;">${formatDate(request.createdAt)}</td>
                <td>
                    <select onchange="updateStatus(${request.id}, this.value)" onclick="event.stopPropagation()" style="padding: 0.4rem; font-size: 0.85rem; border-radius: 6px; border: 1px solid #d1d5db;">
                        <option value="ÎåÄÍ∏∞" ${request.status === 'ÎåÄÍ∏∞' ? 'selected' : ''}>ÎåÄÍ∏∞</option>
                        <option value="ÏßÑÌñâÏ§ë" ${request.status === 'ÏßÑÌñâÏ§ë' ? 'selected' : ''}>ÏßÑÌñâÏ§ë</option>
                        <option value="ÏôÑÎ£å" ${request.status === 'ÏôÑÎ£å' ? 'selected' : ''}>ÏôÑÎ£å</option>
                        <option value="Ï∑®ÏÜå" ${request.status === 'Ï∑®ÏÜå' ? 'selected' : ''}>Ï∑®ÏÜå</option>
                    </select>
                </td>
            `;
        }

        // ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
        async function updateStatus(requestId, newStatus) {
            const request = requests.find(r => r.id === requestId);
            if (request) {
                const oldStatus = request.status;
                request.status = newStatus;
                request.updatedAt = new Date().toISOString();
                
                // FirebaseÏóê ÏóÖÎç∞Ïù¥Ìä∏ ÏãúÎèÑ
                if (isFirebaseConnected && request.firebaseId) {
                    try {
                        await updateRequestInFirebase(request.firebaseId, {
                            status: newStatus,
                            updatedAt: request.updatedAt
                        });
                        showAlert(`ÏöîÏ≤≠ ÏÉÅÌÉúÍ∞Ä "${newStatus}"Î°ú ÏóÖÎç∞Ïù¥Ìä∏ÎêòÏóàÏäµÎãàÎã§. (Ïã§ÏãúÍ∞Ñ ÎèôÍ∏∞Ìôî)`, 'success');
                    } catch (error) {
                        // Firebase ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìå® Ïãú Î°úÏª¨Îßå Ï†ÄÏû•
                        saveToStorage();
                        showAlert(`ÏöîÏ≤≠ ÏÉÅÌÉúÍ∞Ä "${newStatus}"Î°ú ÏóÖÎç∞Ïù¥Ìä∏ÎêòÏóàÏäµÎãàÎã§. (Î°úÏª¨ Ï†ÄÏû•)`, 'success');
                    }
                } else {
                    // Ïò§ÌîÑÎùºÏù∏ Î™®Îìú: Î°úÏª¨ÏóêÎßå Ï†ÄÏû•
                    saveToStorage();
                    showAlert(`ÏöîÏ≤≠ ÏÉÅÌÉúÍ∞Ä "${newStatus}"Î°ú ÏóÖÎç∞Ïù¥Ìä∏ÎêòÏóàÏäµÎãàÎã§. (Ïò§ÌîÑÎùºÏù∏ Î™®Îìú)`, 'success');
                }
                
                // UIÎäî Ïã§ÏãúÍ∞Ñ Î¶¨Ïä§ÎÑàÏóê ÏùòÌï¥ ÏûêÎèô ÏóÖÎç∞Ïù¥Ìä∏Îê®
                // Ïã§ÏãúÍ∞Ñ Î¶¨Ïä§ÎÑàÍ∞Ä ÏóÜÎäî Í≤ΩÏö∞Î•º ÏúÑÌïú Î∞±ÏóÖ UI ÏóÖÎç∞Ïù¥Ìä∏
                if (!isFirebaseConnected) {
                    const activeAdminTab = document.querySelector('.admin-sub-tab.active');
                    if (activeAdminTab) {
                        const tabName = activeAdminTab.textContent.includes('Ï†ÑÏ≤¥') ? 'all' :
                                       activeAdminTab.textContent.includes('Íµ¨Îß§') ? 'purchase' : 'facility';
                        
                        if (tabName === 'all') {
                            loadAllRequests();
                        } else if (tabName === 'purchase') {
                            loadPurchaseRequests();
                        } else if (tabName === 'facility') {
                            loadFacilityRequests();
                        }
                    }
                }
            }
        }

        // ÎÇ†Ïßú Ìè¨Îß∑ÌåÖ
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ko-KR') + ' ' + date.toLocaleTimeString('ko-KR', {hour: '2-digit', minute: '2-digit'});
        }
        
        // ÌååÏùº ÏóÖÎ°úÎìú Í¥ÄÎ†® Ìï®ÏàòÎì§
        function resetFileUpload() {
            const fileNameElement = document.getElementById('selected-file-name');
            const uploadContainer = document.querySelector('.file-upload-container');
            
            fileNameElement.textContent = '';
            uploadContainer.classList.remove('has-file');
        }
        
        function validateFile(file) {
            const maxSize = 10 * 1024 * 1024; // 10MB
            const allowedTypes = [
                'application/pdf',
                'application/vnd.ms-excel',
                'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
                'application/x-hwp',
                'application/haansofthwp'
            ];
            
            if (file.size > maxSize) {
                showAlert('ÌååÏùº ÌÅ¨Í∏∞Îäî 10MB Ïù¥ÌïòÎßå ÏóÖÎ°úÎìú Í∞ÄÎä•Ìï©ÎãàÎã§.', 'error');
                return false;
            }
            
            const fileExtension = file.name.split('.').pop().toLowerCase();
            const allowedExtensions = ['pdf', 'xls', 'xlsx', 'hwp', 'hwpx'];
            
            if (!allowedExtensions.includes(fileExtension)) {
                showAlert('PDF, Excel, ÌïúÍ∏Ä ÌååÏùºÎßå ÏóÖÎ°úÎìú Í∞ÄÎä•Ìï©ÎãàÎã§.', 'error');
                return false;
            }
            
            return true;
        }
        
        function handleFileSelect(file) {
            if (!validateFile(file)) {
                return false;
            }
            
            const fileNameElement = document.getElementById('selected-file-name');
            const uploadContainer = document.querySelector('.file-upload-container');
            
            const sizeInMB = (file.size / (1024 * 1024)).toFixed(2);
            fileNameElement.textContent = `${file.name} (${sizeInMB}MB)`;
            uploadContainer.classList.add('has-file');
            
            return true;
        }
        
        function setupFileUpload() {
            const fileInput = document.getElementById('purchase-quote-file');
            const uploadContainer = document.querySelector('.file-upload-container');
            
            // ÌååÏùº ÏÑ†ÌÉù Ïù¥Î≤§Ìä∏
            fileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    if (!handleFileSelect(file)) {
                        e.target.value = ''; // ÌååÏùº ÏÑ†ÌÉù Ï∑®ÏÜå
                        resetFileUpload();
                    }
                } else {
                    resetFileUpload();
                }
            });
            
            // ÎìúÎûòÍ∑∏ Ïï§ ÎìúÎ°≠ Ïù¥Î≤§Ìä∏
            uploadContainer.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadContainer.classList.add('dragover');
            });
            
            uploadContainer.addEventListener('dragleave', function(e) {
                e.preventDefault();
                uploadContainer.classList.remove('dragover');
            });
            
            uploadContainer.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadContainer.classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    const file = files[0];
                    if (handleFileSelect(file)) {
                        fileInput.files = files;
                    }
                }
            });
            
            // Ïª®ÌÖåÏù¥ÎÑà ÌÅ¥Î¶≠ Ïãú ÌååÏùº ÏÑ†ÌÉù Ï∞Ω Ïó¥Í∏∞
            uploadContainer.addEventListener('click', function() {
                fileInput.click();
            });
        }
        
        // ÏÇ¨ÏßÑ ÏóÖÎ°úÎìú Í¥ÄÎ†® Î≥ÄÏàò
        let selectedPhotos = [];
        const MAX_PHOTOS = 3;
        const MAX_PHOTO_SIZE = 5 * 1024 * 1024; // 5MB
        
        // ÏÇ¨ÏßÑ ÏóÖÎ°úÎìú Ï¥àÍ∏∞Ìôî
        function resetPhotoUpload() {
            selectedPhotos = [];
            const previewContainer = document.getElementById('facility-photo-preview');
            const uploadContainer = document.querySelector('.photo-upload-container');
            
            if (previewContainer) previewContainer.innerHTML = '';
            if (uploadContainer) {
                uploadContainer.classList.remove('has-photos');
                updatePhotoUploadText();
            }
        }
        
        // ÏÇ¨ÏßÑ ÏóÖÎ°úÎìú ÌÖçÏä§Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
        function updatePhotoUploadText() {
            const uploadText = document.querySelector('.photo-upload-text');
            if (!uploadText) return;
            
            if (selectedPhotos.length === 0) {
                uploadText.textContent = 'üì∑ ÏÇ¨ÏßÑÏùÑ ÏÑ†ÌÉùÌïòÍ±∞ÎÇò ÎìúÎûòÍ∑∏ÌïòÏó¨ ÏóÖÎ°úÎìú (ÏµúÎåÄ 3Í∞ú)';
            } else {
                uploadText.textContent = `üì∑ ${selectedPhotos.length}Í∞ú ÏÇ¨ÏßÑ ÏÑ†ÌÉùÎê® (ÏµúÎåÄ 3Í∞ú)`;
            }
        }
        
        // ÏÇ¨ÏßÑ ÌååÏùº Í≤ÄÏ¶ù
        function validatePhoto(file) {
            const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'];
            
            if (!allowedTypes.includes(file.type)) {
                showAlert('JPG, PNG, GIF ÌååÏùºÎßå ÏóÖÎ°úÎìú Í∞ÄÎä•Ìï©ÎãàÎã§.', 'error');
                return false;
            }
            
            if (file.size > MAX_PHOTO_SIZE) {
                showAlert('ÏÇ¨ÏßÑ ÌÅ¨Í∏∞Îäî 5MB Ïù¥ÌïòÎßå ÏóÖÎ°úÎìú Í∞ÄÎä•Ìï©ÎãàÎã§.', 'error');
                return false;
            }
            
            return true;
        }
        
        // ÏÇ¨ÏßÑ ÎØ∏Î¶¨Î≥¥Í∏∞ ÏÉùÏÑ±
        function createPhotoPreview(file, index) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const previewItem = document.createElement('div');
                    previewItem.className = 'photo-preview-item';
                    previewItem.innerHTML = `
                        <img src="${e.target.result}" alt="ÎØ∏Î¶¨Î≥¥Í∏∞" class="photo-preview-img">
                        <button type="button" class="photo-remove-btn" onclick="removePhoto(${index})" title="ÏÇ¨ÏßÑ ÏÇ≠Ï†ú">
                            √ó
                        </button>
                        <div class="photo-info">${file.name}</div>
                    `;
                    resolve(previewItem);
                };
                reader.readAsDataURL(file);
            });
        }
        
        // ÏÇ¨ÏßÑ ÏÇ≠Ï†ú
        function removePhoto(index) {
            selectedPhotos.splice(index, 1);
            updatePhotoPreview();
            updatePhotoUploadText();
            
            // ÌååÏùº input Í∞í ÏóÖÎç∞Ïù¥Ìä∏
            const fileInput = document.getElementById('facility-photo');
            if (fileInput) {
                const dt = new DataTransfer();
                selectedPhotos.forEach(photo => dt.items.add(photo));
                fileInput.files = dt.files;
            }
        }
        
        // ÏÇ¨ÏßÑ ÎØ∏Î¶¨Î≥¥Í∏∞ ÏóÖÎç∞Ïù¥Ìä∏
        async function updatePhotoPreview() {
            const previewContainer = document.getElementById('facility-photo-preview');
            const uploadContainer = document.querySelector('.photo-upload-container');
            
            if (!previewContainer) return;
            
            previewContainer.innerHTML = '';
            
            for (let i = 0; i < selectedPhotos.length; i++) {
                const previewItem = await createPhotoPreview(selectedPhotos[i], i);
                previewContainer.appendChild(previewItem);
            }
            
            if (uploadContainer) {
                if (selectedPhotos.length > 0) {
                    uploadContainer.classList.add('has-photos');
                } else {
                    uploadContainer.classList.remove('has-photos');
                }
            }
        }
        
        // ÏÇ¨ÏßÑ ÌååÏùº Ï∂îÍ∞Ä
        async function addPhotos(files) {
            const filesToAdd = Array.from(files).slice(0, MAX_PHOTOS - selectedPhotos.length);
            
            for (const file of filesToAdd) {
                if (!validatePhoto(file)) continue;
                selectedPhotos.push(file);
            }
            
            if (selectedPhotos.length >= MAX_PHOTOS) {
                showAlert(`ÏµúÎåÄ ${MAX_PHOTOS}Í∞úÏùò ÏÇ¨ÏßÑÎßå ÏóÖÎ°úÎìúÌï† Ïàò ÏûàÏäµÎãàÎã§.`, 'warning');
            }
            
            await updatePhotoPreview();
            updatePhotoUploadText();
        }
        
        // ÏÇ¨ÏßÑ ÏóÖÎ°úÎìú ÏÑ§Ï†ï
        function setupPhotoUpload() {
            const photoInput = document.getElementById('facility-photo');
            const uploadContainer = document.querySelector('.photo-upload-container');
            
            if (!photoInput || !uploadContainer) return;
            
            // ÌååÏùº ÏÑ†ÌÉù Ïù¥Î≤§Ìä∏
            photoInput.addEventListener('change', async function(e) {
                const files = e.target.files;
                if (files.length > 0) {
                    await addPhotos(files);
                }
            });
            
            // ÎìúÎûòÍ∑∏ Ïï§ ÎìúÎ°≠ Ïù¥Î≤§Ìä∏
            uploadContainer.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadContainer.classList.add('dragover');
            });
            
            uploadContainer.addEventListener('dragleave', function(e) {
                e.preventDefault();
                if (!uploadContainer.contains(e.relatedTarget)) {
                    uploadContainer.classList.remove('dragover');
                }
            });
            
            uploadContainer.addEventListener('drop', async function(e) {
                e.preventDefault();
                uploadContainer.classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    await addPhotos(files);
                }
            });
            
            // Ïª®ÌÖåÏù¥ÎÑà ÌÅ¥Î¶≠ Ïãú ÌååÏùº ÏÑ†ÌÉù Ï∞Ω Ïó¥Í∏∞
            uploadContainer.addEventListener('click', function(e) {
                if (e.target === uploadContainer || e.target.classList.contains('photo-upload-display') || e.target.classList.contains('photo-upload-text')) {
                    photoInput.click();
                }
            });
        }
        
        // ÏöîÏ≤≠ ÏÉÅÏÑ∏ Ï†ïÎ≥¥ ÌëúÏãú
        function showRequestDetail(request) {
            const modal = document.getElementById('detail-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalBody = document.getElementById('modal-body');
            
            // Î™®Îã¨ Ï†úÎ™© ÏÑ§Ï†ï
            const typeIcon = request.type === 'purchase' ? 'üõí' : 'üîß';
            const typeName = request.type === 'purchase' ? 'Íµ¨Îß§ ÏöîÏ≤≠' : 'ÏãúÏÑ§ Í¥ÄÎ¶¨ ÏöîÏ≤≠';
            modalTitle.innerHTML = `${typeIcon} ${typeName} ÏÉÅÏÑ∏ Ï†ïÎ≥¥`;
            
            // ÏÉÅÏÑ∏ ÎÇ¥Ïö© ÏÉùÏÑ±
            modalBody.innerHTML = createDetailContent(request);
            
            // Î™®Îã¨ ÌëúÏãú
            modal.style.display = 'block';
            document.body.style.overflow = 'hidden';
        }
        
        // ÏÉÅÏÑ∏ ÎÇ¥Ïö© HTML ÏÉùÏÑ±
        function createDetailContent(request) {
            const statusClass = getStatusBadgeClass(request.status);
            const statusBadge = `<span class="status-badge ${statusClass}">${request.status}</span>`;
            
            let content = `
                <div class="detail-section">
                    <h3>üìã Í∏∞Î≥∏ Ï†ïÎ≥¥</h3>
                    <div class="detail-row">
                        <span class="detail-label">ÏöîÏ≤≠ ID:</span>
                        <span class="detail-value">#${request.id}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">ÏÉÅÌÉú:</span>
                        <span class="detail-value">${statusBadge}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">ÏöîÏ≤≠Ïûê:</span>
                        <span class="detail-value">${request.requestedBy}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Î∂ÄÏÑú:</span>
                        <span class="detail-value">${request.department}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Îì±Î°ùÏùº:</span>
                        <span class="detail-value">${formatDate(request.createdAt)}</span>
                    </div>
                </div>
            `;
            
            if (request.type === 'purchase') {
                content += createPurchaseDetailContent(request);
            } else {
                content += createFacilityDetailContent(request);
            }
            
            return content;
        }
        
        // Íµ¨Îß§ ÏöîÏ≤≠ ÏÉÅÏÑ∏ ÎÇ¥Ïö©
        function createPurchaseDetailContent(request) {
            let content = `
                <div class="detail-section">
                    <h3>üõí Íµ¨Îß§ Ï†ïÎ≥¥</h3>
                    ${request.title ? `
                        <div class="detail-row">
                            <span class="detail-label">ÏöîÏ≤≠ Ï†úÎ™©:</span>
                            <span class="detail-value">${request.title}</span>
                        </div>
                    ` : ''}
                    <div class="detail-row">
                        <span class="detail-label">Î¨ºÌíàÎ™Ö:</span>
                        <span class="detail-value">${request.item}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">ÏàòÎüâ:</span>
                        <span class="detail-value">${formatQuantity(request.quantity)}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Ïö∞ÏÑ†ÏàúÏúÑ:</span>
                        <span class="detail-value"><span class="status-badge ${getPriorityBadgeClass(request.priority || 'Î≥¥ÌÜµ')}">${request.priority || 'Î≥¥ÌÜµ'}</span></span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Íµ¨Îß§ ÏÇ¨Ïú†:</span>
                        <span class="detail-value">${request.reason}</span>
                    </div>
                </div>
            `;
            
            // Í≤¨Ï†ÅÏÑú ÌååÏùº Ï†ïÎ≥¥
            if (request.quoteFile) {
                content += `
                    <div class="detail-section">
                        <h3>üìé Ï≤®Î∂Ä ÌååÏùº</h3>
                        <div class="file-list">
                            <div class="file-item" onclick="event.stopPropagation(); showFilePreview(${JSON.stringify(request.quoteFile).replace(/"/g, '&quot;')}, 'Í≤¨Ï†ÅÏÑú')">
                                <span class="file-icon">üìÑ</span>
                                <div class="file-info">
                                    <span class="file-name">${request.quoteFile.name}</span>
                                    <span class="file-size">${formatFileSize(request.quoteFile.size)}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            return content;
        }
        
        // ÏãúÏÑ§ Í¥ÄÎ¶¨ ÏöîÏ≤≠ ÏÉÅÏÑ∏ ÎÇ¥Ïö©
        function createFacilityDetailContent(request) {
            const priorityClass = getPriorityBadgeClass(request.priority);
            const priorityBadge = `<span class="status-badge ${priorityClass}">${request.priority}</span>`;
            
            let content = `
                <div class="detail-section">
                    <h3>üîß ÏãúÏÑ§ Í¥ÄÎ¶¨ Ï†ïÎ≥¥</h3>
                    <div class="detail-row">
                        <span class="detail-label">ÏöîÏ≤≠ Ï†úÎ™©:</span>
                        <span class="detail-value">${request.title}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">ÏãúÏÑ§ Ïú†Ìòï:</span>
                        <span class="detail-value">${request.facilityType}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Ïö∞ÏÑ†ÏàúÏúÑ:</span>
                        <span class="detail-value">${priorityBadge}</span>
                    </div>
                    ${request.phone ? `
                        <div class="detail-row">
                            <span class="detail-label">Ïó∞ÎùΩÏ≤ò:</span>
                            <span class="detail-value">${request.phone}</span>
                        </div>
                    ` : ''}
                    ${request.location ? `
                        <div class="detail-row">
                            <span class="detail-label">ÏúÑÏπò:</span>
                            <span class="detail-value">${request.location}</span>
                        </div>
                    ` : ''}
                    <div class="detail-row">
                        <span class="detail-label">ÏÉÅÏÑ∏ ÏÑ§Î™Ö:</span>
                        <span class="detail-value">${request.description}</span>
                    </div>
                </div>
            `;
            
            // ÏãúÏÑ§ ÏÇ¨ÏßÑ Ï†ïÎ≥¥
            if (request.facilityPhotos && request.facilityPhotos.length > 0) {
                content += `
                    <div class="detail-section">
                        <h3>üì∑ Ï≤®Î∂Ä ÏÇ¨ÏßÑ</h3>
                        <div class="file-list">
                `;
                
                request.facilityPhotos.forEach((photo, index) => {
                    content += `
                        <div class="file-item" onclick="event.stopPropagation(); showFilePreview(${JSON.stringify(request.facilityPhotos).replace(/"/g, '&quot;')}, 'ÏãúÏÑ§ ÏÇ¨ÏßÑ')">
                            <span class="file-icon">üñºÔ∏è</span>
                            <div class="file-info">
                                <span class="file-name">${photo.name}</span>
                                <span class="file-size">${formatFileSize(photo.size)}</span>
                            </div>
                        </div>
                    `;
                });
                
                content += `
                        </div>
                    </div>
                `;
            }
            
            return content;
        }
        
        // ÌååÏùº ÎØ∏Î¶¨Î≥¥Í∏∞ ÌëúÏãú
        function showFilePreview(files, title) {
            const modal = document.getElementById('file-preview-modal');
            const modalTitle = document.getElementById('file-modal-title');
            const modalBody = document.getElementById('file-modal-body');
            
            modalTitle.innerHTML = `üìé ${title}`;
            
            let content = '';
            
            if (Array.isArray(files)) {
                // ÏÇ¨ÏßÑ ÌååÏùºÎì§ (ÏãúÏÑ§ Í¥ÄÎ¶¨)
                content = `
                    <div class="photo-grid">
                        ${files.map((photo, index) => `
                            <div class="photo-item">
                                <div style="width: 100%; height: 150px; background: #f3f4f6; display: flex; align-items: center; justify-content: center; color: #6b7280;">
                                    üñºÔ∏è<br>
                                    <small>ÎØ∏Î¶¨Î≥¥Í∏∞ Ï§ÄÎπÑ Ï§ë</small>
                                </div>
                                <div class="photo-info-overlay">
                                    <div class="file-name">${photo.name}</div>
                                    <div class="file-size">${formatFileSize(photo.size)}</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div style="margin-top: 16px; text-align: center; color: #6b7280;">
                        <p>üìù Ïã§Ï†ú Ïö¥ÏòÅ ÌôòÍ≤ΩÏóêÏÑúÎäî ÏóÖÎ°úÎìúÎêú ÏÇ¨ÏßÑÏùÑ ÎØ∏Î¶¨Î≥º Ïàò ÏûàÏäµÎãàÎã§.</p>
                    </div>
                `;
            } else {
                // Îã®Ïùº ÌååÏùº (Íµ¨Îß§ ÏöîÏ≤≠ Í≤¨Ï†ÅÏÑú)
                content = `
                    <div class="file-list" style="justify-content: center;">
                        <div class="file-item" style="padding: 24px; background: #f8fafc;">
                            <span class="file-icon" style="font-size: 3rem;">üìÑ</span>
                            <div class="file-info" style="align-items: center;">
                                <span class="file-name" style="font-size: 1.1rem; max-width: none;">${files.name}</span>
                                <span class="file-size">${formatFileSize(files.size)}</span>
                                <div style="margin-top: 8px; color: #6b7280; font-size: 0.9rem;">
                                    ÌååÏùº ÌòïÏãù: ${getFileTypeDisplay(files.type)}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 16px; text-align: center; color: #6b7280;">
                        <p>üìù Ïã§Ï†ú Ïö¥ÏòÅ ÌôòÍ≤ΩÏóêÏÑúÎäî ÌååÏùºÏùÑ Îã§Ïö¥Î°úÎìúÌïòÍ±∞ÎÇò ÎØ∏Î¶¨Î≥º Ïàò ÏûàÏäµÎãàÎã§.</p>
                    </div>
                `;
            }
            
            modalBody.innerHTML = content;
            modal.style.display = 'block';
        }
        
        // ÏÉÅÌÉú Î±ÉÏßÄ ÌÅ¥ÎûòÏä§ Î∞òÌôò
        function getStatusBadgeClass(status) {
            const classes = {
                'ÎåÄÍ∏∞': 'badge-waiting',
                'ÏßÑÌñâÏ§ë': 'badge-progress', 
                'ÏôÑÎ£å': 'badge-completed',
                'Ï∑®ÏÜå': 'badge-cancelled'
            };
            return classes[status] || 'badge-waiting';
        }
        
        // Ïö∞ÏÑ†ÏàúÏúÑ Î±ÉÏßÄ ÌÅ¥ÎûòÏä§ Î∞òÌôò
        function getPriorityBadgeClass(priority) {
            const classes = {
                'ÎÇÆÏùå': 'priority-low',
                'Î≥¥ÌÜµ': 'priority-normal',
                'ÎÜíÏùå': 'priority-high',
                'Í∏¥Í∏â': 'priority-urgent'
            };
            return classes[priority] || 'priority-normal';
        }
        
        // ÌååÏùº ÌÅ¨Í∏∞ Ìè¨Îß∑ÌåÖ
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // ÌååÏùº ÌÉÄÏûÖ ÌëúÏãúÎ™Ö Î∞òÌôò
        function getFileTypeDisplay(mimeType) {
            const types = {
                'application/pdf': 'PDF Î¨∏ÏÑú',
                'application/vnd.ms-excel': 'Excel ÌååÏùº',
                'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet': 'Excel ÌååÏùº',
                'application/x-hwp': 'ÌïúÍ∏Ä Î¨∏ÏÑú',
                'application/haansofthwp': 'ÌïúÍ∏Ä Î¨∏ÏÑú',
                'image/jpeg': 'JPEG Ïù¥ÎØ∏ÏßÄ',
                'image/jpg': 'JPG Ïù¥ÎØ∏ÏßÄ', 
                'image/png': 'PNG Ïù¥ÎØ∏ÏßÄ',
                'image/gif': 'GIF Ïù¥ÎØ∏ÏßÄ'
            };
            return types[mimeType] || 'Ïïå Ïàò ÏóÜÎäî ÌòïÏãù';
        }
        
        // Î™®Îã¨ Îã´Í∏∞ Ìï®ÏàòÎì§
        function closeDetailModal() {
            document.getElementById('detail-modal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }
        
        function closeFileModal() {
            document.getElementById('file-preview-modal').style.display = 'none';
        }
        
        // Î™®Îã¨ Ïô∏Î∂Ä ÌÅ¥Î¶≠ Ïãú Îã´Í∏∞
        window.onclick = function(event) {
            const detailModal = document.getElementById('detail-modal');
            const fileModal = document.getElementById('file-preview-modal');
            
            if (event.target === detailModal) {
                closeDetailModal();
            } else if (event.target === fileModal) {
                closeFileModal();
            }
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìú ÏôÑÎ£å Î©îÏãúÏßÄ
        window.onload = function() {
            console.log('üöÄ ÌÜµÌï© ÏöîÏ≤≠ Í¥ÄÎ¶¨ ÏãúÏä§ÌÖúÏù¥ Ï§ÄÎπÑÎêòÏóàÏäµÎãàÎã§!');
            console.log('üí° ÏöîÏ≤≠ÏùÑ Ï†úÏ∂úÌïòÎ©¥ ÏΩòÏÜîÏóêÏÑú Îç∞Ïù¥ÌÑ∞Î•º ÌôïÏù∏Ìï† Ïàò ÏûàÏäµÎãàÎã§.');
        };

        // Excel Îã§Ïö¥Î°úÎìú Ìï®Ïàò
        function exportToExcel(type) {
            try {
                let data = [];
                let fileName = '';
                
                if (type === 'all') {
                    // Ï†ÑÏ≤¥ ÌòÑÌô© Îç∞Ïù¥ÌÑ∞
                    const filteredRequests = getFilteredAllRequests();
                    fileName = 'Ï†ÑÏ≤¥_ÏöîÏ≤≠_ÌòÑÌô©';
                    
                    data = filteredRequests.map(request => ({
                        'Ïú†Ìòï': request.type === 'purchase' ? 'Íµ¨Îß§ ÏöîÏ≤≠' : 'ÏãúÏÑ§ Í¥ÄÎ¶¨',
                        'Ï†úÎ™©/Î¨ºÌíà': request.title || request.item || request.facility,
                        'ÏàòÎüâ/ÏúÑÏπò': request.quantity ? formatQuantity(request.quantity) : request.location || '-',
                        'ÏòàÏÇ∞': request.type === 'purchase' && request.budget ? request.budget.toLocaleString() + 'Ïõê' : '-',
                        'Ïö∞ÏÑ†ÏàúÏúÑ': request.priority || 'Î≥¥ÌÜµ',
                        'ÏÉÅÌÉú': request.status,
                        'ÏöîÏ≤≠Ïûê': request.requestedBy,
                        'Î∂ÄÏÑú': request.department,
                        'Îì±Î°ùÏùº': new Date(request.createdAt).toLocaleDateString('ko-KR'),
                        'ÏÇ¨Ïú†/ÏÑ§Î™Ö': request.reason || request.description || '-'
                    }));
                    
                } else if (type === 'purchase') {
                    // Íµ¨Îß§ ÏöîÏ≤≠ Îç∞Ïù¥ÌÑ∞
                    const filteredRequests = getFilteredPurchaseRequests();
                    fileName = 'Íµ¨Îß§_ÏöîÏ≤≠_Î™©Î°ù';
                    
                    data = filteredRequests.map(request => ({
                        'ÏöîÏ≤≠ Ï†úÎ™©': request.title || request.item,
                        'Î¨ºÌíàÎ™Ö': request.item,
                        'ÏàòÎüâ': formatQuantity(request.quantity),
                        'ÏòàÏÇ∞ (Ïõê)': request.budget ? request.budget.toLocaleString() : '-',
                        'Ïö∞ÏÑ†ÏàúÏúÑ': request.priority || 'Î≥¥ÌÜµ',
                        'ÏÉÅÌÉú': request.status,
                        'ÏöîÏ≤≠Ïûê': request.requestedBy,
                        'Î∂ÄÏÑú': request.department,
                        'Íµ¨Îß§ ÏÇ¨Ïú†': request.reason,
                        'Í≤¨Ï†ÅÏÑú': request.quoteFile ? 'Ï≤®Î∂ÄÎê®' : 'ÏóÜÏùå',
                        'Îì±Î°ùÏùº': new Date(request.createdAt).toLocaleDateString('ko-KR')
                    }));
                    
                } else if (type === 'facility') {
                    // ÏãúÏÑ§ Í¥ÄÎ¶¨ Îç∞Ïù¥ÌÑ∞
                    const filteredRequests = getFilteredFacilityRequests();
                    fileName = 'ÏãúÏÑ§_Í¥ÄÎ¶¨_Î™©Î°ù';
                    
                    data = filteredRequests.map(request => ({
                        'ÏãúÏÑ§Î™Ö': request.facility,
                        'ÏúÑÏπò': request.location,
                        'Ïö∞ÏÑ†ÏàúÏúÑ': request.priority,
                        'ÏÉÅÌÉú': request.status,
                        'ÏöîÏ≤≠Ïûê': request.requestedBy,
                        'Î∂ÄÏÑú': request.department,
                        'Î¨∏Ï†ú ÏÑ§Î™Ö': request.description,
                        'ÏÇ¨ÏßÑ': request.facilityPhotos && request.facilityPhotos.length > 0 ? `${request.facilityPhotos.length}Í∞ú Ï≤®Î∂Ä` : 'ÏóÜÏùå',
                        'Îì±Î°ùÏùº': new Date(request.createdAt).toLocaleDateString('ko-KR')
                    }));
                }
                
                if (data.length === 0) {
                    alert('Îã§Ïö¥Î°úÎìúÌï† Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.');
                    return;
                }
                
                // Excel ÏõåÌÅ¨Î∂Å ÏÉùÏÑ±
                const wb = XLSX.utils.book_new();
                const ws = XLSX.utils.json_to_sheet(data);
                
                // Ïó¥ ÎÑàÎπÑ ÏûêÎèô Ï°∞Ï†ï
                const colWidths = [];
                if (data.length > 0) {
                    const keys = Object.keys(data[0]);
                    keys.forEach(key => {
                        const maxLength = Math.max(
                            key.length,
                            ...data.map(row => String(row[key] || '').length)
                        );
                        colWidths.push({ width: Math.min(maxLength + 2, 50) });
                    });
                }
                ws['!cols'] = colWidths;
                
                // ÏõåÌÅ¨ÏãúÌä∏Î•º ÏõåÌÅ¨Î∂ÅÏóê Ï∂îÍ∞Ä
                XLSX.utils.book_append_sheet(wb, ws, 'ÏöîÏ≤≠Î™©Î°ù');
                
                // ÌååÏùº Îã§Ïö¥Î°úÎìú
                const today = new Date().toISOString().split('T')[0];
                XLSX.writeFile(wb, `${fileName}_${today}.xlsx`);
                
                console.log(`‚úÖ Excel ÌååÏùº Îã§Ïö¥Î°úÎìú ÏôÑÎ£å: ${fileName}_${today}.xlsx`);
                
            } catch (error) {
                console.error('‚ùå Excel Îã§Ïö¥Î°úÎìú Ïã§Ìå®:', error);
                alert('Excel Îã§Ïö¥Î°úÎìú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
            }
        }
        
        // ÌïÑÌÑ∞ÎßÅÎêú Ï†ÑÏ≤¥ ÏöîÏ≤≠ Í∞ÄÏ†∏Ïò§Í∏∞
        function getFilteredAllRequests() {
            const statusFilter = document.getElementById('all-status-filter')?.value || '';
            let filteredRequests = [...requests];
            
            if (statusFilter) {
                filteredRequests = filteredRequests.filter(request => request.status === statusFilter);
            }
            
            return filteredRequests.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
        }
        
        // ÌïÑÌÑ∞ÎßÅÎêú Íµ¨Îß§ ÏöîÏ≤≠ Í∞ÄÏ†∏Ïò§Í∏∞
        function getFilteredPurchaseRequests() {
            const statusFilter = document.getElementById('purchase-status-filter')?.value || '';
            let filteredRequests = requests.filter(request => request.type === 'purchase');
            
            if (statusFilter) {
                filteredRequests = filteredRequests.filter(request => request.status === statusFilter);
            }
            
            return filteredRequests.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
        }
        
        // ÌïÑÌÑ∞ÎßÅÎêú ÏãúÏÑ§ Í¥ÄÎ¶¨ ÏöîÏ≤≠ Í∞ÄÏ†∏Ïò§Í∏∞
        function getFilteredFacilityRequests() {
            const statusFilter = document.getElementById('facility-status-filter')?.value || '';
            const priorityFilter = document.getElementById('facility-priority-filter')?.value || '';
            let filteredRequests = requests.filter(request => request.type === 'facility');
            
            if (statusFilter) {
                filteredRequests = filteredRequests.filter(request => request.status === statusFilter);
            }
            
            if (priorityFilter) {
                filteredRequests = filteredRequests.filter(request => request.priority === priorityFilter);
            }
            
            return filteredRequests.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
        }

        // Í∏∞ÏïàÏÑú ÌÖúÌîåÎ¶ø Í¥ÄÎ†® Î≥ÄÏàò
        let learnedTemplates = JSON.parse(localStorage.getItem('learnedTemplates') || '{}');
        
        // ÌîºÎìúÎ∞± Í∑úÏπô Ï†ÄÏû•ÏÜå
        let feedbackRules = JSON.parse(localStorage.getItem('feedbackRules') || '[]');
        
        // ÌÖúÌîåÎ¶ø ÌÉ≠ Î°úÎìú
        function loadTemplateTab() {
            displayLearnedTemplates();
            displayFeedbackRules();
        }
        
        // ÌîºÎìúÎ∞± ÌïôÏäµ Ìï®Ïàò
        function learnFeedback() {
            const feedbackText = document.getElementById('feedback-input').value.trim();
            const target = document.getElementById('feedback-target').value;
            
            if (!feedbackText) {
                alert('ÌîºÎìúÎ∞± ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            try {
                // ÌîºÎìúÎ∞±ÏùÑ Í∑úÏπôÏúºÎ°ú Î≥ÄÌôò
                const rules = parseFeedbackToRules(feedbackText, target);
                
                // Í∏∞Ï°¥ Í∑úÏπôÏóê Ï∂îÍ∞Ä
                feedbackRules.push(...rules);
                
                // localStorageÏóê Ï†ÄÏû•
                localStorage.setItem('feedbackRules', JSON.stringify(feedbackRules));
                
                // UI ÏóÖÎç∞Ïù¥Ìä∏
                document.getElementById('feedback-input').value = '';
                displayFeedbackRules();
                
                showAlert(`${rules.length}Í∞úÏùò ÏÉàÎ°úÏö¥ Í∑úÏπôÏù¥ ÌïôÏäµÎêòÏóàÏäµÎãàÎã§!`, 'success');
                
            } catch (error) {
                console.error('ÌîºÎìúÎ∞± ÌïôÏäµ Ïã§Ìå®:', error);
                alert('ÌîºÎìúÎ∞± ÌïôÏäµ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
            }
        }
        
        // ÌîºÎìúÎ∞±ÏùÑ Í∑úÏπôÏúºÎ°ú Î≥ÄÌôò (Í∞úÏÑ†Îêú Î≤ÑÏ†Ñ)
        function parseFeedbackToRules(feedbackText, target) {
            const rules = [];
            const lines = feedbackText.split('\n').filter(line => line.trim());
            
            lines.forEach((line, index) => {
                const rule = {
                    id: Date.now() + Math.random() + index,
                    target: target,
                    original: line.trim(),
                    type: '',
                    action: '',
                    content: '',
                    keywords: [],
                    priority: 1,
                    createdAt: new Date().toISOString()
                };
                
                const lowerLine = line.toLowerCase().trim();
                console.log('üîç ÌîºÎìúÎ∞± Î∂ÑÏÑù Ï§ë:', lowerLine);
                
                // 1. Ï†úÏô∏/ÏÇ≠Ï†ú Í∑úÏπô
                if (lowerLine.includes('ÏïàÎì§Ïñ¥Í∞ÄÍ≤å') || lowerLine.includes('Ï†úÏô∏') || lowerLine.includes('ÎπºÏ§ò') || 
                    lowerLine.includes('ÏÇ≠Ï†ú') || lowerLine.includes('ÏïàÎÇòÏò§Í≤å') || lowerLine.includes('ÏóÜÏï†')) {
                    
                    rule.type = 'exclude';
                    rule.action = 'remove';
                    
                    // Íµ¨Ï°∞Ï†Å ÏÇ≠Ï†ú Ìå®ÌÑ¥ Î∂ÑÏÑù
                    const structuralPatterns = [
                        /(\d+)Î≤à?\s*(ÌïÑÏöîÏÑ±|Î™©Ï†Å|ÎÇ¥Ïö©|Í∏∞ÌÉÄÏÇ¨Ìï≠)\s*(Î∂ÄÌÑ∞|Ïù¥ÌõÑ)\s*(ÏïÑÎûò|Î™®Îì†?\s*ÎÇ¥Ïö©)?/i,
                        /(ÌïÑÏöîÏÑ±|Î™©Ï†Å|ÎÇ¥Ïö©|Í∏∞ÌÉÄÏÇ¨Ìï≠)\s*(Î∂ÄÌÑ∞|Ïù¥ÌõÑ)\s*(ÏïÑÎûò|Î™®Îì†?\s*ÎÇ¥Ïö©)?/i,
                        /(\d+)\.\s*(ÌïÑÏöîÏÑ±|Î™©Ï†Å|Íµ¨Îß§\s*ÎÇ¥Ïö©|ÏàòÎ¶¨\s*ÎÇ¥Ïö©|Í∏∞ÌÉÄÏÇ¨Ìï≠)\s*(Î∂ÄÌÑ∞|Ïù¥ÌõÑ)/i,
                        /(ÌïÑÏöîÏÑ±|Î™©Ï†Å|Í∏∞ÌÉÄÏÇ¨Ìï≠)\s*(Ïù¥Ìïò|Ïù¥ÌõÑ|Î∂ÄÌÑ∞)\s*(Î™®Îì†?\s*ÎÇ¥Ïö©|Îã§|Ï†ÑÎ∂Ä)?/i
                    ];
                    
                    let isStructural = false;
                    for (let pattern of structuralPatterns) {
                        const match = line.match(pattern);
                        if (match) {
                            rule.structuralDelete = {
                                sectionNumber: match[1] || null,
                                sectionName: match[2] || match[1],
                                deleteType: 'fromSection',
                                scope: match[3] || match[4] ? 'below' : 'section'
                            };
                            rule.content = `Íµ¨Ï°∞Ï†Å ÏÇ≠Ï†ú: ${match[0]}`;
                            isStructural = true;
                            console.log('üèóÔ∏è Íµ¨Ï°∞Ï†Å ÏÇ≠Ï†ú Ìå®ÌÑ¥ Í∞êÏßÄ:', rule.structuralDelete);
                            break;
                        }
                    }
                    
                    if (!isStructural) {
                        // Îî∞Ïò¥ÌëúÎ°ú Í∞êÏã∏ÏßÑ ÌÇ§ÏõåÎìú Ï∂îÏ∂ú
                        const quotedMatches = line.match(/['"`]([^'"`]+)['"`]/g);
                        if (quotedMatches) {
                            rule.keywords = quotedMatches.map(match => match.replace(/['"`]/g, ''));
                        } else {
                            // ÏùºÎ∞òÏ†ÅÏù∏ ÌÇ§ÏõåÎìú Ï∂îÏ∂ú
                            const keywords = [];
                            if (lowerLine.includes('Í≤¨Ï†ÅÏÑú')) keywords.push('Í≤¨Ï†ÅÏÑú');
                            if (lowerLine.includes('Ï≤®Î∂Ä')) keywords.push('Ï≤®Î∂Ä');
                            if (lowerLine.includes('ÌïÑÏöîÏÑ±')) keywords.push('ÌïÑÏöîÏÑ±');
                            if (lowerLine.includes('Í∏∞ÌÉÄÏÇ¨Ìï≠')) keywords.push('Í∏∞ÌÉÄÏÇ¨Ìï≠');
                            if (lowerLine.includes('Ïù¥ÏÉÅÍ≥º Í∞ôÏù¥')) keywords.push('Ïù¥ÏÉÅÍ≥º Í∞ôÏù¥');
                            rule.keywords = keywords;
                        }
                        rule.content = rule.keywords.join(' ');
                    }
                    
                } 
                // 2. Ï∂îÍ∞Ä Í∑úÏπô
                else if (lowerLine.includes('Ï∂îÍ∞Ä') || lowerLine.includes('ÎÑ£Ïñ¥Ï§ò') || lowerLine.includes('Ìè¨Ìï®') ||
                         lowerLine.includes('Ïç®Ï§ò') || lowerLine.includes('Îì§Ïñ¥Í∞ÄÍ≤å')) {
                    
                    rule.type = 'include';
                    rule.action = 'add';
                    
                    const quotedMatches = line.match(/['"`]([^'"`]+)['"`]/g);
                    if (quotedMatches) {
                        rule.content = quotedMatches[0].replace(/['"`]/g, '');
                    } else {
                        // ÌÇ§ÏõåÎìú Ï∂îÏ∂ú ÏãúÎèÑ
                        const addMatch = lowerLine.match(/(.*?)(Ï∂îÍ∞Ä|ÎÑ£Ïñ¥Ï§ò|Ìè¨Ìï®|Ïç®Ï§ò|Îì§Ïñ¥Í∞ÄÍ≤å)/);
                        if (addMatch) {
                            rule.content = addMatch[1].trim();
                        }
                    }
                    
                } 
                // 3. Í∞ÑÏÜåÌôî Í∑úÏπô
                else if (lowerLine.includes('Í∞ÑÎã®') || lowerLine.includes('ÏßßÍ≤å') || lowerLine.includes('Í∞ÑÏÜå') ||
                         lowerLine.includes('Ï∂ïÏïΩ') || lowerLine.includes('Ï§ÑÏó¨')) {
                    
                    rule.type = 'simplify';
                    rule.action = 'modify';
                    rule.content = 'simple';
                    
                }
                // 4. ÍµêÏ≤¥ Í∑úÏπô
                else if (lowerLine.includes('Î∞îÍøî') || lowerLine.includes('Î≥ÄÍ≤Ω') || lowerLine.includes('ÍµêÏ≤¥') ||
                         lowerLine.includes('ÎåÄÏã†')) {
                    
                    rule.type = 'replace';
                    rule.action = 'replace';
                    
                    // "AÎ•º BÎ°ú", "A ‚Üí B", "AÏóêÏÑú BÎ°ú" Ìå®ÌÑ¥ Ï∞æÍ∏∞
                    const replacePatterns = [
                        /['"`]([^'"`]+)['"`].*?['"`]([^'"`]+)['"`]/,
                        /(\w+)Î•º\s*(\w+)Î°ú/,
                        /(\w+)\s*‚Üí\s*(\w+)/,
                        /(\w+)ÏóêÏÑú\s*(\w+)Î°ú/
                    ];
                    
                    for (let pattern of replacePatterns) {
                        const match = line.match(pattern);
                        if (match) {
                            rule.content = `${match[1]}‚Üí${match[2]}`;
                            break;
                        }
                    }
                }
                // 5. Í≥µÏãùÌôî Í∑úÏπô
                else if (lowerLine.includes('Í≥µÏãùÏ†Å') || lowerLine.includes('Í≤©Ïãù') || lowerLine.includes('Ï†ïÏ§ë') ||
                         lowerLine.includes('formal')) {
                    
                    rule.type = 'formal';
                    rule.action = 'modify';
                    rule.content = 'formal';
                }
                // 6. ÏùºÎ∞ò ÏöîÏ≤≠
                else {
                    rule.type = 'general';
                    rule.action = 'note';
                    rule.content = line.trim();
                }
                
                // Ïú†Ìö®Ìïú Í∑úÏπôÎßå Ï∂îÍ∞Ä
                if (rule.content || rule.keywords.length > 0) {
                    console.log('‚úÖ Í∑úÏπô ÏÉùÏÑ±Îê®:', rule);
                    rules.push(rule);
                } else {
                    console.log('‚ùå Í∑úÏπô ÏÉùÏÑ± Ïã§Ìå®:', line);
                }
            });
            
            return rules;
        }
        
        // ÌïôÏäµÎêú ÌîºÎìúÎ∞± Í∑úÏπô ÌëúÏãú
        function displayFeedbackRules() {
            const container = document.getElementById('feedback-rules-list');
            if (!container) return;
            
            if (feedbackRules.length === 0) {
                container.innerHTML = `
                    <div style="color: #6b7280; text-align: center; padding: 2rem;">
                        ÏïÑÏßÅ ÌïôÏäµÎêú ÌîºÎìúÎ∞± Í∑úÏπôÏù¥ ÏóÜÏäµÎãàÎã§.
                    </div>
                `;
                return;
            }
            
            const rulesByTarget = {
                both: feedbackRules.filter(r => r.target === 'both'),
                purchase: feedbackRules.filter(r => r.target === 'purchase'),
                facility: feedbackRules.filter(r => r.target === 'facility')
            };
            
            let html = '';
            
            Object.entries(rulesByTarget).forEach(([target, rules]) => {
                if (rules.length === 0) return;
                
                const targetName = target === 'both' ? 'Ï†ÑÏ≤¥' : target === 'purchase' ? 'Íµ¨Îß§ ÏöîÏ≤≠' : 'ÏãúÏÑ§ Í¥ÄÎ¶¨';
                const targetColor = target === 'both' ? '#64748b' : target === 'purchase' ? '#2563eb' : '#22c55e';
                
                html += `
                    <div style="margin-bottom: 2rem;">
                        <h4 style="color: ${targetColor}; margin-bottom: 1rem;">${getTargetIcon(target)} ${targetName} (${rules.length}Í∞ú)</h4>
                        ${rules.map(rule => `
                            <div style="background: white; padding: 1rem; border-radius: 8px; margin-bottom: 0.5rem; border-left: 4px solid ${targetColor};">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <div style="font-weight: 600; color: #374151; margin-bottom: 0.5rem;">
                                            ${rule.structuralDelete ? 'üèóÔ∏è Íµ¨Ï°∞Ï†Å ÏÇ≠Ï†ú' : `${getRuleTypeIcon(rule.type)} ${getRuleTypeName(rule.type)}`}:</strong> ${rule.original}
                                        </div>
                                        <div style="color: #6b7280; font-size: 0.9rem;">
                                            ${rule.original}
                                        </div>
                                        <div style="color: #9ca3af; font-size: 0.8rem; margin-top: 0.5rem;">
                                            ÌïôÏäµÏùº: ${new Date(rule.createdAt).toLocaleDateString('ko-KR')}
                                        </div>
                                    </div>
                                    <button onclick="deleteFeedbackRule('${rule.id}')" style="background: #ef4444; color: white; border: none; padding: 0.5rem; border-radius: 4px; font-size: 0.8rem;">
                                        ÏÇ≠Ï†ú
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // Í∑úÏπô ÌÉÄÏûÖÎ≥Ñ ÏïÑÏù¥ÏΩò
        function getRuleTypeIcon(type) {
            const icons = {
                exclude: 'üö´',
                include: '‚ûï',
                simplify: '‚úÇÔ∏è',
                detail: 'üìù',
                formal: 'üé©',
                replace: 'üîÑ',
                general: 'üí≠'
            };
            return icons[type] || 'üìã';
        }
        
        // Í∑úÏπô ÌÉÄÏûÖÎ≥Ñ Ïù¥Î¶Ñ
        function getRuleTypeName(type) {
            const names = {
                exclude: 'ÎÇ¥Ïö© Ï†úÏô∏',
                include: 'ÎÇ¥Ïö© Ï∂îÍ∞Ä',
                simplify: 'Í∞ÑÏÜåÌôî',
                detail: 'ÏÉÅÏÑ∏Ìôî',
                formal: 'Í≥µÏãùÌôî',
                replace: 'ÎÇ¥Ïö© ÍµêÏ≤¥',
                general: 'ÏùºÎ∞ò ÏöîÏ≤≠'
            };
            return names[type] || 'Í∏∞ÌÉÄ';
        }
        
        // ÎåÄÏÉÅÎ≥Ñ ÏïÑÏù¥ÏΩò
        function getTargetIcon(target) {
            const icons = {
                both: 'üéØ',
                purchase: 'üõí',
                facility: 'üîß'
            };
            return icons[target] || 'üìã';
        }
        
        // ÌîºÎìúÎ∞± Í∑úÏπô ÏÇ≠Ï†ú
        function deleteFeedbackRule(ruleId) {
            if (!confirm('Ïù¥ Í∑úÏπôÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;
            
            feedbackRules = feedbackRules.filter(rule => rule.id !== ruleId);
            localStorage.setItem('feedbackRules', JSON.stringify(feedbackRules));
            displayFeedbackRules();
            showAlert('Í∑úÏπôÏù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.', 'success');
        }
        
        // Î™®Îì† ÌîºÎìúÎ∞± Í∑úÏπô Ï¥àÍ∏∞Ìôî
        function clearAllFeedbackRules() {
            if (!confirm('Î™®Îì† ÌîºÎìúÎ∞± Í∑úÏπôÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;
            
            feedbackRules = [];
            localStorage.setItem('feedbackRules', JSON.stringify(feedbackRules));
            displayFeedbackRules();
            showAlert('Î™®Îì† ÌîºÎìúÎ∞± Í∑úÏπôÏù¥ Ï¥àÍ∏∞ÌôîÎêòÏóàÏäµÎãàÎã§.', 'success');
        }
        
        // ÌîºÎìúÎ∞± Í∑úÏπô ÌÖåÏä§Ìä∏ (Í∞úÏÑ†Îêú Î≤ÑÏ†Ñ)
        function testFeedbackRules() {
            if (feedbackRules.length === 0) {
                alert('ÌÖåÏä§Ìä∏Ìï† ÌîºÎìúÎ∞± Í∑úÏπôÏù¥ ÏóÜÏäµÎãàÎã§.');
                return;
            }
            
            console.log('üß™ ÌîºÎìúÎ∞± Í∑úÏπô ÌÖåÏä§Ìä∏ ÏãúÏûë');
            
            // Íµ¨Îß§ ÏöîÏ≤≠Í≥º ÏãúÏÑ§ Í¥ÄÎ¶¨ Îëò Îã§ ÌÖåÏä§Ìä∏
            const sampleRequests = [
                {
                    type: 'purchase',
                    title: 'ÌÖåÏä§Ìä∏ ÎÖ∏Ìä∏Î∂Å Íµ¨Îß§',
                    item: 'ÏóÖÎ¨¥Ïö© ÎÖ∏Ìä∏Î∂Å',
                    quantity: 2,
                    reason: 'Í∏∞Ï°¥ ÎÖ∏Ìä∏Î∂Å ÎÖ∏ÌõÑÌôîÎ°ú Ïù∏Ìïú ÍµêÏ≤¥ ÌïÑÏöî',
                    requestedBy: 'ÌôçÍ∏∏Îèô',
                    department: 'Ï†ÑÏÇ∞ÌåÄ',
                    priority: 'ÎÜíÏùå',
                    quoteFile: true
                },
                {
                    type: 'facility',
                    facility: 'Í∞ïÏùòÏã§ ÏóêÏñ¥Ïª®',
                    facilityType: 'ÎÉâÎÇúÎ∞©',
                    location: 'Î≥∏Í¥Ä 201Ìò∏',
                    description: 'ÏóêÏñ¥Ïª® ÎÉâÍ∞Å Í∏∞Îä• Î∂àÎüâÏúºÎ°ú ÏàòÎ¶¨ ÌïÑÏöî',
                    requestedBy: 'ÍπÄÏòÅÌù¨',
                    department: 'ÏãúÏÑ§Í¥ÄÎ¶¨ÌåÄ',
                    priority: 'Í∏¥Í∏â',
                    facilityPhotos: [{name: 'test.jpg'}]
                }
            ];
            
            let testResults = [];
            
            sampleRequests.forEach(sampleRequest => {
                console.log(`üîç ${sampleRequest.type} ÌÉÄÏûÖ ÌÖåÏä§Ìä∏ Ï§ë...`);
                
                // ÏõêÎ≥∏ Í∏∞ÏïàÏÑú ÏÉùÏÑ± (Í∑úÏπô Ï†ÅÏö© Ï†Ñ)
                const originalDraft = generateDraftWithRules(sampleRequest, sampleRequest.type, false);
                
                // Í∑úÏπô Ï†ÅÏö©Îêú Í∏∞ÏïàÏÑú ÏÉùÏÑ±
                const modifiedDraft = generateDraftWithRules(sampleRequest, sampleRequest.type, true);
                
                // Ï†ÅÏö©Îêú Í∑úÏπô Î™©Î°ù
                const applicableRules = feedbackRules.filter(rule => 
                    rule.target === sampleRequest.type || rule.target === 'both'
                );
                
                testResults.push({
                    type: sampleRequest.type,
                    original: originalDraft,
                    modified: modifiedDraft,
                    rules: applicableRules,
                    hasChanges: originalDraft !== modifiedDraft
                });
            });
            
            // ÌÖåÏä§Ìä∏ Í≤∞Í≥ºÎ•º ÏÉÅÏÑ∏ÌïòÍ≤å ÌëúÏãú
            const testWindow = window.open('', '_blank', 'width=1000,height=900,scrollbars=yes');
            testWindow.document.write(`
                <html>
                <head>
                    <title>üß™ ÌîºÎìúÎ∞± Í∑úÏπô ÌÖåÏä§Ìä∏ Í≤∞Í≥º</title>
                    <style>
                        body { 
                            font-family: 'Malgun Gothic', sans-serif; 
                            padding: 2rem; 
                            line-height: 1.6; 
                            background: #f8fafc;
                        }
                        .container { max-width: 1200px; margin: 0 auto; }
                        .test-section { 
                            background: white; 
                            margin-bottom: 2rem; 
                            border-radius: 12px; 
                            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                            overflow: hidden;
                        }
                        .section-header { 
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                            color: white; 
                            padding: 1.5rem; 
                            font-weight: bold; 
                            font-size: 1.2rem;
                        }
                        .section-content { padding: 1.5rem; }
                        .rules-list { 
                            background: #f0f9ff; 
                            padding: 1rem; 
                            border-radius: 8px; 
                            border-left: 4px solid #0ea5e9;
                            margin-bottom: 1rem;
                        }
                        .comparison { 
                            display: grid; 
                            grid-template-columns: 1fr 1fr; 
                            gap: 1rem; 
                            margin-top: 1rem;
                        }
                        .draft-box { 
                            background: #f8fafc; 
                            padding: 1.5rem; 
                            border-radius: 8px; 
                            white-space: pre-wrap; 
                            font-family: 'Courier New', monospace;
                            font-size: 0.9rem;
                            border: 2px solid #e2e8f0;
                            max-height: 500px;
                            overflow-y: auto;
                        }
                        .original { border-left: 4px solid #ef4444; }
                        .modified { border-left: 4px solid #22c55e; }
                        .no-changes { color: #6b7280; font-style: italic; }
                        .changes-detected { color: #059669; font-weight: bold; }
                        .rule-item { 
                            padding: 0.5rem; 
                            margin: 0.25rem 0; 
                            background: rgba(14, 165, 233, 0.1); 
                            border-radius: 4px;
                            font-size: 0.9rem;
                        }
                    </style>
                </head>
                <body>
                    <div class="container">
                        <h1 style="text-align: center; color: #1e293b; margin-bottom: 2rem;">
                            üß™ ÌîºÎìúÎ∞± Í∑úÏπô ÌÖåÏä§Ìä∏ Í≤∞Í≥º
                        </h1>
                        
                        ${testResults.map(result => `
                            <div class="test-section">
                                <div class="section-header">
                                    ${result.type === 'purchase' ? 'üõí Íµ¨Îß§ ÏöîÏ≤≠' : 'üîß ÏãúÏÑ§ Í¥ÄÎ¶¨'} ÌÖåÏä§Ìä∏
                                    ${result.hasChanges ? '<span class="changes-detected"> ‚úÖ Î≥ÄÍ≤ΩÏÇ¨Ìï≠ Í∞êÏßÄÎê®</span>' : '<span class="no-changes"> ‚ö†Ô∏è Î≥ÄÍ≤ΩÏÇ¨Ìï≠ ÏóÜÏùå</span>'}
                                </div>
                                <div class="section-content">
                                    <div class="rules-list">
                                        <h4 style="margin-top: 0;">üìã Ï†ÅÏö©Îêú Í∑úÏπô (${result.rules.length}Í∞ú):</h4>
                                        ${result.rules.length > 0 ? 
                                            result.rules.map(rule => `
                                                <div class="rule-item">
                                                    <strong>${getRuleTypeIcon(rule.type)} ${getRuleTypeName(rule.type)}:</strong> ${rule.original}
                                                </div>
                                            `).join('') 
                                            : '<div class="no-changes">Ï†ÅÏö©Îêú Í∑úÏπôÏù¥ ÏóÜÏäµÎãàÎã§.</div>'
                                        }
                                    </div>
                                    
                                    <div class="comparison">
                                        <div>
                                            <h4 style="color: #ef4444;">üìÑ ÏõêÎ≥∏ Í∏∞ÏïàÏÑú</h4>
                                            <div class="draft-box original">${result.original}</div>
                                        </div>
                                        <div>
                                            <h4 style="color: #22c55e;">üìù Í∑úÏπô Ï†ÅÏö© ÌõÑ</h4>
                                            <div class="draft-box modified">${result.modified}</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                        
                        <div style="text-align: center; margin-top: 2rem; padding: 1rem; background: #fef7ed; border-radius: 8px; border: 2px solid #f97316;">
                            <p><strong>üí° Tip:</strong> Í∑úÏπôÏù¥ Ï†úÎåÄÎ°ú Ï†ÅÏö©ÎêòÏßÄ ÏïäÏúºÎ©¥ ÌîºÎìúÎ∞± Î¨∏Íµ¨Î•º Îçî Íµ¨Ï≤¥Ï†ÅÏúºÎ°ú ÏûëÏÑ±Ìï¥Î≥¥ÏÑ∏Ïöî!</p>
                            <p>Ïòà: "Í≤¨Ï†ÅÏÑú Ï≤®Î∂Ä Í¥ÄÎ†® ÎÇ¥Ïö©Ïù¥ ÏïàÎì§Ïñ¥Í∞ÄÍ≤å Ìï¥Ï§ò" ‚Üí Íµ¨Ï≤¥Ï†ÅÏù¥Í≥† Î™ÖÌôïÌï®</p>
                        </div>
                    </div>
                </body>
                </html>
            `);
            
                         showAlert('ÌîºÎìúÎ∞± Í∑úÏπô ÌÖåÏä§Ìä∏ ÏôÑÎ£å! ÏÉà Ï∞ΩÏóêÏÑú ÏÉÅÏÑ∏ Í≤∞Í≥ºÎ•º ÌôïÏù∏ÌïòÏÑ∏Ïöî.', 'success');
         }
         
         // ÌîºÎìúÎ∞± ÏãúÏä§ÌÖú ÎîîÎ≤ÑÍπÖ
         function debugFeedbackSystem() {
             console.clear();
             console.log('üîç ÌîºÎìúÎ∞± ÏãúÏä§ÌÖú ÎîîÎ≤ÑÍπÖ ÏãúÏûë...');
             
             const debug = {
                 Ï¥ùÍ∑úÏπôÏàò: feedbackRules.length,
                 Íµ¨Îß§Í∑úÏπôÏàò: feedbackRules.filter(r => r.target === 'purchase' || r.target === 'both').length,
                 ÏãúÏÑ§Í∑úÏπôÏàò: feedbackRules.filter(r => r.target === 'facility' || r.target === 'both').length,
                 Í∑úÏπôÏú†ÌòïÎ≥Ñ: {},
                 Ïû†Ïû¨Ï†ÅÎ¨∏Ï†ú: [],
                 ÏãúÏä§ÌÖúÏÉÅÌÉú: 'Ï†ïÏÉÅ'
             };
             
             // Í∑úÏπô Ïú†ÌòïÎ≥Ñ ÌÜµÍ≥Ñ
             const ruleTypes = ['exclude', 'include', 'simplify', 'replace', 'formal', 'general'];
             ruleTypes.forEach(type => {
                 debug.Í∑úÏπôÏú†ÌòïÎ≥Ñ[type] = feedbackRules.filter(r => r.type === type).length;
             });
             
             // Ïû†Ïû¨Ï†Å Î¨∏Ï†ú Í≤ÄÏÇ¨
             feedbackRules.forEach((rule, index) => {
                 // Îπà content Í≤ÄÏÇ¨
                 if (!rule.content && (!rule.keywords || rule.keywords.length === 0)) {
                     debug.Ïû†Ïû¨Ï†ÅÎ¨∏Ï†ú.push(`Í∑úÏπô ${index + 1}: Îπà ÎÇ¥Ïö© - "${rule.original}"`);
                 }
                 
                 // exclude Í∑úÏπôÏóêÏÑú ÌÇ§ÏõåÎìú ÎàÑÎùΩ Í≤ÄÏÇ¨
                 if (rule.type === 'exclude' && (!rule.keywords || rule.keywords.length === 0) && !rule.content) {
                     debug.Ïû†Ïû¨Ï†ÅÎ¨∏Ï†ú.push(`Í∑úÏπô ${index + 1}: Ï†úÏô∏ ÌÇ§ÏõåÎìú ÎàÑÎùΩ - "${rule.original}"`);
                 }
                 
                 // replace Í∑úÏπôÏóêÏÑú ‚Üí ÎàÑÎùΩ Í≤ÄÏÇ¨
                 if (rule.type === 'replace' && (!rule.content || !rule.content.includes('‚Üí'))) {
                     debug.Ïû†Ïû¨Ï†ÅÎ¨∏Ï†ú.push(`Í∑úÏπô ${index + 1}: ÍµêÏ≤¥ Ìå®ÌÑ¥ Ïò§Î•ò - "${rule.original}"`);
                 }
             });
             
             // ÏãúÏä§ÌÖú ÏÉÅÌÉú ÌèâÍ∞Ä
             if (debug.Ïû†Ïû¨Ï†ÅÎ¨∏Ï†ú.length > 0) {
                 debug.ÏãúÏä§ÌÖúÏÉÅÌÉú = 'Ï£ºÏùò ÌïÑÏöî';
             }
             
             console.table(debug);
             
             if (debug.Ïû†Ïû¨Ï†ÅÎ¨∏Ï†ú.length > 0) {
                 console.warn('‚ö†Ô∏è Î∞úÍ≤¨Îêú Î¨∏Ï†úÎì§:');
                 debug.Ïû†Ïû¨Ï†ÅÎ¨∏Ï†ú.forEach(problem => console.warn(`- ${problem}`));
             }
             
             // ÏÉòÌîå Í∑úÏπô Ï†ÅÏö© ÌÖåÏä§Ìä∏
             console.log('\nüß™ ÏÉòÌîå ÌÖçÏä§Ìä∏Î°ú Í∑úÏπô Ï†ÅÏö© ÌÖåÏä§Ìä∏:');
             const sampleText = 'Í≤¨Ï†ÅÏÑú Ï≤®Î∂ÄÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§. Ïù¥ÏÉÅÍ≥º Í∞ôÏù¥ Í∏∞ÏïàÌïòÏò§Îãà Í≤ÄÌÜ† ÌõÑ ÏäπÏù∏ÌïòÏó¨ Ï£ºÏãúÍ∏∞ Î∞îÎûçÎãàÎã§.';
             console.log('ÏõêÎ≥∏:', sampleText);
             
             let testText = sampleText;
             feedbackRules.forEach((rule, index) => {
                 const beforeText = testText;
                 testText = applyFeedbackRule(testText, rule);
                 if (beforeText !== testText) {
                     console.log(`Í∑úÏπô ${index + 1} Ï†ÅÏö©Îê®:`, testText);
                 }
             });
             
             // ÏÇ¨Ïö©ÏûêÏóêÍ≤å Í≤∞Í≥º ÌëúÏãú
             let message = `üîç ÎîîÎ≤ÑÍπÖ ÏôÑÎ£å!\n\n`;
             message += `üìä ÌòÑÏû¨ ÏÉÅÌÉú:\n`;
             message += `- Ï¥ù Í∑úÏπô Ïàò: ${debug.Ï¥ùÍ∑úÏπôÏàò}Í∞ú\n`;
             message += `- Íµ¨Îß§ Í¥ÄÎ†® Í∑úÏπô: ${debug.Íµ¨Îß§Í∑úÏπôÏàò}Í∞ú\n`;
             message += `- ÏãúÏÑ§ Í¥ÄÎ†® Í∑úÏπô: ${debug.ÏãúÏÑ§Í∑úÏπôÏàò}Í∞ú\n`;
             message += `- ÏãúÏä§ÌÖú ÏÉÅÌÉú: ${debug.ÏãúÏä§ÌÖúÏÉÅÌÉú}\n\n`;
             
             if (debug.Ïû†Ïû¨Ï†ÅÎ¨∏Ï†ú.length > 0) {
                 message += `‚ö†Ô∏è Î∞úÍ≤¨Îêú Î¨∏Ï†ú (${debug.Ïû†Ïû¨Ï†ÅÎ¨∏Ï†ú.length}Í∞ú):\n`;
                 debug.Ïû†Ïû¨Ï†ÅÎ¨∏Ï†ú.forEach(problem => {
                     message += `‚Ä¢ ${problem}\n`;
                 });
                 message += `\nÌï¥Í≤∞ Î∞©Î≤ï: Î¨∏Ï†úÍ∞Ä ÏûàÎäî Í∑úÏπôÏùÑ ÏÇ≠Ï†úÌïòÍ≥† Îã§Ïãú ÌïôÏäµÌï¥Ï£ºÏÑ∏Ïöî.`;
             } else {
                 message += `‚úÖ Î¨∏Ï†úÍ∞Ä Î∞úÍ≤¨ÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§!`;
             }
             
             message += `\n\nüí° ÏûêÏÑ∏Ìïú Ï†ïÎ≥¥Îäî Î∏åÎùºÏö∞Ï†Ä ÏΩòÏÜî(F12)ÏùÑ ÌôïÏù∏ÌïòÏÑ∏Ïöî.`;
             
             alert(message);
             
             console.log('‚úÖ ÎîîÎ≤ÑÍπÖ ÏôÑÎ£å. ÏúÑ Ï†ïÎ≥¥Î•º Ï∞∏Í≥†ÌïòÏó¨ ÌîºÎìúÎ∞± ÏãúÏä§ÌÖúÏùÑ Í∞úÏÑ†ÌïòÏÑ∏Ïöî.');
         }
        
        // ÌîºÎìúÎ∞± Í∑úÏπôÏù¥ Ï†ÅÏö©Îêú Í∏∞ÏïàÏÑú ÏÉùÏÑ± (Í∞úÏÑ†Îêú Î≤ÑÏ†Ñ)
        function generateDraftWithRules(requestData, type, applyRules = true) {
            const today = new Date().toLocaleDateString('ko-KR');
            let draftText = '';
            
            console.log(`üìù Í∏∞ÏïàÏÑú ÏÉùÏÑ± Ï§ë: ${type}, Í∑úÏπô Ï†ÅÏö©: ${applyRules}`);
            
            // Í∏∞Î≥∏ Í∏∞ÏïàÏÑú ÏÉùÏÑ±
            if (type === 'purchase') {
                draftText = `Í∏∞ Ïïà

Ï†úÎ™©: ${requestData.title} Íµ¨Îß§ ÏöîÏ≤≠

1. Î™©Ï†Å
   ${requestData.reason}

2. Íµ¨Îß§ ÎÇ¥Ïö©
   - Î¨ºÌíàÎ™Ö: ${requestData.item}
   - ÏàòÎüâ: ${formatQuantity(requestData.quantity)}
   - Ïö∞ÏÑ†ÏàúÏúÑ: ${requestData.priority}
   - ÏöîÏ≤≠Ïûê: ${requestData.requestedBy} (${requestData.department})

3. ÌïÑÏöîÏÑ±
   ÏóÖÎ¨¥ Ìö®Ïú®ÏÑ± Ìñ•ÏÉÅ Î∞è ÏõêÌôúÌïú ÏóÖÎ¨¥ ÏàòÌñâÏùÑ ÏúÑÌï¥ ÏÉÅÍ∏∞ Î¨ºÌíàÏùò Íµ¨Îß§Í∞Ä ÌïÑÏöîÌï©ÎãàÎã§.

4. Í∏∞ÌÉÄÏÇ¨Ìï≠
   ${requestData.quoteFile ? 'Í≤¨Ï†ÅÏÑú Ï≤®Î∂Ä' : 'Í≤¨Ï†ÅÏÑú Î≥ÑÎèÑ Ï†úÏ∂ú ÏòàÏ†ï'}

Ïù¥ÏÉÅÍ≥º Í∞ôÏù¥ Í∏∞ÏïàÌïòÏò§Îãà Í≤ÄÌÜ† ÌõÑ ÏäπÏù∏ÌïòÏó¨ Ï£ºÏãúÍ∏∞ Î∞îÎûçÎãàÎã§.

${today}

${requestData.department} ${requestData.requestedBy}`;
            } else {
                draftText = `Í∏∞ Ïïà

Ï†úÎ™©: ${requestData.facility} ÏãúÏÑ§ ÏàòÎ¶¨ ÏöîÏ≤≠

1. Î™©Ï†Å
   ÏãúÏÑ§ Ïú†ÏßÄÎ≥¥ÏàòÎ•º ÌÜµÌïú ÏïàÏ†ÑÌïòÍ≥† ÏæåÏ†ÅÌïú ÍµêÏú°ÌôòÍ≤Ω Ï°∞ÏÑ±

2. ÏàòÎ¶¨ ÎÇ¥Ïö©
   - ÏãúÏÑ§Î™Ö: ${requestData.facility}
   - ÏãúÏÑ§ Ïú†Ìòï: ${requestData.facilityType || 'ÏùºÎ∞òÏãúÏÑ§'}
   - ÏúÑÏπò: ${requestData.location}
   - Î¨∏Ï†úÏÉÅÌô©: ${requestData.description}
   - Ïö∞ÏÑ†ÏàúÏúÑ: ${requestData.priority}
   - ÏöîÏ≤≠Ïûê: ${requestData.requestedBy} (${requestData.department})

3. ÌïÑÏöîÏÑ±
   ${requestData.description}
   
   ÏÉÅÍ∏∞ ÏãúÏÑ§Ïùò Ïã†ÏÜçÌïú ÏàòÎ¶¨Î•º ÌÜµÌï¥ ÏïàÏ†ÑÏÇ¨Í≥†Î•º ÏòàÎ∞©ÌïòÍ≥† ÏõêÌôúÌïú ÏãúÏÑ§ Ïù¥Ïö©Ïù¥ Í∞ÄÎä•ÌïòÎèÑÎ°ù Ï°∞ÏπòÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§.

4. Í∏∞ÌÉÄÏÇ¨Ìï≠
   ${requestData.facilityPhotos && requestData.facilityPhotos.length > 0 ? `ÌòÑÏû• ÏÇ¨ÏßÑ ${requestData.facilityPhotos.length}Ïû• Ï≤®Î∂Ä` : 'ÌòÑÏû• ÏÇ¨ÏßÑ Î≥ÑÎèÑ Ï≤®Î∂Ä ÏòàÏ†ï'}

Ïù¥ÏÉÅÍ≥º Í∞ôÏù¥ Í∏∞ÏïàÌïòÏò§Îãà Í≤ÄÌÜ† ÌõÑ ÏäπÏù∏ÌïòÏó¨ Ï£ºÏãúÍ∏∞ Î∞îÎûçÎãàÎã§.

${today}

${requestData.department} ${requestData.requestedBy}`;
            }
            
            // Í∑úÏπô Ï†ÅÏö© Ïó¨Î∂Ä ÌôïÏù∏
            if (!applyRules) {
                console.log('üìÑ ÏõêÎ≥∏ Í∏∞ÏïàÏÑú ÏÉùÏÑ± ÏôÑÎ£å (Í∑úÏπô Ï†ÅÏö© ÏïàÌï®)');
                return draftText;
            }
            
            // ÌîºÎìúÎ∞± Í∑úÏπô Ï†ÅÏö©
            const applicableRules = feedbackRules.filter(rule => 
                rule.target === type || rule.target === 'both'
            );
            
            console.log(`üîß Ï†ÅÏö© Í∞ÄÎä•Ìïú Í∑úÏπô: ${applicableRules.length}Í∞ú`);
            
            if (applicableRules.length === 0) {
                console.log('‚ö†Ô∏è Ï†ÅÏö©Ìï† Í∑úÏπôÏù¥ ÏóÜÏäµÎãàÎã§.');
                return draftText;
            }
            
            // Í∑úÏπôÏùÑ Ïö∞ÏÑ†ÏàúÏúÑ ÏàúÏúºÎ°ú Ï†ïÎ†¨ ÌõÑ Ï†ÅÏö©
            const sortedRules = applicableRules.sort((a, b) => {
                // Ï†úÏô∏ Í∑úÏπôÏùÑ Î®ºÏ†Ä Ï†ÅÏö©
                if (a.type === 'exclude' && b.type !== 'exclude') return -1;
                if (b.type === 'exclude' && a.type !== 'exclude') return 1;
                
                // ÍµêÏ≤¥ Í∑úÏπôÏùÑ Îã§ÏùåÏóê Ï†ÅÏö©
                if (a.type === 'replace' && b.type !== 'replace' && b.type !== 'exclude') return -1;
                if (b.type === 'replace' && a.type !== 'replace' && a.type !== 'exclude') return 1;
                
                // Í∞ÑÏÜåÌôî Í∑úÏπô
                if (a.type === 'simplify' && b.type === 'include') return -1;
                if (b.type === 'simplify' && a.type === 'include') return 1;
                
                // Ï∂îÍ∞Ä Í∑úÏπôÏùÑ ÎßàÏßÄÎßâÏóê Ï†ÅÏö©
                if (a.type === 'include' && b.type !== 'include') return 1;
                if (b.type === 'include' && a.type !== 'include') return -1;
                
                return 0;
            });
            
            console.log('üìã Í∑úÏπô Ï†ÅÏö© ÏàúÏÑú:', sortedRules.map(r => `${r.type}: ${r.original}`));
            
            let modifiedText = draftText;
            let appliedCount = 0;
            
            sortedRules.forEach((rule, index) => {
                const beforeText = modifiedText;
                modifiedText = applyFeedbackRule(modifiedText, rule);
                
                if (beforeText !== modifiedText) {
                    appliedCount++;
                    console.log(`‚úÖ Í∑úÏπô ${index + 1} Ï†ÅÏö© ÏôÑÎ£å: ${rule.type}`);
                } else {
                    console.log(`‚ö†Ô∏è Í∑úÏπô ${index + 1} Ï†ÅÏö© Ìö®Í≥º ÏóÜÏùå: ${rule.type}`);
                }
            });
            
            console.log(`üéØ Ï¥ù ${appliedCount}Í∞ú Í∑úÏπôÏù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï†ÅÏö©ÎêòÏóàÏäµÎãàÎã§.`);
            
            return modifiedText;
        }
        
        // Í∞úÎ≥Ñ ÌîºÎìúÎ∞± Í∑úÏπô Ï†ÅÏö© (Í∞úÏÑ†Îêú Î≤ÑÏ†Ñ)
        function applyFeedbackRule(text, rule) {
            console.log(`üîß Í∑úÏπô Ï†ÅÏö© Ï§ë: [${rule.type}] ${rule.original}`);
            let modifiedText = text;
            
            try {
                switch (rule.type) {
                    case 'exclude':
                        // Íµ¨Ï°∞Ï†Å ÏÇ≠Ï†ú Ï≤òÎ¶¨
                        if (rule.structuralDelete) {
                            const { sectionName, deleteType, scope } = rule.structuralDelete;
                            console.log(`üèóÔ∏è Íµ¨Ï°∞Ï†Å ÏÇ≠Ï†ú Ï†ÅÏö©: ${sectionName} ${scope === 'below' ? 'Ïù¥ÌõÑ Î™®Îì† ÎÇ¥Ïö©' : 'ÏÑπÏÖòÎßå'} ÏÇ≠Ï†ú`);
                            
                            if (scope === 'below') {
                                // Ìï¥Îãπ ÏÑπÏÖòÎ∂ÄÌÑ∞ ÏïÑÎûò Î™®Îì† ÎÇ¥Ïö© ÏÇ≠Ï†ú
                                const sectionPatterns = [
                                    new RegExp(`3\\. ÌïÑÏöîÏÑ±[\\s\\S]*?(?=Ïù¥ÏÉÅÍ≥º Í∞ôÏù¥|$)`, 'gi'),
                                    new RegExp(`4\\. Í∏∞ÌÉÄÏÇ¨Ìï≠[\\s\\S]*?(?=Ïù¥ÏÉÅÍ≥º Í∞ôÏù¥|$)`, 'gi'),
                                    new RegExp(`\\d+\\. ${sectionName}[\\s\\S]*?(?=Ïù¥ÏÉÅÍ≥º Í∞ôÏù¥|$)`, 'gi')
                                ];
                                
                                for (let sectionPattern of sectionPatterns) {
                                    if (modifiedText.match(sectionPattern)) {
                                        modifiedText = modifiedText.replace(sectionPattern, '');
                                        console.log(`‚úÖ Íµ¨Ï°∞Ï†Å ÏÇ≠Ï†ú Ï†ÅÏö©Îê®: ${sectionName}Î∂ÄÌÑ∞ ÏïÑÎûò Î™®Îì† ÎÇ¥Ïö© ÏÇ≠Ï†ú`);
                                        break;
                                    }
                                }
                            } else {
                                // ÌäπÏ†ï ÏÑπÏÖòÎßå ÏÇ≠Ï†ú
                                const specificSectionPattern = new RegExp(`\\d+\\. ${sectionName}[\\s\\S]*?(?=\\n\\d+\\.|\\n\\nÏù¥ÏÉÅÍ≥º Í∞ôÏù¥|$)`, 'gi');
                                modifiedText = modifiedText.replace(specificSectionPattern, '');
                                console.log(`‚úÖ Íµ¨Ï°∞Ï†Å ÏÇ≠Ï†ú Ï†ÅÏö©Îê®: ${sectionName} ÏÑπÏÖòÎßå ÏÇ≠Ï†ú`);
                            }
                        } else {
                            // Í∏∞Ï°¥ ÌÇ§ÏõåÎìú Í∏∞Î∞ò ÏÇ≠Ï†ú Î°úÏßÅ
                            if (rule.keywords && rule.keywords.length > 0) {
                                rule.keywords.forEach(keyword => {
                                    // Ìï¥Îãπ ÌÇ§ÏõåÎìúÍ∞Ä Ìè¨Ìï®Îêú Ï§Ñ Ï†ÑÏ≤¥ Ï†úÍ±∞
                                    const lineRegex = new RegExp(`.*${escapeRegex(keyword)}.*\\n?`, 'gi');
                                    modifiedText = modifiedText.replace(lineRegex, '');
                                    
                                    // ÌÇ§ÏõåÎìúÎßå Ï†úÍ±∞ (Ï§ÑÏùÄ Ïú†ÏßÄ)
                                    const wordRegex = new RegExp(escapeRegex(keyword), 'gi');
                                    modifiedText = modifiedText.replace(wordRegex, '');
                                });
                            }
                        }
                        break;
                        
                    case 'include':
                        // ÎÇ¥Ïö© Ï∂îÍ∞Ä - Í∏∞ÌÉÄÏÇ¨Ìï≠ ÏÑπÏÖòÏóê Ï∂îÍ∞Ä
                        if (rule.content) {
                            const sections = [
                                /4\. Í∏∞ÌÉÄÏÇ¨Ìï≠\n   ([^\n]+)/,
                                /4\. Í∏∞ÌÉÄÏÇ¨Ìï≠([^5]*?)(?=\n\n|$)/
                            ];
                            
                            for (let sectionRegex of sections) {
                                if (modifiedText.match(sectionRegex)) {
                                    modifiedText = modifiedText.replace(sectionRegex, (match) => {
                                        return match + `\n   ${rule.content}`;
                                    });
                                    break;
                                }
                            }
                            
                            // Í∏∞ÌÉÄÏÇ¨Ìï≠ ÏÑπÏÖòÏù¥ ÏóÜÏúºÎ©¥ ÏÉàÎ°ú Ï∂îÍ∞Ä
                            if (!modifiedText.includes('4. Í∏∞ÌÉÄÏÇ¨Ìï≠')) {
                                const insertPoint = modifiedText.lastIndexOf('\nÏù¥ÏÉÅÍ≥º Í∞ôÏù¥');
                                if (insertPoint !== -1) {
                                    modifiedText = modifiedText.slice(0, insertPoint) + 
                                                  `\n\n4. Í∏∞ÌÉÄÏÇ¨Ìï≠\n   ${rule.content}` + 
                                                  modifiedText.slice(insertPoint);
                                }
                            }
                        }
                        break;
                        
                    case 'simplify':
                        // Í∞ÑÏÜåÌôî - Ïó¨Îü¨ ÏÑπÏÖò Îã®ÏàúÌôî
                        modifiedText = modifiedText.replace(
                            /3\. ÌïÑÏöîÏÑ±\n   ([^4]+)/,
                            '3. ÌïÑÏöîÏÑ±\n   ÏÉÅÍ∏∞ ÏÇ¨ÏïàÏùò Ï≤òÎ¶¨Í∞Ä ÌïÑÏöîÌï©ÎãàÎã§.\n\n'
                        );
                        
                        // Î∂ÄÍ∞Ä ÏÑ§Î™Ö Ï†úÍ±∞
                        modifiedText = modifiedText.replace(
                            /ÏóÖÎ¨¥ Ìö®Ïú®ÏÑ± Ìñ•ÏÉÅ Î∞è ÏõêÌôúÌïú ÏóÖÎ¨¥ ÏàòÌñâÏùÑ ÏúÑÌï¥ ÏÉÅÍ∏∞ Î¨ºÌíàÏùò Íµ¨Îß§Í∞Ä ÌïÑÏöîÌï©ÎãàÎã§\./g,
                            'ÏÉÅÍ∏∞ Î¨ºÌíàÏùò Íµ¨Îß§Í∞Ä ÌïÑÏöîÌï©ÎãàÎã§.'
                        );
                        
                        modifiedText = modifiedText.replace(
                            /ÏÉÅÍ∏∞ ÏãúÏÑ§Ïùò Ïã†ÏÜçÌïú ÏàòÎ¶¨Î•º ÌÜµÌï¥ ÏïàÏ†ÑÏÇ¨Í≥†Î•º ÏòàÎ∞©ÌïòÍ≥† ÏõêÌôúÌïú ÏãúÏÑ§ Ïù¥Ïö©Ïù¥ Í∞ÄÎä•ÌïòÎèÑÎ°ù Ï°∞ÏπòÍ∞Ä ÌïÑÏöîÌï©ÎãàÎã§\./g,
                            'ÏÉÅÍ∏∞ ÏãúÏÑ§Ïùò ÏàòÎ¶¨Í∞Ä ÌïÑÏöîÌï©ÎãàÎã§.'
                        );
                        break;
                        
                    case 'replace':
                        // ÎÇ¥Ïö© ÍµêÏ≤¥
                        if (rule.content && rule.content.includes('‚Üí')) {
                            const [from, to] = rule.content.split('‚Üí');
                            if (from && to) {
                                const replaceRegex = new RegExp(escapeRegex(from.trim()), 'gi');
                                modifiedText = modifiedText.replace(replaceRegex, to.trim());
                            }
                        }
                        break;
                        
                    case 'formal':
                        // Í≥µÏãùÌôî - Îçî Í≤©ÏãùÏûàÎäî ÌëúÌòÑÏúºÎ°ú Î≥ÄÍ≤Ω
                        modifiedText = modifiedText.replace(/Ìï¥Ï£ºÏÑ∏Ïöî/g, 'ÌïòÏó¨ Ï£ºÏãúÍ∏∞ Î∞îÎûçÎãàÎã§');
                        modifiedText = modifiedText.replace(/ÏöîÏ≤≠Ìï©ÎãàÎã§/g, 'ÏöîÏ≤≠ÎìúÎ¶ΩÎãàÎã§');
                        modifiedText = modifiedText.replace(/ÌïÑÏöîÌï©ÎãàÎã§/g, 'ÌïÑÏöîÌïòÏò§Îãà');
                        break;
                        
                    case 'general':
                        // ÏùºÎ∞ò ÏöîÏ≤≠ - Î°úÍ∑∏Îßå ÎÇ®Í∏∞Í≥† ÌÖçÏä§Ìä∏Îäî Í∑∏ÎåÄÎ°ú
                        console.log('üìù ÏùºÎ∞ò ÏöîÏ≤≠ÏÇ¨Ìï≠:', rule.content);
                        break;
                        
                    default:
                        console.log('‚ùì Ïïå Ïàò ÏóÜÎäî Í∑úÏπô ÌÉÄÏûÖ:', rule.type);
                        break;
                }
                
                if (modifiedText !== text) {
                    console.log('‚úÖ Í∑úÏπô Ï†ÅÏö© ÏôÑÎ£å:', rule.type);
                } else {
                    console.log('‚ö†Ô∏è Í∑úÏπô Ï†ÅÏö© Ìö®Í≥º ÏóÜÏùå:', rule.type);
                }
                
            } catch (error) {
                console.error('‚ùå Í∑úÏπô Ï†ÅÏö© Ï§ë Ïò§Î•ò:', error, rule);
            }
            
            return modifiedText;
        }
        
        // Ï†ïÍ∑úÏãù ÌäπÏàòÎ¨∏Ïûê Ïù¥Ïä§ÏºÄÏù¥ÌîÑ
        function escapeRegex(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }
        
        // ÏàòÎüâ Ïä§ÎßàÌä∏ ÌëúÏãú Ìï®Ïàò
        function formatQuantity(quantity) {
            if (!quantity) return '-';
            
            const quantityStr = String(quantity).trim();
            
            // Ïù¥ÎØ∏ Îã®ÏúÑÍ∞Ä Ìè¨Ìï®ÎêòÏñ¥ ÏûàÎäîÏßÄ ÌôïÏù∏
            const hasUnit = /[Í∞Ä-Ìû£]/.test(quantityStr) || // ÌïúÍ∏Ä Îã®ÏúÑ
                           /(Í∞ú|Î∞ïÏä§|ÏÑ∏Ìä∏|Î≥ë|ÌÜµ|Ïû•|Í∂å|ÎåÄ|Î™Ö|Í±¥|Ìå©|Ìè¨|Ï∫î|Î¥â|ÏÉÅÏûê|Î≤å|Ïº§Î†à|Ïåç|Î¨∂Ïùå|Îã§Î∞ú|Ïãù|Ï∂©Î∂Ñ|ÎßéÏù¥|Ï°∞Í∏à|ÏïΩÍ∞Ñ)/.test(quantityStr);
            
            // Ïà´ÏûêÎßå ÏûàÎäî Í≤ΩÏö∞ÏóêÎßå "Í∞ú" Ï∂îÍ∞Ä
            if (!hasUnit && /^\d+$/.test(quantityStr)) {
                return `${quantityStr}Í∞ú`;
            }
            
            return quantityStr;
        }
        
        // Íµ¨Îß§ ÏöîÏ≤≠ Í∏∞ÏïàÏÑú ÏÉùÏÑ± (Ìèº Îç∞Ïù¥ÌÑ∞ ÏÇ¨Ïö©)
        function generatePurchaseDraft() {
            const form = document.getElementById('purchase-form');
            const formData = new FormData(form);
            
// Ìèº ÌïÑÏàò ÌïÑÎìú ÌôïÏù∏
const title = formData.get('title') || formData.get('item');
const item = formData.get('item');
const quantity = formData.get('quantity');
const budget = formData.get('budget');
const reason = formData.get('reason');
const requestedBy = formData.get('requestedBy');
const department = formData.get('department');
const priority = formData.get('priority') || 'Î≥¥ÌÜµ';

if (!title || !item || !quantity || !budget || !reason || !requestedBy || !department) {
    alert('Î™®Îì† ÌïÑÏàò ÌïÑÎìúÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
    return;
}
            
            const quoteFile = document.getElementById('purchase-quote-file').files[0];
            
            const requestData = {
                title, item, quantity, reason, requestedBy, department, priority,
                quoteFile: !!quoteFile
            };
            
            // ÌîºÎìúÎ∞± Í∑úÏπôÏù¥ Ï†ÅÏö©Îêú Í∏∞ÏïàÏÑú ÏÉùÏÑ±
            const draftText = generateDraftWithRules(requestData, 'purchase');
            
            document.getElementById('purchase-draft-preview').textContent = draftText;
            
            const appliedRulesCount = feedbackRules.filter(r => r.target === 'purchase' || r.target === 'both').length;
            showAlert(`Íµ¨Îß§ ÏöîÏ≤≠ Í∏∞ÏïàÏÑúÍ∞Ä ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§! (${appliedRulesCount}Í∞ú Í∑úÏπô Ï†ÅÏö©Îê®)`, 'success');
        }
        
        // ÏãúÏÑ§ Í¥ÄÎ¶¨ Í∏∞ÏïàÏÑú ÏÉùÏÑ± (Ìèº Îç∞Ïù¥ÌÑ∞ ÏÇ¨Ïö©)
        function generateFacilityDraft() {
            const form = document.getElementById('facility-form');
            const formData = new FormData(form);
            
            // Ìèº ÌïÑÏàò ÌïÑÎìú ÌôïÏù∏
            const facility = formData.get('facility');
            const location = formData.get('location');
            const description = formData.get('description');
            const requestedBy = formData.get('requestedBy');
            const department = formData.get('department');
            const priority = formData.get('priority') || 'Î≥¥ÌÜµ';
            const facilityType = formData.get('facilityType');
            
            if (!facility || !location || !description || !requestedBy || !department || !facilityType) {
                alert('Î™®Îì† ÌïÑÏàò ÌïÑÎìúÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            const photos = document.getElementById('facility-photo').files;
            
            const requestData = {
                facility, location, description, requestedBy, department, priority, facilityType,
                facilityPhotos: Array.from(photos)
            };
            
            // ÌîºÎìúÎ∞± Í∑úÏπôÏù¥ Ï†ÅÏö©Îêú Í∏∞ÏïàÏÑú ÏÉùÏÑ±
            const draftText = generateDraftWithRules(requestData, 'facility');
            
            document.getElementById('facility-draft-preview').textContent = draftText;
            
            const appliedRulesCount = feedbackRules.filter(r => r.target === 'facility' || r.target === 'both').length;
            showAlert(`ÏãúÏÑ§ Í¥ÄÎ¶¨ Í∏∞ÏïàÏÑúÍ∞Ä ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§! (${appliedRulesCount}Í∞ú Í∑úÏπô Ï†ÅÏö©Îê®)`, 'success');
        }
        
        // Íµ¨Îß§ ÏöîÏ≤≠ Í∏∞ÏïàÏÑú ÌÅ¥Î¶ΩÎ≥¥Îìú Î≥µÏÇ¨
        function copyPurchaseDraftToClipboard() {
            const draftText = document.getElementById('purchase-draft-preview').textContent;
            if (!draftText || draftText.includes('Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÎ©¥')) {
                alert('Î®ºÏ†Ä Í∏∞ÏïàÏÑúÎ•º ÏÉùÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            copyToClipboard(draftText, 'Íµ¨Îß§ ÏöîÏ≤≠ Í∏∞ÏïàÏÑúÍ∞Ä ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!');
        }
        
        // ÏãúÏÑ§ Í¥ÄÎ¶¨ Í∏∞ÏïàÏÑú ÌÅ¥Î¶ΩÎ≥¥Îìú Î≥µÏÇ¨
        function copyFacilityDraftToClipboard() {
            const draftText = document.getElementById('facility-draft-preview').textContent;
            if (!draftText || draftText.includes('Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÎ©¥')) {
                alert('Î®ºÏ†Ä Í∏∞ÏïàÏÑúÎ•º ÏÉùÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            copyToClipboard(draftText, 'ÏãúÏÑ§ Í¥ÄÎ¶¨ Í∏∞ÏïàÏÑúÍ∞Ä ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!');
        }
        
        // Íµ¨Îß§ ÏöîÏ≤≠ Í∏∞ÏïàÏÑú Ï¥àÍ∏∞Ìôî
        function clearPurchaseDraft() {
            document.getElementById('purchase-draft-preview').textContent = 'ÏúÑÏùò "Í∏∞ÏïàÏÑú ÏÉùÏÑ±" Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÎ©¥ ÏûÖÎ†•ÌïòÏã† Íµ¨Îß§ ÏöîÏ≤≠ Ï†ïÎ≥¥Î•º Î∞îÌÉïÏúºÎ°ú Í∏∞ÏïàÏÑúÍ∞Ä ÏûêÎèô ÏÉùÏÑ±Îê©ÎãàÎã§.';
            showAlert('Í∏∞ÏïàÏÑúÍ∞Ä Ï¥àÍ∏∞ÌôîÎêòÏóàÏäµÎãàÎã§.', 'info');
        }
        
        // ÏãúÏÑ§ Í¥ÄÎ¶¨ Í∏∞ÏïàÏÑú Ï¥àÍ∏∞Ìôî
        function clearFacilityDraft() {
            document.getElementById('facility-draft-preview').textContent = 'ÏúÑÏùò "Í∏∞ÏïàÏÑú ÏÉùÏÑ±" Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÎ©¥ ÏûÖÎ†•ÌïòÏã† ÏãúÏÑ§ Í¥ÄÎ¶¨ ÏöîÏ≤≠ Ï†ïÎ≥¥Î•º Î∞îÌÉïÏúºÎ°ú Í∏∞ÏïàÏÑúÍ∞Ä ÏûêÎèô ÏÉùÏÑ±Îê©ÎãàÎã§.';
            showAlert('Í∏∞ÏïàÏÑúÍ∞Ä Ï¥àÍ∏∞ÌôîÎêòÏóàÏäµÎãàÎã§.', 'info');
        }
        
        // Î≤îÏö© ÌÅ¥Î¶ΩÎ≥¥Îìú Î≥µÏÇ¨ Ìï®Ïàò
        function copyToClipboard(text, successMessage) {
            navigator.clipboard.writeText(text).then(() => {
                showAlert(successMessage, 'success');
            }).catch(() => {
                // ÌÅ¥Î¶ΩÎ≥¥Îìú API Ïã§Ìå® Ïãú ÎåÄÏïà
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showAlert(successMessage, 'success');
            });
        }
        
        // ÌÖúÌîåÎ¶ø ÌïôÏäµ Ìï®Ïàò
        function learnTemplate() {
            const type = document.getElementById('template-type').value;
            const sampleText = document.getElementById('sample-template').value.trim();
            
            if (!sampleText) {
                alert('Í∏∞ÏïàÏÑú ÏÉòÌîåÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            try {
                // ÌÖúÌîåÎ¶ø Î∂ÑÏÑù Î∞è Ï†ÄÏû•
                const templateData = analyzeTemplate(sampleText, type);
                
                if (!learnedTemplates[type]) {
                    learnedTemplates[type] = [];
                }
                
                learnedTemplates[type].push({
                    id: Date.now(),
                    sample: sampleText,
                    patterns: templateData,
                    createdAt: new Date().toISOString()
                });
                
                localStorage.setItem('learnedTemplates', JSON.stringify(learnedTemplates));
                
                document.getElementById('sample-template').value = '';
                displayLearnedTemplates();
                
                showAlert('ÌÖúÌîåÎ¶ø ÌïôÏäµÏù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§!', 'success');
                
            } catch (error) {
                console.error('ÌÖúÌîåÎ¶ø ÌïôÏäµ Ïã§Ìå®:', error);
                alert('ÌÖúÌîåÎ¶ø ÌïôÏäµ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
            }
        }
        
        // ÌÖúÌîåÎ¶ø Î∂ÑÏÑù Ìï®Ïàò
        function analyzeTemplate(text, type) {
            // Í∏∞Î≥∏ Ìå®ÌÑ¥ Ï∂îÏ∂ú
            const patterns = {
                header: extractSection(text, ['Ï†úÎ™©', 'Í∏∞ÏïàÏ†úÎ™©', 'Í±¥Î™Ö']),
                purpose: extractSection(text, ['Î™©Ï†Å', 'ÏÇ¨Ïú†', 'ÌïÑÏöîÏÑ±']),
                content: extractSection(text, ['ÎÇ¥Ïö©', 'ÏÑ∏Î∂ÄÏÇ¨Ìï≠', 'ÏÉÅÏÑ∏ÎÇ¥Ïö©']),
                budget: extractSection(text, ['ÏòàÏÇ∞', 'Í∏àÏï°', 'ÎπÑÏö©']),
                timeline: extractSection(text, ['ÏùºÏ†ï', 'Í∏∞Í∞Ñ', 'ÏôÑÎ£åÏòàÏ†ïÏùº']),
                footer: extractSection(text, ['Ïù¥ÏÉÅ', 'Î∂ôÏûÑ', 'ÎÅù'])
            };
            
            return patterns;
        }
        
        // ÌÖçÏä§Ìä∏ÏóêÏÑú ÌäπÏ†ï ÏÑπÏÖò Ï∂îÏ∂ú
        function extractSection(text, keywords) {
            for (let keyword of keywords) {
                const regex = new RegExp(`${keyword}[\\s\\S]*?(?=\\n\\n|$)`, 'i');
                const match = text.match(regex);
                if (match) {
                    return match[0];
                }
            }
            return '';
        }
        
        // ÌïôÏäµÎêú ÌÖúÌîåÎ¶ø Î™©Î°ù ÌëúÏãú
        function displayLearnedTemplates() {
            const container = document.getElementById('learned-templates');
            if (!container) return;
            
            const purchaseTemplates = learnedTemplates.purchase || [];
            const facilityTemplates = learnedTemplates.facility || [];
            
            if (purchaseTemplates.length === 0 && facilityTemplates.length === 0) {
                container.innerHTML = `
                    <div style="color: #6b7280; text-align: center; padding: 2rem;">
                        ÏïÑÏßÅ ÌïôÏäµÎêú ÌÖúÌîåÎ¶øÏù¥ ÏóÜÏäµÎãàÎã§. ÏúÑÏóêÏÑú Í∏∞ÏïàÏÑú ÏÉòÌîåÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            if (purchaseTemplates.length > 0) {
                html += `
                    <div style="margin-bottom: 2rem;">
                        <h4 style="color: #22c55e; margin-bottom: 1rem;">üõí Íµ¨Îß§ ÏöîÏ≤≠ ÌÖúÌîåÎ¶ø (${purchaseTemplates.length}Í∞ú)</h4>
                        ${purchaseTemplates.map(template => `
                            <div style="background: white; padding: 1rem; border-radius: 8px; margin-bottom: 0.5rem; border-left: 4px solid #22c55e;">
                                <div style="font-size: 0.9rem; color: #6b7280;">
                                    ÌïôÏäµÏùº: ${new Date(template.createdAt).toLocaleDateString('ko-KR')}
                                    <button onclick="deleteTemplate('purchase', ${template.id})" style="float: right; background: #ef4444; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8rem;">ÏÇ≠Ï†ú</button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            if (facilityTemplates.length > 0) {
                html += `
                    <div>
                        <h4 style="color: #2563eb; margin-bottom: 1rem;">üîß ÏãúÏÑ§ Í¥ÄÎ¶¨ ÌÖúÌîåÎ¶ø (${facilityTemplates.length}Í∞ú)</h4>
                        ${facilityTemplates.map(template => `
                            <div style="background: white; padding: 1rem; border-radius: 8px; margin-bottom: 0.5rem; border-left: 4px solid #2563eb;">
                                <div style="font-size: 0.9rem; color: #6b7280;">
                                    ÌïôÏäµÏùº: ${new Date(template.createdAt).toLocaleDateString('ko-KR')}
                                    <button onclick="deleteTemplate('facility', ${template.id})" style="float: right; background: #ef4444; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8rem;">ÏÇ≠Ï†ú</button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }
        
        // ÌÖúÌîåÎ¶ø ÏÇ≠Ï†ú
        function deleteTemplate(type, templateId) {
            if (!confirm('Ïù¥ ÌÖúÌîåÎ¶øÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;
            
            learnedTemplates[type] = learnedTemplates[type].filter(t => t.id !== templateId);
            localStorage.setItem('learnedTemplates', JSON.stringify(learnedTemplates));
            displayLearnedTemplates();
            showAlert('ÌÖúÌîåÎ¶øÏù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.', 'success');
        }
        
        // Í≥†Í∏â Í≤ÄÏÉâ Î∞è ÌïÑÌÑ∞ÎßÅ
        function toggleAdvancedSearch() {
            const panel = document.getElementById('advanced-search-panel');
            const toggleText = document.getElementById('search-toggle-text');
            
            if (panel.style.display === 'none') {
                panel.style.display = 'block';
                toggleText.textContent = 'ÌïÑÌÑ∞ Îã´Í∏∞';
            } else {
                panel.style.display = 'none';
                toggleText.textContent = 'ÌïÑÌÑ∞ Ïó¥Í∏∞';
            }
        }
        
        // Í≥†Í∏â ÌïÑÌÑ∞ Ï†ÅÏö©
        function applyAdvancedFilters() {
            const filters = getFilterValues();
            
            // Ï†ÑÏ≤¥ ÏöîÏ≤≠ Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞
            const allRequests = [...purchaseRequests, ...facilityRequests].map(req => ({
                ...req,
                type: purchaseRequests.includes(req) ? 'purchase' : 'facility'
            }));
            
            // ÌïÑÌÑ∞ Ï†ÅÏö©
            const filteredRequests = allRequests.filter(request => {
                // Î∂ÄÏÑú ÌïÑÌÑ∞
                if (filters.department && request.department !== filters.department) {
                    return false;
                }
                
                // Îã¥ÎãπÏûê ÌïÑÌÑ∞
                if (filters.requester && !request.requestedBy.toLowerCase().includes(filters.requester.toLowerCase())) {
                    return false;
                }
                
                // ÏÉÅÌÉú ÌïÑÌÑ∞
                if (filters.status && request.status !== filters.status) {
                    return false;
                }
                
                // Ïö∞ÏÑ†ÏàúÏúÑ ÌïÑÌÑ∞
                if (filters.priority && request.priority !== filters.priority) {
                    return false;
                }
                
                // ÎÇ†Ïßú Î≤îÏúÑ ÌïÑÌÑ∞
                if (filters.dateStart) {
                    const requestDate = new Date(request.createdAt);
                    const filterStart = new Date(filters.dateStart);
                    if (requestDate < filterStart) return false;
                }
                
                if (filters.dateEnd) {
                    const requestDate = new Date(request.createdAt);
                    const filterEnd = new Date(filters.dateEnd);
                    filterEnd.setHours(23, 59, 59); // ÌïòÎ£® ÎÅùÍπåÏßÄ Ìè¨Ìï®
                    if (requestDate > filterEnd) return false;
                }
                
                // ÏòàÏÇ∞ Î≤îÏúÑ ÌïÑÌÑ∞ (Íµ¨Îß§ ÏöîÏ≤≠Îßå)
                if (request.type === 'purchase' && (filters.budgetMin || filters.budgetMax)) {
                    const budget = request.estimatedBudget || 0;
                    if (filters.budgetMin && budget < filters.budgetMin) return false;
                    if (filters.budgetMax && budget > filters.budgetMax) return false;
                }
                
                return true;
            });
            
            // ÌïÑÌÑ∞Îêú Í≤∞Í≥º ÌëúÏãú
            updateFilteredResults(filteredRequests);
            
            showAlert(`${filteredRequests.length}Í∞úÏùò ÏöîÏ≤≠Ïù¥ ÌïÑÌÑ∞ Ï°∞Í±¥Ïóê ÏùºÏπòÌï©ÎãàÎã§.`, 'success');
            
            console.log('ÌïÑÌÑ∞ Ï†ÅÏö© ÏôÑÎ£å:', {
                totalRequests: allRequests.length,
                filteredRequests: filteredRequests.length,
                filters: filters
            });
        }
        
        // ÌïÑÌÑ∞ Í∞í Í∞ÄÏ†∏Ïò§Í∏∞
        function getFilterValues() {
            return {
                department: document.getElementById('filter-department').value,
                requester: document.getElementById('filter-requester').value,
                status: document.getElementById('filter-status').value,
                priority: document.getElementById('filter-priority').value,
                budgetMin: parseInt(document.getElementById('filter-budget-min').value) || null,
                budgetMax: parseInt(document.getElementById('filter-budget-max').value) || null,
                dateStart: document.getElementById('filter-date-start').value,
                dateEnd: document.getElementById('filter-date-end').value
            };
        }
        
        // ÌïÑÌÑ∞Îêú Í≤∞Í≥º ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
        function updateFilteredResults(filteredRequests) {
            const tableBody = document.querySelector('#admin-all-tab .requests-table tbody');
            if (!tableBody) return;
            
            // Í∏∞Ï°¥ ÌÖåÏù¥Î∏î ÎÇ¥Ïö© ÌÅ¥Î¶¨Ïñ¥
            tableBody.innerHTML = '';
            
            if (filteredRequests.length === 0) {
                const emptyRow = document.createElement('tr');
                emptyRow.innerHTML = `
                    <td colspan="10" style="text-align: center; padding: 3rem; color: #6b7280; font-style: italic;">
                        üîç ÌïÑÌÑ∞ Ï°∞Í±¥Ïóê ÎßûÎäî ÏöîÏ≤≠Ïù¥ ÏóÜÏäµÎãàÎã§.
                    </td>
                `;
                tableBody.appendChild(emptyRow);
                return;
            }
            
            // ÌïÑÌÑ∞Îêú ÏöîÏ≤≠Îì§ÏùÑ ÌÖåÏù¥Î∏îÏóê Ï∂îÍ∞Ä
            filteredRequests.forEach(request => {
                const row = document.createElement('tr');
                row.className = 'clickable-row';
                row.onclick = () => showRequestDetail(request);
                createAllRequestRow(row, request);
                tableBody.appendChild(row);
            });
            
            // ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
            updateFilteredStats(filteredRequests);
        }
        
        // ÌïÑÌÑ∞Îêú Îç∞Ïù¥ÌÑ∞ ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
        function updateFilteredStats(filteredRequests) {
            const stats = {
                waiting: filteredRequests.filter(r => r.status === 'ÎåÄÍ∏∞').length,
                progress: filteredRequests.filter(r => r.status === 'ÏßÑÌñâÏ§ë').length,
                completed: filteredRequests.filter(r => r.status === 'ÏôÑÎ£å').length,
                cancelled: filteredRequests.filter(r => r.status === 'Ï∑®ÏÜå').length
            };
            
            // ÌÜµÍ≥Ñ Ïπ¥Îìú ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('stat-all-waiting').textContent = stats.waiting;
            document.getElementById('stat-all-progress').textContent = stats.progress;
            document.getElementById('stat-all-completed').textContent = stats.completed;
            document.getElementById('stat-all-cancelled').textContent = stats.cancelled;
        }
        
        // Í≥†Í∏â ÌïÑÌÑ∞ Ï¥àÍ∏∞Ìôî
        function resetAdvancedFilters() {
            // Î™®Îì† ÌïÑÌÑ∞ ÏûÖÎ†• ÌïÑÎìú Ï¥àÍ∏∞Ìôî
            document.getElementById('filter-department').value = '';
            document.getElementById('filter-requester').value = '';
            document.getElementById('filter-status').value = '';
            document.getElementById('filter-priority').value = '';
            document.getElementById('filter-budget-min').value = '';
            document.getElementById('filter-budget-max').value = '';
            document.getElementById('filter-date-start').value = '';
            document.getElementById('filter-date-end').value = '';
            
            // ÏõêÎ≥∏ Îç∞Ïù¥ÌÑ∞Î°ú Î≥µÏõê
            loadAllRequests();
            
            showAlert('ÌïÑÌÑ∞Í∞Ä Ï¥àÍ∏∞ÌôîÎêòÏóàÏäµÎãàÎã§.', 'success');
        }
        
        // ÌïÑÌÑ∞Îêú Îç∞Ïù¥ÌÑ∞ Excel ÎÇ¥Î≥¥ÎÇ¥Í∏∞
        function exportFilteredData() {
            const filters = getFilterValues();
            const hasActiveFilters = Object.values(filters).some(value => value !== null && value !== '');
            
            if (!hasActiveFilters) {
                showAlert('ÌïÑÌÑ∞Î•º Ï†ÅÏö©Ìïú ÌõÑ Excel ÎÇ¥Î≥¥ÎÇ¥Í∏∞Î•º ÏÇ¨Ïö©Ìï¥Ï£ºÏÑ∏Ïöî.', 'warning');
                return;
            }
            
            // ÌòÑÏû¨ ÌëúÏãúÎêú ÌïÑÌÑ∞Îêú Îç∞Ïù¥ÌÑ∞Î•º ExcelÎ°ú ÎÇ¥Î≥¥ÎÇ¥Í∏∞
            const tableRows = document.querySelectorAll('#admin-all-tab .requests-table tbody tr');
            const data = [];
            
            tableRows.forEach(row => {
                const cells = row.querySelectorAll('td');
                if (cells.length > 1) { // Îπà Í≤∞Í≥º ÌñâÏù¥ ÏïÑÎãå Í≤ΩÏö∞
                    data.push({
                        'Ïú†Ìòï': cells[0].textContent.trim(),
                        'Ï†úÎ™©/Î¨ºÌíà': cells[1].textContent.trim(),
                        'ÏàòÎüâ/ÏúÑÏπò': cells[2].textContent.trim(),
                        'Ïö∞ÏÑ†ÏàúÏúÑ': cells[3].textContent.trim(),
                        'ÏÉÅÌÉú': cells[4].textContent.trim(),
                        'ÏöîÏ≤≠Ïûê': cells[5].textContent.trim(),
                        'Î∂ÄÏÑú': cells[6].textContent.trim(),
                        'Îì±Î°ùÏùº': cells[7].textContent.trim()
                    });
                }
            });
            
            if (data.length === 0) {
                showAlert('ÎÇ¥Î≥¥ÎÇº Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.', 'warning');
                return;
            }
            
            // Excel ÌååÏùº ÏÉùÏÑ± Î∞è Îã§Ïö¥Î°úÎìú
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.json_to_sheet(data);
            XLSX.utils.book_append_sheet(wb, ws, 'ÌïÑÌÑ∞Îêú_ÏöîÏ≤≠_Î™©Î°ù');
            
            const fileName = `ÌïÑÌÑ∞Îêú_ÏöîÏ≤≠_Î™©Î°ù_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, fileName);
            
            showAlert(`${data.length}Í∞úÏùò ÌïÑÌÑ∞Îêú ÏöîÏ≤≠Ïù¥ Excel ÌååÏùºÎ°ú Îã§Ïö¥Î°úÎìúÎêòÏóàÏäµÎãàÎã§.`, 'success');
        }

        // ==================== UX Í∞úÏÑ† Í∏∞Îä• ====================
        
        // Î°úÎî© Ïò§Î≤ÑÎ†àÏù¥ ÌëúÏãú/Ïà®ÍπÄ
        function showLoading(message = 'Ï≤òÎ¶¨ Ï§ë...') {
            const overlay = document.getElementById('loading-overlay');
            const messageEl = document.getElementById('loading-message');
            if (overlay && messageEl) {
                messageEl.textContent = message;
                overlay.classList.add('active');
            }
        }
        
        function hideLoading() {
            const overlay = document.getElementById('loading-overlay');
            if (overlay) {
                overlay.classList.remove('active');
            }
        }
        
        // ÏûêÎèôÏôÑÏÑ± Í∏∞Îä•
        const autocompleteData = {
            departments: ['ITÌåÄ', 'ÎßàÏºÄÌåÖÌåÄ', 'Ï¥ùÎ¨¥ÌåÄ', 'Ïù∏ÏÇ¨ÌåÄ', 'ÏòÅÏóÖÌåÄ', 'Í∏∞ÌöçÌåÄ', 'Í∞úÎ∞úÌåÄ', 'ÎîîÏûêÏù∏ÌåÄ', 'ÌöåÍ≥ÑÌåÄ'],
            items: ['ÎÖ∏Ìä∏Î∂Å', 'ÎßàÏö∞Ïä§', 'ÌÇ§Î≥¥Îìú', 'Î™®ÎãàÌÑ∞', 'ÌîÑÎ¶∞ÌÑ∞', 'Î≥µÏÇ¨Í∏∞', 'Ï±ÖÏÉÅ', 'ÏùòÏûê', 'ÏÇ¨Î¨¥Ïö©Ìíà', 'Ïä§ÌÖåÏù¥ÌîåÎü¨'],
            facilities: ['ÏóêÏñ¥Ïª®', 'ÌîÑÎ°úÏ†ùÌÑ∞', 'ÌôîÏù¥Ìä∏Î≥¥Îìú', 'Ï±ÖÏÉÅ', 'ÏùòÏûê', 'Ï°∞Î™Ö', 'Ïò®ÏàòÍ∏∞', 'Ï†ïÏàòÍ∏∞', 'ÏóòÎ¶¨Î≤†Ïù¥ÌÑ∞', 'ÌôîÏû•Ïã§']
        };
        
        function initializeAutocomplete() {
            // Î∂ÄÏÑúÎ™Ö ÏûêÎèôÏôÑÏÑ±
            addAutocomplete('purchase-department', autocompleteData.departments);
            addAutocomplete('facility-department', autocompleteData.departments);
            
            // ÏöîÏ≤≠Ïûê ÏûêÎèôÏôÑÏÑ± (localStorageÏóêÏÑú Ïù¥Ï†Ñ ÏûÖÎ†• Í∏∞Î°ù ÏÇ¨Ïö©)
            const previousRequesters = JSON.parse(localStorage.getItem('previousRequesters') || '[]');
            addAutocomplete('purchase-requested-by', previousRequesters);
            addAutocomplete('facility-requested-by', previousRequesters);
            
            // Î¨ºÌíàÎ™Ö ÏûêÎèôÏôÑÏÑ±
            addAutocomplete('purchase-item', autocompleteData.items);
            
            // ÏãúÏÑ§Î™Ö ÏûêÎèôÏôÑÏÑ±
            addAutocomplete('facility-name', autocompleteData.facilities);
        }
        
        function addAutocomplete(inputId, suggestions) {
            const input = document.getElementById(inputId);
            if (!input) return;
            
            // Ïª®ÌÖåÏù¥ÎÑà ÏÉùÏÑ±
            const container = document.createElement('div');
            container.className = 'autocomplete-container';
            input.parentNode.insertBefore(container, input);
            container.appendChild(input);
            
            // ÎìúÎ°≠Îã§Ïö¥ ÏÉùÏÑ±
            const dropdown = document.createElement('div');
            dropdown.className = 'autocomplete-dropdown';
            container.appendChild(dropdown);
            
            let selectedIndex = -1;
            
            input.addEventListener('input', function() {
                const value = this.value.toLowerCase();
                const matches = suggestions.filter(item => 
                    item.toLowerCase().includes(value)
                ).slice(0, 5);
                
                if (matches.length > 0 && value.length > 0) {
                    dropdown.innerHTML = matches.map((match, index) => 
                        `<div class="autocomplete-item" data-value="${match}">${match}</div>`
                    ).join('');
                    dropdown.classList.add('active');
                    selectedIndex = -1;
                } else {
                    dropdown.classList.remove('active');
                }
            });
            
            input.addEventListener('keydown', function(e) {
                const items = dropdown.querySelectorAll('.autocomplete-item');
                
                switch(e.key) {
                    case 'ArrowDown':
                        e.preventDefault();
                        selectedIndex = Math.min(selectedIndex + 1, items.length - 1);
                        updateSelection(items);
                        break;
                    case 'ArrowUp':
                        e.preventDefault();
                        selectedIndex = Math.max(selectedIndex - 1, -1);
                        updateSelection(items);
                        break;
                    case 'Enter':
                        e.preventDefault();
                        if (selectedIndex >= 0) {
                            this.value = items[selectedIndex].dataset.value;
                            dropdown.classList.remove('active');
                        }
                        break;
                    case 'Escape':
                        dropdown.classList.remove('active');
                        break;
                }
            });
            
            dropdown.addEventListener('click', function(e) {
                if (e.target.classList.contains('autocomplete-item')) {
                    input.value = e.target.dataset.value;
                    dropdown.classList.remove('active');
                }
            });
            
            function updateSelection(items) {
                items.forEach((item, index) => {
                    item.classList.toggle('selected', index === selectedIndex);
                });
            }
            
            // Ïô∏Î∂Ä ÌÅ¥Î¶≠ Ïãú ÎìúÎ°≠Îã§Ïö¥ Îã´Í∏∞
            document.addEventListener('click', function(e) {
                if (!container.contains(e.target)) {
                    dropdown.classList.remove('active');
                }
            });
        }
        
        // ÏöîÏ≤≠Ïûê Í∏∞Î°ù Ï†ÄÏû•
        function saveRequesterHistory(requester) {
            if (!requester || requester.trim() === '') return;
            
            const history = JSON.parse(localStorage.getItem('previousRequesters') || '[]');
            if (!history.includes(requester)) {
                history.unshift(requester);
                // ÏµúÎåÄ 10Í∞úÍπåÏßÄÎßå Ï†ÄÏû•
                if (history.length > 10) {
                    history.pop();
                }
                localStorage.setItem('previousRequesters', JSON.stringify(history));
            }
        }
        
        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú UX Í∞úÏÑ† Í∏∞Îä• Ï¥àÍ∏∞Ìôî
        document.addEventListener('DOMContentLoaded', function() {
            initializeAutocomplete();
            
            // ÌéòÏù¥ÏßÄ Î°úÎìú Ïï†ÎãàÎ©îÏù¥ÏÖò
            document.body.style.opacity = '0';
            setTimeout(() => {
                document.body.style.transition = 'opacity 0.5s ease';
                document.body.style.opacity = '1';
            }, 100);
            
            console.log('üé® UX Í∞úÏÑ† Í∏∞Îä•Ïù¥ Ï¥àÍ∏∞ÌôîÎêòÏóàÏäµÎãàÎã§.');
        });
        
        // ==================== Firebase Ïã§ÏãúÍ∞Ñ Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ ====================
        
        // Firebase Ïó∞Í≤∞ ÏÉÅÌÉú
        let isFirebaseConnected = false;
        let firebaseRetryCount = 0;
        const MAX_RETRY_COUNT = 3;
        
        // Firebase Ï¥àÍ∏∞Ìôî ÎåÄÍ∏∞
        async function waitForFirestore() {
            return new Promise((resolve) => {
                const checkFirestore = () => {
                    if (window.firebaseDB && window.firebaseAuth) {
                        resolve(true);
                    } else {
                        setTimeout(checkFirestore, 100);
                    }
                };
                checkFirestore();
            });
        }
        
        // Firebase Ïù∏Ï¶ù (ÏùµÎ™Ö Î°úÍ∑∏Ïù∏)
        async function initializeFirebaseAuth() {
            try {
                await waitForFirestore();
                const auth = window.firebaseAuth;
                
                // ÏùµÎ™Ö Î°úÍ∑∏Ïù∏
                await auth.signInAnonymously();
                isFirebaseConnected = true;
                
                console.log('üî• Firebase Ïù∏Ï¶ù ÏôÑÎ£å');
                showSyncStatus('connected', 'Ïã§ÏãúÍ∞Ñ ÎèôÍ∏∞Ìôî Ïó∞Í≤∞Îê®');
                
                // Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞Î•º FirebaseÎ°ú ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò
                await migrateLocalDataToFirebase();
                
                // Ïã§ÏãúÍ∞Ñ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï
                setupRealtimeListeners();
                
            } catch (error) {
                console.error('‚ùå Firebase Ïù∏Ï¶ù Ïã§Ìå®:', error);
                handleFirebaseError(error);
            }
        }
        
        // Î°úÏª¨ Îç∞Ïù¥ÌÑ∞Î•º FirebaseÎ°ú ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò
        async function migrateLocalDataToFirebase() {
            try {
                const localRequests = JSON.parse(localStorage.getItem('requests') || '[]');
                if (localRequests.length > 0) {
                    console.log('üì¶ Î°úÏª¨ Îç∞Ïù¥ÌÑ∞Î•º FirebaseÎ°ú ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò Ï§ë...', localRequests.length, 'Í∞ú');
                    
                    for (const request of localRequests) {
                        if (!request.firebaseId) {
                            await saveRequestToFirebase(request, false); // Ïã§ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏ Î∞©ÏßÄ
                        }
                    }
                    
                    console.log('‚úÖ ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò ÏôÑÎ£å');
                }
            } catch (error) {
                console.error('‚ùå ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò Ïã§Ìå®:', error);
            }
        }
        
        // ÏöîÏ≤≠ Îç∞Ïù¥ÌÑ∞Î•º FirebaseÏóê Ï†ÄÏû•
        async function saveRequestToFirebase(requestData, shouldTriggerUpdate = true) {
            try {
                if (!isFirebaseConnected) {
                    throw new Error('Firebase Ïó∞Í≤∞Ïù¥ ÎÅäÏñ¥Ïßê');
                }
                
                const { addDoc, collection } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
                const db = window.firebaseDB;
                
                // FirestoreÏóê Ï†ÄÏû•
                const docRef = await addDoc(collection(db, 'requests'), {
                    ...requestData,
                    createdAt: requestData.createdAt || new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                });
                
                console.log('üî• Firebase Ï†ÄÏû• ÏôÑÎ£å:', docRef.id);
                
                // Î°úÏª¨ Îç∞Ïù¥ÌÑ∞Ïóê Firebase ID Ï∂îÍ∞Ä
                const updatedRequest = { ...requestData, firebaseId: docRef.id };
                
                return docRef.id;
                
            } catch (error) {
                console.error('‚ùå Firebase Ï†ÄÏû• Ïã§Ìå®:', error);
                // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄÏóê Î∞±ÏóÖ Ï†ÄÏû•
                saveToLocalStorage(requestData);
                showSyncStatus('error', 'Firebase Ï†ÄÏû• Ïã§Ìå®, Î°úÏª¨Ïóê Î∞±ÏóÖÎê®');
                throw error;
            }
        }
        
        // FirebaseÏóêÏÑú ÏöîÏ≤≠ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
        async function updateRequestInFirebase(firebaseId, updates) {
            try {
                if (!isFirebaseConnected || !firebaseId) {
                    throw new Error('Firebase Ïó∞Í≤∞ ÎòêÎäî ID ÏóÜÏùå');
                }
                
                const { doc, updateDoc } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
                const db = window.firebaseDB;
                
                await updateDoc(doc(db, 'requests', firebaseId), {
                    ...updates,
                    updatedAt: new Date().toISOString()
                });
                
                console.log('üî• Firebase ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å:', firebaseId);
                
            } catch (error) {
                console.error('‚ùå Firebase ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìå®:', error);
                showSyncStatus('error', 'Firebase ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìå®');
                throw error;
            }
        }
        
        // Ïã§ÏãúÍ∞Ñ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï
        async function setupRealtimeListeners() {
            try {
                const { collection, query, orderBy, onSnapshot } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
                const db = window.firebaseDB;
                
                const q = query(collection(db, 'requests'), orderBy('createdAt', 'desc'));
                
                // Ïã§ÏãúÍ∞Ñ Î¶¨Ïä§ÎÑà
                onSnapshot(q, (snapshot) => {
                    const updatedRequests = [];
                    snapshot.forEach((doc) => {
                        updatedRequests.push({
                            firebaseId: doc.id,
                            ...doc.data()
                        });
                    });
                    
                    console.log('üî• Ïã§ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏:', updatedRequests.length, 'Í∞ú');
                    
                    // Ï†ÑÏó≠ ÏöîÏ≤≠ Î∞∞Ïó¥ ÏóÖÎç∞Ïù¥Ìä∏
                    requests = updatedRequests;
                    
                    // UI ÏóÖÎç∞Ïù¥Ìä∏
                    if (isAdmin) {
                        refreshAdminUI();
                    }
                    
                    showSyncStatus('synced', `${updatedRequests.length}Í∞ú ÏöîÏ≤≠ ÎèôÍ∏∞ÌôîÎê®`);
                }, (error) => {
                    console.error('‚ùå Ïã§ÏãúÍ∞Ñ Î¶¨Ïä§ÎÑà Ïò§Î•ò:', error);
                    showSyncStatus('error', 'Ïã§ÏãúÍ∞Ñ ÎèôÍ∏∞Ìôî Ïò§Î•ò');
                });
                
            } catch (error) {
                console.error('‚ùå Ïã§ÏãúÍ∞Ñ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï Ïã§Ìå®:', error);
            }
        }
        
        // Í¥ÄÎ¶¨Ïûê UI ÏÉàÎ°úÍ≥†Ïπ®
        function refreshAdminUI() {
            if (document.getElementById('admin-all-tab')?.style.display !== 'none') {
                loadAllRequests();
            }
            if (document.getElementById('admin-purchase-tab')?.style.display !== 'none') {
                loadPurchaseRequests();
            }
            if (document.getElementById('admin-facility-tab')?.style.display !== 'none') {
                loadFacilityRequests();
            }
            updateAllStats();
        }
        
        // ÎèôÍ∏∞Ìôî ÏÉÅÌÉú ÌëúÏãú
        function showSyncStatus(status, message) {
            const statusDiv = document.getElementById('sync-status');
            if (!statusDiv) return;
            
            const icons = {
                'connecting': 'üîÑ',
                'connected': 'üü¢',
                'synced': '‚úÖ',
                'error': 'üî¥',
                'offline': '‚ö´'
            };
            
            const colors = {
                'connecting': '#f59e0b',
                'connected': '#22c55e',
                'synced': '#10b981',
                'error': '#ef4444',
                'offline': '#6b7280'
            };
            
            statusDiv.innerHTML = `
                <span style="color: ${colors[status]};">${icons[status]}</span>
                <span style="font-size: 0.8rem; margin-left: 0.25rem;">${message}</span>
            `;
        }
        
        // Firebase Ïò§Î•ò Ï≤òÎ¶¨
        function handleFirebaseError(error) {
            firebaseRetryCount++;
            
            if (firebaseRetryCount <= MAX_RETRY_COUNT) {
                console.log(`üîÑ Firebase Ïû¨Ïó∞Í≤∞ ÏãúÎèÑ ${firebaseRetryCount}/${MAX_RETRY_COUNT}`);
                showSyncStatus('connecting', `Ïû¨Ïó∞Í≤∞ Ï§ë... (${firebaseRetryCount}/${MAX_RETRY_COUNT})`);
                
                setTimeout(() => {
                    initializeFirebaseAuth();
                }, 2000 * firebaseRetryCount);
            } else {
                console.log('‚ùå Firebase Ïó∞Í≤∞ Ìè¨Í∏∞, Ïò§ÌîÑÎùºÏù∏ Î™®ÎìúÎ°ú Ï†ÑÌôò');
                showSyncStatus('offline', 'Ïò§ÌîÑÎùºÏù∏ Î™®Îìú (Î°úÏª¨ Ï†ÄÏû•)');
                isFirebaseConnected = false;
            }
        }
        
        // Î°úÏª¨ Î∞±ÏóÖ Í∏∞Îä•
        function saveToLocalStorage(data) {
            try {
                const localData = JSON.parse(localStorage.getItem('requests_backup') || '[]');
                localData.unshift(data);
                localStorage.setItem('requests_backup', JSON.stringify(localData));
            } catch (error) {
                console.error('‚ùå Î°úÏª¨ Ï†ÄÏû• Ïã§Ìå®:', error);
            }
        }
        
                    // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Firebase Ï¥àÍ∏∞Ìôî
        document.addEventListener('DOMContentLoaded', function() {
            // Service Worker Îì±Î°ù
            registerServiceWorker();
            
            // Firebase Ïó∞Í≤∞ ÏãúÎèÑ
            setTimeout(() => {
                initializeFirebaseAuth();
            }, 500);
            
            // ÎÑ§Ìä∏ÏõåÌÅ¨ ÏÉÅÌÉú Î™®ÎãàÌÑ∞ÎßÅ
            window.addEventListener('online', function() {
                console.log('üåê ÎÑ§Ìä∏ÏõåÌÅ¨ Ïó∞Í≤∞Îê®');
                if (!isFirebaseConnected) {
                    initializeFirebaseAuth();
                }
            });
            
            window.addEventListener('offline', function() {
                console.log('üì± Ïò§ÌîÑÎùºÏù∏ ÏÉÅÌÉú');
                showSyncStatus('offline', 'Ïò§ÌîÑÎùºÏù∏ Î™®Îìú');
                isFirebaseConnected = false;
            });
            
            // PWA ÏÑ§Ïπò ÌîÑÎ°¨ÌîÑÌä∏ Ï≤òÎ¶¨
            setupPWAInstallPrompt();
        });
        
        // ==================== PWA Î∞è Service Worker ====================
        
        // Service Worker Îì±Î°ù
        async function registerServiceWorker() {
            if ('serviceWorker' in navigator) {
                try {
                    const registration = await navigator.serviceWorker.register('/sw.js');
                    console.log('‚úÖ Service Worker Îì±Î°ù ÏÑ±Í≥µ:', registration.scope);
                    
                    // ÏóÖÎç∞Ïù¥Ìä∏ ÌôïÏù∏
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                // ÏÉà Î≤ÑÏ†Ñ ÏÇ¨Ïö© Í∞ÄÎä•
                                showUpdateAvailablePrompt();
                            }
                        });
                    });
                    
                } catch (error) {
                    console.error('‚ùå Service Worker Îì±Î°ù Ïã§Ìå®:', error);
                }
            } else {
                console.log('üö´ Ïù¥ Î∏åÎùºÏö∞Ï†ÄÎäî Service WorkerÎ•º ÏßÄÏõêÌïòÏßÄ ÏïäÏäµÎãàÎã§.');
            }
        }
        
        // PWA ÏÑ§Ïπò ÌîÑÎ°¨ÌîÑÌä∏ ÏÑ§Ï†ï
        function setupPWAInstallPrompt() {
            let deferredPrompt;
            
            window.addEventListener('beforeinstallprompt', (e) => {
                console.log('üì± PWA ÏÑ§Ïπò ÌîÑÎ°¨ÌîÑÌä∏ Ï§ÄÎπÑ');
                e.preventDefault();
                deferredPrompt = e;
                
                // ÏÑ§Ïπò Î≤ÑÌäº ÌëúÏãú (Ìó§ÎçîÏóê Ï∂îÍ∞Ä)
                showInstallButton(deferredPrompt);
            });
            
            window.addEventListener('appinstalled', (evt) => {
                console.log('üéâ PWA ÏÑ§Ïπò ÏôÑÎ£å');
                showAlert('Ïï±Ïù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú ÏÑ§ÏπòÎêòÏóàÏäµÎãàÎã§!', 'success');
                hideInstallButton();
            });
        }
        
        // ÏÑ§Ïπò Î≤ÑÌäº ÌëúÏãú
        function showInstallButton(deferredPrompt) {
            const syncStatus = document.getElementById('sync-status');
            if (!syncStatus) return;
            
            const installBtn = document.createElement('button');
            installBtn.id = 'install-btn';
            installBtn.innerHTML = 'üì± Ïï± ÏÑ§Ïπò';
            installBtn.style.cssText = `
                margin-left: 1rem;
                padding: 0.5rem 1rem;
                background: #10b981;
                color: white;
                border: none;
                border-radius: 20px;
                font-size: 0.8rem;
                cursor: pointer;
                transition: all 0.3s ease;
            `;
            
            installBtn.onclick = async () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    console.log('PWA ÏÑ§Ïπò ÏÑ†ÌÉù:', outcome);
                    deferredPrompt = null;
                    hideInstallButton();
                }
            };
            
            syncStatus.parentElement.appendChild(installBtn);
        }
        
        // ÏÑ§Ïπò Î≤ÑÌäº Ïà®Í∏∞Í∏∞
        function hideInstallButton() {
            const installBtn = document.getElementById('install-btn');
            if (installBtn) {
                installBtn.remove();
            }
        }
        
        // ÏóÖÎç∞Ïù¥Ìä∏ ÏÇ¨Ïö© Í∞ÄÎä• ÌîÑÎ°¨ÌîÑÌä∏
        function showUpdateAvailablePrompt() {
            const updatePrompt = confirm(
                'ÏÉàÎ°úÏö¥ Î≤ÑÏ†ÑÏù¥ ÏÇ¨Ïö© Í∞ÄÎä•Ìï©ÎãàÎã§.\nÌéòÏù¥ÏßÄÎ•º ÏÉàÎ°úÍ≥†Ïπ®ÌïòÏó¨ ÏóÖÎç∞Ïù¥Ìä∏ÌïòÏãúÍ≤†ÏäµÎãàÍπå?'
            );
            
            if (updatePrompt) {
                // Service WorkerÏóêÍ≤å skipWaiting Ïã†Ìò∏ Ï†ÑÏÜ°
                if (navigator.serviceWorker.controller) {
                    navigator.serviceWorker.controller.postMessage({ type: 'SKIP_WAITING' });
                }
                window.location.reload();
            }
        }
        
        // Service Worker Î©îÏãúÏßÄ ÏàòÏã†
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.addEventListener('message', event => {
                console.log('üí¨ Service Worker Î©îÏãúÏßÄ:', event.data);
                
                if (event.data.type === 'SYNC_LOCAL_DATA') {
                    // Î∞±Í∑∏ÎùºÏö¥Îìú ÎèôÍ∏∞ÌôîÎêú Îç∞Ïù¥ÌÑ∞ Ï≤òÎ¶¨
                    console.log('üîÑ Î∞±Í∑∏ÎùºÏö¥Îìú ÎèôÍ∏∞Ìôî Îç∞Ïù¥ÌÑ∞ ÏàòÏã†');
                    // ÌïÑÏöî Ïãú UI ÏóÖÎç∞Ïù¥Ìä∏
                }
            });
        }

    </script>

    <!-- SheetJS ÎùºÏù¥Î∏åÎü¨Î¶¨ (Excel ÌååÏùº ÏÉùÏÑ±Ïö©) -->
    <script src="https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

</body>
</html> 
```
</rewritten_
