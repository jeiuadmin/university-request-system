<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¢ ì´ë¬´ì²˜ í†µí•© ìš”ì²­ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    
    <!-- PWA ì„¤ì • -->
    <meta name="description" content="ì´ë¬´ì²˜ êµ¬ë§¤ ìš”ì²­ ë° ì‹œì„¤ ê´€ë¦¬ í†µí•© í”Œë«í¼">
    <meta name="theme-color" content="#3b82f6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ìš”ì²­ê´€ë¦¬">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- ë§¤ë‹ˆí˜ìŠ¤íŠ¸ íŒŒì¼ -->
    <link rel="manifest" href="manifest.json">
    
    <!-- íŒŒë¹„ì½˜ ë° ì•„ì´ì½˜ -->
    <link rel="icon" type="image/png" sizes="32x32" href="icon-32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icon-16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icon-180.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icon-152.png">
    <link rel="apple-touch-icon" sizes="144x144" href="icon-144.png">
    <link rel="apple-touch-icon" sizes="120x120" href="icon-120.png">
    <link rel="apple-touch-icon" sizes="114x114" href="icon-114.png">
    <link rel="apple-touch-icon" sizes="76x76" href="icon-76.png">
    <link rel="apple-touch-icon" sizes="72x72" href="icon-72.png">
    <link rel="apple-touch-icon" sizes="60x60" href="icon-60.png">
    <link rel="apple-touch-icon" sizes="57x57" href="icon-57.png">
    
    <!-- Windows íƒ€ì¼ -->
    <meta name="msapplication-TileColor" content="#3b82f6">
    <meta name="msapplication-TileImage" content="icon-144.png">
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, updateDoc, doc, deleteDoc, getDocs } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getAuth, signInAnonymously, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        
        // Firebase ì„¤ì • (ì‚¬ìš©ìê°€ ì‹¤ì œ í”„ë¡œì íŠ¸ ì„¤ì •ìœ¼ë¡œ êµì²´í•´ì•¼ í•¨)
        const firebaseConfig = {
            apiKey: "your-api-key-here",
            authDomain: "your-project.firebaseapp.com",
            projectId: "your-project-id",
            storageBucket: "your-project.appspot.com",
            messagingSenderId: "123456789",
            appId: "your-app-id"
        };
        
        // Firebase ì´ˆê¸°í™”
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        
        // ì „ì—­ ë³€ìˆ˜ë¡œ ì„¤ì •
        window.firebaseDB = db;
        window.firebaseAuth = auth;
        
        console.log('ğŸ”¥ Firebase ì´ˆê¸°í™” ì™„ë£Œ');
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #ff7f50 0%, #ff6347 50%, #ff4500 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .header {
            background: white;
            padding: 1.5rem 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header h1 {
            color: #dc2626;
            font-size: 2rem;
            margin-bottom: 0.5rem;
            text-shadow: 0 2px 4px rgba(220, 38, 38, 0.2);
        }
        
        .header p {
            color: #6b7280;
            font-size: 1rem;
        }
        
        .nav-tabs {
            background: white;
            padding: 0 2rem;
            border-bottom: 2px solid #e5e7eb;
            display: flex;
            gap: 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .nav-tab {
            padding: 1.2rem 2rem;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            color: #6b7280;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .nav-tab.active {
            color: #dc2626;
            border-bottom-color: #dc2626;
            background: linear-gradient(to bottom, #fef2f2, white);
            font-weight: 700;
            box-shadow: 0 2px 8px rgba(220, 38, 38, 0.2);
        }
        
        .nav-tab:hover:not(.active) {
            color: #374151;
            background: #f9fafb;
        }
        
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
        }
        
        .tab-content {
            display: none;
            background: white;
            border-radius: 16px;
            padding: 2.5rem;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            animation: fadeIn 0.5s ease-out;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group.full-width {
            grid-column: 1 / -1;
        }
        
        label {
            display: block;
            margin-bottom: 0.75rem;
            font-weight: 600;
            color: #374151;
            font-size: 1rem;
        }
        
        .emoji {
            margin-right: 0.5rem;
            font-size: 1.1em;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            font-family: inherit;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #ff6347;
            box-shadow: 0 0 0 4px rgba(255, 127, 80, 0.2);
            transform: translateY(-1px);
        }
        
        textarea {
            resize: vertical;
            min-height: 120px;
        }
        
        .btn {
            padding: 1rem 2.5rem;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            text-decoration: none;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #ff7f50 0%, #ff6347 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 127, 80, 0.4);
            font-weight: 700;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #ff6347 0%, #ff4500 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 99, 71, 0.5);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.3);
        }
        
        .btn-danger:hover {
            background: linear-gradient(135deg, #b91c1c 0%, #991b1b 100%);
            transform: translateY(-2px);
        }
        
        .btn-full {
            width: 100%;
        }
        
        .alert {
            padding: 1.25rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            border-left: 5px solid;
            font-weight: 500;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .alert-success {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-color: #22c55e;
            color: #15803d;
        }
        
        .alert-error {
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            border-color: #ef4444;
            color: #dc2626;
        }
        
        .requests-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1.5rem;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        
        .requests-table th,
        .requests-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #f3f4f6;
        }
        
        .requests-table th {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            font-weight: 700;
            color: #374151;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .requests-table tbody tr:hover {
            background: #f9fafb;
        }
        
        .badge {
            padding: 0.4rem 1rem;
            border-radius: 50px;
            font-size: 0.85rem;
            font-weight: 600;
            display: inline-block;
        }
        
        .badge-waiting {
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
            color: #374151;
        }
        
        .badge-progress {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            color: #1e40af;
        }
        
        .badge-completed {
            background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
            color: #15803d;
        }
        
        .badge-cancelled {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            color: #dc2626;
        }
        
        .priority-low { 
            background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%); 
            color: #15803d; 
        }
        .priority-normal { 
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); 
            color: #d97706; 
        }
        .priority-high { 
            background: linear-gradient(135deg, #fed7aa 0%, #fdba74 100%); 
            color: #ea580c; 
        }
        .priority-urgent { 
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); 
            color: #dc2626; 
        }
        
        .login-form {
            max-width: 450px;
            margin: 2rem auto;
        }
        
        .admin-info {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 2px solid #0ea5e9;
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 1.5rem;
            text-align: center;
            color: #0369a1;
            font-weight: 500;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2.5rem;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            padding: 2rem 1.5rem;
            border-radius: 16px;
            text-align: center;
            border-left: 5px solid;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-4px);
        }
        
        .stat-waiting { border-color: #6b7280; }
        .stat-progress { border-color: #2563eb; }
        .stat-completed { border-color: #16a34a; }
        .stat-cancelled { border-color: #dc2626; }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            color: #6b7280;
            font-size: 1rem;
            font-weight: 500;
        }
        
        .section-title {
            font-size: 2rem;
            font-weight: 800;
            color: #1f2937;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 0;
            border-bottom: 3px solid #f3f4f6;
            position: relative;
        }
        
        .section-title::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            width: 60px;
            height: 3px;
            background: linear-gradient(135deg, #ff7f50, #ff4500);
            border-radius: 2px;
        }
        
        .section-title .emoji {
            background: linear-gradient(135deg, #ff7f50, #ff4500);
            padding: 0.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(255, 127, 80, 0.3);
        }
        
        .footer {
            background: white;
            padding: 2.5rem;
            text-align: center;
            color: #6b7280;
            margin-top: 3rem;
            border-top: 2px solid #f3f4f6;
        }
        
        .footer p {
            margin-bottom: 0.5rem;
        }
        
        .admin-tab-content {
            display: none;
        }
        
        .admin-tab-content.active {
            display: block;
        }
        
        .admin-sub-tab {
            font-size: 0.95rem;
            padding: 1rem 1.5rem;
        }
        
        /* êµ¬ë§¤ ìš”ì²­ íƒ­ ì „ìš© ìŠ¤íƒ€ì¼ */
        .purchase-tab.active {
            color: #059669 !important;
            border-bottom-color: #059669 !important;
            background: linear-gradient(to bottom, #f0fdf4, white) !important;
        }
        
        /* ì‹œì„¤ ê´€ë¦¬ íƒ­ ì „ìš© ìŠ¤íƒ€ì¼ */
        .facility-tab.active {
            color: #2563eb !important;
            border-bottom-color: #2563eb !important;
            background: linear-gradient(to bottom, #eff6ff, white) !important;
        }
        
        /* ê´€ë¦¬ì íƒ­ ì „ìš© ìŠ¤íƒ€ì¼ */
        .admin-tab.active {
            color: #7c2d12 !important;
            border-bottom-color: #7c2d12 !important;
            background: linear-gradient(to bottom, #fef7ed, white) !important;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 0 1rem;
            }
            
            .header {
                padding: 1rem;
            }
            
            .nav-tabs {
                padding: 0 1rem;
                overflow-x: auto;
                flex-wrap: nowrap;
            }
            
            .nav-tab {
                padding: 1rem 1.5rem;
                white-space: nowrap;
            }
            
            .tab-content {
                padding: 1.5rem;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .requests-table {
                font-size: 0.85rem;
            }
        }
        
        /* íŒŒì¼ ì—…ë¡œë“œ ìŠ¤íƒ€ì¼ */
        .file-info {
            font-size: 0.8rem;
            color: #6b7280;
            margin-left: 8px;
        }
        
        .file-upload-container {
            position: relative;
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            padding: 20px;
            background-color: #f9fafb;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .file-upload-container:hover {
            border-color: #ff6347;
            background-color: #fef2f2;
        }
        
        .file-upload-container.dragover {
            border-color: #ff6347;
            background-color: #fef2f2;
            transform: scale(1.02);
        }
        
        .file-input {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }
        
        .file-upload-display {
            text-align: center;
            pointer-events: none;
        }
        
        .file-upload-text {
            display: block;
            color: #6b7280;
            font-size: 0.9rem;
            margin-bottom: 8px;
        }
        
        .file-name {
            display: block;
            color: #ff6347;
            font-weight: 600;
            font-size: 0.9rem;
            margin-top: 8px;
        }
        
        .file-name:empty {
            display: none;
        }
        
        .file-upload-container.has-file {
            border-color: #10b981;
            background-color: #f0fdf4;
        }
        
        .file-upload-container.has-file .file-upload-text {
            color: #059669;
        }
        
        /* ì‚¬ì§„ ì—…ë¡œë“œ ì „ìš© ìŠ¤íƒ€ì¼ */
        .photo-upload-container {
            position: relative;
            border: 2px dashed #d1d5db;
            border-radius: 12px;
            padding: 24px;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            transition: all 0.3s ease;
            cursor: pointer;
            min-height: 120px;
        }
        
        .photo-upload-container:hover {
            border-color: #2563eb;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(37, 99, 235, 0.1);
        }
        
        .photo-upload-container.dragover {
            border-color: #2563eb;
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            transform: scale(1.02);
            box-shadow: 0 8px 32px rgba(37, 99, 235, 0.2);
        }
        
        .photo-input {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }
        
        .photo-upload-display {
            text-align: center;
            pointer-events: none;
        }
        
        .photo-upload-text {
            display: block;
            color: #6b7280;
            font-size: 1rem;
            font-weight: 500;
            margin-bottom: 12px;
        }
        
        .photo-preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            justify-content: center;
            margin-top: 16px;
        }
        
        .photo-preview-item {
            position: relative;
            width: 120px;
            height: 120px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease;
        }
        
        .photo-preview-item:hover {
            transform: scale(1.05);
        }
        
        .photo-preview-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
        }
        
        .photo-remove-btn {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 24px;
            height: 24px;
            background: rgba(239, 68, 68, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        
        .photo-remove-btn:hover {
            background: rgba(220, 38, 38, 1);
            transform: scale(1.1);
        }
        
        .photo-upload-container.has-photos {
            border-color: #2563eb;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
        }
        
        .photo-upload-container.has-photos .photo-upload-text {
            color: #2563eb;
            font-weight: 600;
        }
        
        .photo-info {
            font-size: 0.75rem;
            color: #6b7280;
            margin-top: 8px;
            text-align: center;
        }
        
        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal {
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            animation: modalFadeIn 0.3s ease;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 16px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            animation: modalSlideIn 0.3s ease;
        }
        
        .modal-large {
            max-width: 1200px;
            max-height: 90vh;
        }
        
        @keyframes modalSlideIn {
            from { 
                transform: translateY(-20px) scale(0.95);
                opacity: 0;
            }
            to { 
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }
        
        .modal-header {
            background: linear-gradient(135deg, #ff6347 0%, #ff4500 100%);
            color: white;
            padding: 20px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 16px 16px 0 0;
        }
        
        .modal-header h2 {
            margin: 0;
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .modal-close {
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            padding: 4px 8px;
            border-radius: 8px;
        }
        
        .modal-close:hover {
            background-color: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }
        
        .modal-body {
            padding: 24px;
            max-height: 60vh;
            overflow-y: auto;
        }
        
        .detail-section {
            margin-bottom: 24px;
            padding: 16px;
            background: #f8fafc;
            border-radius: 12px;
            border-left: 4px solid #ff6347;
        }
        
        .detail-section h3 {
            margin: 0 0 12px 0;
            color: #1f2937;
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .detail-row {
            display: grid;
            grid-template-columns: 120px 1fr;
            gap: 12px;
            margin-bottom: 8px;
            align-items: start;
        }
        
        .detail-label {
            font-weight: 600;
            color: #4b5563;
            font-size: 0.9rem;
        }
        
        .detail-value {
            color: #1f2937;
            word-wrap: break-word;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .file-list {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 8px;
        }
        
        .file-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .file-item:hover {
            border-color: #3b82f6;
            background: #eff6ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(59, 130, 246, 0.15);
        }
        
        .file-icon {
            font-size: 1.2rem;
        }
        
        .file-info {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .file-name {
            font-weight: 500;
            font-size: 0.9rem;
            color: #1f2937;
            max-width: 150px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .file-size {
            font-size: 0.75rem;
            color: #6b7280;
        }
        
        .photo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 12px;
        }
        
        .photo-item {
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease;
            cursor: pointer;
        }
        
        .photo-item:hover {
            transform: scale(1.05);
        }
        
        .photo-thumb {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }
        
        .photo-info-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.7));
            color: white;
            padding: 12px;
            font-size: 0.8rem;
        }
        
        .clickable-row {
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        
        .clickable-row:hover {
            background-color: #f3f4f6 !important;
        }
        
        @media (max-width: 768px) {
            .modal-content {
                width: 95%;
                margin: 10% auto;
            }
            
            .detail-row {
                grid-template-columns: 1fr;
                gap: 4px;
            }
            
            .photo-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
        }
        
        /* ==================== ë°˜ì‘í˜• ë””ìì¸ ê°œì„  ==================== */
        
        /* íƒœë¸”ë¦¿ (768px ~ 1024px) */
        @media (max-width: 1024px) {
            .container {
                max-width: 100%;
                padding: 1rem;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .nav-tabs {
                flex-wrap: wrap;
                gap: 0.5rem;
            }
            
            .nav-tab {
                min-width: 120px;
                padding: 0.75rem 1rem;
                font-size: 0.9rem;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }
            
            /* ê³ ê¸‰ ê²€ìƒ‰ í•„í„° */
            #advanced-search-panel > div {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 1rem;
            }
            
            /* ê´€ë¦¬ì ì„œë¸Œ íƒ­ */
            .admin-sub-tabs {
                flex-wrap: wrap;
                gap: 0.5rem;
            }
            
            .admin-sub-tab {
                font-size: 0.8rem;
                padding: 0.5rem 1rem;
            }
        }
        
        /* ëª¨ë°”ì¼ (ìµœëŒ€ 768px) */
        @media (max-width: 768px) {
            .container {
                padding: 0.5rem;
            }
            
            .header {
                padding: 1rem;
                margin-bottom: 1rem;
            }
            
            .header h1 {
                font-size: 1.5rem;
                margin: 0 0 0.5rem 0;
            }
            
            .header p {
                font-size: 0.9rem;
            }
            
            /* ë„¤ë¹„ê²Œì´ì…˜ íƒ­ ëª¨ë°”ì¼ ìµœì í™” */
            .nav-tabs {
                flex-direction: column;
                gap: 0.5rem;
                margin-bottom: 1rem;
            }
            
            .nav-tab {
                width: 100%;
                padding: 1rem;
                font-size: 1rem;
                border-radius: 10px;
            }
            
            /* í¼ ìš”ì†Œ ëª¨ë°”ì¼ ìµœì í™” */
            .form-group input,
            .form-group select,
            .form-group textarea {
                font-size: 16px; /* iOS ì¤Œ ë°©ì§€ */
                padding: 1rem;
            }
            
            .btn {
                width: 100%;
                padding: 1rem;
                font-size: 1rem;
                margin-bottom: 0.5rem;
            }
            
            /* í†µê³„ ì¹´ë“œ ëª¨ë°”ì¼ ìµœì í™” */
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
            
            .stat-card {
                padding: 1rem;
            }
            
            .stat-number {
                font-size: 1.5rem;
            }
            
            /* í…Œì´ë¸” ëª¨ë°”ì¼ ìµœì í™” */
            .requests-table {
                font-size: 0.8rem;
            }
            
            .requests-table th,
            .requests-table td {
                padding: 0.5rem 0.25rem;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                max-width: 100px;
            }
            
            /* ê³ ê¸‰ ê²€ìƒ‰ ëª¨ë°”ì¼ ìµœì í™” */
            #advanced-search-panel > div {
                grid-template-columns: 1fr !important;
                gap: 1rem;
            }
            
            #advanced-search-panel input,
            #advanced-search-panel select {
                font-size: 16px;
                padding: 0.75rem;
            }
            
            /* ê´€ë¦¬ì ì„œë¸Œ íƒ­ ëª¨ë°”ì¼ ìµœì í™” */
            .admin-sub-tabs {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .admin-sub-tab {
                width: 100%;
                padding: 0.75rem;
                font-size: 0.9rem;
            }
            
            /* ëª¨ë‹¬ ëª¨ë°”ì¼ ìµœì í™” */
            .modal-content {
                width: 95%;
                max-width: none;
                margin: 1rem;
                max-height: 90vh;
                overflow-y: auto;
            }
            
            /* íŒŒì¼ ì—…ë¡œë“œ ì˜ì—­ ëª¨ë°”ì¼ ìµœì í™” */
            .file-upload-area {
                padding: 1.5rem 1rem;
            }
            
            .file-upload-text {
                font-size: 0.9rem;
            }
            
            /* ì‚¬ì§„ ê·¸ë¦¬ë“œ ëª¨ë°”ì¼ ìµœì í™” */
            .photo-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.5rem;
            }
            
            .photo-item {
                aspect-ratio: 1;
            }
            
            /* ê¸°ì•ˆì„œ ìƒì„± ì„¹ì…˜ ëª¨ë°”ì¼ ìµœì í™” */
            .section-title {
                font-size: 1.2rem;
            }
            
            #purchase-draft-preview,
            #facility-draft-preview {
                font-size: 0.8rem;
                padding: 1rem;
                max-height: 300px;
                overflow-y: auto;
            }
        }
        
        /* ì´ˆì†Œí˜• ëª¨ë°”ì¼ (ìµœëŒ€ 480px) */
        @media (max-width: 480px) {
            .container {
                padding: 0.25rem;
            }
            
            .header {
                padding: 0.75rem;
            }
            
            .header h1 {
                font-size: 1.25rem;
            }
            
            .form-group {
                margin-bottom: 1rem;
            }
            
            .form-group label {
                font-size: 0.9rem;
                margin-bottom: 0.5rem;
            }
            
            .requests-table th,
            .requests-table td {
                font-size: 0.7rem;
                padding: 0.25rem;
                max-width: 80px;
            }
            
            .stat-card {
                padding: 0.75rem;
            }
            
            .stat-number {
                font-size: 1.25rem;
            }
            
            .stat-label {
                font-size: 0.8rem;
            }
            
            /* ë²„íŠ¼ ê·¸ë£¹ ì„¸ë¡œ ë°°ì¹˜ */
            .btn-group {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .modal-content {
                margin: 0.5rem;
                padding: 1rem;
            }
        }
        
        /* í„°ì¹˜ ë””ë°”ì´ìŠ¤ ìµœì í™” */
        @media (hover: none) and (pointer: coarse) {
            .btn,
            .nav-tab,
            .admin-sub-tab {
                min-height: 44px; /* iOS ê¶Œì¥ í„°ì¹˜ ì˜ì—­ */
            }
            
            .requests-table tr:hover {
                background-color: transparent;
            }
            
            .requests-table tr:active {
                background-color: #f3f4f6;
            }
            
            /* ë“œë¡­ì¡´ í„°ì¹˜ ìµœì í™” */
            .file-upload-area {
                min-height: 120px;
                border-width: 3px;
            }
            
            .file-upload-area.dragover {
                background-color: #e0f2fe;
                border-color: #0284c7;
            }
        }
        
        /* ë‹¤í¬ëª¨ë“œ ì§€ì› ì¤€ë¹„ */
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-color: #1a1a1a;
                --text-color: #ffffff;
                --card-bg: #2d2d2d;
                --border-color: #444444;
            }
            
            /* ë‹¤í¬ëª¨ë“œ ìŠ¤íƒ€ì¼ì€ í•„ìš”ì‹œ ì¶”ê°€ êµ¬í˜„ */
        }
        
        /* ì¸ì‡„ ìµœì í™” */
        @media print {
            .nav-tabs,
            .btn,
            #advanced-search-panel {
                display: none !important;
            }
            
            .container {
                max-width: none;
                margin: 0;
                padding: 0;
            }
            
            .requests-table {
                font-size: 0.8rem;
            }
            
            .stat-card {
                border: 1px solid #000;
                break-inside: avoid;
            }
        }
        
        /* ==================== UX ê°œì„  - ì• ë‹ˆë©”ì´ì…˜ ë° íš¨ê³¼ ==================== */
        
        /* í˜ì´ë“œ ì¸ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 0.5rem;
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .loading-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .loading-content {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: fadeIn 0.3s ease;
        }
        
        .loading-spinner-large {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        /* ë²„íŠ¼ í˜¸ë²„ íš¨ê³¼ ê°œì„  */
        .btn {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .btn:active {
            transform: translateY(0);
            transition: all 0.1s ease;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .btn:active::before {
            width: 300px;
            height: 300px;
        }
        
        /* ì¹´ë“œ í˜¸ë²„ íš¨ê³¼ */
        .stat-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .stat-card:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
        }
        
        /* í…Œì´ë¸” í–‰ í˜¸ë²„ íš¨ê³¼ ê°œì„  */
        .requests-table tbody tr {
            transition: all 0.2s ease;
        }
        
        .requests-table tbody tr:hover {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            transform: translateX(4px);
            box-shadow: 4px 0 12px rgba(0, 0, 0, 0.1);
        }
        
        /* ì…ë ¥ í•„ë“œ í¬ì»¤ìŠ¤ íš¨ê³¼ */
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            transform: scale(1.02);
            transition: all 0.3s ease;
        }
        
        /* íƒ­ ì „í™˜ ì• ë‹ˆë©”ì´ì…˜ */
        .tab-content {
            animation: fadeIn 0.5s ease;
        }
        
        .nav-tab {
            transition: all 0.3s ease;
            position: relative;
        }
        
        .nav-tab::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 3px;
            background: currentColor;
            transition: all 0.3s ease;
            transform: translateX(-50%);
        }
        
        .nav-tab.active::after {
            width: 80%;
        }
        
        /* ì„±ê³µ/ì˜¤ë¥˜ ë©”ì‹œì§€ ì• ë‹ˆë©”ì´ì…˜ */
        .alert {
            animation: slideIn 0.5s ease;
        }
        
        .alert.success {
            animation: fadeIn 0.5s ease, pulse 0.3s ease 0.2s;
        }
        
        .alert.error {
            animation: fadeIn 0.5s ease, shake 0.5s ease 0.2s;
        }
        
        /* ëª¨ë‹¬ ì• ë‹ˆë©”ì´ì…˜ */
        .modal {
            animation: fadeIn 0.3s ease;
        }
        
        .modal-content {
            animation: fadeIn 0.4s ease;
        }
        
        /* íŒŒì¼ ì—…ë¡œë“œ ë“œë˜ê·¸ íš¨ê³¼ */
        .file-upload-area {
            transition: all 0.3s ease;
        }
        
        .file-upload-area.dragover {
            transform: scale(1.02);
            animation: pulse 1s ease infinite;
        }
        
        /* ìë™ì™„ì„± ë“œë¡­ë‹¤ìš´ ìŠ¤íƒ€ì¼ */
        .autocomplete-container {
            position: relative;
        }
        
        .autocomplete-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #e5e7eb;
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            display: none;
        }
        
        .autocomplete-dropdown.active {
            display: block;
            animation: fadeIn 0.2s ease;
        }
        
        .autocomplete-item {
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            border-bottom: 1px solid #f3f4f6;
        }
        
        .autocomplete-item:hover,
        .autocomplete-item.selected {
            background: #3b82f6;
            color: white;
        }
        
        .autocomplete-item:last-child {
            border-bottom: none;
        }
        
        /* ì§„í–‰ë¥  í‘œì‹œ */
        .progress-bar {
            width: 100%;
            height: 4px;
            background: #e5e7eb;
            border-radius: 2px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            border-radius: 2px;
            transition: width 0.3s ease;
        }
        
        /* íˆ´íŒ ìŠ¤íƒ€ì¼ */
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip::before {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #1f2937;
            color: white;
            padding: 0.5rem 0.75rem;
            border-radius: 4px;
            font-size: 0.8rem;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 1000;
            margin-bottom: 5px;
        }
        
        .tooltip::after {
            content: '';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: #1f2937;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .tooltip:hover::before,
        .tooltip:hover::after {
            opacity: 1;
            visibility: visible;
        }
        
        /* ìŠ¤ì¼ˆë ˆí†¤ ë¡œë”© */
        .skeleton {
            background: linear-gradient(90deg, #f3f4f6 25%, #e5e7eb 50%, #f3f4f6 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
        }
        
        @keyframes skeleton-loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        .skeleton-text {
            height: 1em;
            border-radius: 4px;
            margin-bottom: 0.5rem;
        }
        
        .skeleton-text:last-child {
            width: 60%;
        }
    </style>
</head>
<body>
    <!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-content">
            <div class="loading-spinner-large"></div>
            <div style="color: #374151; font-weight: 600; margin-bottom: 0.5rem;">ì²˜ë¦¬ ì¤‘...</div>
            <div style="color: #6b7280; font-size: 0.9rem;" id="loading-message">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.</div>
        </div>
    </div>

    <!-- í—¤ë” -->
    <header class="header">
        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;">
            <div>
                <h1>ğŸ¢ ì´ë¬´ì²˜ í†µí•© ìš”ì²­ ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
                <p>êµ¬ë§¤ ìš”ì²­ ë° ì‹œì„¤ ê´€ë¦¬ í†µí•© í”Œë«í¼</p>
            </div>
            <div id="sync-status" style="background: rgba(255, 255, 255, 0.1); padding: 0.5rem 1rem; border-radius: 20px; backdrop-filter: blur(10px); min-width: 150px; text-align: center;">
                <span style="color: #f59e0b;">ğŸ”„</span>
                <span style="font-size: 0.8rem; margin-left: 0.25rem;">ì—°ê²° ì¤‘...</span>
            </div>
        </div>
    </header>

    <!-- ë„¤ë¹„ê²Œì´ì…˜ íƒ­ -->
    <nav class="nav-tabs">
        <button class="nav-tab purchase-tab active" onclick="showTab('purchase')">
            <span class="emoji">ğŸ›’</span>êµ¬ë§¤ ìš”ì²­
        </button>
        <button class="nav-tab facility-tab" onclick="showTab('facility')">
            <span class="emoji">ğŸ”§</span>ì‹œì„¤ ê´€ë¦¬
        </button>
        <button class="nav-tab admin-tab" onclick="showTab('admin')" id="admin-tab">
            <span class="emoji">ğŸ‘¨â€ğŸ’¼</span>ê´€ë¦¬ì
        </button>
    </nav>

    <div class="container">
        <!-- ì•Œë¦¼ ì˜ì—­ -->
        <div id="alert-container"></div>

        <!-- êµ¬ë§¤ ìš”ì²­ íƒ­ -->
        <div id="purchase-tab" class="tab-content active">
            <h2 class="section-title">
                <span class="emoji">ğŸ›’</span>êµ¬ë§¤ ìš”ì²­
            </h2>
            
            <form id="purchase-form">
                <div class="form-grid">
                    <div class="form-group full-width">
                        <label for="purchase-title">
                            <span class="emoji">ğŸ“‹</span>ìš”ì²­ ì œëª© *
                        </label>
                        <input 
                            type="text" 
                            id="purchase-title" 
                            name="title"
                            placeholder="ì˜ˆ: ë…¸íŠ¸ë¶ êµ¬ë§¤ ìš”ì²­, ì‚¬ë¬´ìš©í’ˆ êµ¬ë§¤ ìš”ì²­"
                            required
                        />
                    </div>

                    <div class="form-group">
                        <label for="purchase-department">
                            <span class="emoji">ğŸ¢</span>ë¶€ì„œëª… *
                        </label>
                        <input 
                            type="text" 
                            id="purchase-department" 
                            name="department"
                            placeholder="ì˜ˆ: ITíŒ€, ë§ˆì¼€íŒ…íŒ€, ì´ë¬´íŒ€"
                            required
                        />
                    </div>

                    <div class="form-group">
                        <label for="purchase-requestedBy">
                            <span class="emoji">ğŸ‘¤</span>ìš”ì²­ìëª… *
                        </label>
                        <input 
                            type="text" 
                            id="purchase-requestedBy" 
                            name="requestedBy"
                            placeholder="ìš”ì²­ì ì´ë¦„"
                            required
                        />
                    </div>

                    <div class="form-group">
                        <label for="purchase-item">
                            <span class="emoji">ğŸ“¦</span>ë¬¼í’ˆëª… *
                        </label>
                        <input 
                            type="text" 
                            id="purchase-item" 
                            name="item"
                            placeholder="ì˜ˆ: ë…¸íŠ¸ë¶, ë§ˆìš°ìŠ¤, ëª¨ë‹ˆí„°"
                            required
                        />
                    </div>

                    <div class="form-group">
                        <label for="purchase-quantity">
                            <span class="emoji">ğŸ“¦</span>ìˆ˜ëŸ‰ *
                        </label>
                        <input 
                            type="text" 
                            id="purchase-quantity" 
                            name="quantity"
                            placeholder="ì˜ˆ: 5ê°œ, 1ë°•ìŠ¤, 10ì„¸íŠ¸, 1ì‹"
                            required
                        />
                    </div>

                    <div class="form-group">
                        <label for="purchase-budget">
                            <span class="emoji">ğŸ’°</span>ì˜ˆì‚° (ì›) *
                        </label>
                        <input type="text" id="purchase-budget" placeholder="ì˜ˆ: 1000000 ë˜ëŠ” 1,000,000" required pattern="[0-9,]+" title="ìˆ«ìë§Œ ì…ë ¥í•˜ì„¸ìš” (ì‰¼í‘œ ì‚¬ìš© ê°€ëŠ¥)">
                    </div>

                    <div class="form-group">
                        <label for="purchase-priority">
                            <span class="emoji">âš¡</span>ìš°ì„ ìˆœìœ„
                        </label>
                        <select id="purchase-priority" name="priority">
                            <option value="ë‚®ìŒ">ë‚®ìŒ</option>
                            <option value="ë³´í†µ" selected>ë³´í†µ</option>
                            <option value="ë†’ìŒ">ë†’ìŒ</option>
                            <option value="ê¸´ê¸‰">ê¸´ê¸‰</option>
                        </select>
                    </div>

                    <div class="form-group full-width">
                        <label for="purchase-reason">
                            <span class="emoji">ğŸ“</span>êµ¬ë§¤ ì‚¬ìœ  *
                        </label>
                        <textarea 
                            id="purchase-reason" 
                            name="reason"
                            placeholder="êµ¬ë§¤ê°€ í•„ìš”í•œ ì´ìœ ë¥¼ ìì„¸íˆ ì‘ì„±í•´ì£¼ì„¸ìš”..."
                            required
                        ></textarea>
                    </div>

                    <div class="form-group full-width">
                        <label for="purchase-quote-file">
                            <span class="emoji">ğŸ“</span>ê²¬ì ì„œ ì²¨ë¶€ (ì„ íƒ)
                            <span class="file-info">PDF, Excel, í•œê¸€ íŒŒì¼ë§Œ ê°€ëŠ¥ (ìµœëŒ€ 10MB)</span>
                        </label>
                        <div class="file-upload-container">
                            <input 
                                type="file" 
                                id="purchase-quote-file" 
                                name="quoteFile"
                                accept=".pdf,.xlsx,.xls,.hwp,.hwpx"
                                class="file-input"
                            />
                            <div class="file-upload-display">
                                <span class="file-upload-text">íŒŒì¼ì„ ì„ íƒí•˜ê±°ë‚˜ ë“œë˜ê·¸í•˜ì—¬ ì—…ë¡œë“œ</span>
                                <span class="file-name" id="selected-file-name"></span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button type="submit" class="btn btn-primary btn-full">
                    <span class="emoji">âœ…</span>êµ¬ë§¤ ìš”ì²­ ì œì¶œ
                </button>
            </form>
            
            <!-- êµ¬ë§¤ ìš”ì²­ ê¸°ì•ˆì„œ ìƒì„± ì„¹ì…˜ -->
            <div style="margin-top: 3rem; background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); padding: 2rem; border-radius: 20px; border: 3px solid #2563eb; box-shadow: 0 8px 32px rgba(37, 99, 235, 0.2);">
                <h3 class="section-title">
                    <span class="emoji">ğŸ“</span>ê¸°ì•ˆì„œ ìë™ ìƒì„±
                    <span style="font-size: 0.8rem; color: #6b7280; font-weight: normal; margin-left: 1rem;">ìœ„ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ê¸°ì•ˆì„œë¥¼ ìƒì„±í•©ë‹ˆë‹¤</span>
                </h3>
                
                <div style="background: rgba(37, 99, 235, 0.1); padding: 1rem; border-radius: 8px; margin-bottom: 2rem; border-left: 4px solid #2563eb;">
                    <div style="color: #1e40af; font-size: 0.9rem; line-height: 1.6;">
                        ğŸ’¡ <strong>Tip:</strong> ìƒì„±ëœ ê¸°ì•ˆì„œê°€ ë§ˆìŒì— ë“¤ì§€ ì•Šìœ¼ì‹œë‚˜ìš”? ê´€ë¦¬ìì—ê²Œ ê°œì„  ìš”ì²­ì„ í•˜ì‹œë©´ ë‹¤ìŒë¶€í„° ë” ë‚˜ì€ ê¸°ì•ˆì„œê°€ ìƒì„±ë©ë‹ˆë‹¤!
                        <br>ì˜ˆ: "ê²¬ì ì„œ ì²¨ë¶€ ë‚´ìš© ì œì™¸í•´ì£¼ì„¸ìš”", "ë” ê°„ë‹¨í•˜ê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”"
                    </div>
                </div>
                
                <div style="display: flex; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap;">
                    <button onclick="generatePurchaseDraft()" class="btn" style="background: #2563eb; color: white; padding: 0.75rem 1.5rem;">
                        <span class="emoji">âš¡</span>ê¸°ì•ˆì„œ ìƒì„±
                    </button>
                    
                    <button onclick="copyPurchaseDraftToClipboard()" class="btn" style="background: #059669; color: white; padding: 0.75rem 1.5rem;">
                        <span class="emoji">ğŸ“‹</span>í´ë¦½ë³´ë“œ ë³µì‚¬
                    </button>
                    
                    <button onclick="clearPurchaseDraft()" class="btn" style="background: #6b7280; color: white; padding: 0.75rem 1.5rem;">
                        <span class="emoji">ğŸ—‘ï¸</span>ì´ˆê¸°í™”
                    </button>
                </div>
                
                <div id="purchase-draft-preview" style="border: 2px solid #e5e7eb; border-radius: 8px; padding: 2rem; min-height: 300px; white-space: pre-wrap; font-family: 'Malgun Gothic', sans-serif; line-height: 1.8; background: white;">
                    ìœ„ì˜ "ê¸°ì•ˆì„œ ìƒì„±" ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ì…ë ¥í•˜ì‹  êµ¬ë§¤ ìš”ì²­ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ê¸°ì•ˆì„œê°€ ìë™ ìƒì„±ë©ë‹ˆë‹¤.
                </div>
            </div>
        </div>

        <!-- ì‹œì„¤ ê´€ë¦¬ íƒ­ -->
        <div id="facility-tab" class="tab-content">
            <h2 class="section-title">
                <span class="emoji">ğŸ”§</span>ì‹œì„¤ ê´€ë¦¬ ìš”ì²­
            </h2>
            
            <form id="facility-form">
                <div class="form-grid">
                    <div class="form-group full-width">
                        <label for="facility-title">
                            <span class="emoji">ğŸ“‹</span>ìš”ì²­ ì œëª© *
                        </label>
                        <input 
                            type="text" 
                            id="facility-title" 
                            name="title"
                            placeholder="ì‹œì„¤ ê´€ë¦¬ ìš”ì²­ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"
                            required
                        />
                    </div>
                    
                    <div class="form-group">
                        <label for="facility-type">
                            <span class="emoji">ğŸ—ï¸</span>ì‹œì„¤ ìœ í˜• *
                        </label>
                        <select id="facility-type" name="facilityType" required>
                            <option value="">ì‹œì„¤ ìœ í˜• ì„ íƒ</option>
                            <option value="ì „ê¸°ì„¤ë¹„">ì „ê¸°ì„¤ë¹„</option>
                            <option value="ëƒ‰ë‚œë°©">ëƒ‰ë‚œë°©</option>
                            <option value="ê¸‰ë°°ìˆ˜">ê¸‰ë°°ìˆ˜</option>
                            <option value="í†µì‹ ì„¤ë¹„">í†µì‹ ì„¤ë¹„</option>
                            <option value="ë³´ì•ˆì„¤ë¹„">ë³´ì•ˆì„¤ë¹„</option>
                            <option value="ê±´ì¶•ë¬¼">ê±´ì¶•ë¬¼</option>
                            <option value="ì¡°ê²½">ì¡°ê²½</option>
                            <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="facility-priority">
                            <span class="emoji">âš¡</span>ìš°ì„ ìˆœìœ„
                        </label>
                        <select id="facility-priority" name="priority">
                            <option value="ë‚®ìŒ">ë‚®ìŒ</option>
                            <option value="ë³´í†µ" selected>ë³´í†µ</option>
                            <option value="ë†’ìŒ">ë†’ìŒ</option>
                            <option value="ê¸´ê¸‰">ê¸´ê¸‰</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="facility-requestedBy">
                            <span class="emoji">ğŸ‘¤</span>ìš”ì²­ìëª… *
                        </label>
                        <input 
                            type="text" 
                            id="facility-requestedBy" 
                            name="requestedBy"
                            placeholder="ìš”ì²­ì ì´ë¦„"
                            required
                        />
                    </div>
                    
                    <div class="form-group">
                        <label for="facility-department">
                            <span class="emoji">ğŸ¢</span>ì†Œì† ë¶€ì„œ *
                        </label>
                        <input 
                            type="text" 
                            id="facility-department" 
                            name="department"
                            placeholder="ì†Œì† ë¶€ì„œëª…"
                            required
                        />
                    </div>
                    
                    <div class="form-group">
                        <label for="facility-phone">
                            <span class="emoji">ğŸ“</span>ì—°ë½ì²˜
                        </label>
                        <input 
                            type="tel" 
                            id="facility-phone" 
                            name="phone"
                            placeholder="010-0000-0000"
                        />
                    </div>
                    
                    <div class="form-group">
                        <label for="facility-location">
                            <span class="emoji">ğŸ“</span>ìœ„ì¹˜
                        </label>
                        <input 
                            type="text" 
                            id="facility-location" 
                            name="location"
                            placeholder="ê±´ë¬¼ëª…, ì¸µìˆ˜, í˜¸ì‹¤ ë“±"
                        />
                    </div>
                    
                    <div class="form-group full-width">
                        <label for="facility-description">
                            <span class="emoji">ğŸ“</span>ìƒì„¸ ì„¤ëª… *
                        </label>
                        <textarea 
                            id="facility-description" 
                            name="description"
                            placeholder="ì‹œì„¤ ê´€ë¦¬ ìš”ì²­ì— ëŒ€í•œ ìƒì„¸í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"
                            required
                        ></textarea>
                    </div>

                    <div class="form-group full-width">
                        <label for="facility-photo">
                            <span class="emoji">ğŸ“·</span>ì‹œì„¤ ì‚¬ì§„ ì²¨ë¶€ (ì„ íƒ)
                            <span class="file-info">JPG, PNG, GIF íŒŒì¼ë§Œ ê°€ëŠ¥ (ìµœëŒ€ 5MB, ìµœëŒ€ 3ê°œ)</span>
                        </label>
                        <div class="photo-upload-container">
                            <input 
                                type="file" 
                                id="facility-photo" 
                                name="facilityPhotos"
                                accept="image/jpeg,image/jpg,image/png,image/gif"
                                class="photo-input"
                                multiple
                                maxlength="3"
                            />
                            <div class="photo-upload-display">
                                <span class="photo-upload-text">ğŸ“· ì‚¬ì§„ì„ ì„ íƒí•˜ê±°ë‚˜ ë“œë˜ê·¸í•˜ì—¬ ì—…ë¡œë“œ (ìµœëŒ€ 3ê°œ)</span>
                                <div class="photo-preview-container" id="facility-photo-preview"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button type="submit" class="btn btn-primary btn-full">
                    <span class="emoji">ğŸ“¤</span>ì‹œì„¤ ê´€ë¦¬ ìš”ì²­ ì œì¶œ
                </button>
            </form>
            
            <!-- ì‹œì„¤ ê´€ë¦¬ ê¸°ì•ˆì„œ ìƒì„± ì„¹ì…˜ -->
            <div style="margin-top: 3rem; background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); padding: 2rem; border-radius: 20px; border: 3px solid #22c55e; box-shadow: 0 8px 32px rgba(34, 197, 94, 0.2);">
                <h3 class="section-title">
                    <span class="emoji">ğŸ“</span>ê¸°ì•ˆì„œ ìë™ ìƒì„±
                    <span style="font-size: 0.8rem; color: #6b7280; font-weight: normal; margin-left: 1rem;">ìœ„ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ê¸°ì•ˆì„œë¥¼ ìƒì„±í•©ë‹ˆë‹¤</span>
                </h3>
                
                <div style="background: rgba(34, 197, 94, 0.1); padding: 1rem; border-radius: 8px; margin-bottom: 2rem; border-left: 4px solid #22c55e;">
                    <div style="color: #166534; font-size: 0.9rem; line-height: 1.6;">
                        ğŸ’¡ <strong>Tip:</strong> ìƒì„±ëœ ê¸°ì•ˆì„œê°€ ë§ˆìŒì— ë“¤ì§€ ì•Šìœ¼ì‹œë‚˜ìš”? ê´€ë¦¬ìì—ê²Œ ê°œì„  ìš”ì²­ì„ í•˜ì‹œë©´ ë‹¤ìŒë¶€í„° ë” ë‚˜ì€ ê¸°ì•ˆì„œê°€ ìƒì„±ë©ë‹ˆë‹¤!
                        <br>ì˜ˆ: "ë” ê°„ë‹¨í•˜ê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”", "ê¸´ê¸‰ì„± ë¬¸êµ¬ë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”"
                    </div>
                </div>
                
                <div style="display: flex; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap;">
                    <button onclick="generateFacilityDraft()" class="btn" style="background: #22c55e; color: white; padding: 0.75rem 1.5rem;">
                        <span class="emoji">âš¡</span>ê¸°ì•ˆì„œ ìƒì„±
                    </button>
                    
                    <button onclick="copyFacilityDraftToClipboard()" class="btn" style="background: #059669; color: white; padding: 0.75rem 1.5rem;">
                        <span class="emoji">ğŸ“‹</span>í´ë¦½ë³´ë“œ ë³µì‚¬
                    </button>
                    
                    <button onclick="clearFacilityDraft()" class="btn" style="background: #6b7280; color: white; padding: 0.75rem 1.5rem;">
                        <span class="emoji">ğŸ—‘ï¸</span>ì´ˆê¸°í™”
                    </button>
                </div>
                
                <div id="facility-draft-preview" style="border: 2px solid #e5e7eb; border-radius: 8px; padding: 2rem; min-height: 300px; white-space: pre-wrap; font-family: 'Malgun Gothic', sans-serif; line-height: 1.8; background: white;">
                    ìœ„ì˜ "ê¸°ì•ˆì„œ ìƒì„±" ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ì…ë ¥í•˜ì‹  ì‹œì„¤ ê´€ë¦¬ ìš”ì²­ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ê¸°ì•ˆì„œê°€ ìë™ ìƒì„±ë©ë‹ˆë‹¤.
                </div>
            </div>
        </div>

        <!-- ê´€ë¦¬ì íƒ­ -->
        <div id="admin-tab-content" class="tab-content">
            <!-- ë¡œê·¸ì¸ í¼ -->
            <div id="admin-login" class="login-form">
                <h2 class="section-title" style="justify-content: center;">
                    <span class="emoji">ğŸ‘¨â€ğŸ’¼</span>ê´€ë¦¬ì ë¡œê·¸ì¸
                </h2>
                
                <form id="admin-form">
                    <div class="form-group">
                        <label for="admin-username">
                            <span class="emoji">ğŸ†”</span>ì•„ì´ë””
                        </label>
                        <input 
                            type="text" 
                            id="admin-username" 
                            name="username"
                            placeholder="ê´€ë¦¬ì ì•„ì´ë””"
                            required
                        />
                    </div>
                    
                    <div class="form-group">
                        <label for="admin-password">
                            <span class="emoji">ğŸ”</span>ë¹„ë°€ë²ˆí˜¸
                        </label>
                        <input 
                            type="password" 
                            id="admin-password" 
                            name="password"
                            placeholder="ë¹„ë°€ë²ˆí˜¸"
                            required
                        />
                    </div>
                    
                    <button type="submit" class="btn btn-primary btn-full">
                        <span class="emoji">ğŸ”‘</span>ë¡œê·¸ì¸
                    </button>
                </form>
                
            </div>
            
                            <!-- ê´€ë¦¬ì íŒ¨ë„ -->
            <div id="admin-panel" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;">
                    <h2 class="section-title" style="margin-bottom: 0;">
                        <span class="emoji">ğŸ‘¨â€ğŸ’¼</span>ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ
                    </h2>
                    <button class="btn btn-danger" onclick="logout()">
                        <span class="emoji">ğŸšª</span>ë¡œê·¸ì•„ì›ƒ
                    </button>
                </div>
                
                <!-- ê´€ë¦¬ì í•˜ìœ„ íƒ­ -->
                <div class="nav-tabs" style="margin-bottom: 2rem; border-radius: 15px; overflow: hidden; background: linear-gradient(135deg, #fef7ed, #fed7aa); border: 2px solid #fdba74; box-shadow: 0 8px 32px rgba(251, 146, 60, 0.2);">
                    <button class="nav-tab admin-sub-tab active" onclick="showAdminTab('all', this)" style="background: linear-gradient(135deg, #fb923c, #f97316); color: white; font-weight: 700; border: 2px solid #ea580c;">
                        <span class="emoji" style="background: rgba(255,255,255,0.2); padding: 0.3rem; border-radius: 8px; margin-right: 0.5rem;">ğŸ“Š</span>ì „ì²´ í˜„í™©
                    </button>
                    <button class="nav-tab admin-sub-tab" onclick="showAdminTab('purchase', this)" style="color: #9a3412; font-weight: 600;">
                        <span class="emoji" style="background: rgba(34, 197, 94, 0.1); padding: 0.3rem; border-radius: 8px; margin-right: 0.5rem;">ğŸ›’</span>êµ¬ë§¤ ìš”ì²­
                    </button>
                    <button class="nav-tab admin-sub-tab" onclick="showAdminTab('facility', this)" style="color: #9a3412; font-weight: 600;">
                        <span class="emoji" style="background: rgba(37, 99, 235, 0.1); padding: 0.3rem; border-radius: 8px; margin-right: 0.5rem;">ğŸ”§</span>ì‹œì„¤ ê´€ë¦¬
                    </button>
                    <button class="nav-tab admin-sub-tab" onclick="showAdminTab('template', this)" style="color: #9a3412; font-weight: 600;">
                        <span class="emoji" style="background: rgba(168, 85, 247, 0.1); padding: 0.3rem; border-radius: 8px; margin-right: 0.5rem;">ğŸ“</span>ê¸°ì•ˆì„œ í…œí”Œë¦¿
                    </button>
                </div>

                <!-- ì „ì²´ í˜„í™© íƒ­ -->
                <div id="admin-all-tab" class="admin-tab-content" style="display: block;">
                    <!-- ì „ì²´ í†µê³„ ì¹´ë“œ -->
                    <div class="stats-grid">
                        <div class="stat-card stat-waiting">
                            <div class="stat-number" id="stat-all-waiting">0</div>
                            <div class="stat-label">ì „ì²´ ëŒ€ê¸°</div>
                        </div>
                        <div class="stat-card stat-progress">
                            <div class="stat-number" id="stat-all-progress">0</div>
                            <div class="stat-label">ì „ì²´ ì§„í–‰ì¤‘</div>
                        </div>
                        <div class="stat-card stat-completed">
                            <div class="stat-number" id="stat-all-completed">0</div>
                            <div class="stat-label">ì „ì²´ ì™„ë£Œ</div>
                        </div>
                        <div class="stat-card stat-cancelled">
                            <div class="stat-number" id="stat-all-cancelled">0</div>
                            <div class="stat-label">ì „ì²´ ì·¨ì†Œ</div>
                        </div>
                    </div>

                    <!-- ê³ ê¸‰ ê²€ìƒ‰ ë° í•„í„°ë§ -->
                    <div style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); padding: 2rem; border-radius: 20px; border: 3px solid #64748b; box-shadow: 0 8px 32px rgba(100, 116, 139, 0.2); margin-bottom: 2rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                            <h3 style="color: #1e293b; font-size: 1.4rem; font-weight: 700; margin: 0;">
                                <span class="emoji" style="background: rgba(100, 116, 139, 0.1); padding: 0.3rem; border-radius: 8px; margin-right: 0.5rem;">ğŸ”</span>ê³ ê¸‰ ê²€ìƒ‰ ë° í•„í„°ë§
                            </h3>
                            <button onclick="toggleAdvancedSearch()" class="btn" style="background: #64748b; color: white; padding: 0.5rem 1rem; font-size: 0.9rem;">
                                <span id="search-toggle-text">í•„í„° ì—´ê¸°</span>
                            </button>
                        </div>
                        
                        <div id="advanced-search-panel" style="display: none;">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem;">
                                <!-- ë¶€ì„œë³„ í•„í„° -->
                                <div>
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">
                                        ğŸ¢ ë¶€ì„œë³„ í•„í„°
                                    </label>
                                    <select id="filter-department" style="width: 100%; padding: 0.75rem; border-radius: 8px; border: 2px solid #d1d5db;">
                                        <option value="">ì „ì²´ ë¶€ì„œ</option>
                                        <option value="ITíŒ€">ITíŒ€</option>
                                        <option value="ë§ˆì¼€íŒ…íŒ€">ë§ˆì¼€íŒ…íŒ€</option>
                                        <option value="ì´ë¬´íŒ€">ì´ë¬´íŒ€</option>
                                        <option value="ì¸ì‚¬íŒ€">ì¸ì‚¬íŒ€</option>
                                        <option value="ì˜ì—…íŒ€">ì˜ì—…íŒ€</option>
                                        <option value="ê¸°íšíŒ€">ê¸°íšíŒ€</option>
                                    </select>
                                </div>
                                
                                <!-- ë‹´ë‹¹ìë³„ í•„í„° -->
                                <div>
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">
                                        ğŸ‘¤ ë‹´ë‹¹ìë³„ í•„í„°
                                    </label>
                                    <input type="text" id="filter-requester" placeholder="ë‹´ë‹¹ìëª… ì…ë ¥" style="width: 100%; padding: 0.75rem; border-radius: 8px; border: 2px solid #d1d5db;">
                                </div>
                                
                                <!-- ìƒíƒœë³„ í•„í„° -->
                                <div>
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">
                                        ğŸ“Š ìƒíƒœë³„ í•„í„°
                                    </label>
                                    <select id="filter-status" style="width: 100%; padding: 0.75rem; border-radius: 8px; border: 2px solid #d1d5db;">
                                        <option value="">ì „ì²´ ìƒíƒœ</option>
                                        <option value="ëŒ€ê¸°">ëŒ€ê¸°</option>
                                        <option value="ì§„í–‰ì¤‘">ì§„í–‰ì¤‘</option>
                                        <option value="ì™„ë£Œ">ì™„ë£Œ</option>
                                        <option value="ì·¨ì†Œ">ì·¨ì†Œ</option>
                                        <option value="ë³´ë¥˜">ë³´ë¥˜</option>
                                    </select>
                                </div>
                                
                                <!-- ìš°ì„ ìˆœìœ„ í•„í„° -->
                                <div>
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">
                                        âš¡ ìš°ì„ ìˆœìœ„ í•„í„°
                                    </label>
                                    <select id="filter-priority" style="width: 100%; padding: 0.75rem; border-radius: 8px; border: 2px solid #d1d5db;">
                                        <option value="">ì „ì²´ ìš°ì„ ìˆœìœ„</option>
                                        <option value="ê¸´ê¸‰">ê¸´ê¸‰</option>
                                        <option value="ë†’ìŒ">ë†’ìŒ</option>
                                        <option value="ë³´í†µ">ë³´í†µ</option>
                                        <option value="ë‚®ìŒ">ë‚®ìŒ</option>
                                    </select>
                                </div>
                                
                                <!-- ì˜ˆì‚° ë²”ìœ„ í•„í„° -->
                                <div>
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">
                                        ğŸ’° ì˜ˆì‚° ë²”ìœ„ (ì›)
                                    </label>
                                    <div style="display: grid; grid-template-columns: 1fr auto 1fr; gap: 0.5rem; align-items: center;">
                                        <input type="number" id="filter-budget-min" placeholder="ìµœì†Œ ê¸ˆì•¡" style="padding: 0.5rem; border-radius: 6px; border: 2px solid #d1d5db;">
                                        <span style="color: #6b7280;">~</span>
                                        <input type="number" id="filter-budget-max" placeholder="ìµœëŒ€ ê¸ˆì•¡" style="padding: 0.5rem; border-radius: 6px; border: 2px solid #d1d5db;">
                                    </div>
                                </div>
                                
                                <!-- ë‚ ì§œ ë²”ìœ„ í•„í„° -->
                                <div>
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">
                                        ğŸ“… ë“±ë¡ì¼ ë²”ìœ„
                                    </label>
                                    <div style="display: grid; grid-template-columns: 1fr auto 1fr; gap: 0.5rem; align-items: center;">
                                        <input type="date" id="filter-date-start" style="padding: 0.5rem; border-radius: 6px; border: 2px solid #d1d5db;">
                                        <span style="color: #6b7280;">~</span>
                                        <input type="date" id="filter-date-end" style="padding: 0.5rem; border-radius: 6px; border: 2px solid #d1d5db;">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- ê²€ìƒ‰ ë° ì´ˆê¸°í™” ë²„íŠ¼ -->
                            <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                                <button onclick="applyAdvancedFilters()" class="btn" style="background: #3b82f6; color: white; padding: 0.75rem 2rem;">
                                    <span class="emoji">ğŸ”</span>ê²€ìƒ‰ ì ìš©
                                </button>
                                <button onclick="resetAdvancedFilters()" class="btn" style="background: #6b7280; color: white; padding: 0.75rem 2rem;">
                                    <span class="emoji">ğŸ”„</span>í•„í„° ì´ˆê¸°í™”
                                </button>
                                <button onclick="exportFilteredData()" class="btn" style="background: #059669; color: white; padding: 0.75rem 2rem;">
                                    <span class="emoji">ğŸ“Š</span>í•„í„°ëœ ë°ì´í„° Excel ë‚´ë³´ë‚´ê¸°
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- ìœ í˜•ë³„ í†µê³„ -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 2rem; margin-bottom: 2.5rem;">
                        <div style="background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); padding: 2rem; border-radius: 20px; border: 3px solid #22c55e; box-shadow: 0 8px 32px rgba(34, 197, 94, 0.2); transition: transform 0.3s ease;" onmouseover="this.style.transform='translateY(-4px)'" onmouseout="this.style.transform='translateY(0)'">
                            <div style="display: flex; align-items: center; margin-bottom: 1.5rem;">
                                <div style="background: linear-gradient(135deg, #22c55e, #16a34a); width: 60px; height: 60px; border-radius: 15px; display: flex; align-items: center; justify-content: center; margin-right: 1rem; box-shadow: 0 4px 15px rgba(34, 197, 94, 0.3);">
                                    <span style="font-size: 1.8rem;">ğŸ›’</span>
                                </div>
                                <div>
                                    <h4 style="color: #15803d; font-size: 1.3rem; font-weight: 700; margin: 0;">êµ¬ë§¤ ìš”ì²­ í˜„í™©</h4>
                                    <p style="color: #059669; font-size: 0.9rem; margin: 0; margin-top: 0.25rem;">Purchase Requests Status</p>
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                                <div style="background: white; padding: 1rem; border-radius: 12px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                                    <div style="color: #6b7280; font-size: 0.8rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">ëŒ€ê¸°</div>
                                    <div style="color: #15803d; font-size: 1.5rem; font-weight: 700; margin-top: 0.25rem;" id="purchase-waiting">0</div>
                                </div>
                                <div style="background: white; padding: 1rem; border-radius: 12px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                                    <div style="color: #6b7280; font-size: 0.8rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">ì§„í–‰ì¤‘</div>
                                    <div style="color: #15803d; font-size: 1.5rem; font-weight: 700; margin-top: 0.25rem;" id="purchase-progress">0</div>
                                </div>
                                <div style="background: white; padding: 1rem; border-radius: 12px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                                    <div style="color: #6b7280; font-size: 0.8rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">ì™„ë£Œ</div>
                                    <div style="color: #15803d; font-size: 1.5rem; font-weight: 700; margin-top: 0.25rem;" id="purchase-completed">0</div>
                                </div>
                                <div style="background: white; padding: 1rem; border-radius: 12px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                                    <div style="color: #6b7280; font-size: 0.8rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">ì·¨ì†Œ</div>
                                    <div style="color: #15803d; font-size: 1.5rem; font-weight: 700; margin-top: 0.25rem;" id="purchase-cancelled">0</div>
                                </div>
                            </div>
                        </div>
                        
                        <div style="background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); padding: 2rem; border-radius: 20px; border: 3px solid #2563eb; box-shadow: 0 8px 32px rgba(37, 99, 235, 0.2); transition: transform 0.3s ease;" onmouseover="this.style.transform='translateY(-4px)'" onmouseout="this.style.transform='translateY(0)'">
                            <div style="display: flex; align-items: center; margin-bottom: 1.5rem;">
                                <div style="background: linear-gradient(135deg, #2563eb, #1d4ed8); width: 60px; height: 60px; border-radius: 15px; display: flex; align-items: center; justify-content: center; margin-right: 1rem; box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);">
                                    <span style="font-size: 1.8rem;">ğŸ”§</span>
                                </div>
                                <div>
                                    <h4 style="color: #1e40af; font-size: 1.3rem; font-weight: 700; margin: 0;">ì‹œì„¤ ê´€ë¦¬ í˜„í™©</h4>
                                    <p style="color: #2563eb; font-size: 0.9rem; margin: 0; margin-top: 0.25rem;">Facility Management Status</p>
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                                <div style="background: white; padding: 1rem; border-radius: 12px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                                    <div style="color: #6b7280; font-size: 0.8rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">ëŒ€ê¸°</div>
                                    <div style="color: #1e40af; font-size: 1.5rem; font-weight: 700; margin-top: 0.25rem;" id="facility-waiting">0</div>
                                </div>
                                <div style="background: white; padding: 1rem; border-radius: 12px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                                    <div style="color: #6b7280; font-size: 0.8rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">ì§„í–‰ì¤‘</div>
                                    <div style="color: #1e40af; font-size: 1.5rem; font-weight: 700; margin-top: 0.25rem;" id="facility-progress">0</div>
                                </div>
                                <div style="background: white; padding: 1rem; border-radius: 12px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                                    <div style="color: #6b7280; font-size: 0.8rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">ì™„ë£Œ</div>
                                    <div style="color: #1e40af; font-size: 1.5rem; font-weight: 700; margin-top: 0.25rem;" id="facility-completed">0</div>
                                </div>
                                <div style="background: white; padding: 1rem; border-radius: 12px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                                    <div style="color: #6b7280; font-size: 0.8rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">ì·¨ì†Œ</div>
                                    <div style="color: #1e40af; font-size: 1.5rem; font-weight: 700; margin-top: 0.25rem;" id="facility-cancelled">0</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ì „ì²´ ìš”ì²­ ëª©ë¡ -->
                    <div>
                        <h3 class="section-title">
                            <span class="emoji">ğŸ“‹</span>ì „ì²´ ìš”ì²­ ëª©ë¡
                        </h3>
                        
                        <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; align-items: center; flex-wrap: wrap;">
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <label for="all-status-filter" style="margin-bottom: 0; font-weight: 600;">ìƒíƒœ í•„í„°:</label>
                                <select id="all-status-filter" onchange="loadAllRequests()" style="padding: 0.5rem; border-radius: 6px;">
                                    <option value="">ì „ì²´</option>
                                    <option value="ëŒ€ê¸°">ëŒ€ê¸°</option>
                                    <option value="ì§„í–‰ì¤‘">ì§„í–‰ì¤‘</option>
                                    <option value="ì™„ë£Œ">ì™„ë£Œ</option>
                                    <option value="ì·¨ì†Œ">ì·¨ì†Œ</option>
                                </select>
                            </div>
                            
                            <button class="btn" onclick="loadAllRequests()" style="background: #6b7280; color: white; padding: 0.5rem 1rem; font-size: 0.9rem;">
                                <span class="emoji">ğŸ”„</span>ìƒˆë¡œê³ ì¹¨
                            </button>
                            
                            <button class="btn" onclick="exportToExcel('all')" style="background: #059669; color: white; padding: 0.5rem 1rem; font-size: 0.9rem;">
                                <span class="emoji">ğŸ“Š</span>Excel ë‹¤ìš´ë¡œë“œ
                            </button>
                        </div>
                        
                        <table class="requests-table">
                            <thead>
                                <tr>
                                    <th>ìœ í˜•</th>
                                    <th>ì œëª©/ë¬¼í’ˆ</th>
                                    <th>ìˆ˜ëŸ‰</th>
                                    <th>ì˜ˆì‚°</th>
                                    <th>ìš°ì„ ìˆœìœ„</th>
                                    <th>ìƒíƒœ</th>
                                    <th>ìš”ì²­ì</th>
                                    <th>ë¶€ì„œ</th>
                                    <th>ë“±ë¡ì¼</th>
                                    <th>ê´€ë¦¬</th>
                                </tr>
                            </thead>
                            <tbody id="all-requests-tbody">
                                <!-- ë™ì ìœ¼ë¡œ ìƒì„± -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- êµ¬ë§¤ ìš”ì²­ íƒ­ -->
                <div id="admin-purchase-tab" class="admin-tab-content" style="display: none;">
                    <!-- êµ¬ë§¤ ìš”ì²­ í†µê³„ -->
                    <div class="stats-grid">
                        <div class="stat-card stat-waiting">
                            <div class="stat-number" id="stat-purchase-waiting">0</div>
                            <div class="stat-label">ëŒ€ê¸° ì¤‘</div>
                        </div>
                        <div class="stat-card stat-progress">
                            <div class="stat-number" id="stat-purchase-progress">0</div>
                            <div class="stat-label">ì§„í–‰ ì¤‘</div>
                        </div>
                        <div class="stat-card stat-completed">
                            <div class="stat-number" id="stat-purchase-completed">0</div>
                            <div class="stat-label">ì™„ë£Œ</div>
                        </div>
                        <div class="stat-card stat-cancelled">
                            <div class="stat-number" id="stat-purchase-cancelled">0</div>
                            <div class="stat-label">ì·¨ì†Œ</div>
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="section-title">
                            <span class="emoji">ğŸ›’</span>êµ¬ë§¤ ìš”ì²­ ëª©ë¡
                        </h3>
                        
                        <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; align-items: center; flex-wrap: wrap;">
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <label for="purchase-status-filter" style="margin-bottom: 0; font-weight: 600;">ìƒíƒœ í•„í„°:</label>
                                <select id="purchase-status-filter" onchange="loadPurchaseRequests()" style="padding: 0.5rem; border-radius: 6px;">
                                    <option value="">ì „ì²´</option>
                                    <option value="ëŒ€ê¸°">ëŒ€ê¸°</option>
                                    <option value="ì§„í–‰ì¤‘">ì§„í–‰ì¤‘</option>
                                    <option value="ì™„ë£Œ">ì™„ë£Œ</option>
                                    <option value="ì·¨ì†Œ">ì·¨ì†Œ</option>
                                </select>
                            </div>
                            
                            <button class="btn" onclick="loadPurchaseRequests()" style="background: #6b7280; color: white; padding: 0.5rem 1rem; font-size: 0.9rem;">
                                <span class="emoji">ğŸ”„</span>ìƒˆë¡œê³ ì¹¨
                            </button>
                            
                            <button class="btn" onclick="exportToExcel('purchase')" style="background: #22c55e; color: white; padding: 0.5rem 1rem; font-size: 0.9rem;">
                                <span class="emoji">ğŸ“Š</span>Excel ë‹¤ìš´ë¡œë“œ
                            </button>
                        </div>
                        
                        <table class="requests-table">
                            <thead>
                                <tr>
                                    <th>ìš”ì²­ ì œëª©</th>
                                    <th>ë¬¼í’ˆëª…</th>
                                    <th>ìˆ˜ëŸ‰</th>
                                    <th>ì˜ˆì‚° (ì›)</th>
                                    <th>ìš°ì„ ìˆœìœ„</th>
                                    <th>ìƒíƒœ</th>
                                    <th>ìš”ì²­ì</th>
                                    <th>ë¶€ì„œ</th>
                                    <th>êµ¬ë§¤ ì‚¬ìœ </th>
                                    <th>ê²¬ì ì„œ</th>
                                    <th>ë“±ë¡ì¼</th>
                                    <th>ê´€ë¦¬</th>
                                </tr>
                            </thead>
                            <tbody id="purchase-requests-tbody">
                                <!-- ë™ì ìœ¼ë¡œ ìƒì„± -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- ì‹œì„¤ ê´€ë¦¬ íƒ­ -->
                <div id="admin-facility-tab" class="admin-tab-content" style="display: none;">
                    <!-- ì‹œì„¤ ê´€ë¦¬ í†µê³„ -->
                    <div class="stats-grid">
                        <div class="stat-card stat-waiting">
                            <div class="stat-number" id="stat-facility-waiting">0</div>
                            <div class="stat-label">ëŒ€ê¸° ì¤‘</div>
                        </div>
                        <div class="stat-card stat-progress">
                            <div class="stat-number" id="stat-facility-progress">0</div>
                            <div class="stat-label">ì§„í–‰ ì¤‘</div>
                        </div>
                        <div class="stat-card stat-completed">
                            <div class="stat-number" id="stat-facility-completed">0</div>
                            <div class="stat-label">ì™„ë£Œ</div>
                        </div>
                        <div class="stat-card stat-cancelled">
                            <div class="stat-number" id="stat-facility-cancelled">0</div>
                            <div class="stat-label">ì·¨ì†Œ</div>
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="section-title">
                            <span class="emoji">ğŸ”§</span>ì‹œì„¤ ê´€ë¦¬ ìš”ì²­ ëª©ë¡
                        </h3>
                        
                        <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; align-items: center; flex-wrap: wrap;">
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <label for="facility-status-filter" style="margin-bottom: 0; font-weight: 600;">ìƒíƒœ í•„í„°:</label>
                                <select id="facility-status-filter" onchange="loadFacilityRequests()" style="padding: 0.5rem; border-radius: 6px;">
                                    <option value="">ì „ì²´</option>
                                    <option value="ëŒ€ê¸°">ëŒ€ê¸°</option>
                                    <option value="ì§„í–‰ì¤‘">ì§„í–‰ì¤‘</option>
                                    <option value="ì™„ë£Œ">ì™„ë£Œ</option>
                                    <option value="ì·¨ì†Œ">ì·¨ì†Œ</option>
                                </select>
                            </div>
                            
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <label for="facility-priority-filter" style="margin-bottom: 0; font-weight: 600;">ìš°ì„ ìˆœìœ„ í•„í„°:</label>
                                <select id="facility-priority-filter" onchange="loadFacilityRequests()" style="padding: 0.5rem; border-radius: 6px;">
                                    <option value="">ì „ì²´</option>
                                    <option value="ê¸´ê¸‰">ê¸´ê¸‰</option>
                                    <option value="ë†’ìŒ">ë†’ìŒ</option>
                                    <option value="ë³´í†µ">ë³´í†µ</option>
                                    <option value="ë‚®ìŒ">ë‚®ìŒ</option>
                                </select>
                            </div>
                            
                            <button class="btn" onclick="loadFacilityRequests()" style="background: #6b7280; color: white; padding: 0.5rem 1rem; font-size: 0.9rem;">
                                <span class="emoji">ğŸ”„</span>ìƒˆë¡œê³ ì¹¨
                            </button>
                            
                            <button class="btn" onclick="exportToExcel('facility')" style="background: #2563eb; color: white; padding: 0.5rem 1rem; font-size: 0.9rem;">
                                <span class="emoji">ğŸ“Š</span>Excel ë‹¤ìš´ë¡œë“œ
                            </button>
                        </div>
                        
                        <table class="requests-table">
                            <thead>
                                <tr>
                                    <th>ì œëª©</th>
                                    <th>ì‹œì„¤ ìœ í˜•</th>
                                    <th>ìš°ì„ ìˆœìœ„</th>
                                    <th>ìƒíƒœ</th>
                                    <th>ìš”ì²­ì</th>
                                    <th>ë¶€ì„œ</th>
                                    <th>ìœ„ì¹˜</th>
                                    <th>ì‚¬ì§„</th>
                                    <th>ë“±ë¡ì¼</th>
                                    <th>ê´€ë¦¬</th>
                                </tr>
                            </thead>
                            <tbody id="facility-requests-tbody">
                                <!-- ë™ì ìœ¼ë¡œ ìƒì„± -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- ê¸°ì•ˆì„œ í…œí”Œë¦¿ íƒ­ -->
                <div id="admin-template-tab" class="admin-tab-content" style="display: none;">
                    <div style="display: grid; gap: 2rem;">
                        
                        <!-- í•™ìŠµ ë°ì´í„° ì…ë ¥ ì„¹ì…˜ -->
                        <div style="background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%); padding: 2rem; border-radius: 20px; border: 3px solid #a855f7; box-shadow: 0 8px 32px rgba(168, 85, 247, 0.2);">
                            <h3 class="section-title">
                                <span class="emoji">ğŸ“</span>ê¸°ì•ˆì„œ í•™ìŠµ ë°ì´í„° ì…ë ¥
                            </h3>
                            
                            <div style="margin-bottom: 2rem;">
                                <label style="display: block; margin-bottom: 1rem; font-weight: 600;">
                                    ğŸ“‹ ê¸°ì•ˆì„œ ìœ í˜• ì„ íƒ
                                </label>
                                <select id="template-type" style="width: 100%; padding: 0.75rem; border-radius: 8px; border: 2px solid #d1d5db;">
                                    <option value="purchase">êµ¬ë§¤ ìš”ì²­ ê¸°ì•ˆì„œ</option>
                                    <option value="facility">ì‹œì„¤ ìˆ˜ë¦¬ ê¸°ì•ˆì„œ</option>
                                </select>
                            </div>
                            
                            <div style="margin-bottom: 2rem;">
                                <label style="display: block; margin-bottom: 1rem; font-weight: 600;">
                                    ğŸ“„ ê¸°ì¡´ ê¸°ì•ˆì„œ ìƒ˜í”Œ ì…ë ¥ (í•™ìŠµìš©)
                                </label>
                                <textarea 
                                    id="sample-template" 
                                    placeholder="ê¸°ì¡´ì— ì‘ì„±í•˜ì‹  ê¸°ì•ˆì„œ ë‚´ìš©ì„ ë¶™ì—¬ë„£ì–´ ì£¼ì„¸ìš”. ì—¬ëŸ¬ ê°œì˜ ìƒ˜í”Œì„ ì…ë ¥í•˜ì‹œë©´ ë” ì •í™•í•œ í…œí”Œë¦¿ì„ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
                                    style="width: 100%; height: 300px; padding: 1rem; border-radius: 8px; border: 2px solid #d1d5db; font-family: 'Malgun Gothic', sans-serif; line-height: 1.6;"
                                ></textarea>
                            </div>
                            
                            <button onclick="learnTemplate()" class="btn" style="background: #a855f7; color: white; padding: 0.75rem 1.5rem;">
                                <span class="emoji">ğŸ§ </span>í…œí”Œë¦¿ í•™ìŠµí•˜ê¸°
                            </button>
                        </div>
                        
                        <!-- í•™ìŠµëœ í…œí”Œë¦¿ ê´€ë¦¬ -->
                        <div style="background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); padding: 2rem; border-radius: 20px; border: 3px solid #22c55e; box-shadow: 0 8px 32px rgba(34, 197, 94, 0.2);">
                            <h3 class="section-title">
                                <span class="emoji">ğŸ“‹</span>í•™ìŠµëœ í…œí”Œë¦¿ ê´€ë¦¬
                            </h3>
                            
                            <div id="learned-templates" style="margin-bottom: 2rem;">
                                <!-- í•™ìŠµëœ í…œí”Œë¦¿ ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œ -->
                                <div style="color: #6b7280; text-align: center; padding: 2rem;">
                                    ì•„ì§ í•™ìŠµëœ í…œí”Œë¦¿ì´ ì—†ìŠµë‹ˆë‹¤. ìœ„ì—ì„œ ê¸°ì•ˆì„œ ìƒ˜í”Œì„ ì…ë ¥í•´ì£¼ì„¸ìš”.
                                </div>
                            </div>
                        </div>
                        
                        <!-- ì‚¬ìš©ì í”¼ë“œë°± í•™ìŠµ ì„¹ì…˜ -->
                        <div style="background: linear-gradient(135deg, #fef7ed 0%, #fed7aa 100%); padding: 2rem; border-radius: 20px; border: 3px solid #f97316; box-shadow: 0 8px 32px rgba(249, 115, 22, 0.2);">
                            <h3 class="section-title">
                                <span class="emoji">ğŸ§ </span>ì‚¬ìš©ì í”¼ë“œë°± í•™ìŠµ
                                <span style="font-size: 0.8rem; color: #6b7280; font-weight: normal; margin-left: 1rem;">ê¸°ì•ˆì„œ ìƒì„± ê·œì¹™ì„ ê°œì„ í•©ë‹ˆë‹¤</span>
                            </h3>
                            
                            <div style="margin-bottom: 2rem;">
                                <label style="display: block; margin-bottom: 1rem; font-weight: 600;">
                                    ğŸ’¬ í”¼ë“œë°± ë° ìš”ì²­ì‚¬í•­
                                </label>
                                <textarea 
                                    id="feedback-input" 
                                    placeholder="âœ… íš¨ê³¼ì ì¸ í”¼ë“œë°± ì˜ˆì‹œ:

ğŸš« ì œì™¸ ìš”ì²­:
â€¢ 'ê²¬ì ì„œ ì²¨ë¶€' ê´€ë ¨ ë‚´ìš©ì´ ì•ˆë“¤ì–´ê°€ê²Œ í•´ì¤˜
â€¢ ì²¨ë¶€ ë‚´ìš©ì„ ë¹¼ì¤˜
â€¢ 'ì´ìƒê³¼ ê°™ì´' ë¬¸êµ¬ë¥¼ ì‚­ì œí•´ì¤˜

ğŸ—ï¸ êµ¬ì¡°ì  ì‚­ì œ:
â€¢ 3ë²ˆ í•„ìš”ì„± ë¶€í„° ì•„ë˜ì˜ ë‚´ìš©ì„ ì‚­ì œí•´ì¤˜
â€¢ í•„ìš”ì„± ì´í›„ ëª¨ë“  ë‚´ìš©ì„ ì œì™¸í•´ì¤˜
â€¢ ê¸°íƒ€ì‚¬í•­ ë¶€í„° ì•„ë˜ë¥¼ ë¹¼ì¤˜

â• ì¶”ê°€ ìš”ì²­:
â€¢ 'ê¸´ê¸‰ ì²˜ë¦¬ ìš”ë§' ë¬¸êµ¬ë¥¼ ì¶”ê°€í•´ì¤˜
â€¢ ê²€í†  ìš”ì²­ ë¬¸êµ¬ë¥¼ ë„£ì–´ì¤˜

âœ‚ï¸ ê°„ì†Œí™” ìš”ì²­:
â€¢ ë” ê°„ë‹¨í•˜ê²Œ ì‘ì„±í•´ì¤˜
â€¢ í•„ìš”ì„± ë¶€ë¶„ì„ ì§§ê²Œ í•´ì¤˜

ğŸ”„ êµì²´ ìš”ì²­:
â€¢ 'ê²€í† ' ë¥¼ 'ìŠ¹ì¸' ë¡œ ë°”ê¿”ì¤˜
â€¢ ë¶€ì„œëª…ì„ ëŒ€ì‹  'ë‹´ë‹¹íŒ€' ìœ¼ë¡œ ì¨ì¤˜

ğŸ’¡ Tip: êµ¬ì²´ì ì´ê³  ëª…í™•í•œ í‘œí˜„ì¼ìˆ˜ë¡ ë” ì •í™•í•˜ê²Œ ì ìš©ë©ë‹ˆë‹¤!"
                                    style="width: 100%; height: 200px; padding: 1rem; border-radius: 8px; border: 2px solid #d1d5db; font-family: 'Malgun Gothic', sans-serif; line-height: 1.6; resize: vertical;"
                                ></textarea>
                            </div>
                            
                            <div style="margin-bottom: 2rem;">
                                <label style="display: block; margin-bottom: 1rem; font-weight: 600;">
                                    ğŸ¯ ì ìš© ëŒ€ìƒ
                                </label>
                                <select id="feedback-target" style="width: 100%; padding: 0.75rem; border-radius: 8px; border: 2px solid #d1d5db;">
                                    <option value="both">êµ¬ë§¤ ìš”ì²­ + ì‹œì„¤ ê´€ë¦¬</option>
                                    <option value="purchase">êµ¬ë§¤ ìš”ì²­ë§Œ</option>
                                    <option value="facility">ì‹œì„¤ ê´€ë¦¬ë§Œ</option>
                                </select>
                            </div>
                            
                            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                                <button onclick="learnFeedback()" class="btn" style="background: #f97316; color: white; padding: 0.75rem 1.5rem;">
                                    <span class="emoji">ğŸ§ </span>í”¼ë“œë°± í•™ìŠµí•˜ê¸°
                                </button>
                                
                                <button onclick="testFeedbackRules()" class="btn" style="background: #2563eb; color: white; padding: 0.75rem 1.5rem;">
                                    <span class="emoji">ğŸ§ª</span>ê·œì¹™ í…ŒìŠ¤íŠ¸
                                </button>
                                
                                <button onclick="debugFeedbackSystem()" class="btn" style="background: #7c3aed; color: white; padding: 0.75rem 1.5rem;">
                                    <span class="emoji">ğŸ”</span>ì‹œìŠ¤í…œ ë””ë²„ê·¸
                                </button>
                            </div>
                        </div>
                        
                        <!-- í•™ìŠµëœ í”¼ë“œë°± ê·œì¹™ ê´€ë¦¬ -->
                        <div style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); padding: 2rem; border-radius: 20px; border: 3px solid #64748b; box-shadow: 0 8px 32px rgba(100, 116, 139, 0.2);">
                            <h3 class="section-title">
                                <span class="emoji">âš™ï¸</span>í•™ìŠµëœ í”¼ë“œë°± ê·œì¹™
                            </h3>
                            
                            <div id="feedback-rules-list" style="margin-bottom: 2rem;">
                                <!-- í•™ìŠµëœ ê·œì¹™ ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œ -->
                                <div style="color: #6b7280; text-align: center; padding: 2rem;">
                                    ì•„ì§ í•™ìŠµëœ í”¼ë“œë°± ê·œì¹™ì´ ì—†ìŠµë‹ˆë‹¤.
                                </div>
                            </div>
                            
                            <button onclick="clearAllFeedbackRules()" class="btn" style="background: #ef4444; color: white; padding: 0.75rem 1.5rem;">
                                <span class="emoji">ğŸ—‘ï¸</span>ëª¨ë“  ê·œì¹™ ì´ˆê¸°í™”
                            </button>
                        </div>
                        
                        <!-- í…œí”Œë¦¿ í•™ìŠµ ì•ˆë‚´ -->
                        <div style="background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%); padding: 2rem; border-radius: 20px; border: 3px solid #f59e0b; box-shadow: 0 8px 32px rgba(245, 158, 11, 0.2);">
                            <h3 class="section-title">
                                <span class="emoji">ğŸ’¡</span>ê¸°ì•ˆì„œ ìƒì„± ì‚¬ìš©ë²•
                            </h3>
                            
                            <div style="color: #92400e; line-height: 1.8;">
                                <p><strong>ğŸ“‹ ê´€ë¦¬ì ì—­í• :</strong></p>
                                <ul style="margin-left: 1.5rem; margin-bottom: 1.5rem;">
                                    <li>ê¸°ì¡´ ê¸°ì•ˆì„œ ìƒ˜í”Œì„ ì…ë ¥í•˜ì—¬ í…œí”Œë¦¿ í•™ìŠµ</li>
                                    <li>ì‚¬ìš©ì í”¼ë“œë°±ì„ í•™ìŠµí•˜ì—¬ ê¸°ì•ˆì„œ ìƒì„± ê·œì¹™ ê°œì„ </li>
                                    <li>í•™ìŠµëœ í…œí”Œë¦¿ ë° í”¼ë“œë°± ê·œì¹™ ê´€ë¦¬ (ì‚­ì œ/ìˆ˜ì •)</li>
                                </ul>
                                
                                <p><strong>ğŸ‘¤ ì‚¬ìš©ì ì—­í• :</strong></p>
                                <ul style="margin-left: 1.5rem; margin-bottom: 1.5rem;">
                                    <li>êµ¬ë§¤ ìš”ì²­ íƒ­ â†’ í¼ ì‘ì„± í›„ í•˜ë‹¨ì˜ "ê¸°ì•ˆì„œ ìƒì„±" ë²„íŠ¼ í´ë¦­</li>
                                    <li>ì‹œì„¤ ê´€ë¦¬ íƒ­ â†’ í¼ ì‘ì„± í›„ í•˜ë‹¨ì˜ "ê¸°ì•ˆì„œ ìƒì„±" ë²„íŠ¼ í´ë¦­</li>
                                    <li>ìƒì„±ëœ ê¸°ì•ˆì„œë¥¼ í´ë¦½ë³´ë“œë¡œ ë³µì‚¬í•˜ì—¬ ê·¸ë£¹ì›¨ì–´ì—ì„œ í™œìš©</li>
                                </ul>
                                
                                <p><strong>ğŸ§  í”¼ë“œë°± í•™ìŠµ ì˜ˆì‹œ:</strong></p>
                                <ul style="margin-left: 1.5rem; margin-bottom: 1.5rem; font-size: 0.9rem; color: #7c2d12;">
                                    <li>"ê²¬ì ì„œ ì²¨ë¶€ ê´€ë ¨ ë‚´ìš©ì´ ì•ˆë“¤ì–´ê°€ê²Œ í•´ì¤˜"</li>
                                    <li>"ë” ê°„ë‹¨í•˜ê²Œ ì‘ì„±í•´ì¤˜"</li>
                                    <li>"ê¸´ê¸‰ ì²˜ë¦¬ ìš”ë§ ë¬¸êµ¬ë¥¼ ì¶”ê°€í•´ì¤˜"</li>
                                </ul>
                                
                                <div style="background: rgba(245, 158, 11, 0.1); padding: 1rem; border-radius: 8px; border-left: 4px solid #f59e0b;">
                                    <strong>âœ¨ Tip:</strong> í”¼ë“œë°± í•™ìŠµì„ í†µí•´ ê¸°ì•ˆì„œê°€ ê³„ì† ê°œì„ ë©ë‹ˆë‹¤. ë¶ˆë§Œì‚¬í•­ì´ë‚˜ ìš”ì²­ì‚¬í•­ì„ ìì—°ì–´ë¡œ ì…ë ¥í•˜ë©´ ìë™ìœ¼ë¡œ ê·œì¹™í™”ë©ë‹ˆë‹¤!
                                </div>
                            </div>
                        </div>
                        
                    </div>
                </div>
                
            </div>
        </div>
    </div>

    <!-- ìš”ì²­ ìƒì„¸ ëª¨ë‹¬ -->
    <div id="detail-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">ìš”ì²­ ìƒì„¸ ì •ë³´</h2>
                <span class="modal-close" onclick="closeDetailModal()">&times;</span>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- ë™ì ìœ¼ë¡œ ìƒì„± -->
            </div>
        </div>
    </div>

    <!-- íŒŒì¼ ë¯¸ë¦¬ë³´ê¸° ëª¨ë‹¬ -->
    <div id="file-preview-modal" class="modal" style="display: none;">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 id="file-modal-title">íŒŒì¼ ë¯¸ë¦¬ë³´ê¸°</h2>
                <span class="modal-close" onclick="closeFileModal()">&times;</span>
            </div>
            <div class="modal-body" id="file-modal-body">
                <!-- ë™ì ìœ¼ë¡œ ìƒì„± -->
            </div>
        </div>
    </div>

    <!-- í‘¸í„° -->
    <footer class="footer">
        <p><strong>Â© 2024 í†µí•© ìš”ì²­ ê´€ë¦¬ ì‹œìŠ¤í…œ. All rights reserved.</strong></p>
        <p>êµ¬ë§¤ ë° ì‹œì„¤ ê´€ë¦¬ ë¬¸ì˜: <strong>support@system.com</strong></p>
    </footer>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let isAdmin = false;
        let requests = [];
        let requestIdCounter = 1;

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            loadSampleData();
            
            // í¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.getElementById('purchase-form').addEventListener('submit', submitPurchaseRequest);
            document.getElementById('facility-form').addEventListener('submit', submitFacilityRequest);
            document.getElementById('admin-form').addEventListener('submit', adminLogin);
            
            // íŒŒì¼ ì—…ë¡œë“œ ì„¤ì •
            setupFileUpload();
            
            // ì‚¬ì§„ ì—…ë¡œë“œ ì„¤ì •
            setupPhotoUpload();
        });

        // ìƒ˜í”Œ ë°ì´í„° ë¡œë“œ
        function loadSampleData() {
            const storedRequests = localStorage.getItem('integratedRequests');
            const storedCounter = localStorage.getItem('requestIdCounter');
            
            if (storedCounter) {
                requestIdCounter = parseInt(storedCounter);
            }
            
            if (!storedRequests) {
                requests = [
                    {
                        id: 1,
                        type: 'facility',
                        title: 'ê°•ì˜ì‹¤ ì—ì–´ì»¨ ê³ ì¥',
                        description: '301í˜¸ ê°•ì˜ì‹¤ ì—ì–´ì»¨ì´ ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤',
                        facilityType: 'ëƒ‰ë‚œë°©',
                        priority: 'ë†’ìŒ',
                        status: 'ì§„í–‰ì¤‘',
                        requestedBy: 'ê¹€êµìˆ˜',
                        department: 'ì»´í“¨í„°ê³µí•™ê³¼',
                        phone: '010-1234-5678',
                        location: 'ê³µí•™ê´€ 301í˜¸',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 2,
                        type: 'purchase',
                        department: 'ITíŒ€',
                        item: 'ë…¸íŠ¸ë¶',
                        quantity: 2,
                        reason: 'ì‹ ì…ì‚¬ì› ì—…ë¬´ìš©',
                        status: 'ëŒ€ê¸°',
                        requestedBy: 'ì´ê´€ë¦¬',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 3,
                        type: 'facility',
                        title: 'í™”ì¥ì‹¤ ì¡°ëª… êµì²´',
                        description: 'í™”ì¥ì‹¤ LED ì¡°ëª…ì´ ê¹œë¹¡ì…ë‹ˆë‹¤',
                        facilityType: 'ì „ê¸°ì„¤ë¹„',
                        priority: 'ë³´í†µ',
                        status: 'ì™„ë£Œ',
                        requestedBy: 'ë°•ê´€ë¦¬',
                        department: 'ì‹œì„¤ê´€ë¦¬íŒ€',
                        phone: '010-9876-5432',
                        location: 'ë³¸ê´€ 1ì¸µ í™”ì¥ì‹¤',
                        createdAt: new Date(Date.now() - 86400000).toISOString()
                    },
                    {
                        id: 4,
                        type: 'purchase',
                        department: 'ë§ˆì¼€íŒ…íŒ€',
                        item: 'í”„ë¦°í„°',
                        quantity: 1,
                        reason: 'ê¸°ì¡´ í”„ë¦°í„° ê³ ì¥ìœ¼ë¡œ êµì²´ í•„ìš”',
                        status: 'ì·¨ì†Œ',
                        requestedBy: 'ìµœì§ì›',
                        createdAt: new Date(Date.now() - 172800000).toISOString()
                    }
                ];
                requestIdCounter = 5;
                saveToStorage();
            } else {
                requests = JSON.parse(storedRequests);
            }
        }

        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
        function saveToStorage() {
            localStorage.setItem('integratedRequests', JSON.stringify(requests));
            localStorage.setItem('requestIdCounter', requestIdCounter.toString());
        }

        // ì•Œë¦¼ í‘œì‹œ
        function showAlert(message, type) {
            const container = document.getElementById('alert-container');
            const alertClass = type === 'success' ? 'alert-success' : 'alert-error';
            const icon = type === 'success' ? 'âœ…' : 'âŒ';
            
            container.innerHTML = `<div class="alert ${alertClass}"><span class="emoji">${icon}</span>${message}</div>`;
            
            setTimeout(() => {
                container.innerHTML = '';
            }, 5000);
        }

        // íƒ­ ì „í™˜
        function showTab(tabName) {
            // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // ì„ íƒëœ íƒ­ í™œì„±í™”
            event.target.closest('.nav-tab').classList.add('active');
            
            if (tabName === 'purchase') {
                document.getElementById('purchase-tab').classList.add('active');
            } else if (tabName === 'facility') {
                document.getElementById('facility-tab').classList.add('active');
            } else if (tabName === 'admin') {
                document.getElementById('admin-tab-content').classList.add('active');
                if (isAdmin) {
                    showAdminTab('all');
                }
            }
        }
        // ì˜ˆì‚° ì…ë ¥ê°’ ì •ë¦¬ (ì‰¼í‘œ ì œê±°, ìˆ«ìë§Œ ì¶”ì¶œ)
        function cleanBudgetInput(value) {
            if (!value) return '';
            return value.toString().replace(/[^0-9]/g, '');
        }
        // êµ¬ë§¤ ìš”ì²­ ì œì¶œ
        async function submitPurchaseRequest(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const fileInput = document.getElementById('purchase-quote-file');
            const file = fileInput.files[0];
            
            const requestData = {
                id: requestIdCounter++,
                type: 'purchase',
                title: formData.get('title'),
                department: formData.get('department'),
                item: formData.get('item'),
                quantity: formData.get('quantity'),
                budget: parseInt(cleanBudgetInput(formData.get('budget'))),
                reason: formData.get('reason'),
                status: 'ëŒ€ê¸°',
                requestedBy: formData.get('requestedBy'),
                priority: formData.get('priority') || 'ë³´í†µ',
                quoteFile: file ? {
                    name: file.name,
                    size: file.size,
                    type: file.type,
                    lastModified: file.lastModified
                } : null,
                createdAt: new Date().toISOString()
            };
            
            // Firebaseì— ì €ì¥ ì‹œë„
            if (isFirebaseConnected) {
                try {
                    showLoading('Firebaseì— ì €ì¥ ì¤‘...');
                    const firebaseId = await saveRequestToFirebase(requestData);
                    requestData.firebaseId = firebaseId;
                    hideLoading();
                    showAlert('êµ¬ë§¤ ìš”ì²­ì´ ì„±ê³µì ìœ¼ë¡œ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤! (ì‹¤ì‹œê°„ ë™ê¸°í™”)', 'success');
                } catch (error) {
                    hideLoading();
                    // Firebase ì‹¤íŒ¨ ì‹œ ë¡œì»¬ì— ì €ì¥
                    requests.unshift(requestData);
                    saveToStorage();
                    showAlert('êµ¬ë§¤ ìš”ì²­ì´ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤. (ë¡œì»¬ ì €ì¥)', 'success');
                }
            } else {
                // ì˜¤í”„ë¼ì¸ ëª¨ë“œ: ë¡œì»¬ì—ë§Œ ì €ì¥
                requests.unshift(requestData);
                saveToStorage();
                showAlert('êµ¬ë§¤ ìš”ì²­ì´ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤. (ì˜¤í”„ë¼ì¸ ëª¨ë“œ)', 'success');
            }
            e.target.reset();
            
            // íŒŒì¼ ì—…ë¡œë“œ UI ì´ˆê¸°í™”
            resetFileUpload();
            
            console.log('ğŸ›’ ìƒˆë¡œìš´ êµ¬ë§¤ ìš”ì²­:', requestData);
        }

        // ì‹œì„¤ ê´€ë¦¬ ìš”ì²­ ì œì¶œ
        async function submitFacilityRequest(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            
            // ì‚¬ì§„ ë°ì´í„° ì²˜ë¦¬
            const photoData = selectedPhotos.map(photo => ({
                name: photo.name,
                size: photo.size,
                type: photo.type,
                lastModified: photo.lastModified
            }));
            
            const requestData = {
                id: requestIdCounter++,
                type: 'facility',
                title: formData.get('title'),
                description: formData.get('description'),
                facilityType: formData.get('facilityType'),
                priority: formData.get('priority'),
                status: 'ëŒ€ê¸°',
                requestedBy: formData.get('requestedBy'),
                department: formData.get('department'),
                phone: formData.get('phone') || '',
                location: formData.get('location') || '',
                facilityPhotos: photoData.length > 0 ? photoData : null,
                createdAt: new Date().toISOString()
            };
            
            // Firebaseì— ì €ì¥ ì‹œë„
            if (isFirebaseConnected) {
                try {
                    showLoading('Firebaseì— ì €ì¥ ì¤‘...');
                    const firebaseId = await saveRequestToFirebase(requestData);
                    requestData.firebaseId = firebaseId;
                    hideLoading();
                    showAlert('ì‹œì„¤ ê´€ë¦¬ ìš”ì²­ì´ ì„±ê³µì ìœ¼ë¡œ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤! (ì‹¤ì‹œê°„ ë™ê¸°í™”)', 'success');
                } catch (error) {
                    hideLoading();
                    // Firebase ì‹¤íŒ¨ ì‹œ ë¡œì»¬ì— ì €ì¥
                    requests.unshift(requestData);
                    saveToStorage();
                    showAlert('ì‹œì„¤ ê´€ë¦¬ ìš”ì²­ì´ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤. (ë¡œì»¬ ì €ì¥)', 'success');
                }
            } else {
                // ì˜¤í”„ë¼ì¸ ëª¨ë“œ: ë¡œì»¬ì—ë§Œ ì €ì¥
                requests.unshift(requestData);
                saveToStorage();
                showAlert('ì‹œì„¤ ê´€ë¦¬ ìš”ì²­ì´ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤. (ì˜¤í”„ë¼ì¸ ëª¨ë“œ)', 'success');
            }
            e.target.reset();
            
            // ì‚¬ì§„ ì—…ë¡œë“œ UI ì´ˆê¸°í™”
            resetPhotoUpload();
            
            console.log('ğŸ”§ ìƒˆë¡œìš´ ì‹œì„¤ ê´€ë¦¬ ìš”ì²­:', requestData);
        }

        // ê´€ë¦¬ì ë¡œê·¸ì¸
        function adminLogin(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const username = formData.get('username');
            const password = formData.get('password');
            
            if (username === 'admin' && password === 'admin123') {
                isAdmin = true;
                document.getElementById('admin-login').style.display = 'none';
                document.getElementById('admin-panel').style.display = 'block';
                document.getElementById('admin-tab').innerHTML = '<span class="emoji">ğŸ‘¨â€ğŸ’¼</span>ê´€ë¦¬ì (ë¡œê·¸ì¸ë¨)';
                
                showAlert('ê´€ë¦¬ìë¡œ ë¡œê·¸ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                showAdminTab('all');
            } else {
                showAlert('ì˜ëª»ëœ ê´€ë¦¬ì ì •ë³´ì…ë‹ˆë‹¤.', 'error');
            }
        }

        // ë¡œê·¸ì•„ì›ƒ
        function logout() {
            isAdmin = false;
            document.getElementById('admin-login').style.display = 'block';
            document.getElementById('admin-panel').style.display = 'none';
            document.getElementById('admin-tab').innerHTML = '<span class="emoji">ğŸ‘¨â€ğŸ’¼</span>ê´€ë¦¬ì';
            document.getElementById('admin-form').reset();
            showAlert('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        }

        // ê´€ë¦¬ì íƒ­ ì „í™˜
        function showAdminTab(tabName, element) {
            console.log('ğŸ”„ ê´€ë¦¬ì íƒ­ ì „í™˜:', tabName);
            
            // ëª¨ë“  ê´€ë¦¬ì í•˜ìœ„ íƒ­ ë¹„í™œì„±í™” ë° ìŠ¤íƒ€ì¼ ì´ˆê¸°í™”
            document.querySelectorAll('.admin-sub-tab').forEach(tab => {
                tab.classList.remove('active');
                tab.style.background = '';
                tab.style.color = '#9a3412';
                tab.style.fontWeight = '600';
                tab.style.border = '';
            });
            
            // ëª¨ë“  ê´€ë¦¬ì íƒ­ ì»¨í…ì¸  ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.admin-tab-content').forEach(content => {
                content.style.display = 'none';
                content.classList.remove('active');
            });
            
            // ì„ íƒëœ íƒ­ í™œì„±í™” ë° ìŠ¤íƒ€ì¼ ì ìš©
            if (element) {
                element.classList.add('active');
                if (tabName === 'all') {
                    element.style.background = 'linear-gradient(135deg, #fb923c, #f97316)';
                    element.style.color = 'white';
                    element.style.border = '2px solid #ea580c';
                } else if (tabName === 'purchase') {
                    element.style.background = 'linear-gradient(135deg, #22c55e, #16a34a)';
                    element.style.color = 'white';
                    element.style.border = '2px solid #15803d';
                } else if (tabName === 'facility') {
                    element.style.background = 'linear-gradient(135deg, #2563eb, #1d4ed8)';
                    element.style.color = 'white';
                    element.style.border = '2px solid #1e40af';
                } else if (tabName === 'template') {
                    element.style.background = 'linear-gradient(135deg, #a855f7, #9333ea)';
                    element.style.color = 'white';
                    element.style.border = '2px solid #7c3aed';
                }
                element.style.fontWeight = '700';
                console.log('âœ… íƒ­ ë²„íŠ¼ í™œì„±í™”:', element.textContent.trim());
            } else {
                // tabNameì— ë”°ë¼ í•´ë‹¹ ë²„íŠ¼ ì°¾ì•„ì„œ í™œì„±í™”
                const tabButton = Array.from(document.querySelectorAll('.admin-sub-tab')).find(tab => {
                    if (tabName === 'all' && tab.textContent.includes('ì „ì²´')) return true;
                    if (tabName === 'purchase' && tab.textContent.includes('êµ¬ë§¤')) return true;
                    if (tabName === 'facility' && tab.textContent.includes('ì‹œì„¤')) return true;
                    if (tabName === 'template' && tab.textContent.includes('ê¸°ì•ˆì„œ')) return true;
                    return false;
                });
                if (tabButton) {
                    tabButton.classList.add('active');
                    showAdminTab(tabName, tabButton); // ì¬ê·€ í˜¸ì¶œë¡œ ìŠ¤íƒ€ì¼ ì ìš©
                    console.log('âœ… íƒ­ ë²„íŠ¼ í™œì„±í™”:', tabButton.textContent.trim());
                    return; // ì¬ê·€ í˜¸ì¶œ í›„ ë¦¬í„´
                }
            }
            
            // í•´ë‹¹ ì»¨í…ì¸  íƒ­ í‘œì‹œ
            const contentTab = document.getElementById(`admin-${tabName}-tab`);
            if (contentTab) {
                contentTab.style.display = 'block';
                contentTab.classList.add('active');
                console.log('âœ… ì»¨í…ì¸  ì˜ì—­ í™œì„±í™”:', `admin-${tabName}-tab`);
            } else {
                console.error('âŒ ì»¨í…ì¸  ì˜ì—­ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', `admin-${tabName}-tab`);
            }
            
            // í•´ë‹¹ íƒ­ ë°ì´í„° ë¡œë“œ
            if (tabName === 'all') {
                console.log('ğŸ“Š ì „ì²´ í˜„í™© íƒ­ ë¡œë“œ ì‹œì‘');
                loadAllRequests();
            } else if (tabName === 'purchase') {
                console.log('ğŸ›’ êµ¬ë§¤ ìš”ì²­ íƒ­ ë¡œë“œ ì‹œì‘');
                loadPurchaseRequests();
            } else if (tabName === 'facility') {
                console.log('ğŸ”§ ì‹œì„¤ ê´€ë¦¬ íƒ­ ë¡œë“œ ì‹œì‘');
                loadFacilityRequests();
            } else if (tabName === 'template') {
                console.log('ğŸ“ ê¸°ì•ˆì„œ í…œí”Œë¦¿ íƒ­ ë¡œë“œ ì‹œì‘');
                loadTemplateTab();
            }
        }

        // ì „ì²´ í†µê³„ ì—…ë°ì´íŠ¸
        function updateAllStats() {
            const allStats = {
                ëŒ€ê¸°: requests.filter(r => r.status === 'ëŒ€ê¸°').length,
                ì§„í–‰ì¤‘: requests.filter(r => r.status === 'ì§„í–‰ì¤‘').length,
                ì™„ë£Œ: requests.filter(r => r.status === 'ì™„ë£Œ').length,
                ì·¨ì†Œ: requests.filter(r => r.status === 'ì·¨ì†Œ').length
            };
            
            const purchaseStats = {
                ëŒ€ê¸°: requests.filter(r => r.type === 'purchase' && r.status === 'ëŒ€ê¸°').length,
                ì§„í–‰ì¤‘: requests.filter(r => r.type === 'purchase' && r.status === 'ì§„í–‰ì¤‘').length,
                ì™„ë£Œ: requests.filter(r => r.type === 'purchase' && r.status === 'ì™„ë£Œ').length,
                ì·¨ì†Œ: requests.filter(r => r.type === 'purchase' && r.status === 'ì·¨ì†Œ').length
            };
            
            const facilityStats = {
                ëŒ€ê¸°: requests.filter(r => r.type === 'facility' && r.status === 'ëŒ€ê¸°').length,
                ì§„í–‰ì¤‘: requests.filter(r => r.type === 'facility' && r.status === 'ì§„í–‰ì¤‘').length,
                ì™„ë£Œ: requests.filter(r => r.type === 'facility' && r.status === 'ì™„ë£Œ').length,
                ì·¨ì†Œ: requests.filter(r => r.type === 'facility' && r.status === 'ì·¨ì†Œ').length
            };
            
            // ì „ì²´ í†µê³„ ì—…ë°ì´íŠ¸
            document.getElementById('stat-all-waiting').textContent = allStats.ëŒ€ê¸°;
            document.getElementById('stat-all-progress').textContent = allStats.ì§„í–‰ì¤‘;
            document.getElementById('stat-all-completed').textContent = allStats.ì™„ë£Œ;
            document.getElementById('stat-all-cancelled').textContent = allStats.ì·¨ì†Œ;
            
            // êµ¬ë§¤ ìš”ì²­ í†µê³„ ì—…ë°ì´íŠ¸
            document.getElementById('purchase-waiting').textContent = purchaseStats.ëŒ€ê¸°;
            document.getElementById('purchase-progress').textContent = purchaseStats.ì§„í–‰ì¤‘;
            document.getElementById('purchase-completed').textContent = purchaseStats.ì™„ë£Œ;
            document.getElementById('purchase-cancelled').textContent = purchaseStats.ì·¨ì†Œ;
            
            // ì‹œì„¤ ê´€ë¦¬ í†µê³„ ì—…ë°ì´íŠ¸
            document.getElementById('facility-waiting').textContent = facilityStats.ëŒ€ê¸°;
            document.getElementById('facility-progress').textContent = facilityStats.ì§„í–‰ì¤‘;
            document.getElementById('facility-completed').textContent = facilityStats.ì™„ë£Œ;
            document.getElementById('facility-cancelled').textContent = facilityStats.ì·¨ì†Œ;
        }

        // êµ¬ë§¤ ìš”ì²­ í†µê³„ ì—…ë°ì´íŠ¸
        function updatePurchaseStats() {
            const purchaseRequests = requests.filter(r => r.type === 'purchase');
            const stats = {
                ëŒ€ê¸°: purchaseRequests.filter(r => r.status === 'ëŒ€ê¸°').length,
                ì§„í–‰ì¤‘: purchaseRequests.filter(r => r.status === 'ì§„í–‰ì¤‘').length,
                ì™„ë£Œ: purchaseRequests.filter(r => r.status === 'ì™„ë£Œ').length,
                ì·¨ì†Œ: purchaseRequests.filter(r => r.status === 'ì·¨ì†Œ').length
            };
            
            document.getElementById('stat-purchase-waiting').textContent = stats.ëŒ€ê¸°;
            document.getElementById('stat-purchase-progress').textContent = stats.ì§„í–‰ì¤‘;
            document.getElementById('stat-purchase-completed').textContent = stats.ì™„ë£Œ;
            document.getElementById('stat-purchase-cancelled').textContent = stats.ì·¨ì†Œ;
        }

        // ì‹œì„¤ ê´€ë¦¬ í†µê³„ ì—…ë°ì´íŠ¸
        function updateFacilityStats() {
            const facilityRequests = requests.filter(r => r.type === 'facility');
            const stats = {
                ëŒ€ê¸°: facilityRequests.filter(r => r.status === 'ëŒ€ê¸°').length,
                ì§„í–‰ì¤‘: facilityRequests.filter(r => r.status === 'ì§„í–‰ì¤‘').length,
                ì™„ë£Œ: facilityRequests.filter(r => r.status === 'ì™„ë£Œ').length,
                ì·¨ì†Œ: facilityRequests.filter(r => r.status === 'ì·¨ì†Œ').length
            };
            
            document.getElementById('stat-facility-waiting').textContent = stats.ëŒ€ê¸°;
            document.getElementById('stat-facility-progress').textContent = stats.ì§„í–‰ì¤‘;
            document.getElementById('stat-facility-completed').textContent = stats.ì™„ë£Œ;
            document.getElementById('stat-facility-cancelled').textContent = stats.ì·¨ì†Œ;
        }

        // ì „ì²´ ìš”ì²­ ëª©ë¡ ë¡œë“œ
        function loadAllRequests() {
            if (!isAdmin) return;
            
            console.log('ğŸ” ì „ì²´ ìš”ì²­ ëª©ë¡ ë¡œë“œ ì¤‘...', requests.length, 'ê°œ ìš”ì²­');
            
            const tbody = document.getElementById('all-requests-tbody');
            if (!tbody) {
                console.error('âŒ all-requests-tbody í…Œì´ë¸”ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            tbody.innerHTML = '';
            
            const statusFilter = document.getElementById('all-status-filter');
            const filteredRequests = statusFilter && statusFilter.value 
                ? requests.filter(r => r.status === statusFilter.value)
                : requests;
            
            console.log('ğŸ“Š í•„í„°ë§ëœ ìš”ì²­:', filteredRequests.length, 'ê°œ');
            
            if (filteredRequests.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; color: #6b7280; padding: 2rem;">ìš”ì²­ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                return;
            }
            
            filteredRequests.forEach(request => {
                const row = document.createElement('tr');
                row.className = 'clickable-row';
                row.onclick = () => showRequestDetail(request);
                createAllRequestRow(row, request);
                tbody.appendChild(row);
            });
            
            updateAllStats();
        }

        // êµ¬ë§¤ ìš”ì²­ ëª©ë¡ ë¡œë“œ
        function loadPurchaseRequests() {
            if (!isAdmin) return;
            
            console.log('ğŸ›’ êµ¬ë§¤ ìš”ì²­ ëª©ë¡ ë¡œë“œ ì¤‘...');
            
            const tbody = document.getElementById('purchase-requests-tbody');
            if (!tbody) {
                console.error('âŒ purchase-requests-tbody í…Œì´ë¸”ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            tbody.innerHTML = '';
            
            const statusFilter = document.getElementById('purchase-status-filter');
            let purchaseRequests = requests.filter(r => r.type === 'purchase');
            
            console.log('ğŸ›’ ì „ì²´ êµ¬ë§¤ ìš”ì²­:', purchaseRequests.length, 'ê°œ');
            
            if (statusFilter && statusFilter.value) {
                purchaseRequests = purchaseRequests.filter(r => r.status === statusFilter.value);
            }
            
            console.log('ğŸ›’ í•„í„°ë§ëœ êµ¬ë§¤ ìš”ì²­:', purchaseRequests.length, 'ê°œ');
            
            if (purchaseRequests.length === 0) {
                tbody.innerHTML = '<tr><td colspan="12" style="text-align: center; color: #6b7280; padding: 2rem;">êµ¬ë§¤ ìš”ì²­ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                return;
            }
            
            purchaseRequests.forEach(request => {
                const row = document.createElement('tr');
                row.className = 'clickable-row';
                row.onclick = () => showRequestDetail(request);
                createPurchaseRequestRow(row, request);
                tbody.appendChild(row);
            });
            
            updatePurchaseStats();
        }

        // ì‹œì„¤ ê´€ë¦¬ ìš”ì²­ ëª©ë¡ ë¡œë“œ
        function loadFacilityRequests() {
            if (!isAdmin) return;
            
            console.log('ğŸ”§ ì‹œì„¤ ê´€ë¦¬ ìš”ì²­ ëª©ë¡ ë¡œë“œ ì¤‘...');
            
            const tbody = document.getElementById('facility-requests-tbody');
            if (!tbody) {
                console.error('âŒ facility-requests-tbody í…Œì´ë¸”ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            tbody.innerHTML = '';
            
            const statusFilter = document.getElementById('facility-status-filter');
            const priorityFilter = document.getElementById('facility-priority-filter');
            let facilityRequests = requests.filter(r => r.type === 'facility');
            
            console.log('ğŸ”§ ì „ì²´ ì‹œì„¤ ê´€ë¦¬ ìš”ì²­:', facilityRequests.length, 'ê°œ');
            
            if (statusFilter && statusFilter.value) {
                facilityRequests = facilityRequests.filter(r => r.status === statusFilter.value);
            }
            
            if (priorityFilter && priorityFilter.value) {
                facilityRequests = facilityRequests.filter(r => r.priority === priorityFilter.value);
            }
            
            console.log('ğŸ”§ í•„í„°ë§ëœ ì‹œì„¤ ê´€ë¦¬ ìš”ì²­:', facilityRequests.length, 'ê°œ');
            
            if (facilityRequests.length === 0) {
                tbody.innerHTML = '<tr><td colspan="10" style="text-align: center; color: #6b7280; padding: 2rem;">ì‹œì„¤ ê´€ë¦¬ ìš”ì²­ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                return;
            }
            
            facilityRequests.forEach(request => {
                const row = document.createElement('tr');
                row.className = 'clickable-row';
                row.onclick = () => showRequestDetail(request);
                createFacilityRequestRow(row, request);
                tbody.appendChild(row);
            });
            
            updateFacilityStats();
        }

        // ì „ì²´ ìš”ì²­ í–‰ ìƒì„±
        function createAllRequestRow(row, request) {
            const statusClass = {
                'ëŒ€ê¸°': 'badge-waiting',
                'ì§„í–‰ì¤‘': 'badge-progress',
                'ì™„ë£Œ': 'badge-completed',
                'ì·¨ì†Œ': 'badge-cancelled'
            }[request.status];
            
            const priorityClass = request.type === 'facility' ? {
                'ë‚®ìŒ': 'priority-low',
                'ë³´í†µ': 'priority-normal',
                'ë†’ìŒ': 'priority-high',
                'ê¸´ê¸‰': 'priority-urgent'
            }[request.priority] : '';
            
            const typeIcon = request.type === 'purchase' ? 'ğŸ›’' : 'ğŸ”§';
            const typeLabel = request.type === 'purchase' ? 'êµ¬ë§¤' : 'ì‹œì„¤';
            
            row.innerHTML = `
                <td style="font-weight: 600;">
                    <span class="emoji">${typeIcon}</span>${typeLabel}
                </td>
                <td>
                    <div style="font-weight: 600; margin-bottom: 0.25rem;">
                        ${request.type === 'purchase' ? request.item : request.title}
                    </div>
                    <div style="font-size: 0.85rem; color: #6b7280;">
                        ${request.type === 'purchase' 
                            ? `ìˆ˜ëŸ‰: ${formatQuantity(request.quantity)}` 
                            : request.facilityType}
                    </div>
                    ${request.location ? `<div style="font-size: 0.8rem; color: #9ca3af; margin-top: 0.25rem;"><span class="emoji">ğŸ“</span>${request.location}</div>` : ''}
                </td>
                <td>
                    ${request.type === 'purchase' && request.budget 
                        ? `<span style="font-weight: 600; color: #059669;">${request.budget.toLocaleString()}ì›</span>` 
                        : request.type === 'purchase' ? '-' : '-'}
                </td>
                <td>
                    ${request.type === 'facility' 
                        ? `<span class="badge ${priorityClass}">${request.priority}</span>`
                        : `<span class="badge ${getPriorityBadgeClass(request.priority || 'ë³´í†µ')}">${request.priority || 'ë³´í†µ'}</span>`}
                </td>
                <td>
                    <span class="badge ${statusClass}">${request.status}</span>
                </td>
                <td>
                    <div style="font-weight: 500;">${request.requestedBy}</div>
                    ${request.phone ? `<div style="font-size: 0.8rem; color: #6b7280;">${request.phone}</div>` : ''}
                </td>
                <td>${request.department}</td>
                <td style="font-size: 0.85rem;">${formatDate(request.createdAt)}</td>
                <td>
                    <select onchange="updateStatus(${request.id}, this.value)" onclick="event.stopPropagation()" style="padding: 0.4rem; font-size: 0.85rem; border-radius: 6px; border: 1px solid #d1d5db;">
                        <option value="ëŒ€ê¸°" ${request.status === 'ëŒ€ê¸°' ? 'selected' : ''}>ëŒ€ê¸°</option>
                        <option value="ì§„í–‰ì¤‘" ${request.status === 'ì§„í–‰ì¤‘' ? 'selected' : ''}>ì§„í–‰ì¤‘</option>
                        <option value="ì™„ë£Œ" ${request.status === 'ì™„ë£Œ' ? 'selected' : ''}>ì™„ë£Œ</option>
                        <option value="ì·¨ì†Œ" ${request.status === 'ì·¨ì†Œ' ? 'selected' : ''}>ì·¨ì†Œ</option>
                    </select>
                </td>
            `;
        }

        // êµ¬ë§¤ ìš”ì²­ í–‰ ìƒì„±
        function createPurchaseRequestRow(row, request) {
            const statusClass = {
                'ëŒ€ê¸°': 'badge-waiting',
                'ì§„í–‰ì¤‘': 'badge-progress',
                'ì™„ë£Œ': 'badge-completed',
                'ì·¨ì†Œ': 'badge-cancelled'
            }[request.status];
            
            // íŒŒì¼ ì •ë³´ ì²˜ë¦¬
            let fileInfo = '';
            if (request.quoteFile) {
                const sizeInMB = (request.quoteFile.size / (1024 * 1024)).toFixed(2);
                fileInfo = `<span class="badge" style="background: #10b981; color: white; font-size: 0.8rem;" title="${request.quoteFile.name} (${sizeInMB}MB)">
                    ğŸ“ ${request.quoteFile.name.length > 15 ? request.quoteFile.name.substring(0, 15) + '...' : request.quoteFile.name}
                </span>`;
            } else {
                fileInfo = '<span style="color: #9ca3af; font-size: 0.8rem;">ì—†ìŒ</span>';
            }
            
            row.innerHTML = `
                <td style="font-weight: 600; max-width: 180px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${request.title || request.item}">${request.title || request.item}</td>
                <td style="font-weight: 500;">${request.item}</td>
                <td><span class="badge" style="background: #f3f4f6; color: #374151;">${formatQuantity(request.quantity)}</span></td>
                <td style="font-weight: 600; color: #059669; text-align: right;">${request.budget ? request.budget.toLocaleString() + 'ì›' : '-'}</td>
                <td><span class="badge ${getPriorityBadgeClass(request.priority || 'ë³´í†µ')}">${request.priority || 'ë³´í†µ'}</span></td>
                <td><span class="badge ${statusClass}">${request.status}</span></td>
                <td style="font-weight: 500;">${request.requestedBy}</td>
                <td>${request.department}</td>
                <td style="font-size: 0.9rem; max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${request.reason}">${request.reason}</td>
                <td style="text-align: center;">${fileInfo}</td>
                <td style="font-size: 0.85rem;">${formatDate(request.createdAt)}</td>
                <td>
                    <select onchange="updateStatus(${request.id}, this.value)" onclick="event.stopPropagation()" style="padding: 0.4rem; font-size: 0.85rem; border-radius: 6px; border: 1px solid #d1d5db;">
                        <option value="ëŒ€ê¸°" ${request.status === 'ëŒ€ê¸°' ? 'selected' : ''}>ëŒ€ê¸°</option>
                        <option value="ì§„í–‰ì¤‘" ${request.status === 'ì§„í–‰ì¤‘' ? 'selected' : ''}>ì§„í–‰ì¤‘</option>
                        <option value="ì™„ë£Œ" ${request.status === 'ì™„ë£Œ' ? 'selected' : ''}>ì™„ë£Œ</option>
                        <option value="ì·¨ì†Œ" ${request.status === 'ì·¨ì†Œ' ? 'selected' : ''}>ì·¨ì†Œ</option>
                    </select>
                </td>
            `;
        }
        
        // ì‚¬ì§„ í‘œì‹œ ì…€ ìƒì„±
        function createPhotoDisplayCell(facilityPhotos) {
            if (!facilityPhotos || facilityPhotos.length === 0) {
                return '<span style="color: #9ca3af; font-size: 0.8rem;">ì—†ìŒ</span>';
            }
            
            const photoCount = facilityPhotos.length;
            return `<span class="badge" style="background: #3b82f6; color: white; font-size: 0.8rem; cursor: pointer;" 
                       onclick="event.stopPropagation(); showPhotoModal(${JSON.stringify(facilityPhotos).replace(/"/g, '&quot;')})" 
                       title="ì‚¬ì§„ ${photoCount}ê°œ ë³´ê¸°">
                ğŸ“· ${photoCount}ê°œ
            </span>`;
        }
        
        // ì‚¬ì§„ ëª¨ë‹¬ í‘œì‹œ
        function showPhotoModal(photos) {
            showFilePreview(photos, 'ì‹œì„¤ ì‚¬ì§„');
        }

        // ì‹œì„¤ ê´€ë¦¬ ìš”ì²­ í–‰ ìƒì„±
        function createFacilityRequestRow(row, request) {
            const statusClass = {
                'ëŒ€ê¸°': 'badge-waiting',
                'ì§„í–‰ì¤‘': 'badge-progress',
                'ì™„ë£Œ': 'badge-completed',
                'ì·¨ì†Œ': 'badge-cancelled'
            }[request.status];
            
            const priorityClass = {
                'ë‚®ìŒ': 'priority-low',
                'ë³´í†µ': 'priority-normal',
                'ë†’ìŒ': 'priority-high',
                'ê¸´ê¸‰': 'priority-urgent'
            }[request.priority];
            
            row.innerHTML = `
                <td>
                    <div style="font-weight: 600; margin-bottom: 0.25rem;">${request.title}</div>
                    <div style="font-size: 0.8rem; color: #6b7280; max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${request.description}">${request.description}</div>
                </td>
                <td><span class="badge" style="background: #f3f4f6; color: #374151;">${request.facilityType}</span></td>
                <td><span class="badge ${priorityClass}">${request.priority}</span></td>
                <td><span class="badge ${statusClass}">${request.status}</span></td>
                <td>
                    <div style="font-weight: 500;">${request.requestedBy}</div>
                    ${request.phone ? `<div style="font-size: 0.8rem; color: #6b7280;">${request.phone}</div>` : ''}
                </td>
                <td>${request.department}</td>
                <td style="font-size: 0.85rem;">${request.location || '-'}</td>
                <td style="text-align: center;">${createPhotoDisplayCell(request.facilityPhotos)}</td>
                <td style="font-size: 0.85rem;">${formatDate(request.createdAt)}</td>
                <td>
                    <select onchange="updateStatus(${request.id}, this.value)" onclick="event.stopPropagation()" style="padding: 0.4rem; font-size: 0.85rem; border-radius: 6px; border: 1px solid #d1d5db;">
                        <option value="ëŒ€ê¸°" ${request.status === 'ëŒ€ê¸°' ? 'selected' : ''}>ëŒ€ê¸°</option>
                        <option value="ì§„í–‰ì¤‘" ${request.status === 'ì§„í–‰ì¤‘' ? 'selected' : ''}>ì§„í–‰ì¤‘</option>
                        <option value="ì™„ë£Œ" ${request.status === 'ì™„ë£Œ' ? 'selected' : ''}>ì™„ë£Œ</option>
                        <option value="ì·¨ì†Œ" ${request.status === 'ì·¨ì†Œ' ? 'selected' : ''}>ì·¨ì†Œ</option>
                    </select>
                </td>
            `;
        }

        // ìƒíƒœ ì—…ë°ì´íŠ¸
        async function updateStatus(requestId, newStatus) {
            const request = requests.find(r => r.id === requestId);
            if (request) {
                const oldStatus = request.status;
                request.status = newStatus;
                request.updatedAt = new Date().toISOString();
                
                // Firebaseì— ì—…ë°ì´íŠ¸ ì‹œë„
                if (isFirebaseConnected && request.firebaseId) {
                    try {
                        await updateRequestInFirebase(request.firebaseId, {
                            status: newStatus,
                            updatedAt: request.updatedAt
                        });
                        showAlert(`ìš”ì²­ ìƒíƒœê°€ "${newStatus}"ë¡œ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤. (ì‹¤ì‹œê°„ ë™ê¸°í™”)`, 'success');
                    } catch (error) {
                        // Firebase ì—…ë°ì´íŠ¸ ì‹¤íŒ¨ ì‹œ ë¡œì»¬ë§Œ ì €ì¥
                        saveToStorage();
                        showAlert(`ìš”ì²­ ìƒíƒœê°€ "${newStatus}"ë¡œ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤. (ë¡œì»¬ ì €ì¥)`, 'success');
                    }
                } else {
                    // ì˜¤í”„ë¼ì¸ ëª¨ë“œ: ë¡œì»¬ì—ë§Œ ì €ì¥
                    saveToStorage();
                    showAlert(`ìš”ì²­ ìƒíƒœê°€ "${newStatus}"ë¡œ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤. (ì˜¤í”„ë¼ì¸ ëª¨ë“œ)`, 'success');
                }
                
                // UIëŠ” ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆì— ì˜í•´ ìë™ ì—…ë°ì´íŠ¸ë¨
                // ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆê°€ ì—†ëŠ” ê²½ìš°ë¥¼ ìœ„í•œ ë°±ì—… UI ì—…ë°ì´íŠ¸
                if (!isFirebaseConnected) {
                    const activeAdminTab = document.querySelector('.admin-sub-tab.active');
                    if (activeAdminTab) {
                        const tabName = activeAdminTab.textContent.includes('ì „ì²´') ? 'all' :
                                       activeAdminTab.textContent.includes('êµ¬ë§¤') ? 'purchase' : 'facility';
                        
                        if (tabName === 'all') {
                            loadAllRequests();
                        } else if (tabName === 'purchase') {
                            loadPurchaseRequests();
                        } else if (tabName === 'facility') {
                            loadFacilityRequests();
                        }
                    }
                }
            }
        }

        // ë‚ ì§œ í¬ë§·íŒ…
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ko-KR') + ' ' + date.toLocaleTimeString('ko-KR', {hour: '2-digit', minute: '2-digit'});
        }
        
        // íŒŒì¼ ì—…ë¡œë“œ ê´€ë ¨ í•¨ìˆ˜ë“¤
        function resetFileUpload() {
            const fileNameElement = document.getElementById('selected-file-name');
            const uploadContainer = document.querySelector('.file-upload-container');
            
            fileNameElement.textContent = '';
            uploadContainer.classList.remove('has-file');
        }
        
        function validateFile(file) {
            const maxSize = 10 * 1024 * 1024; // 10MB
            const allowedTypes = [
                'application/pdf',
                'application/vnd.ms-excel',
                'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
                'application/x-hwp',
                'application/haansofthwp'
            ];
            
            if (file.size > maxSize) {
                showAlert('íŒŒì¼ í¬ê¸°ëŠ” 10MB ì´í•˜ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'error');
                return false;
            }
            
            const fileExtension = file.name.split('.').pop().toLowerCase();
            const allowedExtensions = ['pdf', 'xls', 'xlsx', 'hwp', 'hwpx'];
            
            if (!allowedExtensions.includes(fileExtension)) {
                showAlert('PDF, Excel, í•œê¸€ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'error');
                return false;
            }
            
            return true;
        }
        
        function handleFileSelect(file) {
            if (!validateFile(file)) {
                return false;
            }
            
            const fileNameElement = document.getElementById('selected-file-name');
            const uploadContainer = document.querySelector('.file-upload-container');
            
            const sizeInMB = (file.size / (1024 * 1024)).toFixed(2);
            fileNameElement.textContent = `${file.name} (${sizeInMB}MB)`;
            uploadContainer.classList.add('has-file');
            
            return true;
        }
        
        function setupFileUpload() {
            const fileInput = document.getElementById('purchase-quote-file');
            const uploadContainer = document.querySelector('.file-upload-container');
            
            // íŒŒì¼ ì„ íƒ ì´ë²¤íŠ¸
            fileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    if (!handleFileSelect(file)) {
                        e.target.value = ''; // íŒŒì¼ ì„ íƒ ì·¨ì†Œ
                        resetFileUpload();
                    }
                } else {
                    resetFileUpload();
                }
            });
            
            // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì´ë²¤íŠ¸
            uploadContainer.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadContainer.classList.add('dragover');
            });
            
            uploadContainer.addEventListener('dragleave', function(e) {
                e.preventDefault();
                uploadContainer.classList.remove('dragover');
            });
            
            uploadContainer.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadContainer.classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    const file = files[0];
                    if (handleFileSelect(file)) {
                        fileInput.files = files;
                    }
                }
            });
            
            // ì»¨í…Œì´ë„ˆ í´ë¦­ ì‹œ íŒŒì¼ ì„ íƒ ì°½ ì—´ê¸°
            uploadContainer.addEventListener('click', function() {
                fileInput.click();
            });
        }
        
        // ì‚¬ì§„ ì—…ë¡œë“œ ê´€ë ¨ ë³€ìˆ˜
        let selectedPhotos = [];
        const MAX_PHOTOS = 3;
        const MAX_PHOTO_SIZE = 5 * 1024 * 1024; // 5MB
        
        // ì‚¬ì§„ ì—…ë¡œë“œ ì´ˆê¸°í™”
        function resetPhotoUpload() {
            selectedPhotos = [];
            const previewContainer = document.getElementById('facility-photo-preview');
            const uploadContainer = document.querySelector('.photo-upload-container');
            
            if (previewContainer) previewContainer.innerHTML = '';
            if (uploadContainer) {
                uploadContainer.classList.remove('has-photos');
                updatePhotoUploadText();
            }
        }
        
        // ì‚¬ì§„ ì—…ë¡œë“œ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        function updatePhotoUploadText() {
            const uploadText = document.querySelector('.photo-upload-text');
            if (!uploadText) return;
            
            if (selectedPhotos.length === 0) {
                uploadText.textContent = 'ğŸ“· ì‚¬ì§„ì„ ì„ íƒí•˜ê±°ë‚˜ ë“œë˜ê·¸í•˜ì—¬ ì—…ë¡œë“œ (ìµœëŒ€ 3ê°œ)';
            } else {
                uploadText.textContent = `ğŸ“· ${selectedPhotos.length}ê°œ ì‚¬ì§„ ì„ íƒë¨ (ìµœëŒ€ 3ê°œ)`;
            }
        }
        
        // ì‚¬ì§„ íŒŒì¼ ê²€ì¦
        function validatePhoto(file) {
            const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'];
            
            if (!allowedTypes.includes(file.type)) {
                showAlert('JPG, PNG, GIF íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'error');
                return false;
            }
            
            if (file.size > MAX_PHOTO_SIZE) {
                showAlert('ì‚¬ì§„ í¬ê¸°ëŠ” 5MB ì´í•˜ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'error');
                return false;
            }
            
            return true;
        }
        
        // ì‚¬ì§„ ë¯¸ë¦¬ë³´ê¸° ìƒì„±
        function createPhotoPreview(file, index) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const previewItem = document.createElement('div');
                    previewItem.className = 'photo-preview-item';
                    previewItem.innerHTML = `
                        <img src="${e.target.result}" alt="ë¯¸ë¦¬ë³´ê¸°" class="photo-preview-img">
                        <button type="button" class="photo-remove-btn" onclick="removePhoto(${index})" title="ì‚¬ì§„ ì‚­ì œ">
                            Ã—
                        </button>
                        <div class="photo-info">${file.name}</div>
                    `;
                    resolve(previewItem);
                };
                reader.readAsDataURL(file);
            });
        }
        
        // ì‚¬ì§„ ì‚­ì œ
        function removePhoto(index) {
            selectedPhotos.splice(index, 1);
            updatePhotoPreview();
            updatePhotoUploadText();
            
            // íŒŒì¼ input ê°’ ì—…ë°ì´íŠ¸
            const fileInput = document.getElementById('facility-photo');
            if (fileInput) {
                const dt = new DataTransfer();
                selectedPhotos.forEach(photo => dt.items.add(photo));
                fileInput.files = dt.files;
            }
        }
        
        // ì‚¬ì§„ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
        async function updatePhotoPreview() {
            const previewContainer = document.getElementById('facility-photo-preview');
            const uploadContainer = document.querySelector('.photo-upload-container');
            
            if (!previewContainer) return;
            
            previewContainer.innerHTML = '';
            
            for (let i = 0; i < selectedPhotos.length; i++) {
                const previewItem = await createPhotoPreview(selectedPhotos[i], i);
                previewContainer.appendChild(previewItem);
            }
            
            if (uploadContainer) {
                if (selectedPhotos.length > 0) {
                    uploadContainer.classList.add('has-photos');
                } else {
                    uploadContainer.classList.remove('has-photos');
                }
            }
        }
        
        // ì‚¬ì§„ íŒŒì¼ ì¶”ê°€
        async function addPhotos(files) {
            const filesToAdd = Array.from(files).slice(0, MAX_PHOTOS - selectedPhotos.length);
            
            for (const file of filesToAdd) {
                if (!validatePhoto(file)) continue;
                selectedPhotos.push(file);
            }
            
            if (selectedPhotos.length >= MAX_PHOTOS) {
                showAlert(`ìµœëŒ€ ${MAX_PHOTOS}ê°œì˜ ì‚¬ì§„ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`, 'warning');
            }
            
            await updatePhotoPreview();
            updatePhotoUploadText();
        }
        
        // ì‚¬ì§„ ì—…ë¡œë“œ ì„¤ì •
        function setupPhotoUpload() {
            const photoInput = document.getElementById('facility-photo');
            const uploadContainer = document.querySelector('.photo-upload-container');
            
            if (!photoInput || !uploadContainer) return;
            
            // íŒŒì¼ ì„ íƒ ì´ë²¤íŠ¸
            photoInput.addEventListener('change', async function(e) {
                const files = e.target.files;
                if (files.length > 0) {
                    await addPhotos(files);
                }
            });
            
            // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì´ë²¤íŠ¸
            uploadContainer.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadContainer.classList.add('dragover');
            });
            
            uploadContainer.addEventListener('dragleave', function(e) {
                e.preventDefault();
                if (!uploadContainer.contains(e.relatedTarget)) {
                    uploadContainer.classList.remove('dragover');
                }
            });
            
            uploadContainer.addEventListener('drop', async function(e) {
                e.preventDefault();
                uploadContainer.classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    await addPhotos(files);
                }
            });
            
            // ì»¨í…Œì´ë„ˆ í´ë¦­ ì‹œ íŒŒì¼ ì„ íƒ ì°½ ì—´ê¸°
            uploadContainer.addEventListener('click', function(e) {
                if (e.target === uploadContainer || e.target.classList.contains('photo-upload-display') || e.target.classList.contains('photo-upload-text')) {
                    photoInput.click();
                }
            });
        }
        
        // ìš”ì²­ ìƒì„¸ ì •ë³´ í‘œì‹œ
        function showRequestDetail(request) {
            const modal = document.getElementById('detail-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalBody = document.getElementById('modal-body');
            
            // ëª¨ë‹¬ ì œëª© ì„¤ì •
            const typeIcon = request.type === 'purchase' ? 'ğŸ›’' : 'ğŸ”§';
            const typeName = request.type === 'purchase' ? 'êµ¬ë§¤ ìš”ì²­' : 'ì‹œì„¤ ê´€ë¦¬ ìš”ì²­';
            modalTitle.innerHTML = `${typeIcon} ${typeName} ìƒì„¸ ì •ë³´`;
            
            // ìƒì„¸ ë‚´ìš© ìƒì„±
            modalBody.innerHTML = createDetailContent(request);
            
            // ëª¨ë‹¬ í‘œì‹œ
            modal.style.display = 'block';
            document.body.style.overflow = 'hidden';
        }
        
        // ìƒì„¸ ë‚´ìš© HTML ìƒì„±
        function createDetailContent(request) {
            const statusClass = getStatusBadgeClass(request.status);
            const statusBadge = `<span class="status-badge ${statusClass}">${request.status}</span>`;
            
            let content = `
                <div class="detail-section">
                    <h3>ğŸ“‹ ê¸°ë³¸ ì •ë³´</h3>
                    <div class="detail-row">
                        <span class="detail-label">ìš”ì²­ ID:</span>
                        <span class="detail-value">#${request.id}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">ìƒíƒœ:</span>
                        <span class="detail-value">${statusBadge}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">ìš”ì²­ì:</span>
                        <span class="detail-value">${request.requestedBy}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">ë¶€ì„œ:</span>
                        <span class="detail-value">${request.department}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">ë“±ë¡ì¼:</span>
                        <span class="detail-value">${formatDate(request.createdAt)}</span>
                    </div>
                </div>
            `;
            
            if (request.type === 'purchase') {
                content += createPurchaseDetailContent(request);
            } else {
                content += createFacilityDetailContent(request);
            }
            
            return content;
        }
        
        // êµ¬ë§¤ ìš”ì²­ ìƒì„¸ ë‚´ìš©
        function createPurchaseDetailContent(request) {
            let content = `
                <div class="detail-section">
                    <h3>ğŸ›’ êµ¬ë§¤ ì •ë³´</h3>
                    ${request.title ? `
                        <div class="detail-row">
                            <span class="detail-label">ìš”ì²­ ì œëª©:</span>
                            <span class="detail-value">${request.title}</span>
                        </div>
                    ` : ''}
                    <div class="detail-row">
                        <span class="detail-label">ë¬¼í’ˆëª…:</span>
                        <span class="detail-value">${request.item}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">ìˆ˜ëŸ‰:</span>
                        <span class="detail-value">${formatQuantity(request.quantity)}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">ìš°ì„ ìˆœìœ„:</span>
                        <span class="detail-value"><span class="status-badge ${getPriorityBadgeClass(request.priority || 'ë³´í†µ')}">${request.priority || 'ë³´í†µ'}</span></span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">êµ¬ë§¤ ì‚¬ìœ :</span>
                        <span class="detail-value">${request.reason}</span>
                    </div>
                </div>
            `;
            
            // ê²¬ì ì„œ íŒŒì¼ ì •ë³´
            if (request.quoteFile) {
                content += `
                    <div class="detail-section">
                        <h3>ğŸ“ ì²¨ë¶€ íŒŒì¼</h3>
                        <div class="file-list">
                            <div class="file-item" onclick="event.stopPropagation(); showFilePreview(${JSON.stringify(request.quoteFile).replace(/"/g, '&quot;')}, 'ê²¬ì ì„œ')">
                                <span class="file-icon">ğŸ“„</span>
                                <div class="file-info">
                                    <span class="file-name">${request.quoteFile.name}</span>
                                    <span class="file-size">${formatFileSize(request.quoteFile.size)}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            return content;
        }
        
        // ì‹œì„¤ ê´€ë¦¬ ìš”ì²­ ìƒì„¸ ë‚´ìš©
        function createFacilityDetailContent(request) {
            const priorityClass = getPriorityBadgeClass(request.priority);
            const priorityBadge = `<span class="status-badge ${priorityClass}">${request.priority}</span>`;
            
            let content = `
                <div class="detail-section">
                    <h3>ğŸ”§ ì‹œì„¤ ê´€ë¦¬ ì •ë³´</h3>
                    <div class="detail-row">
                        <span class="detail-label">ìš”ì²­ ì œëª©:</span>
                        <span class="detail-value">${request.title}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">ì‹œì„¤ ìœ í˜•:</span>
                        <span class="detail-value">${request.facilityType}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">ìš°ì„ ìˆœìœ„:</span>
                        <span class="detail-value">${priorityBadge}</span>
                    </div>
                    ${request.phone ? `
                        <div class="detail-row">
                            <span class="detail-label">ì—°ë½ì²˜:</span>
                            <span class="detail-value">${request.phone}</span>
                        </div>
                    ` : ''}
                    ${request.location ? `
                        <div class="detail-row">
                            <span class="detail-label">ìœ„ì¹˜:</span>
                            <span class="detail-value">${request.location}</span>
                        </div>
                    ` : ''}
                    <div class="detail-row">
                        <span class="detail-label">ìƒì„¸ ì„¤ëª…:</span>
                        <span class="detail-value">${request.description}</span>
                    </div>
                </div>
            `;
            
            // ì‹œì„¤ ì‚¬ì§„ ì •ë³´
            if (request.facilityPhotos && request.facilityPhotos.length > 0) {
                content += `
                    <div class="detail-section">
                        <h3>ğŸ“· ì²¨ë¶€ ì‚¬ì§„</h3>
                        <div class="file-list">
                `;
                
                request.facilityPhotos.forEach((photo, index) => {
                    content += `
                        <div class="file-item" onclick="event.stopPropagation(); showFilePreview(${JSON.stringify(request.facilityPhotos).replace(/"/g, '&quot;')}, 'ì‹œì„¤ ì‚¬ì§„')">
                            <span class="file-icon">ğŸ–¼ï¸</span>
                            <div class="file-info">
                                <span class="file-name">${photo.name}</span>
                                <span class="file-size">${formatFileSize(photo.size)}</span>
                            </div>
                        </div>
                    `;
                });
                
                content += `
                        </div>
                    </div>
                `;
            }
            
            return content;
        }
        
        // íŒŒì¼ ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
        function showFilePreview(files, title) {
            const modal = document.getElementById('file-preview-modal');
            const modalTitle = document.getElementById('file-modal-title');
            const modalBody = document.getElementById('file-modal-body');
            
            modalTitle.innerHTML = `ğŸ“ ${title}`;
            
            let content = '';
            
            if (Array.isArray(files)) {
                // ì‚¬ì§„ íŒŒì¼ë“¤ (ì‹œì„¤ ê´€ë¦¬)
                content = `
                    <div class="photo-grid">
                        ${files.map((photo, index) => `
                            <div class="photo-item">
                                <div style="width: 100%; height: 150px; background: #f3f4f6; display: flex; align-items: center; justify-content: center; color: #6b7280;">
                                    ğŸ–¼ï¸<br>
                                    <small>ë¯¸ë¦¬ë³´ê¸° ì¤€ë¹„ ì¤‘</small>
                                </div>
                                <div class="photo-info-overlay">
                                    <div class="file-name">${photo.name}</div>
                                    <div class="file-size">${formatFileSize(photo.size)}</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div style="margin-top: 16px; text-align: center; color: #6b7280;">
                        <p>ğŸ“ ì‹¤ì œ ìš´ì˜ í™˜ê²½ì—ì„œëŠ” ì—…ë¡œë“œëœ ì‚¬ì§„ì„ ë¯¸ë¦¬ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                    </div>
                `;
            } else {
                // ë‹¨ì¼ íŒŒì¼ (êµ¬ë§¤ ìš”ì²­ ê²¬ì ì„œ)
                content = `
                    <div class="file-list" style="justify-content: center;">
                        <div class="file-item" style="padding: 24px; background: #f8fafc;">
                            <span class="file-icon" style="font-size: 3rem;">ğŸ“„</span>
                            <div class="file-info" style="align-items: center;">
                                <span class="file-name" style="font-size: 1.1rem; max-width: none;">${files.name}</span>
                                <span class="file-size">${formatFileSize(files.size)}</span>
                                <div style="margin-top: 8px; color: #6b7280; font-size: 0.9rem;">
                                    íŒŒì¼ í˜•ì‹: ${getFileTypeDisplay(files.type)}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 16px; text-align: center; color: #6b7280;">
                        <p>ğŸ“ ì‹¤ì œ ìš´ì˜ í™˜ê²½ì—ì„œëŠ” íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ê±°ë‚˜ ë¯¸ë¦¬ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                    </div>
                `;
            }
            
            modalBody.innerHTML = content;
            modal.style.display = 'block';
        }
        
        // ìƒíƒœ ë±ƒì§€ í´ë˜ìŠ¤ ë°˜í™˜
        function getStatusBadgeClass(status) {
            const classes = {
                'ëŒ€ê¸°': 'badge-waiting',
                'ì§„í–‰ì¤‘': 'badge-progress', 
                'ì™„ë£Œ': 'badge-completed',
                'ì·¨ì†Œ': 'badge-cancelled'
            };
            return classes[status] || 'badge-waiting';
        }
        
        // ìš°ì„ ìˆœìœ„ ë±ƒì§€ í´ë˜ìŠ¤ ë°˜í™˜
        function getPriorityBadgeClass(priority) {
            const classes = {
                'ë‚®ìŒ': 'priority-low',
                'ë³´í†µ': 'priority-normal',
                'ë†’ìŒ': 'priority-high',
                'ê¸´ê¸‰': 'priority-urgent'
            };
            return classes[priority] || 'priority-normal';
        }
        
        // íŒŒì¼ í¬ê¸° í¬ë§·íŒ…
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // íŒŒì¼ íƒ€ì… í‘œì‹œëª… ë°˜í™˜
        function getFileTypeDisplay(mimeType) {
            const types = {
                'application/pdf': 'PDF ë¬¸ì„œ',
                'application/vnd.ms-excel': 'Excel íŒŒì¼',
                'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet': 'Excel íŒŒì¼',
                'application/x-hwp': 'í•œê¸€ ë¬¸ì„œ',
                'application/haansofthwp': 'í•œê¸€ ë¬¸ì„œ',
                'image/jpeg': 'JPEG ì´ë¯¸ì§€',
                'image/jpg': 'JPG ì´ë¯¸ì§€', 
                'image/png': 'PNG ì´ë¯¸ì§€',
                'image/gif': 'GIF ì´ë¯¸ì§€'
            };
            return types[mimeType] || 'ì•Œ ìˆ˜ ì—†ëŠ” í˜•ì‹';
        }
        
        // ëª¨ë‹¬ ë‹«ê¸° í•¨ìˆ˜ë“¤
        function closeDetailModal() {
            document.getElementById('detail-modal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }
        
        function closeFileModal() {
            document.getElementById('file-preview-modal').style.display = 'none';
        }
        
        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        window.onclick = function(event) {
            const detailModal = document.getElementById('detail-modal');
            const fileModal = document.getElementById('file-preview-modal');
            
            if (event.target === detailModal) {
                closeDetailModal();
            } else if (event.target === fileModal) {
                closeFileModal();
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ ë©”ì‹œì§€
        window.onload = function() {
            console.log('ğŸš€ í†µí•© ìš”ì²­ ê´€ë¦¬ ì‹œìŠ¤í…œì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤!');
            console.log('ğŸ’¡ ìš”ì²­ì„ ì œì¶œí•˜ë©´ ì½˜ì†”ì—ì„œ ë°ì´í„°ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
        };

        // Excel ë‹¤ìš´ë¡œë“œ í•¨ìˆ˜
        function exportToExcel(type) {
            try {
                let data = [];
                let fileName = '';
                
                if (type === 'all') {
                    // ì „ì²´ í˜„í™© ë°ì´í„°
                    const filteredRequests = getFilteredAllRequests();
                    fileName = 'ì „ì²´_ìš”ì²­_í˜„í™©';
                    
                    data = filteredRequests.map(request => ({
                        'ìœ í˜•': request.type === 'purchase' ? 'êµ¬ë§¤ ìš”ì²­' : 'ì‹œì„¤ ê´€ë¦¬',
                        'ì œëª©/ë¬¼í’ˆ': request.title || request.item || request.facility,
                        'ìˆ˜ëŸ‰/ìœ„ì¹˜': request.quantity ? formatQuantity(request.quantity) : request.location || '-',
                        'ì˜ˆì‚°': request.type === 'purchase' && request.budget ? request.budget.toLocaleString() + 'ì›' : '-',
                        'ìš°ì„ ìˆœìœ„': request.priority || 'ë³´í†µ',
                        'ìƒíƒœ': request.status,
                        'ìš”ì²­ì': request.requestedBy,
                        'ë¶€ì„œ': request.department,
                        'ë“±ë¡ì¼': new Date(request.createdAt).toLocaleDateString('ko-KR'),
                        'ì‚¬ìœ /ì„¤ëª…': request.reason || request.description || '-'
                    }));
                    
                } else if (type === 'purchase') {
                    // êµ¬ë§¤ ìš”ì²­ ë°ì´í„°
                    const filteredRequests = getFilteredPurchaseRequests();
                    fileName = 'êµ¬ë§¤_ìš”ì²­_ëª©ë¡';
                    
                    data = filteredRequests.map(request => ({
                        'ìš”ì²­ ì œëª©': request.title || request.item,
                        'ë¬¼í’ˆëª…': request.item,
                        'ìˆ˜ëŸ‰': formatQuantity(request.quantity),
                        'ì˜ˆì‚° (ì›)': request.budget ? request.budget.toLocaleString() : '-',
                        'ìš°ì„ ìˆœìœ„': request.priority || 'ë³´í†µ',
                        'ìƒíƒœ': request.status,
                        'ìš”ì²­ì': request.requestedBy,
                        'ë¶€ì„œ': request.department,
                        'êµ¬ë§¤ ì‚¬ìœ ': request.reason,
                        'ê²¬ì ì„œ': request.quoteFile ? 'ì²¨ë¶€ë¨' : 'ì—†ìŒ',
                        'ë“±ë¡ì¼': new Date(request.createdAt).toLocaleDateString('ko-KR')
                    }));
                    
                } else if (type === 'facility') {
                    // ì‹œì„¤ ê´€ë¦¬ ë°ì´í„°
                    const filteredRequests = getFilteredFacilityRequests();
                    fileName = 'ì‹œì„¤_ê´€ë¦¬_ëª©ë¡';
                    
                    data = filteredRequests.map(request => ({
                        'ì‹œì„¤ëª…': request.facility,
                        'ìœ„ì¹˜': request.location,
                        'ìš°ì„ ìˆœìœ„': request.priority,
                        'ìƒíƒœ': request.status,
                        'ìš”ì²­ì': request.requestedBy,
                        'ë¶€ì„œ': request.department,
                        'ë¬¸ì œ ì„¤ëª…': request.description,
                        'ì‚¬ì§„': request.facilityPhotos && request.facilityPhotos.length > 0 ? `${request.facilityPhotos.length}ê°œ ì²¨ë¶€` : 'ì—†ìŒ',
                        'ë“±ë¡ì¼': new Date(request.createdAt).toLocaleDateString('ko-KR')
                    }));
                }
                
                if (data.length === 0) {
                    alert('ë‹¤ìš´ë¡œë“œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                // Excel ì›Œí¬ë¶ ìƒì„±
                const wb = XLSX.utils.book_new();
                const ws = XLSX.utils.json_to_sheet(data);
                
                // ì—´ ë„ˆë¹„ ìë™ ì¡°ì •
                const colWidths = [];
                if (data.length > 0) {
                    const keys = Object.keys(data[0]);
                    keys.forEach(key => {
                        const maxLength = Math.max(
                            key.length,
                            ...data.map(row => String(row[key] || '').length)
                        );
                        colWidths.push({ width: Math.min(maxLength + 2, 50) });
                    });
                }
                ws['!cols'] = colWidths;
                
                // ì›Œí¬ì‹œíŠ¸ë¥¼ ì›Œí¬ë¶ì— ì¶”ê°€
                XLSX.utils.book_append_sheet(wb, ws, 'ìš”ì²­ëª©ë¡');
                
                // íŒŒì¼ ë‹¤ìš´ë¡œë“œ
                const today = new Date().toISOString().split('T')[0];
                XLSX.writeFile(wb, `${fileName}_${today}.xlsx`);
                
                console.log(`âœ… Excel íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ: ${fileName}_${today}.xlsx`);
                
            } catch (error) {
                console.error('âŒ Excel ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨:', error);
                alert('Excel ë‹¤ìš´ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // í•„í„°ë§ëœ ì „ì²´ ìš”ì²­ ê°€ì ¸ì˜¤ê¸°
        function getFilteredAllRequests() {
            const statusFilter = document.getElementById('all-status-filter')?.value || '';
            let filteredRequests = [...requests];
            
            if (statusFilter) {
                filteredRequests = filteredRequests.filter(request => request.status === statusFilter);
            }
            
            return filteredRequests.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
        }
        
        // í•„í„°ë§ëœ êµ¬ë§¤ ìš”ì²­ ê°€ì ¸ì˜¤ê¸°
        function getFilteredPurchaseRequests() {
            const statusFilter = document.getElementById('purchase-status-filter')?.value || '';
            let filteredRequests = requests.filter(request => request.type === 'purchase');
            
            if (statusFilter) {
                filteredRequests = filteredRequests.filter(request => request.status === statusFilter);
            }
            
            return filteredRequests.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
        }
        
        // í•„í„°ë§ëœ ì‹œì„¤ ê´€ë¦¬ ìš”ì²­ ê°€ì ¸ì˜¤ê¸°
        function getFilteredFacilityRequests() {
            const statusFilter = document.getElementById('facility-status-filter')?.value || '';
            const priorityFilter = document.getElementById('facility-priority-filter')?.value || '';
            let filteredRequests = requests.filter(request => request.type === 'facility');
            
            if (statusFilter) {
                filteredRequests = filteredRequests.filter(request => request.status === statusFilter);
            }
            
            if (priorityFilter) {
                filteredRequests = filteredRequests.filter(request => request.priority === priorityFilter);
            }
            
            return filteredRequests.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
        }

        // ê¸°ì•ˆì„œ í…œí”Œë¦¿ ê´€ë ¨ ë³€ìˆ˜
        let learnedTemplates = JSON.parse(localStorage.getItem('learnedTemplates') || '{}');
        
        // í”¼ë“œë°± ê·œì¹™ ì €ì¥ì†Œ
        let feedbackRules = JSON.parse(localStorage.getItem('feedbackRules') || '[]');
        
        // í…œí”Œë¦¿ íƒ­ ë¡œë“œ
        function loadTemplateTab() {
            displayLearnedTemplates();
            displayFeedbackRules();
        }
        
        // í”¼ë“œë°± í•™ìŠµ í•¨ìˆ˜
        function learnFeedback() {
            const feedbackText = document.getElementById('feedback-input').value.trim();
            const target = document.getElementById('feedback-target').value;
            
            if (!feedbackText) {
                alert('í”¼ë“œë°± ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            try {
                // í”¼ë“œë°±ì„ ê·œì¹™ìœ¼ë¡œ ë³€í™˜
                const rules = parseFeedbackToRules(feedbackText, target);
                
                // ê¸°ì¡´ ê·œì¹™ì— ì¶”ê°€
                feedbackRules.push(...rules);
                
                // localStorageì— ì €ì¥
                localStorage.setItem('feedbackRules', JSON.stringify(feedbackRules));
                
                // UI ì—…ë°ì´íŠ¸
                document.getElementById('feedback-input').value = '';
                displayFeedbackRules();
                
                showAlert(`${rules.length}ê°œì˜ ìƒˆë¡œìš´ ê·œì¹™ì´ í•™ìŠµë˜ì—ˆìŠµë‹ˆë‹¤!`, 'success');
                
            } catch (error) {
                console.error('í”¼ë“œë°± í•™ìŠµ ì‹¤íŒ¨:', error);
                alert('í”¼ë“œë°± í•™ìŠµ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // í”¼ë“œë°±ì„ ê·œì¹™ìœ¼ë¡œ ë³€í™˜ (ê°œì„ ëœ ë²„ì „)
        function parseFeedbackToRules(feedbackText, target) {
            const rules = [];
            const lines = feedbackText.split('\n').filter(line => line.trim());
            
            lines.forEach((line, index) => {
                const rule = {
                    id: Date.now() + Math.random() + index,
                    target: target,
                    original: line.trim(),
                    type: '',
                    action: '',
                    content: '',
                    keywords: [],
                    priority: 1,
                    createdAt: new Date().toISOString()
                };
                
                const lowerLine = line.toLowerCase().trim();
                console.log('ğŸ” í”¼ë“œë°± ë¶„ì„ ì¤‘:', lowerLine);
                
                // 1. ì œì™¸/ì‚­ì œ ê·œì¹™
                if (lowerLine.includes('ì•ˆë“¤ì–´ê°€ê²Œ') || lowerLine.includes('ì œì™¸') || lowerLine.includes('ë¹¼ì¤˜') || 
                    lowerLine.includes('ì‚­ì œ') || lowerLine.includes('ì•ˆë‚˜ì˜¤ê²Œ') || lowerLine.includes('ì—†ì• ')) {
                    
                    rule.type = 'exclude';
                    rule.action = 'remove';
                    
                    // êµ¬ì¡°ì  ì‚­ì œ íŒ¨í„´ ë¶„ì„
                    const structuralPatterns = [
                        /(\d+)ë²ˆ?\s*(í•„ìš”ì„±|ëª©ì |ë‚´ìš©|ê¸°íƒ€ì‚¬í•­)\s*(ë¶€í„°|ì´í›„)\s*(ì•„ë˜|ëª¨ë“ ?\s*ë‚´ìš©)?/i,
                        /(í•„ìš”ì„±|ëª©ì |ë‚´ìš©|ê¸°íƒ€ì‚¬í•­)\s*(ë¶€í„°|ì´í›„)\s*(ì•„ë˜|ëª¨ë“ ?\s*ë‚´ìš©)?/i,
                        /(\d+)\.\s*(í•„ìš”ì„±|ëª©ì |êµ¬ë§¤\s*ë‚´ìš©|ìˆ˜ë¦¬\s*ë‚´ìš©|ê¸°íƒ€ì‚¬í•­)\s*(ë¶€í„°|ì´í›„)/i,
                        /(í•„ìš”ì„±|ëª©ì |ê¸°íƒ€ì‚¬í•­)\s*(ì´í•˜|ì´í›„|ë¶€í„°)\s*(ëª¨ë“ ?\s*ë‚´ìš©|ë‹¤|ì „ë¶€)?/i
                    ];
                    
                    let isStructural = false;
                    for (let pattern of structuralPatterns) {
                        const match = line.match(pattern);
                        if (match) {
                            rule.structuralDelete = {
                                sectionNumber: match[1] || null,
                                sectionName: match[2] || match[1],
                                deleteType: 'fromSection',
                                scope: match[3] || match[4] ? 'below' : 'section'
                            };
                            rule.content = `êµ¬ì¡°ì  ì‚­ì œ: ${match[0]}`;
                            isStructural = true;
                            console.log('ğŸ—ï¸ êµ¬ì¡°ì  ì‚­ì œ íŒ¨í„´ ê°ì§€:', rule.structuralDelete);
                            break;
                        }
                    }
                    
                    if (!isStructural) {
                        // ë”°ì˜´í‘œë¡œ ê°ì‹¸ì§„ í‚¤ì›Œë“œ ì¶”ì¶œ
                        const quotedMatches = line.match(/['"`]([^'"`]+)['"`]/g);
                        if (quotedMatches) {
                            rule.keywords = quotedMatches.map(match => match.replace(/['"`]/g, ''));
                        } else {
                            // ì¼ë°˜ì ì¸ í‚¤ì›Œë“œ ì¶”ì¶œ
                            const keywords = [];
                            if (lowerLine.includes('ê²¬ì ì„œ')) keywords.push('ê²¬ì ì„œ');
                            if (lowerLine.includes('ì²¨ë¶€')) keywords.push('ì²¨ë¶€');
                            if (lowerLine.includes('í•„ìš”ì„±')) keywords.push('í•„ìš”ì„±');
                            if (lowerLine.includes('ê¸°íƒ€ì‚¬í•­')) keywords.push('ê¸°íƒ€ì‚¬í•­');
                            if (lowerLine.includes('ì´ìƒê³¼ ê°™ì´')) keywords.push('ì´ìƒê³¼ ê°™ì´');
                            rule.keywords = keywords;
                        }
                        rule.content = rule.keywords.join(' ');
                    }
                    
                } 
                // 2. ì¶”ê°€ ê·œì¹™
                else if (lowerLine.includes('ì¶”ê°€') || lowerLine.includes('ë„£ì–´ì¤˜') || lowerLine.includes('í¬í•¨') ||
                         lowerLine.includes('ì¨ì¤˜') || lowerLine.includes('ë“¤ì–´ê°€ê²Œ')) {
                    
                    rule.type = 'include';
                    rule.action = 'add';
                    
                    const quotedMatches = line.match(/['"`]([^'"`]+)['"`]/g);
                    if (quotedMatches) {
                        rule.content = quotedMatches[0].replace(/['"`]/g, '');
                    } else {
                        // í‚¤ì›Œë“œ ì¶”ì¶œ ì‹œë„
                        const addMatch = lowerLine.match(/(.*?)(ì¶”ê°€|ë„£ì–´ì¤˜|í¬í•¨|ì¨ì¤˜|ë“¤ì–´ê°€ê²Œ)/);
                        if (addMatch) {
                            rule.content = addMatch[1].trim();
                        }
                    }
                    
                } 
                // 3. ê°„ì†Œí™” ê·œì¹™
                else if (lowerLine.includes('ê°„ë‹¨') || lowerLine.includes('ì§§ê²Œ') || lowerLine.includes('ê°„ì†Œ') ||
                         lowerLine.includes('ì¶•ì•½') || lowerLine.includes('ì¤„ì—¬')) {
                    
                    rule.type = 'simplify';
                    rule.action = 'modify';
                    rule.content = 'simple';
                    
                }
                // 4. êµì²´ ê·œì¹™
                else if (lowerLine.includes('ë°”ê¿”') || lowerLine.includes('ë³€ê²½') || lowerLine.includes('êµì²´') ||
                         lowerLine.includes('ëŒ€ì‹ ')) {
                    
                    rule.type = 'replace';
                    rule.action = 'replace';
                    
                    // "Aë¥¼ Bë¡œ", "A â†’ B", "Aì—ì„œ Bë¡œ" íŒ¨í„´ ì°¾ê¸°
                    const replacePatterns = [
                        /['"`]([^'"`]+)['"`].*?['"`]([^'"`]+)['"`]/,
                        /(\w+)ë¥¼\s*(\w+)ë¡œ/,
                        /(\w+)\s*â†’\s*(\w+)/,
                        /(\w+)ì—ì„œ\s*(\w+)ë¡œ/
                    ];
                    
                    for (let pattern of replacePatterns) {
                        const match = line.match(pattern);
                        if (match) {
                            rule.content = `${match[1]}â†’${match[2]}`;
                            break;
                        }
                    }
                }
                // 5. ê³µì‹í™” ê·œì¹™
                else if (lowerLine.includes('ê³µì‹ì ') || lowerLine.includes('ê²©ì‹') || lowerLine.includes('ì •ì¤‘') ||
                         lowerLine.includes('formal')) {
                    
                    rule.type = 'formal';
                    rule.action = 'modify';
                    rule.content = 'formal';
                }
                // 6. ì¼ë°˜ ìš”ì²­
                else {
                    rule.type = 'general';
                    rule.action = 'note';
                    rule.content = line.trim();
                }
                
                // ìœ íš¨í•œ ê·œì¹™ë§Œ ì¶”ê°€
                if (rule.content || rule.keywords.length > 0) {
                    console.log('âœ… ê·œì¹™ ìƒì„±ë¨:', rule);
                    rules.push(rule);
                } else {
                    console.log('âŒ ê·œì¹™ ìƒì„± ì‹¤íŒ¨:', line);
                }
            });
            
            return rules;
        }
        
        // í•™ìŠµëœ í”¼ë“œë°± ê·œì¹™ í‘œì‹œ
        function displayFeedbackRules() {
            const container = document.getElementById('feedback-rules-list');
            if (!container) return;
            
            if (feedbackRules.length === 0) {
                container.innerHTML = `
                    <div style="color: #6b7280; text-align: center; padding: 2rem;">
                        ì•„ì§ í•™ìŠµëœ í”¼ë“œë°± ê·œì¹™ì´ ì—†ìŠµë‹ˆë‹¤.
                    </div>
                `;
                return;
            }
            
            const rulesByTarget = {
                both: feedbackRules.filter(r => r.target === 'both'),
                purchase: feedbackRules.filter(r => r.target === 'purchase'),
                facility: feedbackRules.filter(r => r.target === 'facility')
            };
            
            let html = '';
            
            Object.entries(rulesByTarget).forEach(([target, rules]) => {
                if (rules.length === 0) return;
                
                const targetName = target === 'both' ? 'ì „ì²´' : target === 'purchase' ? 'êµ¬ë§¤ ìš”ì²­' : 'ì‹œì„¤ ê´€ë¦¬';
                const targetColor = target === 'both' ? '#64748b' : target === 'purchase' ? '#2563eb' : '#22c55e';
                
                html += `
                    <div style="margin-bottom: 2rem;">
                        <h4 style="color: ${targetColor}; margin-bottom: 1rem;">${getTargetIcon(target)} ${targetName} (${rules.length}ê°œ)</h4>
                        ${rules.map(rule => `
                            <div style="background: white; padding: 1rem; border-radius: 8px; margin-bottom: 0.5rem; border-left: 4px solid ${targetColor};">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <div style="font-weight: 600; color: #374151; margin-bottom: 0.5rem;">
                                            ${rule.structuralDelete ? 'ğŸ—ï¸ êµ¬ì¡°ì  ì‚­ì œ' : `${getRuleTypeIcon(rule.type)} ${getRuleTypeName(rule.type)}`}:</strong> ${rule.original}
                                        </div>
                                        <div style="color: #6b7280; font-size: 0.9rem;">
                                            ${rule.original}
                                        </div>
                                        <div style="color: #9ca3af; font-size: 0.8rem; margin-top: 0.5rem;">
                                            í•™ìŠµì¼: ${new Date(rule.createdAt).toLocaleDateString('ko-KR')}
                                        </div>
                                    </div>
                                    <button onclick="deleteFeedbackRule('${rule.id}')" style="background: #ef4444; color: white; border: none; padding: 0.5rem; border-radius: 4px; font-size: 0.8rem;">
                                        ì‚­ì œ
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // ê·œì¹™ íƒ€ì…ë³„ ì•„ì´ì½˜
        function getRuleTypeIcon(type) {
            const icons = {
                exclude: 'ğŸš«',
                include: 'â•',
                simplify: 'âœ‚ï¸',
                detail: 'ğŸ“',
                formal: 'ğŸ©',
                replace: 'ğŸ”„',
                general: 'ğŸ’­'
            };
            return icons[type] || 'ğŸ“‹';
        }
        
        // ê·œì¹™ íƒ€ì…ë³„ ì´ë¦„
        function getRuleTypeName(type) {
            const names = {
                exclude: 'ë‚´ìš© ì œì™¸',
                include: 'ë‚´ìš© ì¶”ê°€',
                simplify: 'ê°„ì†Œí™”',
                detail: 'ìƒì„¸í™”',
                formal: 'ê³µì‹í™”',
                replace: 'ë‚´ìš© êµì²´',
                general: 'ì¼ë°˜ ìš”ì²­'
            };
            return names[type] || 'ê¸°íƒ€';
        }
        
        // ëŒ€ìƒë³„ ì•„ì´ì½˜
        function getTargetIcon(target) {
            const icons = {
                both: 'ğŸ¯',
                purchase: 'ğŸ›’',
                facility: 'ğŸ”§'
            };
            return icons[target] || 'ğŸ“‹';
        }
        
        // í”¼ë“œë°± ê·œì¹™ ì‚­ì œ
        function deleteFeedbackRule(ruleId) {
            if (!confirm('ì´ ê·œì¹™ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            feedbackRules = feedbackRules.filter(rule => rule.id !== ruleId);
            localStorage.setItem('feedbackRules', JSON.stringify(feedbackRules));
            displayFeedbackRules();
            showAlert('ê·œì¹™ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        }
        
        // ëª¨ë“  í”¼ë“œë°± ê·œì¹™ ì´ˆê¸°í™”
        function clearAllFeedbackRules() {
            if (!confirm('ëª¨ë“  í”¼ë“œë°± ê·œì¹™ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            feedbackRules = [];
            localStorage.setItem('feedbackRules', JSON.stringify(feedbackRules));
            displayFeedbackRules();
            showAlert('ëª¨ë“  í”¼ë“œë°± ê·œì¹™ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        }
        
        // í”¼ë“œë°± ê·œì¹™ í…ŒìŠ¤íŠ¸ (ê°œì„ ëœ ë²„ì „)
        function testFeedbackRules() {
            if (feedbackRules.length === 0) {
                alert('í…ŒìŠ¤íŠ¸í•  í”¼ë“œë°± ê·œì¹™ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            console.log('ğŸ§ª í”¼ë“œë°± ê·œì¹™ í…ŒìŠ¤íŠ¸ ì‹œì‘');
            
            // êµ¬ë§¤ ìš”ì²­ê³¼ ì‹œì„¤ ê´€ë¦¬ ë‘˜ ë‹¤ í…ŒìŠ¤íŠ¸
            const sampleRequests = [
                {
                    type: 'purchase',
                    title: 'í…ŒìŠ¤íŠ¸ ë…¸íŠ¸ë¶ êµ¬ë§¤',
                    item: 'ì—…ë¬´ìš© ë…¸íŠ¸ë¶',
                    quantity: 2,
                    reason: 'ê¸°ì¡´ ë…¸íŠ¸ë¶ ë…¸í›„í™”ë¡œ ì¸í•œ êµì²´ í•„ìš”',
                    requestedBy: 'í™ê¸¸ë™',
                    department: 'ì „ì‚°íŒ€',
                    priority: 'ë†’ìŒ',
                    quoteFile: true
                },
                {
                    type: 'facility',
                    facility: 'ê°•ì˜ì‹¤ ì—ì–´ì»¨',
                    facilityType: 'ëƒ‰ë‚œë°©',
                    location: 'ë³¸ê´€ 201í˜¸',
                    description: 'ì—ì–´ì»¨ ëƒ‰ê° ê¸°ëŠ¥ ë¶ˆëŸ‰ìœ¼ë¡œ ìˆ˜ë¦¬ í•„ìš”',
                    requestedBy: 'ê¹€ì˜í¬',
                    department: 'ì‹œì„¤ê´€ë¦¬íŒ€',
                    priority: 'ê¸´ê¸‰',
                    facilityPhotos: [{name: 'test.jpg'}]
                }
            ];
            
            let testResults = [];
            
            sampleRequests.forEach(sampleRequest => {
                console.log(`ğŸ” ${sampleRequest.type} íƒ€ì… í…ŒìŠ¤íŠ¸ ì¤‘...`);
                
                // ì›ë³¸ ê¸°ì•ˆì„œ ìƒì„± (ê·œì¹™ ì ìš© ì „)
                const originalDraft = generateDraftWithRules(sampleRequest, sampleRequest.type, false);
                
                // ê·œì¹™ ì ìš©ëœ ê¸°ì•ˆì„œ ìƒì„±
                const modifiedDraft = generateDraftWithRules(sampleRequest, sampleRequest.type, true);
                
                // ì ìš©ëœ ê·œì¹™ ëª©ë¡
                const applicableRules = feedbackRules.filter(rule => 
                    rule.target === sampleRequest.type || rule.target === 'both'
                );
                
                testResults.push({
                    type: sampleRequest.type,
                    original: originalDraft,
                    modified: modifiedDraft,
                    rules: applicableRules,
                    hasChanges: originalDraft !== modifiedDraft
                });
            });
            
            // í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¥¼ ìƒì„¸í•˜ê²Œ í‘œì‹œ
            const testWindow = window.open('', '_blank', 'width=1000,height=900,scrollbars=yes');
            testWindow.document.write(`
                <html>
                <head>
                    <title>ğŸ§ª í”¼ë“œë°± ê·œì¹™ í…ŒìŠ¤íŠ¸ ê²°ê³¼</title>
                    <style>
                        body { 
                            font-family: 'Malgun Gothic', sans-serif; 
                            padding: 2rem; 
                            line-height: 1.6; 
                            background: #f8fafc;
                        }
                        .container { max-width: 1200px; margin: 0 auto; }
                        .test-section { 
                            background: white; 
                            margin-bottom: 2rem; 
                            border-radius: 12px; 
                            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                            overflow: hidden;
                        }
                        .section-header { 
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                            color: white; 
                            padding: 1.5rem; 
                            font-weight: bold; 
                            font-size: 1.2rem;
                        }
                        .section-content { padding: 1.5rem; }
                        .rules-list { 
                            background: #f0f9ff; 
                            padding: 1rem; 
                            border-radius: 8px; 
                            border-left: 4px solid #0ea5e9;
                            margin-bottom: 1rem;
                        }
                        .comparison { 
                            display: grid; 
                            grid-template-columns: 1fr 1fr; 
                            gap: 1rem; 
                            margin-top: 1rem;
                        }
                        .draft-box { 
                            background: #f8fafc; 
                            padding: 1.5rem; 
                            border-radius: 8px; 
                            white-space: pre-wrap; 
                            font-family: 'Courier New', monospace;
                            font-size: 0.9rem;
                            border: 2px solid #e2e8f0;
                            max-height: 500px;
                            overflow-y: auto;
                        }
                        .original { border-left: 4px solid #ef4444; }
                        .modified { border-left: 4px solid #22c55e; }
                        .no-changes { color: #6b7280; font-style: italic; }
                        .changes-detected { color: #059669; font-weight: bold; }
                        .rule-item { 
                            padding: 0.5rem; 
                            margin: 0.25rem 0; 
                            background: rgba(14, 165, 233, 0.1); 
                            border-radius: 4px;
                            font-size: 0.9rem;
                        }
                    </style>
                </head>
                <body>
                    <div class="container">
                        <h1 style="text-align: center; color: #1e293b; margin-bottom: 2rem;">
                            ğŸ§ª í”¼ë“œë°± ê·œì¹™ í…ŒìŠ¤íŠ¸ ê²°ê³¼
                        </h1>
                        
                        ${testResults.map(result => `
                            <div class="test-section">
                                <div class="section-header">
                                    ${result.type === 'purchase' ? 'ğŸ›’ êµ¬ë§¤ ìš”ì²­' : 'ğŸ”§ ì‹œì„¤ ê´€ë¦¬'} í…ŒìŠ¤íŠ¸
                                    ${result.hasChanges ? '<span class="changes-detected"> âœ… ë³€ê²½ì‚¬í•­ ê°ì§€ë¨</span>' : '<span class="no-changes"> âš ï¸ ë³€ê²½ì‚¬í•­ ì—†ìŒ</span>'}
                                </div>
                                <div class="section-content">
                                    <div class="rules-list">
                                        <h4 style="margin-top: 0;">ğŸ“‹ ì ìš©ëœ ê·œì¹™ (${result.rules.length}ê°œ):</h4>
                                        ${result.rules.length > 0 ? 
                                            result.rules.map(rule => `
                                                <div class="rule-item">
                                                    <strong>${getRuleTypeIcon(rule.type)} ${getRuleTypeName(rule.type)}:</strong> ${rule.original}
                                                </div>
                                            `).join('') 
                                            : '<div class="no-changes">ì ìš©ëœ ê·œì¹™ì´ ì—†ìŠµë‹ˆë‹¤.</div>'
                                        }
                                    </div>
                                    
                                    <div class="comparison">
                                        <div>
                                            <h4 style="color: #ef4444;">ğŸ“„ ì›ë³¸ ê¸°ì•ˆì„œ</h4>
                                            <div class="draft-box original">${result.original}</div>
                                        </div>
                                        <div>
                                            <h4 style="color: #22c55e;">ğŸ“ ê·œì¹™ ì ìš© í›„</h4>
                                            <div class="draft-box modified">${result.modified}</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                        
                        <div style="text-align: center; margin-top: 2rem; padding: 1rem; background: #fef7ed; border-radius: 8px; border: 2px solid #f97316;">
                            <p><strong>ğŸ’¡ Tip:</strong> ê·œì¹™ì´ ì œëŒ€ë¡œ ì ìš©ë˜ì§€ ì•Šìœ¼ë©´ í”¼ë“œë°± ë¬¸êµ¬ë¥¼ ë” êµ¬ì²´ì ìœ¼ë¡œ ì‘ì„±í•´ë³´ì„¸ìš”!</p>
                            <p>ì˜ˆ: "ê²¬ì ì„œ ì²¨ë¶€ ê´€ë ¨ ë‚´ìš©ì´ ì•ˆë“¤ì–´ê°€ê²Œ í•´ì¤˜" â†’ êµ¬ì²´ì ì´ê³  ëª…í™•í•¨</p>
                        </div>
                    </div>
                </body>
                </html>
            `);
            
                         showAlert('í”¼ë“œë°± ê·œì¹™ í…ŒìŠ¤íŠ¸ ì™„ë£Œ! ìƒˆ ì°½ì—ì„œ ìƒì„¸ ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”.', 'success');
         }
         
         // í”¼ë“œë°± ì‹œìŠ¤í…œ ë””ë²„ê¹…
         function debugFeedbackSystem() {
             console.clear();
             console.log('ğŸ” í”¼ë“œë°± ì‹œìŠ¤í…œ ë””ë²„ê¹… ì‹œì‘...');
             
             const debug = {
                 ì´ê·œì¹™ìˆ˜: feedbackRules.length,
                 êµ¬ë§¤ê·œì¹™ìˆ˜: feedbackRules.filter(r => r.target === 'purchase' || r.target === 'both').length,
                 ì‹œì„¤ê·œì¹™ìˆ˜: feedbackRules.filter(r => r.target === 'facility' || r.target === 'both').length,
                 ê·œì¹™ìœ í˜•ë³„: {},
                 ì ì¬ì ë¬¸ì œ: [],
                 ì‹œìŠ¤í…œìƒíƒœ: 'ì •ìƒ'
             };
             
             // ê·œì¹™ ìœ í˜•ë³„ í†µê³„
             const ruleTypes = ['exclude', 'include', 'simplify', 'replace', 'formal', 'general'];
             ruleTypes.forEach(type => {
                 debug.ê·œì¹™ìœ í˜•ë³„[type] = feedbackRules.filter(r => r.type === type).length;
             });
             
             // ì ì¬ì  ë¬¸ì œ ê²€ì‚¬
             feedbackRules.forEach((rule, index) => {
                 // ë¹ˆ content ê²€ì‚¬
                 if (!rule.content && (!rule.keywords || rule.keywords.length === 0)) {
                     debug.ì ì¬ì ë¬¸ì œ.push(`ê·œì¹™ ${index + 1}: ë¹ˆ ë‚´ìš© - "${rule.original}"`);
                 }
                 
                 // exclude ê·œì¹™ì—ì„œ í‚¤ì›Œë“œ ëˆ„ë½ ê²€ì‚¬
                 if (rule.type === 'exclude' && (!rule.keywords || rule.keywords.length === 0) && !rule.content) {
                     debug.ì ì¬ì ë¬¸ì œ.push(`ê·œì¹™ ${index + 1}: ì œì™¸ í‚¤ì›Œë“œ ëˆ„ë½ - "${rule.original}"`);
                 }
                 
                 // replace ê·œì¹™ì—ì„œ â†’ ëˆ„ë½ ê²€ì‚¬
                 if (rule.type === 'replace' && (!rule.content || !rule.content.includes('â†’'))) {
                     debug.ì ì¬ì ë¬¸ì œ.push(`ê·œì¹™ ${index + 1}: êµì²´ íŒ¨í„´ ì˜¤ë¥˜ - "${rule.original}"`);
                 }
             });
             
             // ì‹œìŠ¤í…œ ìƒíƒœ í‰ê°€
             if (debug.ì ì¬ì ë¬¸ì œ.length > 0) {
                 debug.ì‹œìŠ¤í…œìƒíƒœ = 'ì£¼ì˜ í•„ìš”';
             }
             
             console.table(debug);
             
             if (debug.ì ì¬ì ë¬¸ì œ.length > 0) {
                 console.warn('âš ï¸ ë°œê²¬ëœ ë¬¸ì œë“¤:');
                 debug.ì ì¬ì ë¬¸ì œ.forEach(problem => console.warn(`- ${problem}`));
             }
             
             // ìƒ˜í”Œ ê·œì¹™ ì ìš© í…ŒìŠ¤íŠ¸
             console.log('\nğŸ§ª ìƒ˜í”Œ í…ìŠ¤íŠ¸ë¡œ ê·œì¹™ ì ìš© í…ŒìŠ¤íŠ¸:');
             const sampleText = 'ê²¬ì ì„œ ì²¨ë¶€ê°€ í•„ìš”í•©ë‹ˆë‹¤. ì´ìƒê³¼ ê°™ì´ ê¸°ì•ˆí•˜ì˜¤ë‹ˆ ê²€í†  í›„ ìŠ¹ì¸í•˜ì—¬ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.';
             console.log('ì›ë³¸:', sampleText);
             
             let testText = sampleText;
             feedbackRules.forEach((rule, index) => {
                 const beforeText = testText;
                 testText = applyFeedbackRule(testText, rule);
                 if (beforeText !== testText) {
                     console.log(`ê·œì¹™ ${index + 1} ì ìš©ë¨:`, testText);
                 }
             });
             
             // ì‚¬ìš©ìì—ê²Œ ê²°ê³¼ í‘œì‹œ
             let message = `ğŸ” ë””ë²„ê¹… ì™„ë£Œ!\n\n`;
             message += `ğŸ“Š í˜„ì¬ ìƒíƒœ:\n`;
             message += `- ì´ ê·œì¹™ ìˆ˜: ${debug.ì´ê·œì¹™ìˆ˜}ê°œ\n`;
             message += `- êµ¬ë§¤ ê´€ë ¨ ê·œì¹™: ${debug.êµ¬ë§¤ê·œì¹™ìˆ˜}ê°œ\n`;
             message += `- ì‹œì„¤ ê´€ë ¨ ê·œì¹™: ${debug.ì‹œì„¤ê·œì¹™ìˆ˜}ê°œ\n`;
             message += `- ì‹œìŠ¤í…œ ìƒíƒœ: ${debug.ì‹œìŠ¤í…œìƒíƒœ}\n\n`;
             
             if (debug.ì ì¬ì ë¬¸ì œ.length > 0) {
                 message += `âš ï¸ ë°œê²¬ëœ ë¬¸ì œ (${debug.ì ì¬ì ë¬¸ì œ.length}ê°œ):\n`;
                 debug.ì ì¬ì ë¬¸ì œ.forEach(problem => {
                     message += `â€¢ ${problem}\n`;
                 });
                 message += `\ní•´ê²° ë°©ë²•: ë¬¸ì œê°€ ìˆëŠ” ê·œì¹™ì„ ì‚­ì œí•˜ê³  ë‹¤ì‹œ í•™ìŠµí•´ì£¼ì„¸ìš”.`;
             } else {
                 message += `âœ… ë¬¸ì œê°€ ë°œê²¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!`;
             }
             
             message += `\n\nğŸ’¡ ìì„¸í•œ ì •ë³´ëŠ” ë¸Œë¼ìš°ì € ì½˜ì†”(F12)ì„ í™•ì¸í•˜ì„¸ìš”.`;
             
             alert(message);
             
             console.log('âœ… ë””ë²„ê¹… ì™„ë£Œ. ìœ„ ì •ë³´ë¥¼ ì°¸ê³ í•˜ì—¬ í”¼ë“œë°± ì‹œìŠ¤í…œì„ ê°œì„ í•˜ì„¸ìš”.');
         }
        
        // í”¼ë“œë°± ê·œì¹™ì´ ì ìš©ëœ ê¸°ì•ˆì„œ ìƒì„± (ê°œì„ ëœ ë²„ì „)
        function generateDraftWithRules(requestData, type, applyRules = true) {
            const today = new Date().toLocaleDateString('ko-KR');
            let draftText = '';
            
            console.log(`ğŸ“ ê¸°ì•ˆì„œ ìƒì„± ì¤‘: ${type}, ê·œì¹™ ì ìš©: ${applyRules}`);
            
            // ê¸°ë³¸ ê¸°ì•ˆì„œ ìƒì„±
            if (type === 'purchase') {
                draftText = `ê¸° ì•ˆ

ì œëª©: ${requestData.title} êµ¬ë§¤ ìš”ì²­

1. ëª©ì 
   ${requestData.reason}

2. êµ¬ë§¤ ë‚´ìš©
   - ë¬¼í’ˆëª…: ${requestData.item}
   - ìˆ˜ëŸ‰: ${formatQuantity(requestData.quantity)}
   - ìš°ì„ ìˆœìœ„: ${requestData.priority}
   - ìš”ì²­ì: ${requestData.requestedBy} (${requestData.department})

3. í•„ìš”ì„±
   ì—…ë¬´ íš¨ìœ¨ì„± í–¥ìƒ ë° ì›í™œí•œ ì—…ë¬´ ìˆ˜í–‰ì„ ìœ„í•´ ìƒê¸° ë¬¼í’ˆì˜ êµ¬ë§¤ê°€ í•„ìš”í•©ë‹ˆë‹¤.

4. ê¸°íƒ€ì‚¬í•­
   ${requestData.quoteFile ? 'ê²¬ì ì„œ ì²¨ë¶€' : 'ê²¬ì ì„œ ë³„ë„ ì œì¶œ ì˜ˆì •'}

ì´ìƒê³¼ ê°™ì´ ê¸°ì•ˆí•˜ì˜¤ë‹ˆ ê²€í†  í›„ ìŠ¹ì¸í•˜ì—¬ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.

${today}

${requestData.department} ${requestData.requestedBy}`;
            } else {
                draftText = `ê¸° ì•ˆ

ì œëª©: ${requestData.facility} ì‹œì„¤ ìˆ˜ë¦¬ ìš”ì²­

1. ëª©ì 
   ì‹œì„¤ ìœ ì§€ë³´ìˆ˜ë¥¼ í†µí•œ ì•ˆì „í•˜ê³  ì¾Œì í•œ êµìœ¡í™˜ê²½ ì¡°ì„±

2. ìˆ˜ë¦¬ ë‚´ìš©
   - ì‹œì„¤ëª…: ${requestData.facility}
   - ì‹œì„¤ ìœ í˜•: ${requestData.facilityType || 'ì¼ë°˜ì‹œì„¤'}
   - ìœ„ì¹˜: ${requestData.location}
   - ë¬¸ì œìƒí™©: ${requestData.description}
   - ìš°ì„ ìˆœìœ„: ${requestData.priority}
   - ìš”ì²­ì: ${requestData.requestedBy} (${requestData.department})

3. í•„ìš”ì„±
   ${requestData.description}
   
   ìƒê¸° ì‹œì„¤ì˜ ì‹ ì†í•œ ìˆ˜ë¦¬ë¥¼ í†µí•´ ì•ˆì „ì‚¬ê³ ë¥¼ ì˜ˆë°©í•˜ê³  ì›í™œí•œ ì‹œì„¤ ì´ìš©ì´ ê°€ëŠ¥í•˜ë„ë¡ ì¡°ì¹˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.

4. ê¸°íƒ€ì‚¬í•­
   ${requestData.facilityPhotos && requestData.facilityPhotos.length > 0 ? `í˜„ì¥ ì‚¬ì§„ ${requestData.facilityPhotos.length}ì¥ ì²¨ë¶€` : 'í˜„ì¥ ì‚¬ì§„ ë³„ë„ ì²¨ë¶€ ì˜ˆì •'}

ì´ìƒê³¼ ê°™ì´ ê¸°ì•ˆí•˜ì˜¤ë‹ˆ ê²€í†  í›„ ìŠ¹ì¸í•˜ì—¬ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.

${today}

${requestData.department} ${requestData.requestedBy}`;
            }
            
            // ê·œì¹™ ì ìš© ì—¬ë¶€ í™•ì¸
            if (!applyRules) {
                console.log('ğŸ“„ ì›ë³¸ ê¸°ì•ˆì„œ ìƒì„± ì™„ë£Œ (ê·œì¹™ ì ìš© ì•ˆí•¨)');
                return draftText;
            }
            
            // í”¼ë“œë°± ê·œì¹™ ì ìš©
            const applicableRules = feedbackRules.filter(rule => 
                rule.target === type || rule.target === 'both'
            );
            
            console.log(`ğŸ”§ ì ìš© ê°€ëŠ¥í•œ ê·œì¹™: ${applicableRules.length}ê°œ`);
            
            if (applicableRules.length === 0) {
                console.log('âš ï¸ ì ìš©í•  ê·œì¹™ì´ ì—†ìŠµë‹ˆë‹¤.');
                return draftText;
            }
            
            // ê·œì¹™ì„ ìš°ì„ ìˆœìœ„ ìˆœìœ¼ë¡œ ì •ë ¬ í›„ ì ìš©
            const sortedRules = applicableRules.sort((a, b) => {
                // ì œì™¸ ê·œì¹™ì„ ë¨¼ì € ì ìš©
                if (a.type === 'exclude' && b.type !== 'exclude') return -1;
                if (b.type === 'exclude' && a.type !== 'exclude') return 1;
                
                // êµì²´ ê·œì¹™ì„ ë‹¤ìŒì— ì ìš©
                if (a.type === 'replace' && b.type !== 'replace' && b.type !== 'exclude') return -1;
                if (b.type === 'replace' && a.type !== 'replace' && a.type !== 'exclude') return 1;
                
                // ê°„ì†Œí™” ê·œì¹™
                if (a.type === 'simplify' && b.type === 'include') return -1;
                if (b.type === 'simplify' && a.type === 'include') return 1;
                
                // ì¶”ê°€ ê·œì¹™ì„ ë§ˆì§€ë§‰ì— ì ìš©
                if (a.type === 'include' && b.type !== 'include') return 1;
                if (b.type === 'include' && a.type !== 'include') return -1;
                
                return 0;
            });
            
            console.log('ğŸ“‹ ê·œì¹™ ì ìš© ìˆœì„œ:', sortedRules.map(r => `${r.type}: ${r.original}`));
            
            let modifiedText = draftText;
            let appliedCount = 0;
            
            sortedRules.forEach((rule, index) => {
                const beforeText = modifiedText;
                modifiedText = applyFeedbackRule(modifiedText, rule);
                
                if (beforeText !== modifiedText) {
                    appliedCount++;
                    console.log(`âœ… ê·œì¹™ ${index + 1} ì ìš© ì™„ë£Œ: ${rule.type}`);
                } else {
                    console.log(`âš ï¸ ê·œì¹™ ${index + 1} ì ìš© íš¨ê³¼ ì—†ìŒ: ${rule.type}`);
                }
            });
            
            console.log(`ğŸ¯ ì´ ${appliedCount}ê°œ ê·œì¹™ì´ ì„±ê³µì ìœ¼ë¡œ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            
            return modifiedText;
        }
        
        // ê°œë³„ í”¼ë“œë°± ê·œì¹™ ì ìš© (ê°œì„ ëœ ë²„ì „)
        function applyFeedbackRule(text, rule) {
            console.log(`ğŸ”§ ê·œì¹™ ì ìš© ì¤‘: [${rule.type}] ${rule.original}`);
            let modifiedText = text;
            
            try {
                switch (rule.type) {
                    case 'exclude':
                        // êµ¬ì¡°ì  ì‚­ì œ ì²˜ë¦¬
                        if (rule.structuralDelete) {
                            const { sectionName, deleteType, scope } = rule.structuralDelete;
                            console.log(`ğŸ—ï¸ êµ¬ì¡°ì  ì‚­ì œ ì ìš©: ${sectionName} ${scope === 'below' ? 'ì´í›„ ëª¨ë“  ë‚´ìš©' : 'ì„¹ì…˜ë§Œ'} ì‚­ì œ`);
                            
                            if (scope === 'below') {
                                // í•´ë‹¹ ì„¹ì…˜ë¶€í„° ì•„ë˜ ëª¨ë“  ë‚´ìš© ì‚­ì œ
                                const sectionPatterns = [
                                    new RegExp(`3\\. í•„ìš”ì„±[\\s\\S]*?(?=ì´ìƒê³¼ ê°™ì´|$)`, 'gi'),
                                    new RegExp(`4\\. ê¸°íƒ€ì‚¬í•­[\\s\\S]*?(?=ì´ìƒê³¼ ê°™ì´|$)`, 'gi'),
                                    new RegExp(`\\d+\\. ${sectionName}[\\s\\S]*?(?=ì´ìƒê³¼ ê°™ì´|$)`, 'gi')
                                ];
                                
                                for (let sectionPattern of sectionPatterns) {
                                    if (modifiedText.match(sectionPattern)) {
                                        modifiedText = modifiedText.replace(sectionPattern, '');
                                        console.log(`âœ… êµ¬ì¡°ì  ì‚­ì œ ì ìš©ë¨: ${sectionName}ë¶€í„° ì•„ë˜ ëª¨ë“  ë‚´ìš© ì‚­ì œ`);
                                        break;
                                    }
                                }
                            } else {
                                // íŠ¹ì • ì„¹ì…˜ë§Œ ì‚­ì œ
                                const specificSectionPattern = new RegExp(`\\d+\\. ${sectionName}[\\s\\S]*?(?=\\n\\d+\\.|\\n\\nì´ìƒê³¼ ê°™ì´|$)`, 'gi');
                                modifiedText = modifiedText.replace(specificSectionPattern, '');
                                console.log(`âœ… êµ¬ì¡°ì  ì‚­ì œ ì ìš©ë¨: ${sectionName} ì„¹ì…˜ë§Œ ì‚­ì œ`);
                            }
                        } else {
                            // ê¸°ì¡´ í‚¤ì›Œë“œ ê¸°ë°˜ ì‚­ì œ ë¡œì§
                            if (rule.keywords && rule.keywords.length > 0) {
                                rule.keywords.forEach(keyword => {
                                    // í•´ë‹¹ í‚¤ì›Œë“œê°€ í¬í•¨ëœ ì¤„ ì „ì²´ ì œê±°
                                    const lineRegex = new RegExp(`.*${escapeRegex(keyword)}.*\\n?`, 'gi');
                                    modifiedText = modifiedText.replace(lineRegex, '');
                                    
                                    // í‚¤ì›Œë“œë§Œ ì œê±° (ì¤„ì€ ìœ ì§€)
                                    const wordRegex = new RegExp(escapeRegex(keyword), 'gi');
                                    modifiedText = modifiedText.replace(wordRegex, '');
                                });
                            }
                        }
                        break;
                        
                    case 'include':
                        // ë‚´ìš© ì¶”ê°€ - ê¸°íƒ€ì‚¬í•­ ì„¹ì…˜ì— ì¶”ê°€
                        if (rule.content) {
                            const sections = [
                                /4\. ê¸°íƒ€ì‚¬í•­\n   ([^\n]+)/,
                                /4\. ê¸°íƒ€ì‚¬í•­([^5]*?)(?=\n\n|$)/
                            ];
                            
                            for (let sectionRegex of sections) {
                                if (modifiedText.match(sectionRegex)) {
                                    modifiedText = modifiedText.replace(sectionRegex, (match) => {
                                        return match + `\n   ${rule.content}`;
                                    });
                                    break;
                                }
                            }
                            
                            // ê¸°íƒ€ì‚¬í•­ ì„¹ì…˜ì´ ì—†ìœ¼ë©´ ìƒˆë¡œ ì¶”ê°€
                            if (!modifiedText.includes('4. ê¸°íƒ€ì‚¬í•­')) {
                                const insertPoint = modifiedText.lastIndexOf('\nì´ìƒê³¼ ê°™ì´');
                                if (insertPoint !== -1) {
                                    modifiedText = modifiedText.slice(0, insertPoint) + 
                                                  `\n\n4. ê¸°íƒ€ì‚¬í•­\n   ${rule.content}` + 
                                                  modifiedText.slice(insertPoint);
                                }
                            }
                        }
                        break;
                        
                    case 'simplify':
                        // ê°„ì†Œí™” - ì—¬ëŸ¬ ì„¹ì…˜ ë‹¨ìˆœí™”
                        modifiedText = modifiedText.replace(
                            /3\. í•„ìš”ì„±\n   ([^4]+)/,
                            '3. í•„ìš”ì„±\n   ìƒê¸° ì‚¬ì•ˆì˜ ì²˜ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.\n\n'
                        );
                        
                        // ë¶€ê°€ ì„¤ëª… ì œê±°
                        modifiedText = modifiedText.replace(
                            /ì—…ë¬´ íš¨ìœ¨ì„± í–¥ìƒ ë° ì›í™œí•œ ì—…ë¬´ ìˆ˜í–‰ì„ ìœ„í•´ ìƒê¸° ë¬¼í’ˆì˜ êµ¬ë§¤ê°€ í•„ìš”í•©ë‹ˆë‹¤\./g,
                            'ìƒê¸° ë¬¼í’ˆì˜ êµ¬ë§¤ê°€ í•„ìš”í•©ë‹ˆë‹¤.'
                        );
                        
                        modifiedText = modifiedText.replace(
                            /ìƒê¸° ì‹œì„¤ì˜ ì‹ ì†í•œ ìˆ˜ë¦¬ë¥¼ í†µí•´ ì•ˆì „ì‚¬ê³ ë¥¼ ì˜ˆë°©í•˜ê³  ì›í™œí•œ ì‹œì„¤ ì´ìš©ì´ ê°€ëŠ¥í•˜ë„ë¡ ì¡°ì¹˜ê°€ í•„ìš”í•©ë‹ˆë‹¤\./g,
                            'ìƒê¸° ì‹œì„¤ì˜ ìˆ˜ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.'
                        );
                        break;
                        
                    case 'replace':
                        // ë‚´ìš© êµì²´
                        if (rule.content && rule.content.includes('â†’')) {
                            const [from, to] = rule.content.split('â†’');
                            if (from && to) {
                                const replaceRegex = new RegExp(escapeRegex(from.trim()), 'gi');
                                modifiedText = modifiedText.replace(replaceRegex, to.trim());
                            }
                        }
                        break;
                        
                    case 'formal':
                        // ê³µì‹í™” - ë” ê²©ì‹ìˆëŠ” í‘œí˜„ìœ¼ë¡œ ë³€ê²½
                        modifiedText = modifiedText.replace(/í•´ì£¼ì„¸ìš”/g, 'í•˜ì—¬ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤');
                        modifiedText = modifiedText.replace(/ìš”ì²­í•©ë‹ˆë‹¤/g, 'ìš”ì²­ë“œë¦½ë‹ˆë‹¤');
                        modifiedText = modifiedText.replace(/í•„ìš”í•©ë‹ˆë‹¤/g, 'í•„ìš”í•˜ì˜¤ë‹ˆ');
                        break;
                        
                    case 'general':
                        // ì¼ë°˜ ìš”ì²­ - ë¡œê·¸ë§Œ ë‚¨ê¸°ê³  í…ìŠ¤íŠ¸ëŠ” ê·¸ëŒ€ë¡œ
                        console.log('ğŸ“ ì¼ë°˜ ìš”ì²­ì‚¬í•­:', rule.content);
                        break;
                        
                    default:
                        console.log('â“ ì•Œ ìˆ˜ ì—†ëŠ” ê·œì¹™ íƒ€ì…:', rule.type);
                        break;
                }
                
                if (modifiedText !== text) {
                    console.log('âœ… ê·œì¹™ ì ìš© ì™„ë£Œ:', rule.type);
                } else {
                    console.log('âš ï¸ ê·œì¹™ ì ìš© íš¨ê³¼ ì—†ìŒ:', rule.type);
                }
                
            } catch (error) {
                console.error('âŒ ê·œì¹™ ì ìš© ì¤‘ ì˜¤ë¥˜:', error, rule);
            }
            
            return modifiedText;
        }
        
        // ì •ê·œì‹ íŠ¹ìˆ˜ë¬¸ì ì´ìŠ¤ì¼€ì´í”„
        function escapeRegex(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }
        
        // ìˆ˜ëŸ‰ ìŠ¤ë§ˆíŠ¸ í‘œì‹œ í•¨ìˆ˜
        function formatQuantity(quantity) {
            if (!quantity) return '-';
            
            const quantityStr = String(quantity).trim();
            
            // ì´ë¯¸ ë‹¨ìœ„ê°€ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
            const hasUnit = /[ê°€-í£]/.test(quantityStr) || // í•œê¸€ ë‹¨ìœ„
                           /(ê°œ|ë°•ìŠ¤|ì„¸íŠ¸|ë³‘|í†µ|ì¥|ê¶Œ|ëŒ€|ëª…|ê±´|íŒ©|í¬|ìº”|ë´‰|ìƒì|ë²Œ|ì¼¤ë ˆ|ìŒ|ë¬¶ìŒ|ë‹¤ë°œ|ì‹|ì¶©ë¶„|ë§ì´|ì¡°ê¸ˆ|ì•½ê°„)/.test(quantityStr);
            
            // ìˆ«ìë§Œ ìˆëŠ” ê²½ìš°ì—ë§Œ "ê°œ" ì¶”ê°€
            if (!hasUnit && /^\d+$/.test(quantityStr)) {
                return `${quantityStr}ê°œ`;
            }
            
            return quantityStr;
        }
        
        // êµ¬ë§¤ ìš”ì²­ ê¸°ì•ˆì„œ ìƒì„± (í¼ ë°ì´í„° ì‚¬ìš©)
        function generatePurchaseDraft() {
            const form = document.getElementById('purchase-form');
            const formData = new FormData(form);
            
// í¼ í•„ìˆ˜ í•„ë“œ í™•ì¸
const title = formData.get('title') || formData.get('item');
const item = formData.get('item');
const quantity = formData.get('quantity');
const budget = formData.get('budget');
const reason = formData.get('reason');
const requestedBy = formData.get('requestedBy');
const department = formData.get('department');
const priority = formData.get('priority') || 'ë³´í†µ';

if (!title || !item || !quantity || !budget || !reason || !requestedBy || !department) {
    alert('ëª¨ë“  í•„ìˆ˜ í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
}
            
            const quoteFile = document.getElementById('purchase-quote-file').files[0];
            
            const requestData = {
                title, item, quantity, reason, requestedBy, department, priority,
                quoteFile: !!quoteFile
            };
            
            // í”¼ë“œë°± ê·œì¹™ì´ ì ìš©ëœ ê¸°ì•ˆì„œ ìƒì„±
            const draftText = generateDraftWithRules(requestData, 'purchase');
            
            document.getElementById('purchase-draft-preview').textContent = draftText;
            
            const appliedRulesCount = feedbackRules.filter(r => r.target === 'purchase' || r.target === 'both').length;
            showAlert(`êµ¬ë§¤ ìš”ì²­ ê¸°ì•ˆì„œê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤! (${appliedRulesCount}ê°œ ê·œì¹™ ì ìš©ë¨)`, 'success');
        }
        
        // ì‹œì„¤ ê´€ë¦¬ ê¸°ì•ˆì„œ ìƒì„± (í¼ ë°ì´í„° ì‚¬ìš©)
        function generateFacilityDraft() {
            const form = document.getElementById('facility-form');
            const formData = new FormData(form);
            
            // í¼ í•„ìˆ˜ í•„ë“œ í™•ì¸
            const facility = formData.get('facility');
            const location = formData.get('location');
            const description = formData.get('description');
            const requestedBy = formData.get('requestedBy');
            const department = formData.get('department');
            const priority = formData.get('priority') || 'ë³´í†µ';
            const facilityType = formData.get('facilityType');
            
            if (!facility || !location || !description || !requestedBy || !department || !facilityType) {
                alert('ëª¨ë“  í•„ìˆ˜ í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const photos = document.getElementById('facility-photo').files;
            
            const requestData = {
                facility, location, description, requestedBy, department, priority, facilityType,
                facilityPhotos: Array.from(photos)
            };
            
            // í”¼ë“œë°± ê·œì¹™ì´ ì ìš©ëœ ê¸°ì•ˆì„œ ìƒì„±
            const draftText = generateDraftWithRules(requestData, 'facility');
            
            document.getElementById('facility-draft-preview').textContent = draftText;
            
            const appliedRulesCount = feedbackRules.filter(r => r.target === 'facility' || r.target === 'both').length;
            showAlert(`ì‹œì„¤ ê´€ë¦¬ ê¸°ì•ˆì„œê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤! (${appliedRulesCount}ê°œ ê·œì¹™ ì ìš©ë¨)`, 'success');
        }
        
        // êµ¬ë§¤ ìš”ì²­ ê¸°ì•ˆì„œ í´ë¦½ë³´ë“œ ë³µì‚¬
        function copyPurchaseDraftToClipboard() {
            const draftText = document.getElementById('purchase-draft-preview').textContent;
            if (!draftText || draftText.includes('ë²„íŠ¼ì„ í´ë¦­í•˜ë©´')) {
                alert('ë¨¼ì € ê¸°ì•ˆì„œë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            copyToClipboard(draftText, 'êµ¬ë§¤ ìš”ì²­ ê¸°ì•ˆì„œê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }
        
        // ì‹œì„¤ ê´€ë¦¬ ê¸°ì•ˆì„œ í´ë¦½ë³´ë“œ ë³µì‚¬
        function copyFacilityDraftToClipboard() {
            const draftText = document.getElementById('facility-draft-preview').textContent;
            if (!draftText || draftText.includes('ë²„íŠ¼ì„ í´ë¦­í•˜ë©´')) {
                alert('ë¨¼ì € ê¸°ì•ˆì„œë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            copyToClipboard(draftText, 'ì‹œì„¤ ê´€ë¦¬ ê¸°ì•ˆì„œê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }
        
        // êµ¬ë§¤ ìš”ì²­ ê¸°ì•ˆì„œ ì´ˆê¸°í™”
        function clearPurchaseDraft() {
            document.getElementById('purchase-draft-preview').textContent = 'ìœ„ì˜ "ê¸°ì•ˆì„œ ìƒì„±" ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ì…ë ¥í•˜ì‹  êµ¬ë§¤ ìš”ì²­ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ê¸°ì•ˆì„œê°€ ìë™ ìƒì„±ë©ë‹ˆë‹¤.';
            showAlert('ê¸°ì•ˆì„œê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
        }
        
        // ì‹œì„¤ ê´€ë¦¬ ê¸°ì•ˆì„œ ì´ˆê¸°í™”
        function clearFacilityDraft() {
            document.getElementById('facility-draft-preview').textContent = 'ìœ„ì˜ "ê¸°ì•ˆì„œ ìƒì„±" ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ì…ë ¥í•˜ì‹  ì‹œì„¤ ê´€ë¦¬ ìš”ì²­ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ê¸°ì•ˆì„œê°€ ìë™ ìƒì„±ë©ë‹ˆë‹¤.';
            showAlert('ê¸°ì•ˆì„œê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
        }
        
        // ë²”ìš© í´ë¦½ë³´ë“œ ë³µì‚¬ í•¨ìˆ˜
        function copyToClipboard(text, successMessage) {
            navigator.clipboard.writeText(text).then(() => {
                showAlert(successMessage, 'success');
            }).catch(() => {
                // í´ë¦½ë³´ë“œ API ì‹¤íŒ¨ ì‹œ ëŒ€ì•ˆ
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showAlert(successMessage, 'success');
            });
        }
        
        // í…œí”Œë¦¿ í•™ìŠµ í•¨ìˆ˜
        function learnTemplate() {
            const type = document.getElementById('template-type').value;
            const sampleText = document.getElementById('sample-template').value.trim();
            
            if (!sampleText) {
                alert('ê¸°ì•ˆì„œ ìƒ˜í”Œì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            try {
                // í…œí”Œë¦¿ ë¶„ì„ ë° ì €ì¥
                const templateData = analyzeTemplate(sampleText, type);
                
                if (!learnedTemplates[type]) {
                    learnedTemplates[type] = [];
                }
                
                learnedTemplates[type].push({
                    id: Date.now(),
                    sample: sampleText,
                    patterns: templateData,
                    createdAt: new Date().toISOString()
                });
                
                localStorage.setItem('learnedTemplates', JSON.stringify(learnedTemplates));
                
                document.getElementById('sample-template').value = '';
                displayLearnedTemplates();
                
                showAlert('í…œí”Œë¦¿ í•™ìŠµì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                
            } catch (error) {
                console.error('í…œí”Œë¦¿ í•™ìŠµ ì‹¤íŒ¨:', error);
                alert('í…œí”Œë¦¿ í•™ìŠµ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // í…œí”Œë¦¿ ë¶„ì„ í•¨ìˆ˜
        function analyzeTemplate(text, type) {
            // ê¸°ë³¸ íŒ¨í„´ ì¶”ì¶œ
            const patterns = {
                header: extractSection(text, ['ì œëª©', 'ê¸°ì•ˆì œëª©', 'ê±´ëª…']),
                purpose: extractSection(text, ['ëª©ì ', 'ì‚¬ìœ ', 'í•„ìš”ì„±']),
                content: extractSection(text, ['ë‚´ìš©', 'ì„¸ë¶€ì‚¬í•­', 'ìƒì„¸ë‚´ìš©']),
                budget: extractSection(text, ['ì˜ˆì‚°', 'ê¸ˆì•¡', 'ë¹„ìš©']),
                timeline: extractSection(text, ['ì¼ì •', 'ê¸°ê°„', 'ì™„ë£Œì˜ˆì •ì¼']),
                footer: extractSection(text, ['ì´ìƒ', 'ë¶™ì„', 'ë'])
            };
            
            return patterns;
        }
        
        // í…ìŠ¤íŠ¸ì—ì„œ íŠ¹ì • ì„¹ì…˜ ì¶”ì¶œ
        function extractSection(text, keywords) {
            for (let keyword of keywords) {
                const regex = new RegExp(`${keyword}[\\s\\S]*?(?=\\n\\n|$)`, 'i');
                const match = text.match(regex);
                if (match) {
                    return match[0];
                }
            }
            return '';
        }
        
        // í•™ìŠµëœ í…œí”Œë¦¿ ëª©ë¡ í‘œì‹œ
        function displayLearnedTemplates() {
            const container = document.getElementById('learned-templates');
            if (!container) return;
            
            const purchaseTemplates = learnedTemplates.purchase || [];
            const facilityTemplates = learnedTemplates.facility || [];
            
            if (purchaseTemplates.length === 0 && facilityTemplates.length === 0) {
                container.innerHTML = `
                    <div style="color: #6b7280; text-align: center; padding: 2rem;">
                        ì•„ì§ í•™ìŠµëœ í…œí”Œë¦¿ì´ ì—†ìŠµë‹ˆë‹¤. ìœ„ì—ì„œ ê¸°ì•ˆì„œ ìƒ˜í”Œì„ ì…ë ¥í•´ì£¼ì„¸ìš”.
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            if (purchaseTemplates.length > 0) {
                html += `
                    <div style="margin-bottom: 2rem;">
                        <h4 style="color: #22c55e; margin-bottom: 1rem;">ğŸ›’ êµ¬ë§¤ ìš”ì²­ í…œí”Œë¦¿ (${purchaseTemplates.length}ê°œ)</h4>
                        ${purchaseTemplates.map(template => `
                            <div style="background: white; padding: 1rem; border-radius: 8px; margin-bottom: 0.5rem; border-left: 4px solid #22c55e;">
                                <div style="font-size: 0.9rem; color: #6b7280;">
                                    í•™ìŠµì¼: ${new Date(template.createdAt).toLocaleDateString('ko-KR')}
                                    <button onclick="deleteTemplate('purchase', ${template.id})" style="float: right; background: #ef4444; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8rem;">ì‚­ì œ</button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            if (facilityTemplates.length > 0) {
                html += `
                    <div>
                        <h4 style="color: #2563eb; margin-bottom: 1rem;">ğŸ”§ ì‹œì„¤ ê´€ë¦¬ í…œí”Œë¦¿ (${facilityTemplates.length}ê°œ)</h4>
                        ${facilityTemplates.map(template => `
                            <div style="background: white; padding: 1rem; border-radius: 8px; margin-bottom: 0.5rem; border-left: 4px solid #2563eb;">
                                <div style="font-size: 0.9rem; color: #6b7280;">
                                    í•™ìŠµì¼: ${new Date(template.createdAt).toLocaleDateString('ko-KR')}
                                    <button onclick="deleteTemplate('facility', ${template.id})" style="float: right; background: #ef4444; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8rem;">ì‚­ì œ</button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }
        
        // í…œí”Œë¦¿ ì‚­ì œ
        function deleteTemplate(type, templateId) {
            if (!confirm('ì´ í…œí”Œë¦¿ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            learnedTemplates[type] = learnedTemplates[type].filter(t => t.id !== templateId);
            localStorage.setItem('learnedTemplates', JSON.stringify(learnedTemplates));
            displayLearnedTemplates();
            showAlert('í…œí”Œë¦¿ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        }
        
        // ê³ ê¸‰ ê²€ìƒ‰ ë° í•„í„°ë§
        function toggleAdvancedSearch() {
            const panel = document.getElementById('advanced-search-panel');
            const toggleText = document.getElementById('search-toggle-text');
            
            if (panel.style.display === 'none') {
                panel.style.display = 'block';
                toggleText.textContent = 'í•„í„° ë‹«ê¸°';
            } else {
                panel.style.display = 'none';
                toggleText.textContent = 'í•„í„° ì—´ê¸°';
            }
        }
        
        // ê³ ê¸‰ í•„í„° ì ìš©
        function applyAdvancedFilters() {
            const filters = getFilterValues();
            
            // ì „ì²´ ìš”ì²­ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const allRequests = [...purchaseRequests, ...facilityRequests].map(req => ({
                ...req,
                type: purchaseRequests.includes(req) ? 'purchase' : 'facility'
            }));
            
            // í•„í„° ì ìš©
            const filteredRequests = allRequests.filter(request => {
                // ë¶€ì„œ í•„í„°
                if (filters.department && request.department !== filters.department) {
                    return false;
                }
                
                // ë‹´ë‹¹ì í•„í„°
                if (filters.requester && !request.requestedBy.toLowerCase().includes(filters.requester.toLowerCase())) {
                    return false;
                }
                
                // ìƒíƒœ í•„í„°
                if (filters.status && request.status !== filters.status) {
                    return false;
                }
                
                // ìš°ì„ ìˆœìœ„ í•„í„°
                if (filters.priority && request.priority !== filters.priority) {
                    return false;
                }
                
                // ë‚ ì§œ ë²”ìœ„ í•„í„°
                if (filters.dateStart) {
                    const requestDate = new Date(request.createdAt);
                    const filterStart = new Date(filters.dateStart);
                    if (requestDate < filterStart) return false;
                }
                
                if (filters.dateEnd) {
                    const requestDate = new Date(request.createdAt);
                    const filterEnd = new Date(filters.dateEnd);
                    filterEnd.setHours(23, 59, 59); // í•˜ë£¨ ëê¹Œì§€ í¬í•¨
                    if (requestDate > filterEnd) return false;
                }
                
                // ì˜ˆì‚° ë²”ìœ„ í•„í„° (êµ¬ë§¤ ìš”ì²­ë§Œ)
                if (request.type === 'purchase' && (filters.budgetMin || filters.budgetMax)) {
                    const budget = request.estimatedBudget || 0;
                    if (filters.budgetMin && budget < filters.budgetMin) return false;
                    if (filters.budgetMax && budget > filters.budgetMax) return false;
                }
                
                return true;
            });
            
            // í•„í„°ëœ ê²°ê³¼ í‘œì‹œ
            updateFilteredResults(filteredRequests);
            
            showAlert(`${filteredRequests.length}ê°œì˜ ìš”ì²­ì´ í•„í„° ì¡°ê±´ì— ì¼ì¹˜í•©ë‹ˆë‹¤.`, 'success');
            
            console.log('í•„í„° ì ìš© ì™„ë£Œ:', {
                totalRequests: allRequests.length,
                filteredRequests: filteredRequests.length,
                filters: filters
            });
        }
        
        // í•„í„° ê°’ ê°€ì ¸ì˜¤ê¸°
        function getFilterValues() {
            return {
                department: document.getElementById('filter-department').value,
                requester: document.getElementById('filter-requester').value,
                status: document.getElementById('filter-status').value,
                priority: document.getElementById('filter-priority').value,
                budgetMin: parseInt(document.getElementById('filter-budget-min').value) || null,
                budgetMax: parseInt(document.getElementById('filter-budget-max').value) || null,
                dateStart: document.getElementById('filter-date-start').value,
                dateEnd: document.getElementById('filter-date-end').value
            };
        }
        
        // í•„í„°ëœ ê²°ê³¼ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateFilteredResults(filteredRequests) {
            const tableBody = document.querySelector('#admin-all-tab .requests-table tbody');
            if (!tableBody) return;
            
            // ê¸°ì¡´ í…Œì´ë¸” ë‚´ìš© í´ë¦¬ì–´
            tableBody.innerHTML = '';
            
            if (filteredRequests.length === 0) {
                const emptyRow = document.createElement('tr');
                emptyRow.innerHTML = `
                    <td colspan="10" style="text-align: center; padding: 3rem; color: #6b7280; font-style: italic;">
                        ğŸ” í•„í„° ì¡°ê±´ì— ë§ëŠ” ìš”ì²­ì´ ì—†ìŠµë‹ˆë‹¤.
                    </td>
                `;
                tableBody.appendChild(emptyRow);
                return;
            }
            
            // í•„í„°ëœ ìš”ì²­ë“¤ì„ í…Œì´ë¸”ì— ì¶”ê°€
            filteredRequests.forEach(request => {
                const row = document.createElement('tr');
                row.className = 'clickable-row';
                row.onclick = () => showRequestDetail(request);
                createAllRequestRow(row, request);
                tableBody.appendChild(row);
            });
            
            // í†µê³„ ì—…ë°ì´íŠ¸
            updateFilteredStats(filteredRequests);
        }
        
        // í•„í„°ëœ ë°ì´í„° í†µê³„ ì—…ë°ì´íŠ¸
        function updateFilteredStats(filteredRequests) {
            const stats = {
                waiting: filteredRequests.filter(r => r.status === 'ëŒ€ê¸°').length,
                progress: filteredRequests.filter(r => r.status === 'ì§„í–‰ì¤‘').length,
                completed: filteredRequests.filter(r => r.status === 'ì™„ë£Œ').length,
                cancelled: filteredRequests.filter(r => r.status === 'ì·¨ì†Œ').length
            };
            
            // í†µê³„ ì¹´ë“œ ì—…ë°ì´íŠ¸
            document.getElementById('stat-all-waiting').textContent = stats.waiting;
            document.getElementById('stat-all-progress').textContent = stats.progress;
            document.getElementById('stat-all-completed').textContent = stats.completed;
            document.getElementById('stat-all-cancelled').textContent = stats.cancelled;
        }
        
        // ê³ ê¸‰ í•„í„° ì´ˆê¸°í™”
        function resetAdvancedFilters() {
            // ëª¨ë“  í•„í„° ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            document.getElementById('filter-department').value = '';
            document.getElementById('filter-requester').value = '';
            document.getElementById('filter-status').value = '';
            document.getElementById('filter-priority').value = '';
            document.getElementById('filter-budget-min').value = '';
            document.getElementById('filter-budget-max').value = '';
            document.getElementById('filter-date-start').value = '';
            document.getElementById('filter-date-end').value = '';
            
            // ì›ë³¸ ë°ì´í„°ë¡œ ë³µì›
            loadAllRequests();
            
            showAlert('í•„í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        }
        
        // í•„í„°ëœ ë°ì´í„° Excel ë‚´ë³´ë‚´ê¸°
        function exportFilteredData() {
            const filters = getFilterValues();
            const hasActiveFilters = Object.values(filters).some(value => value !== null && value !== '');
            
            if (!hasActiveFilters) {
                showAlert('í•„í„°ë¥¼ ì ìš©í•œ í›„ Excel ë‚´ë³´ë‚´ê¸°ë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }
            
            // í˜„ì¬ í‘œì‹œëœ í•„í„°ëœ ë°ì´í„°ë¥¼ Excelë¡œ ë‚´ë³´ë‚´ê¸°
            const tableRows = document.querySelectorAll('#admin-all-tab .requests-table tbody tr');
            const data = [];
            
            tableRows.forEach(row => {
                const cells = row.querySelectorAll('td');
                if (cells.length > 1) { // ë¹ˆ ê²°ê³¼ í–‰ì´ ì•„ë‹Œ ê²½ìš°
                    data.push({
                        'ìœ í˜•': cells[0].textContent.trim(),
                        'ì œëª©/ë¬¼í’ˆ': cells[1].textContent.trim(),
                        'ìˆ˜ëŸ‰/ìœ„ì¹˜': cells[2].textContent.trim(),
                        'ìš°ì„ ìˆœìœ„': cells[3].textContent.trim(),
                        'ìƒíƒœ': cells[4].textContent.trim(),
                        'ìš”ì²­ì': cells[5].textContent.trim(),
                        'ë¶€ì„œ': cells[6].textContent.trim(),
                        'ë“±ë¡ì¼': cells[7].textContent.trim()
                    });
                }
            });
            
            if (data.length === 0) {
                showAlert('ë‚´ë³´ë‚¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                return;
            }
            
            // Excel íŒŒì¼ ìƒì„± ë° ë‹¤ìš´ë¡œë“œ
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.json_to_sheet(data);
            XLSX.utils.book_append_sheet(wb, ws, 'í•„í„°ëœ_ìš”ì²­_ëª©ë¡');
            
            const fileName = `í•„í„°ëœ_ìš”ì²­_ëª©ë¡_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, fileName);
            
            showAlert(`${data.length}ê°œì˜ í•„í„°ëœ ìš”ì²­ì´ Excel íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
        }

        // ==================== UX ê°œì„  ê¸°ëŠ¥ ====================
        
        // ë¡œë”© ì˜¤ë²„ë ˆì´ í‘œì‹œ/ìˆ¨ê¹€
        function showLoading(message = 'ì²˜ë¦¬ ì¤‘...') {
            const overlay = document.getElementById('loading-overlay');
            const messageEl = document.getElementById('loading-message');
            if (overlay && messageEl) {
                messageEl.textContent = message;
                overlay.classList.add('active');
            }
        }
        
        function hideLoading() {
            const overlay = document.getElementById('loading-overlay');
            if (overlay) {
                overlay.classList.remove('active');
            }
        }
        
        // ìë™ì™„ì„± ê¸°ëŠ¥
        const autocompleteData = {
            departments: ['ITíŒ€', 'ë§ˆì¼€íŒ…íŒ€', 'ì´ë¬´íŒ€', 'ì¸ì‚¬íŒ€', 'ì˜ì—…íŒ€', 'ê¸°íšíŒ€', 'ê°œë°œíŒ€', 'ë””ìì¸íŒ€', 'íšŒê³„íŒ€'],
            items: ['ë…¸íŠ¸ë¶', 'ë§ˆìš°ìŠ¤', 'í‚¤ë³´ë“œ', 'ëª¨ë‹ˆí„°', 'í”„ë¦°í„°', 'ë³µì‚¬ê¸°', 'ì±…ìƒ', 'ì˜ì', 'ì‚¬ë¬´ìš©í’ˆ', 'ìŠ¤í…Œì´í”ŒëŸ¬'],
            facilities: ['ì—ì–´ì»¨', 'í”„ë¡œì í„°', 'í™”ì´íŠ¸ë³´ë“œ', 'ì±…ìƒ', 'ì˜ì', 'ì¡°ëª…', 'ì˜¨ìˆ˜ê¸°', 'ì •ìˆ˜ê¸°', 'ì—˜ë¦¬ë² ì´í„°', 'í™”ì¥ì‹¤']
        };
        
        function initializeAutocomplete() {
            // ë¶€ì„œëª… ìë™ì™„ì„±
            addAutocomplete('purchase-department', autocompleteData.departments);
            addAutocomplete('facility-department', autocompleteData.departments);
            
            // ìš”ì²­ì ìë™ì™„ì„± (localStorageì—ì„œ ì´ì „ ì…ë ¥ ê¸°ë¡ ì‚¬ìš©)
            const previousRequesters = JSON.parse(localStorage.getItem('previousRequesters') || '[]');
            addAutocomplete('purchase-requested-by', previousRequesters);
            addAutocomplete('facility-requested-by', previousRequesters);
            
            // ë¬¼í’ˆëª… ìë™ì™„ì„±
            addAutocomplete('purchase-item', autocompleteData.items);
            
            // ì‹œì„¤ëª… ìë™ì™„ì„±
            addAutocomplete('facility-name', autocompleteData.facilities);
        }
        
        function addAutocomplete(inputId, suggestions) {
            const input = document.getElementById(inputId);
            if (!input) return;
            
            // ì»¨í…Œì´ë„ˆ ìƒì„±
            const container = document.createElement('div');
            container.className = 'autocomplete-container';
            input.parentNode.insertBefore(container, input);
            container.appendChild(input);
            
            // ë“œë¡­ë‹¤ìš´ ìƒì„±
            const dropdown = document.createElement('div');
            dropdown.className = 'autocomplete-dropdown';
            container.appendChild(dropdown);
            
            let selectedIndex = -1;
            
            input.addEventListener('input', function() {
                const value = this.value.toLowerCase();
                const matches = suggestions.filter(item => 
                    item.toLowerCase().includes(value)
                ).slice(0, 5);
                
                if (matches.length > 0 && value.length > 0) {
                    dropdown.innerHTML = matches.map((match, index) => 
                        `<div class="autocomplete-item" data-value="${match}">${match}</div>`
                    ).join('');
                    dropdown.classList.add('active');
                    selectedIndex = -1;
                } else {
                    dropdown.classList.remove('active');
                }
            });
            
            input.addEventListener('keydown', function(e) {
                const items = dropdown.querySelectorAll('.autocomplete-item');
                
                switch(e.key) {
                    case 'ArrowDown':
                        e.preventDefault();
                        selectedIndex = Math.min(selectedIndex + 1, items.length - 1);
                        updateSelection(items);
                        break;
                    case 'ArrowUp':
                        e.preventDefault();
                        selectedIndex = Math.max(selectedIndex - 1, -1);
                        updateSelection(items);
                        break;
                    case 'Enter':
                        e.preventDefault();
                        if (selectedIndex >= 0) {
                            this.value = items[selectedIndex].dataset.value;
                            dropdown.classList.remove('active');
                        }
                        break;
                    case 'Escape':
                        dropdown.classList.remove('active');
                        break;
                }
            });
            
            dropdown.addEventListener('click', function(e) {
                if (e.target.classList.contains('autocomplete-item')) {
                    input.value = e.target.dataset.value;
                    dropdown.classList.remove('active');
                }
            });
            
            function updateSelection(items) {
                items.forEach((item, index) => {
                    item.classList.toggle('selected', index === selectedIndex);
                });
            }
            
            // ì™¸ë¶€ í´ë¦­ ì‹œ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
            document.addEventListener('click', function(e) {
                if (!container.contains(e.target)) {
                    dropdown.classList.remove('active');
                }
            });
        }
        
        // ìš”ì²­ì ê¸°ë¡ ì €ì¥
        function saveRequesterHistory(requester) {
            if (!requester || requester.trim() === '') return;
            
            const history = JSON.parse(localStorage.getItem('previousRequesters') || '[]');
            if (!history.includes(requester)) {
                history.unshift(requester);
                // ìµœëŒ€ 10ê°œê¹Œì§€ë§Œ ì €ì¥
                if (history.length > 10) {
                    history.pop();
                }
                localStorage.setItem('previousRequesters', JSON.stringify(history));
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ UX ê°œì„  ê¸°ëŠ¥ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            initializeAutocomplete();
            
            // í˜ì´ì§€ ë¡œë“œ ì• ë‹ˆë©”ì´ì…˜
            document.body.style.opacity = '0';
            setTimeout(() => {
                document.body.style.transition = 'opacity 0.5s ease';
                document.body.style.opacity = '1';
            }, 100);
            
            console.log('ğŸ¨ UX ê°œì„  ê¸°ëŠ¥ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
        });
        
        // ==================== Firebase ì‹¤ì‹œê°„ ë°ì´í„°ë² ì´ìŠ¤ ====================
        
        // Firebase ì—°ê²° ìƒíƒœ
        let isFirebaseConnected = false;
        let firebaseRetryCount = 0;
        const MAX_RETRY_COUNT = 3;
        
        // Firebase ì´ˆê¸°í™” ëŒ€ê¸°
        async function waitForFirestore() {
            return new Promise((resolve) => {
                const checkFirestore = () => {
                    if (window.firebaseDB && window.firebaseAuth) {
                        resolve(true);
                    } else {
                        setTimeout(checkFirestore, 100);
                    }
                };
                checkFirestore();
            });
        }
        
        // Firebase ì¸ì¦ (ìµëª… ë¡œê·¸ì¸)
        async function initializeFirebaseAuth() {
            try {
                await waitForFirestore();
                const auth = window.firebaseAuth;
                
                // ìµëª… ë¡œê·¸ì¸
                await auth.signInAnonymously();
                isFirebaseConnected = true;
                
                console.log('ğŸ”¥ Firebase ì¸ì¦ ì™„ë£Œ');
                showSyncStatus('connected', 'ì‹¤ì‹œê°„ ë™ê¸°í™” ì—°ê²°ë¨');
                
                // ê¸°ì¡´ ë°ì´í„°ë¥¼ Firebaseë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜
                await migrateLocalDataToFirebase();
                
                // ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
                setupRealtimeListeners();
                
            } catch (error) {
                console.error('âŒ Firebase ì¸ì¦ ì‹¤íŒ¨:', error);
                handleFirebaseError(error);
            }
        }
        
        // ë¡œì»¬ ë°ì´í„°ë¥¼ Firebaseë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜
        async function migrateLocalDataToFirebase() {
            try {
                const localRequests = JSON.parse(localStorage.getItem('requests') || '[]');
                if (localRequests.length > 0) {
                    console.log('ğŸ“¦ ë¡œì»¬ ë°ì´í„°ë¥¼ Firebaseë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ ì¤‘...', localRequests.length, 'ê°œ');
                    
                    for (const request of localRequests) {
                        if (!request.firebaseId) {
                            await saveRequestToFirebase(request, false); // ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ë°©ì§€
                        }
                    }
                    
                    console.log('âœ… ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ');
                }
            } catch (error) {
                console.error('âŒ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤íŒ¨:', error);
            }
        }
        
        // ìš”ì²­ ë°ì´í„°ë¥¼ Firebaseì— ì €ì¥
        async function saveRequestToFirebase(requestData, shouldTriggerUpdate = true) {
            try {
                if (!isFirebaseConnected) {
                    throw new Error('Firebase ì—°ê²°ì´ ëŠì–´ì§');
                }
                
                const { addDoc, collection } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
                const db = window.firebaseDB;
                
                // Firestoreì— ì €ì¥
                const docRef = await addDoc(collection(db, 'requests'), {
                    ...requestData,
                    createdAt: requestData.createdAt || new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                });
                
                console.log('ğŸ”¥ Firebase ì €ì¥ ì™„ë£Œ:', docRef.id);
                
                // ë¡œì»¬ ë°ì´í„°ì— Firebase ID ì¶”ê°€
                const updatedRequest = { ...requestData, firebaseId: docRef.id };
                
                return docRef.id;
                
            } catch (error) {
                console.error('âŒ Firebase ì €ì¥ ì‹¤íŒ¨:', error);
                // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ë°±ì—… ì €ì¥
                saveToLocalStorage(requestData);
                showSyncStatus('error', 'Firebase ì €ì¥ ì‹¤íŒ¨, ë¡œì»¬ì— ë°±ì—…ë¨');
                throw error;
            }
        }
        
        // Firebaseì—ì„œ ìš”ì²­ ìƒíƒœ ì—…ë°ì´íŠ¸
        async function updateRequestInFirebase(firebaseId, updates) {
            try {
                if (!isFirebaseConnected || !firebaseId) {
                    throw new Error('Firebase ì—°ê²° ë˜ëŠ” ID ì—†ìŒ');
                }
                
                const { doc, updateDoc } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
                const db = window.firebaseDB;
                
                await updateDoc(doc(db, 'requests', firebaseId), {
                    ...updates,
                    updatedAt: new Date().toISOString()
                });
                
                console.log('ğŸ”¥ Firebase ì—…ë°ì´íŠ¸ ì™„ë£Œ:', firebaseId);
                
            } catch (error) {
                console.error('âŒ Firebase ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
                showSyncStatus('error', 'Firebase ì—…ë°ì´íŠ¸ ì‹¤íŒ¨');
                throw error;
            }
        }
        
        // ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        async function setupRealtimeListeners() {
            try {
                const { collection, query, orderBy, onSnapshot } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
                const db = window.firebaseDB;
                
                const q = query(collection(db, 'requests'), orderBy('createdAt', 'desc'));
                
                // ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ
                onSnapshot(q, (snapshot) => {
                    const updatedRequests = [];
                    snapshot.forEach((doc) => {
                        updatedRequests.push({
                            firebaseId: doc.id,
                            ...doc.data()
                        });
                    });
                    
                    console.log('ğŸ”¥ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸:', updatedRequests.length, 'ê°œ');
                    
                    // ì „ì—­ ìš”ì²­ ë°°ì—´ ì—…ë°ì´íŠ¸
                    requests = updatedRequests;
                    
                    // UI ì—…ë°ì´íŠ¸
                    if (isAdmin) {
                        refreshAdminUI();
                    }
                    
                    showSyncStatus('synced', `${updatedRequests.length}ê°œ ìš”ì²­ ë™ê¸°í™”ë¨`);
                }, (error) => {
                    console.error('âŒ ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ ì˜¤ë¥˜:', error);
                    showSyncStatus('error', 'ì‹¤ì‹œê°„ ë™ê¸°í™” ì˜¤ë¥˜');
                });
                
            } catch (error) {
                console.error('âŒ ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì‹¤íŒ¨:', error);
            }
        }
        
        // ê´€ë¦¬ì UI ìƒˆë¡œê³ ì¹¨
        function refreshAdminUI() {
            if (document.getElementById('admin-all-tab')?.style.display !== 'none') {
                loadAllRequests();
            }
            if (document.getElementById('admin-purchase-tab')?.style.display !== 'none') {
                loadPurchaseRequests();
            }
            if (document.getElementById('admin-facility-tab')?.style.display !== 'none') {
                loadFacilityRequests();
            }
            updateAllStats();
        }
        
        // ë™ê¸°í™” ìƒíƒœ í‘œì‹œ
        function showSyncStatus(status, message) {
            const statusDiv = document.getElementById('sync-status');
            if (!statusDiv) return;
            
            const icons = {
                'connecting': 'ğŸ”„',
                'connected': 'ğŸŸ¢',
                'synced': 'âœ…',
                'error': 'ğŸ”´',
                'offline': 'âš«'
            };
            
            const colors = {
                'connecting': '#f59e0b',
                'connected': '#22c55e',
                'synced': '#10b981',
                'error': '#ef4444',
                'offline': '#6b7280'
            };
            
            statusDiv.innerHTML = `
                <span style="color: ${colors[status]};">${icons[status]}</span>
                <span style="font-size: 0.8rem; margin-left: 0.25rem;">${message}</span>
            `;
        }
        
        // Firebase ì˜¤ë¥˜ ì²˜ë¦¬
        function handleFirebaseError(error) {
            firebaseRetryCount++;
            
            if (firebaseRetryCount <= MAX_RETRY_COUNT) {
                console.log(`ğŸ”„ Firebase ì¬ì—°ê²° ì‹œë„ ${firebaseRetryCount}/${MAX_RETRY_COUNT}`);
                showSyncStatus('connecting', `ì¬ì—°ê²° ì¤‘... (${firebaseRetryCount}/${MAX_RETRY_COUNT})`);
                
                setTimeout(() => {
                    initializeFirebaseAuth();
                }, 2000 * firebaseRetryCount);
            } else {
                console.log('âŒ Firebase ì—°ê²° í¬ê¸°, ì˜¤í”„ë¼ì¸ ëª¨ë“œë¡œ ì „í™˜');
                showSyncStatus('offline', 'ì˜¤í”„ë¼ì¸ ëª¨ë“œ (ë¡œì»¬ ì €ì¥)');
                isFirebaseConnected = false;
            }
        }
        
        // ë¡œì»¬ ë°±ì—… ê¸°ëŠ¥
        function saveToLocalStorage(data) {
            try {
                const localData = JSON.parse(localStorage.getItem('requests_backup') || '[]');
                localData.unshift(data);
                localStorage.setItem('requests_backup', JSON.stringify(localData));
            } catch (error) {
                console.error('âŒ ë¡œì»¬ ì €ì¥ ì‹¤íŒ¨:', error);
            }
        }
        
                    // í˜ì´ì§€ ë¡œë“œ ì‹œ Firebase ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            // Service Worker ë“±ë¡
            registerServiceWorker();
            
            // Firebase ì—°ê²° ì‹œë„
            setTimeout(() => {
                initializeFirebaseAuth();
            }, 500);
            
            // ë„¤íŠ¸ì›Œí¬ ìƒíƒœ ëª¨ë‹ˆí„°ë§
            window.addEventListener('online', function() {
                console.log('ğŸŒ ë„¤íŠ¸ì›Œí¬ ì—°ê²°ë¨');
                if (!isFirebaseConnected) {
                    initializeFirebaseAuth();
                }
            });
            
            window.addEventListener('offline', function() {
                console.log('ğŸ“± ì˜¤í”„ë¼ì¸ ìƒíƒœ');
                showSyncStatus('offline', 'ì˜¤í”„ë¼ì¸ ëª¨ë“œ');
                isFirebaseConnected = false;
            });
            
            // PWA ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ ì²˜ë¦¬
            setupPWAInstallPrompt();
        });
        
        // ==================== PWA ë° Service Worker ====================
        
        // Service Worker ë“±ë¡
        async function registerServiceWorker() {
            if ('serviceWorker' in navigator) {
                try {
                    const registration = await navigator.serviceWorker.register('/sw.js');
                    console.log('âœ… Service Worker ë“±ë¡ ì„±ê³µ:', registration.scope);
                    
                    // ì—…ë°ì´íŠ¸ í™•ì¸
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                // ìƒˆ ë²„ì „ ì‚¬ìš© ê°€ëŠ¥
                                showUpdateAvailablePrompt();
                            }
                        });
                    });
                    
                } catch (error) {
                    console.error('âŒ Service Worker ë“±ë¡ ì‹¤íŒ¨:', error);
                }
            } else {
                console.log('ğŸš« ì´ ë¸Œë¼ìš°ì €ëŠ” Service Workerë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
            }
        }
        
        // PWA ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ ì„¤ì •
        function setupPWAInstallPrompt() {
            let deferredPrompt;
            
            window.addEventListener('beforeinstallprompt', (e) => {
                console.log('ğŸ“± PWA ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ ì¤€ë¹„');
                e.preventDefault();
                deferredPrompt = e;
                
                // ì„¤ì¹˜ ë²„íŠ¼ í‘œì‹œ (í—¤ë”ì— ì¶”ê°€)
                showInstallButton(deferredPrompt);
            });
            
            window.addEventListener('appinstalled', (evt) => {
                console.log('ğŸ‰ PWA ì„¤ì¹˜ ì™„ë£Œ');
                showAlert('ì•±ì´ ì„±ê³µì ìœ¼ë¡œ ì„¤ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                hideInstallButton();
            });
        }
        
        // ì„¤ì¹˜ ë²„íŠ¼ í‘œì‹œ
        function showInstallButton(deferredPrompt) {
            const syncStatus = document.getElementById('sync-status');
            if (!syncStatus) return;
            
            const installBtn = document.createElement('button');
            installBtn.id = 'install-btn';
            installBtn.innerHTML = 'ğŸ“± ì•± ì„¤ì¹˜';
            installBtn.style.cssText = `
                margin-left: 1rem;
                padding: 0.5rem 1rem;
                background: #10b981;
                color: white;
                border: none;
                border-radius: 20px;
                font-size: 0.8rem;
                cursor: pointer;
                transition: all 0.3s ease;
            `;
            
            installBtn.onclick = async () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    console.log('PWA ì„¤ì¹˜ ì„ íƒ:', outcome);
                    deferredPrompt = null;
                    hideInstallButton();
                }
            };
            
            syncStatus.parentElement.appendChild(installBtn);
        }
        
        // ì„¤ì¹˜ ë²„íŠ¼ ìˆ¨ê¸°ê¸°
        function hideInstallButton() {
            const installBtn = document.getElementById('install-btn');
            if (installBtn) {
                installBtn.remove();
            }
        }
        
        // ì—…ë°ì´íŠ¸ ì‚¬ìš© ê°€ëŠ¥ í”„ë¡¬í”„íŠ¸
        function showUpdateAvailablePrompt() {
            const updatePrompt = confirm(
                'ìƒˆë¡œìš´ ë²„ì „ì´ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.\ní˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ ì—…ë°ì´íŠ¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?'
            );
            
            if (updatePrompt) {
                // Service Workerì—ê²Œ skipWaiting ì‹ í˜¸ ì „ì†¡
                if (navigator.serviceWorker.controller) {
                    navigator.serviceWorker.controller.postMessage({ type: 'SKIP_WAITING' });
                }
                window.location.reload();
            }
        }
        
        // Service Worker ë©”ì‹œì§€ ìˆ˜ì‹ 
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.addEventListener('message', event => {
                console.log('ğŸ’¬ Service Worker ë©”ì‹œì§€:', event.data);
                
                if (event.data.type === 'SYNC_LOCAL_DATA') {
                    // ë°±ê·¸ë¼ìš´ë“œ ë™ê¸°í™”ëœ ë°ì´í„° ì²˜ë¦¬
                    console.log('ğŸ”„ ë°±ê·¸ë¼ìš´ë“œ ë™ê¸°í™” ë°ì´í„° ìˆ˜ì‹ ');
                    // í•„ìš” ì‹œ UI ì—…ë°ì´íŠ¸
                }
            });
        }

    </script>

    <!-- SheetJS ë¼ì´ë¸ŒëŸ¬ë¦¬ (Excel íŒŒì¼ ìƒì„±ìš©) -->
    <script src="https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

</body>
</html> 
```
</rewritten_
